(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-1615cf38"],{"36be":function(e,t,a){"use strict";a("6ebf")},"6ebf":function(e,t,a){},abda:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ec-container",{attrs:{height:"100%"}},[a("ec-container-header",[a("ec-panel-item",[a("ec-panel-item-left",[a("ec-header",{attrs:{title:"收购码包分配领用",icon:"onetomany","color-code":"008"}})],1)],1)],1),a("ec-container-body",[a("ec-panel",{attrs:{auto:!1}},[a("ec-panel-toolbar",[a("a-descriptions",{attrs:{bordered:"",column:4}},[a("a-descriptions-item",{attrs:{label:"调拨年度"}},[e._v(" "+e._s(this.nowYear)+" ")]),a("a-descriptions-item",{attrs:{label:"烟叶类型"}},[e._v(" "+e._s(this.leafTypeName))]),a("a-descriptions-item",{attrs:{label:"省计划总量"}},[e._v(" "+e._s(e.totalData.planTotalWeight)+" ")]),a("a-descriptions-item",{attrs:{label:"省剩余计划总量"}},[e._v(" "+e._s(e.totalData.leftWeight)+" ")]),a("a-descriptions-item",{attrs:{label:"省申请码包数量"}},[e._v(" "+e._s(e.totalData.applyNum)+" ")]),a("a-descriptions-item",{attrs:{label:"省分配码包数量"}},[e._v(" "+e._s(e.totalData.allotNum)+" ")]),a("a-descriptions-item",{attrs:{label:"省领用码包数量"}},[e._v(" "+e._s(e.totalData.collectNum)+" ")]),a("a-descriptions-item",{attrs:{label:""}})],1)],1),a("ec-panel-toolbar",[a("ec-query-panel",{attrs:{defaultFold:!0},on:{query:function(t){return e.$refs.table.pageAction(1)},reset:e.onReset}},[a("ec-query-item",{attrs:{label:"领用单位"}},[a("select-picker",{attrs:{title:"选择领用单位",lazy:!1,search:!1,fetchData:e.onFetchBusinessOrgList},on:{ok:e.handleLevelEk},model:{value:e.queryItems.applyOrgCode,callback:function(t){e.$set(e.queryItems,"applyOrgCode",t)},expression:"queryItems.applyOrgCode"}})],1),a("ec-query-item",{attrs:{label:"烟叶类型"}},[a("ec-select",{attrs:{showSearch:"",allowClear:"",placeholder:"请选择"},on:{select:e.handleVisibleTypeName},model:{value:e.queryItems.leafTypeCode,callback:function(t){e.$set(e.queryItems,"leafTypeCode",t)},expression:"queryItems.leafTypeCode"}},e._l(e.leafTypeList,(function(t){return a("a-select-option",{key:t.leafTypeCode},[e._v(" "+e._s(t.leafTypeName)+" ")])})),1)],1)],1),a("ec-divider")],1),a("ec-panel-header",[a("ec-panel-item",[a("ec-panel-item-right",[a("a-space",{attrs:{size:15}},[a("span",[e._v("重量单位："),a("ec-select",{staticStyle:{width:"150px"},attrs:{showSearch:"",allowClear:"",placeholder:"请选择"},on:{select:e.handleUnitParse},model:{value:e.weightUnit,callback:function(t){e.weightUnit=t},expression:"weightUnit"}},e._l(e.weightUnitList,(function(t){return a("a-select-option",{key:t.weightUnitCd},[e._v(" "+e._s(t.weightUnitName)+" ")])})),1)],1)])],1)],1)],1),a("ec-panel-body",[a("ec-table",{ref:"table",attrs:{border:"",height:"100%",auto:!1,pagination:e.pagination,data:e.tableData.rows,loading:e.loading,"highlight-current-row":""},on:{"page-action":e.handlePagination,"checkbox-all":e.selectAllEvent,"checkbox-change":e.selectRowChange}},[a("ec-table-col",{attrs:{type:"checkbox",width:"50",align:"center"}}),a("ec-table-col",{attrs:{title:"序号",type:"seq",width:"70",align:"center"}}),a("ec-table-col",{attrs:{field:"applyOrgName",title:"领用单位",align:"left","min-width":"150"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;return[a("a-button",{attrs:{type:"link"},on:{click:function(t){return e.handleDrillData(i)}}},[e._v(e._s(i.applyOrgName))])]}}])}),a("ec-table-col",{attrs:{field:"planTotalWeight",title:"计划量",align:"right","min-width":"150"}}),a("ec-table-col",{attrs:{field:"leftWeight",title:"剩余计划量",align:"right","min-width":"150"}}),a("ec-table-col",{attrs:{field:"applyNum",title:"申请码包数量",align:"right","min-width":"150"}}),a("ec-table-col",{attrs:{field:"allotNum",title:"分配码包数量",align:"right","min-width":"150"}}),a("ec-table-col",{attrs:{field:"collectNum",title:"领用码包数量",align:"right","min-width":"150"}}),a("ec-table-col",{attrs:{title:"操作",align:"center",width:"150",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;return[a("a-button",{attrs:{type:"link"},on:{click:function(t){return e.onDetail(i)}}},[e._v("详细")])]}}])})],1)],1)],1),a("receive-detail",{ref:"ReceiveDetail"})],1)],1)},l=[],n=a("c7eb"),o=a("1da1"),r=(a("6198"),a("6fc0")),s=a.n(r),c=(a("d3b7"),a("a9e3"),a("e9c4"),a("159b"),a("b680"),a("99af"),a("7db0"),function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ec-drawer",{staticClass:"ec-draw-form",attrs:{title:"详细",visible:e.visible,size:"large"},on:{close:e.onclose}},[a("ec-container",{attrs:{height:"100%"}},[a("ec-container-header",[a("ec-panel-item",[a("ec-panel-item-left",[a("ec-header",{attrs:{title:"明细信息",icon:"onetomany","color-code":"008"}})],1)],1)],1),a("ec-container-body",[a("ec-panel",[a("ec-panel-body",[a("ec-v-layout",[a("ec-v-item",[a("ec-table",{ref:"table",attrs:{border:"",data:e.tableData,loading:e.loading,"row-select":"","show-footer":"","footer-method":e.footerMethod}},[a("ec-table-col",{attrs:{title:"序号",type:"seq",width:"70",align:"center"}}),a("ec-table-col",{attrs:{field:"applyOrgName",title:"领用单位",align:"left","min-width":"180"}}),a("ec-table-col",{attrs:{field:"leafTypeName",title:"烟叶类型",align:"right","min-width":"150"}}),a("ec-table-col",{attrs:{field:"packType",title:"包装类型",align:"left",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;return e._l(e.packTypeList,(function(t){return a("div",{key:t.enumKey},[i.packType===t.enumKey?a("span",[e._v(" "+e._s(t.name))]):e._e()])}))}}])}),a("ec-table-col",{attrs:{field:"spec",title:"包装规格（KG/件）",align:"right",width:"150"}}),a("ec-table-col",{attrs:{field:"collectNum",title:"领用码包数量",align:"right",width:"150"}})],1)],1)],1)],1)],1)],1),a("ec-container-footer",{attrs:{fixed:""}},[a("a-space",[a("a-button",{on:{click:e.onclose}},[e._v("关闭")])],1)],1)],1)],1)}),p=[],d=(a("d81d"),a("caad"),{name:"ExecutionEnterManage",components:{},data:function(){return{visible:!1,queryItems:{leafTypeCode:"10",submitStateFlag:!0,busiYear:""},nowYear:"",loading:!1,leafTypeCd:"",leafTypeList:[{leafTypeCode:"10",leafTypeName:"烤烟"},{leafTypeCode:"20",leafTypeName:"晾晒烟(全部)"},{leafTypeCode:"2013",leafTypeName:"晾晒烟(雪茄烟叶)"}],oldDataRow:[],orgCode:"",weightUnitList:[{weightUnitCd:1,weightUnitName:"公斤",isSelected:!1},{weightUnitCd:50,weightUnitName:"担",isSelected:!1},{weightUnitCd:5e5,weightUnitName:"万担",isSelected:!1}],packTypeList:[],tableData:{rows:[]}}},created:function(){var e=this.$router.history.current.query.appCode;this.appCode=e||"CM"},methods:{show:function(e){this.visible=!0;var t=e.tableData||[];this.tableData=t,this.packTypeList=e.packTypeList||[]},sumNum:function(e,t){var a=0;return e.forEach((function(e){a+=Number(e[t])})),a.toFixed(2)},footerMethod:function(e){var t=this,a=e.columns,i=e.data;return[a.map((function(e,a){return 0===a?"合计":["collectNum"].includes(e.property)?t.sumNum(i,e.property):null}))]},onclose:function(){this.tableData=[],this.visible=!1}}}),u=d,f=a("2877"),h=Object(f["a"])(u,c,p,!1,null,null,null),g=h.exports,y=a("6ea6"),m=a("2ef0"),b=a.n(m),v={name:"ExecutionManage",components:{ReceiveDetail:g,SelectPicker:s.a},data:function(){return{objectData:{},busiYear:"",flag:!1,queryItems:{applyOrgCode:void 0,leafTypeCode:"",packType:"",spec:"",applyState:""},isVisible:!0,weightUnit:1,nowYear:"",loading:!1,leafTypeCd:"",leafTypeList:[],oldLeafTypeList:[],oldDataRow:[],oldTotalData:[],totalData:{},leafTypeName:"",beforeLeafTypeName:"",businesOrgCodeTemp:void 0,levelCodeObj:{1:"country",2:"prov",3:"citc",4:"couc",5:"stac",6:"sstc"},weightUnitList:[{weightUnitCd:1,weightUnitName:"公斤",isSelected:!1},{weightUnitCd:50,weightUnitName:"担",isSelected:!1}],orgLevelEk:"",isDrill:!1,defaultOrgLevelEk:"",changeTreeOrgLevelEk:"",orgCodeList:[],packTypeList:[],businessOrgList:[],replaceFields:{pkey:"parentBizCode",title:"orgName",key:"bizCode",children:"children"},userInfo:{},orgCode:"",params:{},bizCode:"",pagination:{pageNumber:1,pageSize:10,total:0},tableData:{rows:[]}}},computed:{appConfig:function(){return this.$store.getters.getAppConfig}},created:function(){var e=this;return Object(o["a"])(Object(n["a"])().mark((function t(){var a,i,l,o,r,s,c,p,d,u,f,h,g,y,m;return Object(n["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return u=e.$router.history.current.query.appCode,e.appCode=u||"CM",f=["PC_PACK_TYPE"],h={enumTypeCodes:f},t.next=6,e.$apis.enum.index.getEnumType(h);case 6:return g=t.sent,y=(null===g||void 0===g?void 0:g.enumMap)||{},m=(null===y||void 0===y?void 0:y.PC_PACK_TYPE)||[],e.packTypeList=m,e.bizCode=null===(a=e.appConfig)||void 0===a?void 0:a.bizCode,e.orgCode=null===(i=e.appConfig)||void 0===i?void 0:i.orgCode,e.orgName=null===(l=e.appConfig)||void 0===l?void 0:l.orgName,e.queryItems.tranYear=null===(o=e.appConfig)||void 0===o||null===(r=o.yearValueMap)||void 0===r?void 0:r.SM_YEAR,e.nowYear=null===(s=e.appConfig)||void 0===s||null===(c=s.yearValueMap)||void 0===c?void 0:c.SM_YEAR,e.visibleTranYear=null===(p=e.appConfig)||void 0===p||null===(d=p.yearValueMap)||void 0===d?void 0:d.SM_YEAR,t.next=18,e.handleQueryBusinessOrgList();case 18:e.queryItems.applyOrgCode=e.bizCode;case 19:case"end":return t.stop()}}),t)})))()},methods:{handleQueryBusinessOrgList:function(){var e=this;return Object(o["a"])(Object(n["a"])().mark((function t(){var a,i;return Object(n["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a={busiYear:e.nowYear,orgTypeEk:"TOBACCO",orgLevelEk:"6",parentBizCode:e.bizCode},t.next=3,e.$apis.common.index.queryTreeByCode(a);case 3:i=t.sent,e.businessOrgList=i.rows||[];case 5:case"end":return t.stop()}}),t)})))()},onFetchBusinessOrgList:function(){var e=this;return new Promise((function(t){var a=Object(y["treeFormatList"])(e.businessOrgList,e.replaceFields);t(a)}))},handleDrillData:function(e){var t=this.orgLevelEk;if(Number(t)<6){var a=Number(this.orgLevelEk)+1;this.orgLevelEk=a,console.log("钻取前：".concat(this.drillApplyOrgCode)),this.drillApplyOrgCode=e.applyOrgCode,console.log("钻取后：".concat(this.drillApplyOrgCode)),this.isDrill=!0,this.onQuery()}else this.$message.error("末级无法继续钻取！")},handleVisibleTypeName:function(){this.beforeLeafTypeName=this.handleLeafTypeName(this.queryItems.leafTypeCode)},handleUnitParse:function(){var e=this,t=JSON.parse(JSON.stringify(this.oldDataRow));t.forEach((function(t){var a=t;a.planTotalWeight=(t.planTotalWeight/e.weightUnit).toFixed(2),a.leftWeight=(t.leftWeight/e.weightUnit).toFixed(2)}));var a=JSON.parse(JSON.stringify(this.oldTotalData));a.planTotalWeight=(a.planTotalWeight/this.weightUnit).toFixed(2),a.leftWeight=(a.leftWeight/this.weightUnit).toFixed(2),this.totalData=a,this.tableData.rows=t},handlePagination:function(e,t){var a=this;return Object(o["a"])(Object(n["a"])().mark((function i(){return Object(n["a"])().wrap((function(i){while(1)switch(i.prev=i.next){case 0:return a.pagination.pageNumber=e,a.pagination.pageSize=t,a.orgLevelEk=a.changeTreeOrgLevelEk,i.next=5,a.handleGetLeafTypeList();case 5:case"end":return i.stop()}}),i)})))()},handleGetLeafTypeList:function(){var e=this;return Object(o["a"])(Object(n["a"])().mark((function t(){var a,i,l,o;return Object(n["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(null!==(a=e.leafTypeList)&&void 0!==a&&a.length){t.next=9;break}return t.next=3,e.$apis.common.index.queryLeafType({});case 3:i=t.sent,l=(null===i||void 0===i?void 0:i.rows)||[],e.oldLeafTypeList=b.a.cloneDeep(l),l&&l.length>0&&l.unshift({leafTypeName:"全部",leafTypeCode:""}),e.leafTypeList=l,e.leafTypeList.some((function(t){return"烤烟"===t.leafTypeName&&(e.leafTypeCd=t.leafTypeCode,e.queryItems.leafTypeCode=t.leafTypeCode,e.leafTypeName="烤烟",!0)}));case 9:e.queryItems.leafTypeCode||(o=e.leafTypeList[0].leafTypeCode,e.leafTypeCd=o,e.queryItems.leafTypeCode=o,e.leafTypeName=e.leafTypeList[0].leafTypeName),e.onQuery();case 11:case"end":return t.stop()}}),t)})))()},handleLevelEk:function(e){var t=null===e||void 0===e?void 0:e.selectOption[0].orgLevel;this.changeTreeOrgLevelEk=t,console.log("orgLevelEk:".concat(t))},onQuery:function(){var e=this;return Object(o["a"])(Object(n["a"])().mark((function t(){var a,i,l,o,r,s,c;return Object(n["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.leafTypeName=e.beforeLeafTypeName||e.leafTypeName,e.loading=!0,a=e.isDrill?e.orgLevelEk:e.changeTreeOrgLevelEk,e.isVisible="1"===a,console.log(e.isVisible),i=e.levelCodeObj[a],l="1"===a,o={pageNo:e.pagination.pageNumber,pageSize:e.pagination.pageSize,leafTypeCode:e.queryItems.leafTypeCode,applyOrgCode:e.isDrill?e.drillApplyOrgCode:e.queryItems.applyOrgCode,tranYear:e.nowYear,applyType:"BU_CP",leafFormCode:"101",flag:l,levelCode:i},console.log("".concat(JSON.stringify(o),";orgLevelEk:").concat(e.orgLevelEk)),t.next=11,e.$apis.pcm.buy.packReceive.query(o).then((function(t){var a=t.rows||[];e.pagination.total=t.totalRows,e.oldDataRow=JSON.parse(JSON.stringify(a))})).catch((function(e){console.log(e)})).finally((function(){e.loading=!1,e.selectedRows=[]}));case 11:return r={leafTypeCode:e.queryItems.leafTypeCode,applyOrgCode:e.isDrill?e.drillApplyOrgCode:e.queryItems.applyOrgCode,leafFormCode:"101",tranYear:e.nowYear,applyType:"BU_CP",flag:l,levelCode:i},e.params=r,t.next=15,e.$apis.pcm.buy.packReceive.queryTotalData(r);case 15:s=t.sent,e.isDrill=!1,e.drillApplyOrgCode="",console.log("汇总数据：".concat(JSON.stringify(s))),e.oldTotalData=JSON.parse(JSON.stringify(s)),e.handleUnitParse(),c=["planTotalWeight","leftWeight","applyNum","allotNum"],"1"===e.orgLevelEk?c.forEach((function(t){e.$refs.table.showColumn(e.$refs.table.getColumnByField(t))})):c.forEach((function(t){e.$refs.table.hideColumn(e.$refs.table.getColumnByField(t))}));case 23:case"end":return t.stop()}}),t)})))()},onDetail:function(e){var t=this;return Object(o["a"])(Object(n["a"])().mark((function a(){var i,l,o;return Object(n["a"])().wrap((function(a){while(1)switch(a.prev=a.next){case 0:return i=t.params,i.applyOrgCode=e.applyOrgCode,a.next=4,t.$apis.pcm.buy.packReceive.queryDetail(i);case 4:l=a.sent,console.log(i),o={tableData:l,packTypeList:t.packTypeList},t.$refs.ReceiveDetail.show(o);case 8:case"end":return a.stop()}}),a)})))()},onReset:function(){this.queryItems.leafTypeCode=this.leafTypeCd,this.queryItems.applyOrgCode=this.orgCode,this.queryItems.submitState="",this.queryItems.auditState="",this.queryItems.oprType="",this.queryItems.remark="",this.queryItems.orgName="",this.handleVisibleTypeName(),this.leafTypeName=this.beforeLeafTypeName||this.leafTypeName,this.orgLevelEk=this.defaultOrgLevelEk,this.changeTreeOrgLevelEk=this.orgLevelEk,console.log("----".concat(JSON.stringify(this.orgLevelEk))),this.$refs.table.pageAction(1)},handleLeafTypeName:function(e){var t=this.leafTypeList.find((function(t){return t.leafTypeCode===e}));return null===t||void 0===t?void 0:t.leafTypeName},selectAllEvent:function(e){var t=e.checked,a=e.records;console.log("".concat(t,"-选中所有records包含选中的所以对象----").concat(JSON.stringify(a))),this.selectedRows=a},selectRowChange:function(e){var t=e.checked,a=e.records;console.log("".concat(t,"-选择改变时会把records包含选中的所以对象----").concat(JSON.stringify(a))),this.selectedRows=a}}},C=v,T=(a("36be"),Object(f["a"])(C,i,l,!1,null,"72f57876",null));t["default"]=T.exports}}]);
//# sourceMappingURL=chunk-1615cf38.c0b25cf8.js.map