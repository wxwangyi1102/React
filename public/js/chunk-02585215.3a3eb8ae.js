(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-02585215"],{2396:function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ec-container",{attrs:{height:"100%"}},[a("ec-container-header",[a("ec-panel-item",[a("ec-panel-item-left",[a("ec-header",{attrs:{title:"收购计划执行量管理",icon:"onetomany","color-code":"008"}})],1)],1)],1),a("ec-container-body",[a("ec-panel",{attrs:{auto:!1}},[a("ec-panel-toolbar",[a("ec-v-item",[a("a-descriptions",{attrs:{bordered:"",column:4}},[a("a-descriptions-item",{attrs:{label:"收购计划执行总量"}},[e._v(" "+e._s(e.totalData.sumPlanTotalWeight)+" ")]),a("a-descriptions-item",{attrs:{label:"国内总量"}},[e._v(" "+e._s(e.totalData.sumPlanInnerWeight))]),a("a-descriptions-item",{attrs:{label:"出口备货总量"}},[e._v(" "+e._s(e.totalData.sumExportTotalWeight)+" ")]),a("a-descriptions-item",{attrs:{label:"种植面积"}},[e._v(" "+e._s(e.totalData.sumPlanPlantArea)+" ")]),a("a-descriptions-item",{attrs:{label:"剩余收购计划执行总量"}},[e._v(" "+e._s(e.totalData.surplusPlanTotalWeight)+" ")]),a("a-descriptions-item",{attrs:{label:"剩余国内总量"}},[e._v(" "+e._s(e.totalData.surplusPlanInnerWeight)+" ")]),a("a-descriptions-item",{attrs:{label:"剩余出口备货总量"}},[e._v(" "+e._s(e.totalData.surplusExportTotalWeight)+" ")]),a("a-descriptions-item",{attrs:{label:"剩余种植面积"}},[e._v(" "+e._s(e.totalData.surplusPlanPlantArea)+" ")])],1)],1)],1),a("ec-panel-toolbar",[a("ec-query-panel",{attrs:{colCount:e.colCount},on:{query:e.onQuery,reset:e.onReset}},[a("ec-query-item",{attrs:{label:"烟叶类型"}},[a("ec-select",{attrs:{showSearch:"",allowClear:"",placeholder:"请选择"},model:{value:e.queryItems.leafTypeCode,callback:function(t){e.$set(e.queryItems,"leafTypeCode",t)},expression:"queryItems.leafTypeCode"}},e._l(e.leafTypeList,(function(t){return a("a-select-option",{key:t.leafTypeCode},[e._v(" "+e._s(t.leafTypeName)+" ")])})),1)],1)],1),a("ec-divider")],1),a("ec-panel-header",[a("ec-v-item",[a("ec-panel-item",[a("ec-panel-item-left",[a("a-button",{attrs:{type:"primary"},on:{click:e.onEdit}},[e._v("编辑")]),a("a-button",{on:{click:e.onAgree}},[e._v("同意")]),a("a-button",{on:{click:e.onExport}},[e._v("导出")])],1),a("ec-panel-item-right",[a("a-space",{attrs:{size:15}},[a("span",[e._v("种植收购年度："+e._s(e.queryItems.busiYear)+"年")]),a("span",[e._v("重量单位："),a("ec-select",{staticStyle:{width:"150px"},attrs:{showSearch:"",allowClear:"",placeholder:"请选择"},on:{select:function(t){return e.handleUnitParse()}},model:{value:e.weightUnit,callback:function(t){e.weightUnit=t},expression:"weightUnit"}},e._l(e.weightUnitList,(function(t){return a("a-select-option",{key:t.weightUnitCd},[e._v(" "+e._s(t.weightUnitName)+" ")])})),1)],1),a("span",[e._v("面积单位："),a("ec-select",{staticStyle:{width:"150px"},attrs:{showSearch:"",allowClear:"",placeholder:"请选择"},on:{select:function(t){return e.handleUnitParse()}},model:{value:e.areaUnit,callback:function(t){e.areaUnit=t},expression:"areaUnit"}},e._l(e.areaUnitList,(function(t){return a("a-select-option",{key:t.areaUnitCd},[e._v(" "+e._s(t.areaUnitName)+" ")])})),1)],1)])],1)],1)],1)],1),a("ec-panel-body",[a("ec-table",{ref:"table",attrs:{border:"",height:"100%",auto:!1,data:e.tableData.rows,loading:e.loading,"show-footer":"","footer-method":e.footerMethod,"highlight-current-row":""},on:{"checkbox-all":e.selectAllEvent,"checkbox-change":e.selectRowChange}},[a("ec-table-col",{attrs:{type:"checkbox",width:"50",align:"center"}}),a("ec-table-col",{attrs:{title:"序号",type:"seq",width:"70",align:"center"}}),a("ec-table-col",{attrs:{field:"orgCode",title:"单位代码",align:"center",width:"200"}}),a("ec-table-col",{attrs:{field:"orgName",title:"单位名称",align:"left","min-width":"150"}}),a("ec-table-colgroup",{attrs:{title:"收购计划执行量"}},[a("ec-table-col",{attrs:{field:"planTotalWeight",title:"合计",align:"center",width:"150"}}),a("ec-table-col",{attrs:{field:"planInnerWeight",title:"国内",align:"center",width:"150"}}),a("ec-table-col",{attrs:{field:"planExportWeight",title:"出口备货",align:"center",width:"150"}})],1),a("ec-table-col",{attrs:{field:"planPlantArea",title:"种植面积",align:"right",width:"150"}}),a("ec-table-col",{attrs:{field:"auditState",title:"审核状态",align:"left",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.row;return["1"===n.auditState?a("div",[a("span",[e._v("处长审批")])]):"2"===n.auditState?a("div",[a("span",[e._v("副总经理审批")])]):"3"===n.auditState?a("div",[a("span",[e._v("完成")])]):a("div",[a("span",[e._v("未审批")])])]}}])}),a("ec-table-col",{attrs:{title:"操作",align:"center",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.row;return[a("a-button",{attrs:{type:"link"},on:{click:function(t){return e.onDetail(n)}}},[e._v("详细")])]}}])})],1)],1)],1),a("execution-manage-form",{ref:"ExecutionManageForm",on:{onQuery:e.onQuery}}),a("detail",{ref:"Detail"})],1)],1)},i=[],l=a("c7eb"),r=a("1da1"),o=(a("d3b7"),a("159b"),a("b680"),a("7db0"),a("b0c0"),a("a9e3"),a("d81d"),a("caad"),a("99af"),a("e9c4"),function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ec-drawer",{staticClass:"ec-draw-form",attrs:{title:"收购计划执行量录入",visible:e.visible,width:"80%","is-confirm":!0},on:{close:e.onclose}},[a("ec-container",{attrs:{height:"100%",fixed:"top bottom","color-code":"007"}},[a("ec-container-header",[a("ec-panel-item",[a("ec-panel-item-left",[a("ec-header",{attrs:{title:"收购计划执行量管理",icon:"onetomany","color-code":"008"}})],1),a("ec-panel-item-right",[a("div",{staticClass:"year"},[e._v(" 种植收购年度："+e._s(e.nowYear)+"年;正在编辑的烟叶类型："+e._s(e.leafTypeName)+"；单位："+e._s(e.weightUnitName)+"、"+e._s(e.areaUnitName)+" ")])])],1)],1),a("ec-container-body",[a("ec-panel",{attrs:{auto:!1}},[a("ec-panel-toolbar",[a("a-descriptions",{attrs:{bordered:"",column:4}},[a("a-descriptions-item",{attrs:{label:"收购计划执行总量"}},[e._v(" "+e._s(e.totalData.sumPlanTotalWeight)+" ")]),a("a-descriptions-item",{attrs:{label:"国内总量"}},[e._v(" "+e._s(e.totalData.sumPlanInnerWeight))]),a("a-descriptions-item",{attrs:{label:"出口备货总量"}},[e._v(" "+e._s(e.totalData.sumExportTotalWeight)+" ")]),a("a-descriptions-item",{attrs:{label:"种植面积"}},[e._v(" "+e._s(e.totalData.sumPlanPlantArea)+" ")]),a("a-descriptions-item",{attrs:{label:"剩余收购计划执行总量"}},[e._v(" "+e._s(e.totalData.surplusPlanTotalWeight)+" ")]),a("a-descriptions-item",{attrs:{label:"剩余国内总量"}},[e._v(" "+e._s(e.totalData.surplusPlanInnerWeight)+" ")]),a("a-descriptions-item",{attrs:{label:"剩余出口备货总量"}},[e._v(" "+e._s(e.totalData.surplusExportTotalWeight)+" ")]),a("a-descriptions-item",{attrs:{label:"剩余种植面积"}},[e._v(" "+e._s(e.totalData.surplusPlanPlantArea)+" ")])],1)],1),a("ec-panel-body",[a("ec-table",{ref:"xTable",staticClass:"my-xtable-antd",attrs:{border:"","show-overflow":"",height:"100%",auto:!1,"keep-source":"",loading:e.saving,data:e.tableData,"edit-config":{trigger:"click",mode:"row",showStatus:!0},"edit-rules":e.validRules,"show-footer":"","footer-method":e.footerMethod}},[a("ec-table-col",{attrs:{title:"序号",type:"seq",width:"70",fixed:"left",align:"center"}}),a("ec-table-col",{attrs:{field:"orgCode",title:"单位代码",align:"left",fixed:"left","min-width":"180"}}),a("ec-table-col",{attrs:{field:"orgName",title:"单位名称",fixed:"left",align:"left","min-width":"200"}}),a("ec-table-colgroup",{attrs:{title:"收购计划执行量"}},[a("ec-table-col",{attrs:{field:"planTotalWeight",title:"合计",align:"center",width:"150","edit-render":{}},scopedSlots:e._u([{key:"edit",fn:function(t){var n=t.row;return[a("a-input-number",{attrs:{min:0,max:1e5,precision:2},on:{blur:function(t){return e.handleValidData(n,"planTotalWeight")}},model:{value:n.planTotalWeight,callback:function(t){e.$set(n,"planTotalWeight",t)},expression:"row.planTotalWeight"}})]}}])}),a("ec-table-col",{attrs:{field:"planInnerWeight",title:"国内",align:"center",width:"150","edit-render":{}},scopedSlots:e._u([{key:"edit",fn:function(t){var n=t.row;return[a("a-input-number",{attrs:{min:0,max:1e5,precision:2},on:{blur:function(t){return e.handleValidData(n,"planInnerWeight")}},model:{value:n.planInnerWeight,callback:function(t){e.$set(n,"planInnerWeight",t)},expression:"row.planInnerWeight"}})]}}])}),a("ec-table-col",{attrs:{field:"planExportWeight",title:"出口备货",width:"150",align:"center","edit-render":{}},scopedSlots:e._u([{key:"edit",fn:function(t){var n=t.row;return[a("a-input-number",{attrs:{min:0,max:1e5,precision:2},on:{blur:function(t){return e.handleValidData(n,"planExportWeight")}},model:{value:n.planExportWeight,callback:function(t){e.$set(n,"planExportWeight",t)},expression:"row.planExportWeight"}})]}}])})],1),a("ec-table-col",{attrs:{field:"planPlantArea",title:"种植面积",align:"right",width:"150","edit-render":{}},scopedSlots:e._u([{key:"edit",fn:function(t){var n=t.row;return[a("a-input-number",{attrs:{min:0,max:1e5,precision:2},on:{blur:function(t){return e.handleValidData(n,"planPlantArea")}},model:{value:n.planPlantArea,callback:function(t){e.$set(n,"planPlantArea",t)},expression:"row.planPlantArea"}})]}}])}),a("ec-table-colgroup",{attrs:{title:"下属单位已分解量"}},[a("ec-table-colgroup",{attrs:{title:"收购计划执行量"}},[a("ec-table-col",{attrs:{field:"childPlanTotalWeight",title:"合计",align:"left",width:"150"}}),a("ec-table-col",{attrs:{field:"childPlanInnerWeight",title:"国内",align:"left",width:"150"}}),a("ec-table-col",{attrs:{field:"childPlanExportWeight",title:"出口备货",align:"left",width:"150"}})],1)],1),a("ec-table-col",{attrs:{field:"childPlanPlantArea",title:"种植面积",align:"left",width:"150"}})],1)],1)],1)],1),a("ec-container-footer",{attrs:{fixed:""}},[a("a-space",[a("a-button",{attrs:{type:"primary",loading:e.saving},on:{click:e.onSave}},[e._v("保存")]),a("a-button",{on:{click:e.onclose}},[e._v("取消")])],1)],1)],1)],1)}),s=[],c=a("2ef0"),d=a.n(c),u={name:"ExecutionFormManage",data:function(){return{surplusData:{},totalData:{},tableData:[],data:{},leafTypeName:"",weightUnitName:"",areaUnitName:"",weightUnit:1,areaUnit:1,nowYear:"",visible:!1,isEditor:!1,saving:!1,isShowSaveAndAdd:!0,oldDataRow:[],ruleForm:{},leafTypeCode:"",leafTypeList:[],validRules:{planTotalWeight:[{required:!0,message:"请输入合计"}],planInnerWeight:[{required:!0,message:"请输入国内执行量"}],planExportWeight:[{required:!0,message:"请输入出口备货执行量"}],planPlantArea:[{required:!0,message:"请输入种植面积"}]}}},methods:{show:function(e){var t=this;return Object(r["a"])(Object(l["a"])().mark((function a(){return Object(l["a"])().wrap((function(a){while(1)switch(a.prev=a.next){case 0:return t.visible=!0,t.data=e,t.totalData=e.totalDataObj,t.leafTypeName=e.leafTypeObj.leafTypeName,t.leafTypeCode=e.leafTypeObj.leafTypeCode,t.weightUnitName=e.weightUnitObj.weightUnitName,t.weightUnit=e.weightUnitObj.weightUnitCd,t.areaUnit=e.areaUnitObj.areaUnitCd,t.areaUnitName=e.areaUnitObj.areaUnitName,t.nowYear=e.nowYear,a.next=12,t.queryEditData();case 12:case"end":return a.stop()}}),a)})))()},queryEditData:function(){var e=this;return Object(r["a"])(Object(l["a"])().mark((function t(){var a;return Object(l["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.loading=!0,a={leafTypeCode:e.leafTypeCode,busiYear:e.nowYear},console.log(a),t.next=5,e.$apis.bpm.executionManage.queryEditData(a).then((function(t){var a=t.rows||[];e.tableData=a,e.saveTableData=d.a.cloneDeep(a)}));case 5:e.handleUnitParse();case 6:case"end":return t.stop()}}),t)})))()},handleUnitParse:function(){var e=this,t=[],a=JSON.parse(JSON.stringify(this.tableData));a.forEach((function(a){var n=a;n.leafTypeCode=e.leafTypeCode,n.busiYear=e.nowYear,n.planTotalWeight=(n.planTotalWeight/e.weightUnit).toFixed(2),n.planInnerWeight=(n.planInnerWeight/e.weightUnit).toFixed(2),n.planExportWeight=(n.planExportWeight/e.weightUnit).toFixed(2),n.planPlantArea=(n.planPlantArea/e.areaUnit).toFixed(2),n.childPlanTotalWeight=(n.childPlanTotalWeight/e.weightUnit).toFixed(2),n.childPlanInnerWeight=(n.childPlanInnerWeight/e.weightUnit).toFixed(2),n.childPlanExportWeight=(n.childPlanExportWeight/e.weightUnit).toFixed(2),n.childPlanPlantArea=(n.childPlanPlantArea/e.areaUnit).toFixed(2),t.push(n)})),this.tableData=t},onSave:function(){var e=this;return Object(r["a"])(Object(l["a"])().mark((function t(){var a,n,i;return Object(l["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(a=e.saveTableData,console.log(a),a){t.next=5;break}return e.$message.error("无数据，不能进行保存！"),t.abrupt("return");case 5:return n=e.$refs.xTable,t.next=8,n.validate(!0).catch((function(e){return e}));case 8:i=t.sent,i?e.$message.error("校验不通过！"):(e.saving=!0,e.$apis.bpm.executionManage.save(a).then((function(){e.saving=!1,e.$message.success("保存成功"),e.$emit("onQuery"),e.onclose()})).catch((function(){e.saving=!1})));case 10:case"end":return t.stop()}}),t)})))()},handleBeforeSaveAdjustData:function(){var e=this;console.log("保存之前：".concat(JSON.stringify(this.tableData)));var t=JSON.parse(JSON.stringify(this.tableData)),a=[];return console.log("拷贝之后的数据".concat(JSON.stringify(t),"----单位：").concat(this.weightUnit)),t.forEach((function(t){var n=t;n.planTotalWeight=(n.planTotalWeight*e.weightUnit).toFixed(2),n.planInnerWeight=(n.planInnerWeight*e.weightUnit).toFixed(2),n.planExportWeight=(n.planExportWeight*e.weightUnit).toFixed(2),n.planPlantArea=(n.planPlantArea*e.areaUnit).toFixed(2),a.push(n)})),a},handleValidData:function(e,t){var a=this,n=e,i=e.planTotalWeight||0,l=e.planExportWeight||0,r=e.planInnerWeight||0,o=e.planPlantArea||0,s=e.childPlanTotalWeight||0,c=e.childPlanExportWeight||0,d=e.childPlanInnerWeight||0,u=e.childPlanPlantArea||0,h=r+l;if(i<h)return this.$message.warn("[合计]不能小于国内跟出口备货的和"),void(n[t]="");if("planTotalWeight"===t&&i<s)return this.$message.warn("[合计]不能小于下级单位已分解的[合计]"),void(n.planTotalWeight="");if("planExportWeight"===t&&l<c)return this.$message.warn("[出口备货]不能小于下级单位已分解的[出口备货]"),void(n.planExportWeight="");if("planInnerWeight"===t&&r<d)return this.$message.warn("[国内]不能小于下级单位已分解的[国内]"),void(n.planInnerWeight="");"planPlantArea"===t&&o<u&&(this.$message.warn("[种植面积]不能小于下级单位已分解的[种植面积]"),n.planPlantArea="");var p=n[t];p||(n[t]="0.00"),this.saveTableData.forEach((function(i){if(i.buPlanId===n.buPlanId){var l=i;l[t]="planPlantArea"===t?(Number(e[t])*Number(a.areaUnit)).toFixed(2):(Number(e[t])*Number(a.weightUnit)).toFixed(2)}}))},sumNum:function(e,t){var a=0;return e.forEach((function(e){a+=Number(e[t])})),a.toFixed(2)},footerMethod:function(e){var t=this,a=e.columns,n=e.data;return[a.map((function(e,a){return 0===a?"合计":["planTotalWeight","planInnerWeight","planExportWeight","planPlantArea","childPlanTotalWeight","childPlanInnerWeight","childPlanExportWeight","childPlanPlantArea"].includes(e.property)?t.sumNum(n,e.property):null}))]},onclose:function(){this.tableData=[],this.visible=!1}}},h=u,p=(a("c722"),a("2877")),g=Object(p["a"])(h,o,s,!1,null,"1272c28e",null),f=g.exports,m=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ec-drawer",{staticClass:"ec-draw-form",attrs:{title:"详情",visible:e.visible,size:"large"},on:{close:e.onclose}},[a("ec-container",{attrs:{fixed:"top bottom",height:"100%","color-code":"007"}},[a("ec-container-body",[a("ec-panel",{staticStyle:{height:"99%"},attrs:{"color-code":"002",auto:!1}},[a("ec-panel-header",[e._t("default",null,{data:e.data}),a("ec-panel-item-left",{staticClass:"ec-panel-item-left"},[a("div",{staticClass:"ec-panel-title"},[a("div",{staticClass:"ec-bar bg-color-1"}),a("div",{staticClass:"ec-title"},[e._v(" 单位："+e._s(e.selectRow.orgName)+"；烟叶类型："+e._s(e.leafTypeName)+" ")])])]),a("ec-panel-item-right",[a("div",{staticStyle:{display:"inline-block"}},[a("span",{staticStyle:{"margin-left":"14px"}},[e._v("种植收购年度："+e._s(e.nowYear)+"年;计量单位："+e._s(e.weightUnitName)+"、"+e._s(e.areaUnitName))])])])],2),a("ec-panel-body",[a("ec-table",{ref:"xTable",staticClass:"my-xtable-antd",attrs:{border:"","show-overflow":"","keep-source":"",data:e.tableData,"show-footer":"","footer-method":e.footerMethod,auto:!1,height:"100%"}},[a("ec-table-col",{attrs:{type:"seq",title:"序号",align:"left",width:"80"}}),a("ec-table-col",{attrs:{field:"recordDate",title:"录入日期",align:"left","min-width":"150"}}),a("ec-table-colgroup",{attrs:{title:"收购计划执行量"}},[a("ec-table-col",{attrs:{field:"planTotalWeight",title:"合计",align:"center",width:"150"}}),a("ec-table-col",{attrs:{field:"planInnerWeight",title:"国内",align:"center",width:"150"}}),a("ec-table-col",{attrs:{field:"planExportWeight",title:"出口备货",align:"center",width:"150"}})],1),a("ec-table-col",{attrs:{field:"planPlantArea",title:"种植面积",align:"right",width:"150"}}),a("ec-table-col",{attrs:{field:"auditState",title:"审核状态",align:"left",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.row;return["1"===n.auditState?a("div",[a("span",[e._v("处长审批")])]):"2"===n.auditState?a("div",[a("span",[e._v("副总经理审批")])]):"3"===n.auditState?a("div",[a("span",[e._v("完成")])]):a("div",[a("span",[e._v("未审批")])])]}}])})],1)],1)],1)],1),a("ec-container-footer",{attrs:{fixed:""}},[a("a-space",[a("a-button",{on:{click:e.onclose}},[e._v("关闭")])],1)],1)],1)],1)},b=[],w={name:"ExecutionDtlManage",data:function(){return{tableData:[],data:{},leafTypeName:"",leafTypeCode:"",leafTypeCd:"",weightUnitName:"",weightUnit:1,areaUnit:1,areaUnitName:"",orgCode:"",nowYear:"",rowData:"",visible:!1,selectRow:{},leafTypeList:[],workAuditState:[{id:"",name:"全部"},{id:"0",name:"未审批"},{id:"1",name:"处长审批"},{id:"2",name:"副总经理审批"},{id:"3",name:"完成"}]}},methods:{handleUnitParse:function(){var e=this;this.tableData.forEach((function(t){var a=t;a.planTotalWeight=(a.planTotalWeight/e.weightUnit).toFixed(2),a.planInnerWeight=(a.planInnerWeight/e.weightUnit).toFixed(2),a.planExportWeight=(a.planExportWeight/e.weightUnit).toFixed(2),a.planPlantArea=(a.planPlantArea/e.areaUnit).toFixed(2)}))},show:function(e){var t=this;return Object(r["a"])(Object(l["a"])().mark((function a(){var n,i;return Object(l["a"])().wrap((function(a){while(1)switch(a.prev=a.next){case 0:return t.visible=!0,t.data=e,n=e.selectedRows,t.selectRow=n,t.orgCode=n.orgCode,t.leafTypeCode=n.leafTypeCode,t.leafTypeName=e.leafTypeObj.leafTypeName,t.weightUnitName=e.weightUnitObj.weightUnitName,t.weightUnit=e.weightUnitObj.weightUnitCd,t.areaUnitName=e.areaUnitObj.areaUnitName,t.areaUnit=e.areaUnitObj.areaUnitCd,t.nowYear=e.nowYear,a.next=14,t.$apis.bpm.executionManage.queryDetail({leafTypeCode:t.leafTypeCode,orgCode:t.orgCode,busiYear:t.nowYear});case 14:i=a.sent,console.log("详情返回的数据：".concat(JSON.stringify(i))),t.tableData=null===i||void 0===i?void 0:i.rows,t.handleUnitParse();case 18:case"end":return a.stop()}}),a)})))()},sumNum:function(e,t){var a=0;return e.forEach((function(e){var n=e;n[t]=n[t]||0,a+=Number(e[t])})),a.toFixed(2)},footerMethod:function(e){var t=this,a=e.columns,n=e.data;return[a.map((function(e,a){return 0===a?"合计":["planTotalWeight","planInnerWeight","planExportWeight"].includes(e.property)?t.sumNum(n,e.property):null}))]},onclose:function(){this.visible=!1}}},v=w,y=(a("4cef1"),Object(p["a"])(v,m,b,!1,null,"37b616f6",null)),x=y.exports,T={name:"ExecutionManage",components:{ExecutionManageForm:f,Detail:x},data:function(){return{objectData:{},busiYear:"",queryItems:{leafTypeCode:"",busiYear:""},weightUnit:5e5,areaUnit:1e4,colCount:5,nowYear:"",loading:!1,leafTypeCd:"",leafTypeList:[],oldDataRow:[],oldTotalData:[],totalData:{},isNullData:[],bizCode:"",workSubmitState:[{id:"",name:"全部"},{id:"0",name:"未提交"},{id:"1",name:"已提交"}],workAuditState:[{id:"",name:"全部"},{id:"0",name:"未审批"},{id:"1",name:"处长审批"},{id:"2",name:"副总经理审批"},{id:"3",name:"完成"}],workOptType:[{id:"",name:"全部"},{id:"0",name:"调减"},{id:"1",name:"调增"}],weightUnitList:[{weightUnitCd:1,weightUnitName:"公斤",isSelected:!1},{weightUnitCd:50,weightUnitName:"担",isSelected:!1},{weightUnitCd:5e5,weightUnitName:"万担",isSelected:!1}],areaUnitList:[{areaUnitCd:1e4,areaUnitName:"万亩"},{areaUnitCd:1,areaUnitName:"亩"}],pagination:{pageNumber:1,pageSize:10,total:0},tableData:{rows:[]}}},computed:{appConfig:function(){return this.$store.getters.getAppConfig}},created:function(){var e=this.$router.history.current.query.appCode;this.appCode=e||"CM"},mounted:function(){this.onQuery()},methods:{handleUnitParse:function(){var e=this,t=[];console.log("單位：".concat(this.weightUnit));var a=d.a.cloneDeep(this.oldDataRow);a.forEach((function(a){var n=a;n.planTotalWeight=(n.planTotalWeight/e.weightUnit).toFixed(2),n.planInnerWeight=(n.planInnerWeight/e.weightUnit).toFixed(2),n.planExportWeight=(n.planExportWeight/e.weightUnit).toFixed(2),n.planPlantArea=(n.planPlantArea/e.areaUnit).toFixed(2),n.childPlanTotalWeight=(n.childPlanTotalWeight/e.weightUnit).toFixed(2),n.childPlanInnerWeight=(n.childPlanInnerWeight/e.weightUnit).toFixed(2),n.childPlanExportWeight=(n.childPlanExportWeight/e.weightUnit).toFixed(2),n.childPlanPlantArea=(n.childPlanPlantArea/e.areaUnit).toFixed(2),t.push(n)}));var n=d.a.clonDeep(this.oldTotalData);n.sumPlanTotalWeight=(n.sumPlanTotalWeight/this.weightUnit).toFixed(2),n.sumPlanInnerWeight=(n.sumPlanInnerWeight/this.weightUnit).toFixed(2),n.sumExportTotalWeight=(n.sumExportTotalWeight/this.weightUnit).toFixed(2),n.sumPlanPlantArea=(n.sumPlanPlantArea/this.areaUnit).toFixed(2),n.surplusPlanTotalWeight=(n.surplusPlanTotalWeight/this.weightUnit).toFixed(2),n.surplusPlanInnerWeight=(n.surplusPlanInnerWeight/this.weightUnit).toFixed(2),n.surplusExportTotalWeight=(n.surplusExportTotalWeight/this.weightUnit).toFixed(2),n.surplusPlanPlantArea=(n.surplusPlanPlantArea/this.areaUnit).toFixed(2),this.totalData=n,this.tableData.rows=t},handlePagination:function(e,t){var a=this;return Object(r["a"])(Object(l["a"])().mark((function n(){return Object(l["a"])().wrap((function(n){while(1)switch(n.prev=n.next){case 0:return a.pagination.pageNumber=e,a.pagination.pageSize=t,n.next=4,a.handleGetLeafTypeList();case 4:case"end":return n.stop()}}),n)})))()},handleGetLeafTypeList:function(){var e=this;return Object(r["a"])(Object(l["a"])().mark((function t(){var a,n,i,r,o,s;return Object(l["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(null!==(a=e.leafTypeList)&&void 0!==a&&a.length){t.next=6;break}return t.next=3,e.$apis.bpm.executionEnter.queryAllLeafType({});case 3:n=t.sent,e.leafTypeList=(null===n||void 0===n?void 0:n.rows)||[],e.leafTypeList.some((function(t){return"烤烟"===t.leafTypeName&&(e.leafTypeCd=t.leafTypeCode,e.queryItems.leafTypeCode=t.leafTypeCode,!0)}));case 6:if(e.queryItems.leafTypeCode||(i=e.leafTypeList[0].leafTypeCode,e.leafTypeCd=i,e.queryItems.leafTypeCode=i),e.orgCode){t.next=13;break}return t.next=10,e.$apis.bim.curOrg.get({});case 10:r=t.sent,e.bizCode=null===r||void 0===r?void 0:r.bizCode,e.orgCode=null===r||void 0===r?void 0:r.orgUniqueCode;case 13:if(!(!e.queryItems.busiYear>0)){t.next=20;break}return o={bizCode:e.appConfig.bizCode,appCode:e.appCode||"CM",yearTypeCode:"BIZ_YEAR"},t.next=17,e.$apis.bpm.executionEnter.getBuYear(o);case 17:s=t.sent,e.queryItems.busiYear=null===s||void 0===s?void 0:s.yearValue,e.nowYear=null===s||void 0===s?void 0:s.yearValue;case 20:case"end":return t.stop()}}),t)})))()},onQuery:function(){var e=this;return Object(r["a"])(Object(l["a"])().mark((function t(){var a,n,i;return Object(l["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.handleGetLeafTypeList();case 2:return e.loading=!0,a={pageNo:e.pagination.pageNumber,pageSize:e.pagination.pageSize,leafTypeCode:e.queryItems.leafTypeCode,busiYear:e.queryItems.busiYear,scope:"1"},t.next=6,e.$apis.bpm.executionManage.query(a).then((function(t){var a=t.rows||[];e.pagination.total=t.totalRows,e.oldDataRow=d.a.cloneDeep(a),e.tableData=a})).catch((function(e){console.log(e)})).finally((function(){e.loading=!1,e.selectedRows=[]}));case 6:return n={leafTypeCode:e.queryItems.leafTypeCode,busiYear:e.queryItems.busiYear},t.next=9,e.$apis.bpm.executionManage.queryTotalData(n);case 9:i=t.sent,e.oldTotalData=d.a.cloneDeep(i),e.handleUnitParse();case 12:case"end":return t.stop()}}),t)})))()},onAgree:function(){var e=this,t=this.$createElement;!this.selectedRows||this.selectedRows.length<=0?this.$message.error("请选择一条数据再同意"):this.$confirm({title:"是否执行该操作?",content:function(){return t("div",{style:"color:red;"},["是否确认提交选中的数据，确认请点击'确认'按钮，取消点击'取消'按钮。"])},onOk:function(){e.loading=!0;for(var t=[],a=0;a<e.selectedRows.length;a++)t.push(e.selectedRows[a].buPlanId);e.$apis.bpm.executionManage.agree({buPlanIds:t}).then((function(t){t.result?(e.loading=!1,e.$message.success("操作成功"),e.onQuery()):e.$message.error("操作失败")}))}})},onExport:function(){},onDetail:function(e){var t=this,a=this.leafTypeList.find((function(e){return e.leafTypeCode===t.queryItems.leafTypeCode})),n=this.weightUnitList.find((function(e){return e.weightUnitCd===t.weightUnit})),i=this.areaUnitList.find((function(e){return e.areaUnitCd===t.areaUnit})),l=d.a.cloneDeep(e),r={leafTypeObj:a,weightUnitObj:n,areaUnitObj:i,selectedRows:l,nowYear:this.queryItems.busiYear};this.$refs.Detail.show(r)},onEdit:function(){var e=this,t=this.$route.query.name;console.log("xxxxxxxxxxxxx".concat(t));var a=this.leafTypeList.find((function(t){return t.leafTypeCode===e.queryItems.leafTypeCode})),n=this.weightUnitList.find((function(t){return t.weightUnitCd===e.weightUnit})),i=this.areaUnitList.find((function(t){return t.areaUnitCd===e.areaUnit})),l=d.a.cloneDeep(this.totalData),r=this.tableData.rows,o=d.a.cloneDeep(r),s={leafTypeObj:a,weightUnitObj:n,areaUnitObj:i,selectedRows:o,totalDataObj:l,nowYear:this.queryItems.busiYear};this.$refs.ExecutionManageForm.show(s)},onReset:function(){this.queryItems.leafTypeCode=this.leafTypeCd,this.queryItems.submitState="",this.queryItems.auditState="",this.queryItems.oprType="",this.queryItems.remark="",this.queryItems.orgName="",this.$refs.table.pageAction(1)},handleLeafTypeName:function(e){var t=this.leafTypeList.find((function(t){return t.leafTypeCode===e}));return null===t||void 0===t?void 0:t.leafTypeName},sumNum:function(e,t){var a=0;return e.forEach((function(e){a+=Number(e[t])})),a.toFixed(2)},footerMethod:function(e){var t=this,a=e.columns,n=e.data;return[a.map((function(e,a){return 0===a?"合计":["planTotalWeight","planInnerWeight","planExportWeight","planPlantArea"].includes(e.property)?t.sumNum(n,e.property):null}))]},selectAllEvent:function(e){var t=e.checked,a=e.records;console.log("".concat(t,"-选中所有records包含选中的所以对象----").concat(JSON.stringify(a))),this.selectedRows=a},selectRowChange:function(e){var t=e.checked,a=e.records;console.log("".concat(t,"-选择改变时会把records包含选中的所以对象----").concat(JSON.stringify(a))),this.selectedRows=a}}},U=T,W=(a("66b1"),Object(p["a"])(U,n,i,!1,null,"3108f7d4",null));t["default"]=W.exports},"4cef1":function(e,t,a){"use strict";a("de8c")},"66b1":function(e,t,a){"use strict";a("a100")},a100:function(e,t,a){},c722:function(e,t,a){"use strict";a("e59c")},de8c:function(e,t,a){},e59c:function(e,t,a){}}]);
//# sourceMappingURL=chunk-02585215.3a3eb8ae.js.map