(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-52bbbd88"],{"0676":function(e,t,a){function n(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}a("d9e2"),e.exports=n,e.exports.__esModule=!0,e.exports["default"]=e.exports},"0ef8":function(e,t,a){var n=a("448a").default,r=a("63748").default,i=a("7ec2").default,o=a("c973").default,l=a("9523").default,s=a("ded3").default;a("99af"),a("b0c0"),a("a9e3"),a("ac1f"),a("841c"),a("d3b7"),a("4de4"),a("d81d"),a("caad"),a("2532"),a("3ca3"),a("ddb0"),a("4ec9"),a("159b"),a("a630"),a("6062"),a("00b4"),a("a15b"),a("ac16"),a("f8c9"),function(){"use strict";var t={483:function(e,t,a){function n(e,t,a,n,r,i,o,l){var s,c="function"===typeof e?e.options:e;if(t&&(c.render=t,c.staticRenderFns=a,c._compiled=!0),n&&(c.functional=!0),i&&(c._scopeId="data-v-"+i),o?(s=function(e){e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,e||"undefined"===typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),r&&r.call(this,e),e&&e._registeredComponents&&e._registeredComponents.add(o)},c._ssrRegister=s):r&&(s=l?function(){r.call(this,(c.functional?this.parent:this).$root.$options.shadowRoot)}:r),s)if(c.functional){c._injectStyles=s;var d=c.render;c.render=function(e,t){return s.call(t),d(e,t)}}else{var u=c.beforeCreate;c.beforeCreate=u?[].concat(u,s):[s]}return{exports:e,options:c}}a.d(t,{Z:function(){return n}})},51:function(e,t,a){a.d(t,{H_:function(){return i},Qb:function(){return o}});var n="Ecm",r="$ecm",i=function(e){var t;return null!==(t=null===e||void 0===e?void 0:e.componentPrefix)&&void 0!==t?t:n},o=function(e,t){var a,n=e;t&&t.classPrefix&&(n.prototype[r]=s(s({},null!==(a=n.prototype[r])&&void 0!==a?a:{}),{},{classPrefix:t.classPrefix}))}},657:function(e,t,a){var c;a.d(t,{default:function(){return w}});var d=function(){var e=this,t=e._self._c;return t("div",{staticClass:"tree-search"},[e._t("title"),e.isSearch?t("div",{staticClass:"tree-search-select",style:{padding:e.searchPadding}},[t("a-select",{staticStyle:{width:"100%"},attrs:{"show-search":"",value:e.selectedValue,placeholder:e.placeholder,"default-active-first-option":!1,"show-arrow":!1,"filter-option":!1,"not-found-content":null},on:{search:e.onSelectSearch,select:e.onSelectChange,rightClick:e.oRightClick}},e._l(e.selectOption,(function(a){return t("a-select-option",{key:a.key,attrs:{value:a.key,title:"".concat(a.title)}},[t("a-row",[t("a-col",{staticClass:"ellipsis",attrs:{span:e.isShowParent?18:24,title:a.title}},[e._v(e._s(a.title))]),t("a-col",{staticClass:"ellipsis",staticStyle:{color:"#ccc","font-size":"12px"},attrs:{span:e.isShowParent?6:0,title:e.getNameBy(e.tmpSearchOption,a.pkey)}},[e._v(e._s(e.getNameBy(e.tmpSearchOption,a.pkey)))])],1)],1)})),1)],1):e._e(),e.isSearch?t("a-divider",{staticStyle:{margin:"8px 0"}}):e._e(),t("div",{staticClass:"tree-search-tree"},[t("a-spin",{staticClass:"spin",attrs:{spinning:e.fetching}}),e.lazy?t("a-tree",e._b({ref:"treeRef",attrs:{blockNode:!0,multiple:e.multiple,checkedKeys:e.treeCheckedKeys,checkable:e.checkable,selectable:e.selectable,expandedKeys:e.treeExpandedKeys,selectedKeys:e.treeSelectedKeys,loadedKeys:e.treeLoadedKeys,"tree-data":e.treeData,loadData:e.handleLoadLazyData},on:{select:e.onSelectTree,check:e.onCheckTree,expand:e.onExpandTree,load:e.onLazyLoad,rightClick:e.oRightClick},scopedSlots:e._u([{key:"title",fn:function(a){return[t("span",{attrs:{id:"".concat(e.treeType,"_").concat(a.key)}},[e._v(e._s(a.title))]),e._t("action",null,{action:a})]}}],null,!0)},"a-tree",e.$attrs,!1)):t("a-tree",e._b({ref:"treeRef",attrs:{blockNode:!0,checkable:e.checkable,selectable:e.selectable,multiple:e.multiple,checkedKeys:e.treeCheckedKeys,expandedKeys:e.treeExpandedKeys,selectedKeys:e.treeSelectedKeys,"tree-data":e.treeData,replaceFields:e.replaceFields},on:{select:e.onSelectTree,check:e.onCheckTree,expand:e.onExpandTree},scopedSlots:e._u([{key:"title",fn:function(a){return[t("span",{attrs:{id:"".concat(e.treeType,"_").concat(a.key)}},[e._v(e._s(a.title))]),e._t("action",null,{action:a})]}}],null,!0)},"a-tree",e.$attrs,!1)),e.fetching||e.treeData&&(!Array.isArray(e.treeData)||0!==e.treeData.length)?e._e():t("a-empty",{staticClass:"spin"})],1)],2)},u=[],p=a(632),f=a(142),h={inheritAttrs:!1,name:"SelectTree",components:(c={},l(c,f.Select.name,f.Select),l(c,f.Row.name,f.Row),l(c,f.Col.name,f.Col),l(c,f.Divider.name,f.Divider),l(c,f.Spin.name,f.Spin),l(c,f.Empty.name,f.Empty),l(c,f.Tree.name,f.Tree),c),props:{treeType:{type:String,default:"st"},selectedKeys:{type:Array,default:null},checkedKeys:{type:Array,default:null},expandedKeys:{type:Array,default:null},lazy:{type:Boolean,default:!0},selectable:{type:Boolean,default:!0},checkable:{type:Boolean,default:!1},searchPadding:{type:String,default:"12px 12px 6px"},placeholder:{type:String,default:"请输入关键词筛选"},multiple:{type:Boolean,default:!1},join:{type:[String,Boolean],default:","},isShowParent:{type:Boolean,default:!1},replaceFields:{type:Object,default:function(){return{pkey:"pkey",title:"title",key:"key",children:"children"}}},search:{type:Boolean,default:!0},activeFirst:{type:Boolean,default:!1},beforeSelect:{type:Function,default:null},beforeCheck:{type:Function,default:null},initLevel:{type:Number,default:2},fetchData:{type:Function,required:!0},fetchDataById:{type:Function},fetchDataByName:{type:Function},valueField:{type:String,default:"key"},params:{type:Object,default:function(){return{}}}},data:function(){return this.onSelectSearch=(0,p.debounce)(this.onSelectSearch,500),{fetching:!1,selectedValue:void 0,treeCheckedKeys:[],treeSelectedKeys:[],treeExpandedKeys:[],treeLoadedKeys:[],treeData:[],selectOption:[],tmpSearchOption:[]}},computed:{isSearch:function(){return this.search&&(this.treeData||Array.isArray(this.treeData)&&0!==this.treeData.length)}},watch:{params:{handler:function(e,t){(0,p.isRefEqual)(e,t)||this.handleTreeData(e)},deep:!0,immediate:!0},checkedKeys:{handler:function(e){this.treeCheckedKeys=e},deep:!0,immediate:!0},selectedKeys:{handler:function(e){this.treeSelectedKeys=e},deep:!0,immediate:!0},expandedKeys:{handler:function(e){this.treeExpandedKeys=e},deep:!0,immediate:!0}},methods:{getNameBy:p.getNameBy,handleTreeData:function(e){var t=this;this.fetching=!0,this.treeLoadedKeys=[],this.treeExpandedKeys=[],this.treeData=[];try{this.fetchData(e).then(function(){var e=o(i().mark((function e(a){var n,r,o;return i().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n=(0,p.cloneDeep)(a).filter((function(e){return!e.pkey}))[0],t.treeData=(0,p.listFormatTree)(a,t.replaceFields),r=a.map((function(e){return e.key})).filter((function(e){return e})),o=(t.selectedKeys||[]).filter((function(e){return!r.includes(e)})),Array.isArray(t.treeData)&&0!==t.treeData.length&&(t.treeExpandedKeys=[n.key],t.$emit("expand",t.treeExpandedKeys),t.activeFirst&&t.onSelectTreeFn(n.key)),e.t0=0!==o.length,!e.t0){e.next=8;break}return e.next=8,t.handleTreeByCode(o);case 8:Array.isArray(t.treeSelectedKeys)&&0!==t.treeSelectedKeys.length&&setTimeout((function(){t.onScrollIntoView(t.treeSelectedKeys[0])}),500);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).finally((function(){t.fetching=!1}))}catch(a){this.treeData=[]}},handleTreeByCode:function(e){var t=this;return o(i().mark((function a(){var o,l,c,d,u,f,h,g,m,y,b,v;return i().wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(o=Array.isArray(e)?e:[e],t.fetching=!0,a.prev=2,!t.lazy){a.next=20;break}l=[],c=r(o);try{for(c.s();!(d=c.n()).done;)u=d.value,u&&l.push(t.fetchDataById(s(s({},t.params),{},{code:u})))}catch(i){c.e(i)}finally{c.f()}return a.next=9,Promise.all(l);case 9:if(f=a.sent,h=(0,p.treeFormatList)(t.treeData,t.replaceFields),g=(0,p.flattenDeep)(f),m=h.map((function(e){return e.key})).filter((function(e){return e})),y=g.filter((function(e){return!m.includes(e.key)})),b=y.map((function(e){return e.pkey})),v=(0,p.uniqueBy)(b),a.t0=0!==v.length,!a.t0){a.next=20;break}return a.next=20,t.handleLoadMore(v);case 20:o.forEach((function(e){var a=(0,p.getExpandedKeys)(t.treeData,e,t.replaceFields);t.treeExpandedKeys=Array.from(new Set([].concat(n(a),n(t.treeExpandedKeys))))})),a.next=25;break;case 23:a.prev=23,a.t1=a["catch"](2);case 25:t.fetching=!1;case 26:case"end":return a.stop()}}),a,null,[[2,23]])})))()},handleLoadMore:function(e){var t=this;return o(i().mark((function a(){var o,l,c,d,u,f,h,g;return i().wrap((function(a){while(1)switch(a.prev=a.next){case 0:t.fetching=!0,o=[],l=r(e);try{for(l.s();!(c=l.n()).done;)d=c.value,d&&o.push(t.fetchData(s(s({},t.params),{},{code:d})))}catch(i){l.e(i)}finally{l.f()}return a.next=6,Promise.all(o);case 6:u=a.sent,f=(0,p.flattenDeep)(u),h=(0,p.treeFormatList)(t.treeData),g=(0,p.uniqueBy)([].concat(n(h),n(f))),t.treeData=(0,p.listFormatTree)(g,t.replaceFields),t.fetching=!1;case 11:case"end":return a.stop()}}),a)})))()},handleLoadLazyData:function(e){var t=this,a=e;return new Promise((function(e){a.dataRef.children?e():t.fetchData(s(s({},t.params),{},{code:a.dataRef.key})).then((function(r){var i=(0,p.uniqueBy)(r,"key");a.dataRef.children=n(i),t.treeData=n(t.treeData),e(i)})).finally((function(){t.fetching=!1}))}))},onSelectSearch:function(e){/^\s*$/.test(e)||(this.handlerSearch(e),this.$emit("search",e))},handlerSearch:function(e){var t=this;return o(i().mark((function a(){var n,r;return i().wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(!t.lazy){a.next=8;break}return a.next=3,t.fetchDataByName(s(s({},t.params),{},{name:e})).catch((function(e){}));case 3:n=a.sent,r=(0,p.uniqueBy)(n,"key"),t.tmpSearchOption=(0,p.cloneDeep)(r)||[],t.selectOption=r.filter((function(t){return String(null===t||void 0===t?void 0:t.title).indexOf(e)>-1})),a.next=9;break;case 8:t.selectOption=(0,p.filterList)(t.treeData,(function(t){return String(null===t||void 0===t?void 0:t.title).indexOf(e)>-1}),t.replaceFields);case 9:case"end":return a.stop()}}),a)})))()},handleReturnValue:function(e){return Array.isArray(e)&&this.multiple?e:Array.isArray(e)&&0!==e.length?e[0]:Array.isArray(e)&&0===e.length?this.multiple?e:null:e},onSelectChange:function(e){var t=this;return o(i().mark((function a(){var r,o,l,s,c,d,u,f;return i().wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(o=Array.isArray(e)?e:[e],l=(0,p.cloneDeep)(t.selectOption).filter((function(e){return o.includes(e.key)})),!t.lazy){a.next=7;break}if(s=(0,p.treeFormatList)(t.treeData,t.replaceFields),c=s.map((function(e){return e.key})).filter((function(e){return e})),d=t.tmpSearchOption.filter((function(e){return!c.includes(e.key)})),u=d.map((function(e){return e.pkey})),a.t0=0!==u.length,!a.t0){a.next=7;break}return a.next=7,t.handleLoadMore(u);case 7:f=(0,p.getExpandedKeys)(t.treeData,Array.isArray(e)&&0!==e.length?e[0]:e,t.replaceFields),t.multiple?!t.treeSelectedKeys.includes(o)&&(r=t.treeSelectedKeys).push.apply(r,n(o)):t.treeSelectedKeys=o,Object.assign(t,{selectedValue:o,treeExpandedKeys:f,selectOption:l,fetching:!1}),t.onSelectTreeFn(e);case 9:case"end":return a.stop()}}),a)})))()},onExpandTree:function(e,t){this.treeExpandedKeys=Array.isArray(e)?e:[e],this.$emit("expand",this.treeExpandedKeys,t)},onSelectTreeFn:function(e){var t=this;return o(i().mark((function a(){var r,o,l,s,c,d,u,f,h;return i().wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(r=Array.isArray(e)?e:[e],o=Array.isArray(e)&&0!==e.length?e[0]:e,l=(0,p.treeFormatList)(t.treeData,t.replaceFields),s=l.map((function(e){return e.key})).filter((function(e){return e})),s.includes(o)){a.next=11;break}return a.next=4,t.fetchDataById({code:o});case 4:return c=a.sent,a.next=7,(0,p.uniqueBy)([].concat(n(l),n(c)));case 7:return d=a.sent,a.next=10,(0,p.listFormatTree)(d);case 10:t.treeData=a.sent;case 11:u=(0,p.getNodeBy)(t.treeData,o),f=(0,p.getExpandedKeys)(t.treeData,o),h=Array.from(new Set(t.multiple?[].concat(n(t.treeSelectedKeys),n(r)):r)),t.expandedKeys=[].concat(n(t.expandedKeys),n(f)),t.onSelectTree(h,{event:"select",selected:!0,node:{dataRef:u}});case 13:case"end":return a.stop()}}),a)})))()},onScrollIntoView:function(e){var t=this;this.$nextTick((function(){var a,n,r=document.querySelector(".select-picker-modal");r?null===(a=document.querySelector(".select-picker-modal #".concat(t.treeType,"_").concat(e)))||void 0===a||a.scrollIntoView({behavior:"smooth",block:"center"}):null===(n=document.getElementById("".concat(t.treeType,"_").concat(e)))||void 0===n||n.scrollIntoView({behavior:"smooth",block:"center"})}))},onSelectTree:function(e,t){var a=this;return o(i().mark((function n(){var r,o,l,s,c,d,u,f;return i().wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(n.t0=a.beforeSelect,!n.t0){n.next=4;break}return n.next=4,a.beforeSelect(e,t);case 4:r=Array.isArray(e)?e:[e],o=t.node.dataRef.key,Object.assign(a,{treeSelectedKeys:r}),l=(0,p.uniqueBy)((0,p.filterList)(a.treeData,(function(e){return a.treeSelectedKeys.includes(e.key)}),a.replaceFields)),s=[],a.join&&(s=l.map((function(e){var t={};for(var n in e)n&&(t[n]=(0,p.getSelectedBy)(a.treeData,o,n,a.replaceFields).join("string"===typeof a.join?a.join:","));return t}))),c=l.map((function(e){return e[a.valueField]})),d=a.handleReturnValue(c),u=a.handleReturnValue(l),f=a.handleReturnValue(s),a.$emit("select",{treeSelectedKeys:d,selectOption:u,joinSelectOption:f,treeData:(0,p.cloneDeep)(a.treeData)},t),Array.isArray(a.selectedValue)&&0!==a.selectedValue.length&&a.selectedValue[0]!==o&&(a.selectedValue=void 0,a.selectOption=[]),a.onScrollIntoView(o);case 11:case"end":return n.stop()}}),n)})))()},onCheckTree:function(e,t){var a=this;return o(i().mark((function n(){var r,o,l,s;return i().wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(n.t0=a.beforeCheck,!n.t0){n.next=4;break}return n.next=4,a.beforeCheck(e,t);case 4:r=Array.isArray(e)?e:[e],o=t.node.dataRef.key,Object.assign(a,{treeCheckedKeys:r}),l=(0,p.uniqueBy)((0,p.filterList)(a.treeData,(function(e){return a.treeCheckedKeys.includes(e.key)}),a.replaceFields)),s=l.map((function(e){return e[a.valueField]})),a.$emit("check",{treeCheckedKeys:s,checkOption:l,treeData:(0,p.cloneDeep)(a.treeData)},t),Array.isArray(a.selectedValue)&&0!==a.selectedValue.length&&a.selectedValue[0]!==o&&(a.selectedValue=void 0,a.selectOption=[]),a.onScrollIntoView(o);case 8:case"end":return n.stop()}}),n)})))()},oRightClick:function(e){this.$emit("rightClick",e)},onLazyLoad:function(e){this.treeLoadedKeys=e}}},g=h,m=a(483),y=(0,m.Z)(g,d,u,!1,null,null,null),b=y.exports,v=a(51);b.install=function(e,t){(0,v.Qb)(e,t);var a=(0,v.H_)(t);e.component(a+b.name,b)};var w=b},632:function(e){e.exports=a("6ea6")},142:function(e){e.exports=a("f23d")}},c={};function d(e){var a=c[e];if(void 0!==a)return a.exports;var n=c[e]={exports:{}};return t[e](n,n.exports,d),n.exports}!function(){d.d=function(e,t){for(var a in t)d.o(t,a)&&!d.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})}}(),function(){d.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}();var u={};!function(){d.d(u,{default:function(){return f}});var e=function(){var e=this,t=e._self._c;return t("SelectTree",e._g(e._b({ref:"org",attrs:{treeType:"ort",lazy:e.lazy,join:e.join,search:e.search,activeFirst:e.activeFirst,multiple:e.multiple,initLevel:e.initLevel,fetchData:e.fetchGetTree,fetchDataById:e.fetchGetTreeById,fetchDataByName:e.fetchGetTreeByName,replaceFields:e.replaceFields,valueField:e.valueField,isShowParent:e.isShowParent,params:e.params},on:{select:e.onSelectTreeData}},"SelectTree",e.$attrs,!1),e.$listeners),[t("template",{slot:"title"},[e._t("title")],2)],2)},t=[],a=d(657),n=d(632),r={inheritAttrs:!1,name:"OrgTree",components:{SelectTree:a["default"]},props:{baseUrl:{type:String,default:"/dts/bim"},treeApi:{type:String,default:"/q/cmTOrgMain/getCmTOrgMainTreeDataList/v1"},treeApiById:{type:String,default:"/q/cmTOrgMain/getCmTOrgMainTreeParentByOrgUniqueCode/v1"},treeApiByName:{type:String,default:"/q/cmTOrgMain/getCmTOrgMainTreeParentByOrgName/v1"},placeholder:{type:String,default:"请选择关键词搜索"},multiple:{type:Boolean,default:!1},isShowParent:{type:Boolean,default:!1},activeFirst:{type:Boolean,default:!1},allowClear:{type:Boolean,default:!1},initLevel:{type:[Number,null],default:2},limitLevel:{type:[Number,String,null],validator:function(e){return[1,2,3,4,5,6].includes(Number(e))},default:null},replaceFields:{type:Object,default:function(){return{pkey:"pkey",title:"title",key:"key",children:"children"}}},valueField:{type:String,default:"key"},join:{type:[String,Boolean],default:!1},search:{type:Boolean,default:!0},lazy:{type:Boolean,default:!0},params:{type:Object,default:function(){}}},data:function(){return{otherParams:{}}},methods:{fetchGetTree:function(e){var t=this;return new Promise((function(a,r){var i=null===e||void 0===e?void 0:e.code;i&&Reflect.deleteProperty(e,"code"),$ec.http.send(t.baseUrl+t.treeApi,s(s({orgLevelNum:t.limitLevel,bizCode:i},e),t.otherParams)).then((function(e){var r=e.rows,i=(0,n.treeFormatList)(r,t.replaceFields);a(i)})).catch((function(e){r(e)})).finally((function(){}))}))},fetchGetTreeById:function(e){var t=this;return new Promise((function(a,r){var i=null===e||void 0===e?void 0:e.code;i&&Reflect.deleteProperty(e,"code"),$ec.http.send(t.baseUrl+t.treeApiById,s(s({orgLevelNum:t.limitLevel,bizCode:i},e),t.otherParams)).then((function(e){var r=e.rows,i=(0,n.treeFormatList)(r,t.replaceFields);a(i)})).catch((function(e){r(e)})).finally((function(){}))}))},fetchGetTreeByName:function(e){var t=this;return new Promise((function(a,r){var i=null===e||void 0===e?void 0:e.name;i&&Reflect.deleteProperty(e,"name"),$ec.http.send(t.baseUrl+t.treeApiByName,s(s({orgLevelNum:t.limitLevel,orgName:i},e),t.otherParams)).then((function(e){var r=e.rows,i=(0,n.treeFormatList)(r,t.replaceFields);a(i)})).catch((function(e){r(e)})).finally((function(){}))}))},onSelectTreeData:function(e){var t=e.treeSelectedKeys,a=e.treeData,n=e.selectOption;Object.assign(this,{selectedKeys:t,selectOption:n,treeData:a})},onRefreshTree:function(e){this.otherParams=e,this.$refs.org&&this.$refs.org.handleTreeData(e)},onSelectTreeFn:function(e){this.$refs.org&&this.$refs.org.onSelectTreeFn(e)}}},i=r,o=d(483),l=(0,o.Z)(i,e,t,!1,null,null,null),c=l.exports,p=d(51);c.install=function(e,t){(0,p.Qb)(e,t);var a=(0,p.H_)(t);e.component(a+c.name,c)};var f=c}(),e.exports=u["default"]}()},"11b0":function(e,t,a){function n(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}a("a4d3"),a("e01a"),a("d3b7"),a("d28b"),a("3ca3"),a("ddb0"),a("a630"),e.exports=n,e.exports.__esModule=!0,e.exports["default"]=e.exports},"1d40":function(e,t,a){},2236:function(e,t,a){var n=a("5a43");function r(e){if(Array.isArray(e))return n(e)}e.exports=r,e.exports.__esModule=!0,e.exports["default"]=e.exports},"278c":function(e,t,a){var n=a("c135"),r=a("9b42"),i=a("6613"),o=a("c240");function l(e,t){return n(e)||r(e,t)||i(e,t)||o()}e.exports=l,e.exports.__esModule=!0,e.exports["default"]=e.exports},"2b22":function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ec-container",{attrs:{height:"100%"}},[a("ec-container-header",[a("ec-panel-item",[a("ec-panel-item-left",[a("ec-header",{attrs:{title:"收购计划执行量调整",icon:"onetomany","color-code":"008"}})],1)],1)],1),a("ec-container-body",[a("ec-panel",{attrs:{auto:!1}},[a("ec-panel-toolbar",[a("ec-query-panel",{attrs:{defaultFold:!0},on:{query:function(t){return e.$refs.table.pageAction(1)},reset:e.onReset},scopedSlots:e._u([{key:"inner",fn:function(){return[a("ec-query-item",{attrs:{label:"办理依据"}},[a("a-input",{attrs:{placeholder:"请输入办理依据"},model:{value:e.queryItems.remark,callback:function(t){e.$set(e.queryItems,"remark",t)},expression:"queryItems.remark"}})],1),a("ec-query-item",{attrs:{label:"单位名称"}},[a("org-picker",{attrs:{placeholder:"请选择"},model:{value:e.queryItems.orgCode,callback:function(t){e.$set(e.queryItems,"orgCode",t)},expression:"queryItems.orgCode"}})],1)]},proxy:!0}])},[a("ec-query-item",{attrs:{label:"烟叶类型"}},[a("ec-select",{attrs:{showSearch:"",allowClear:"",placeholder:"请选择"},model:{value:e.queryItems.leafTypeCode,callback:function(t){e.$set(e.queryItems,"leafTypeCode",t)},expression:"queryItems.leafTypeCode"}},e._l(e.leafTypeList,(function(t){return a("a-select-option",{key:t.leafTypeCode},[e._v(" "+e._s(t.leafTypeName)+" ")])})),1)],1),a("ec-query-item",{attrs:{label:"提交状态"}},[a("a-select",{attrs:{"allow-clear":"",placeholder:"请选择"},model:{value:e.queryItems.submitState,callback:function(t){e.$set(e.queryItems,"submitState",t)},expression:"queryItems.submitState"}},e._l(e.workSubmitState,(function(t){return a("a-select-option",{key:t.id},[e._v(" "+e._s(t.name)+" ")])})),1)],1),a("ec-query-item",{attrs:{label:"操作类型"}},[a("a-select",{attrs:{"allow-clear":"",placeholder:"请选择"},model:{value:e.queryItems.oprType,callback:function(t){e.$set(e.queryItems,"oprType",t)},expression:"queryItems.oprType"}},e._l(e.workOptType,(function(t){return a("a-select-option",{key:t.id},[e._v(" "+e._s(t.name)+" ")])})),1)],1)],1),a("ec-divider")],1),a("ec-panel-header",[a("ec-panel-item",[a("ec-panel-item-left",[a("a-button",{attrs:{type:"primary"},on:{click:e.onAdd}},[e._v("新增")]),a("a-button",{on:{click:e.onDel}},[e._v("删除")]),a("a-button",{on:{click:e.onSubmit}},[e._v("提交")])],1),a("ec-panel-item-right",[a("a-space",{attrs:{size:15}},[a("span",[e._v("重量单位："),a("ec-select",{staticStyle:{width:"150px"},attrs:{showSearch:"",allowClear:"",placeholder:"请选择"},on:{select:function(t){return e.handleUnitParse()}},model:{value:e.weightUnit,callback:function(t){e.weightUnit=t},expression:"weightUnit"}},e._l(e.weightUnitList,(function(t){return a("a-select-option",{key:t.weightUnitCd},[e._v(" "+e._s(t.weightUnitName)+" ")])})),1)],1),a("span",[e._v("面积单位："),a("ec-select",{staticStyle:{width:"150px"},attrs:{showSearch:"",allowClear:"",placeholder:"请选择"},on:{select:function(t){return e.handleUnitParse()}},model:{value:e.areaUnit,callback:function(t){e.areaUnit=t},expression:"areaUnit"}},e._l(e.areaUnitList,(function(t){return a("a-select-option",{key:t.areaUnitCd},[e._v(" "+e._s(t.areaUnitName)+" ")])})),1)],1)])],1)],1)],1),a("ec-panel-body",[a("ec-table",{ref:"table",attrs:{border:"",height:"100%",auto:!1,pagination:e.pagination,data:e.tableData.rows,loading:e.loading,"show-footer":"","footer-method":e.footerMethod,"highlight-current-row":""},on:{"page-action":e.handlePagination,"checkbox-all":e.selectAllEvent,"checkbox-change":e.selectRowChange}},[a("ec-table-col",{attrs:{type:"checkbox",width:"50",align:"center"}}),a("ec-table-col",{attrs:{title:"序号",type:"seq",width:"70",align:"center"}}),a("ec-table-col",{attrs:{field:"orgName",title:"单位名称",align:"left","min-width":"200"}}),a("ec-table-colgroup",{attrs:{title:"收购计划执行量"}},[a("ec-table-col",{attrs:{field:"aaPlanTotalWeight",title:"合计",align:"center",width:"120"}}),a("ec-table-col",{attrs:{field:"aaPlanInnerWeight",title:"国内",align:"center",width:"120"}}),a("ec-table-col",{attrs:{field:"aaPlanExportWeight",title:"出口备货",align:"center",width:"120"}})],1),a("ec-table-col",{attrs:{field:"aaPlanPlantArea",title:"种植面积",align:"right",width:"120"}}),a("ec-table-col",{attrs:{field:"remark",title:"办理依据",align:"left",width:"150"}}),a("ec-table-col",{attrs:{field:"submitState",title:"提交状态",align:"center",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.row;return["1"===n.submitState?a("div",[a("span",[e._v("已提交")])]):a("div",[a("span",[e._v("未提交")])])]}}])}),a("ec-table-col",{attrs:{title:"操作",align:"center",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.row;return[a("a-button",{attrs:{type:"link"},on:{click:function(t){return e.onEdit(n)}}},[e._v("编辑")]),a("a-button",{attrs:{type:"link"},on:{click:function(t){return e.onDetail(n)}}},[e._v("详细")])]}}])})],1)],1)],1),a("execution-enter-adjust-form",{ref:"ExecutionEnterAdjustForm",on:{onQuery:e.onQuery}}),a("execution-enter-adjust-add",{ref:"ExecutionEnterAdjustAdd",on:{onQuery:e.onQuery}}),a("detail",{ref:"Detail"})],1)],1)},r=[],i=a("c7eb"),o=a("1da1"),l=(a("e906"),a("dd14")),s=a.n(l),c=(a("e9c4"),a("d3b7"),a("159b"),a("b680"),a("7db0"),a("a9e3"),a("d81d"),a("caad"),a("99af"),function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ec-drawer",{staticClass:"ec-draw-form",attrs:{title:e.title,visible:e.visible,size:"large","is-confirm":!0},on:{close:e.onclose}},[a("ec-container",{attrs:{height:"auto",fixed:"top bottom","color-code":"007"}},[a("ec-container-body",[a("ec-panel",{attrs:{"color-code":"002"}},[a("ec-panel-header",[a("ec-panel-item-left",{staticClass:"ec-panel-item-left"},[a("div",{staticClass:"ec-panel-title"},[a("div",{staticClass:"ec-bar bg-color-1"}),a("div",{staticClass:"ec-title",staticStyle:{color:"rgb(24, 144, 255)","font-weight":"700"}},[e._v(" 第一步：选取单位、烟叶类型、操作类型 ")])])]),a("ec-panel-item-right",[a("div",{staticStyle:{display:"inline-block"}},[a("span",{staticStyle:{"margin-left":"14px"}},[e._v("种植收购年度："+e._s(e.nowYear)+"年;单位："+e._s(e.weightUnitName)+"、"+e._s(e.areaUnitName))])])])],1),a("ec-panel-item",[a("ec-form",{ref:"ruleForm1",attrs:{model:e.formData,rules:e.rules}},[a("a-row",{attrs:{type:"flex",gutter:12}},[a("a-col",{attrs:{span:8}},[a("a-form-model-item",{ref:"leafTypeCode",attrs:{prop:"leafTypeCode",label:"烟叶类型"}},[a("a-select",{attrs:{disabled:e.disabled,placeholder:"请选择"},model:{value:e.formData.leafTypeCode,callback:function(t){e.$set(e.formData,"leafTypeCode",t)},expression:"formData.leafTypeCode"}},e._l(e.leafTypeList,(function(t,n){return a("a-select-option",{key:n,attrs:{value:t.leafTypeCode}},[e._v(e._s(t.leafTypeName)+" ")])})),1)],1)],1),a("a-col",{attrs:{span:8}},[a("a-form-model-item",{ref:"orgName",attrs:{label:"单位名称",prop:"orgName"}},[a("a-input-number",{attrs:{min:0,placeholder:"请输入单位名称",disabled:e.disabled,autocomplete:"off"},model:{value:e.formData.orgName,callback:function(t){e.$set(e.formData,"orgName",t)},expression:"formData.orgName"}})],1)],1),a("a-col",{attrs:{span:8}},[a("a-form-model-item",{ref:"oprType",attrs:{prop:"oprType",label:"操作类型"}},[a("a-select",{attrs:{disabled:e.disabled,placeholder:"请选择"},on:{select:e.handleChangeOprType},model:{value:e.formData.oprType,callback:function(t){e.$set(e.formData,"oprType",t)},expression:"formData.oprType"}},e._l(e.workOptType,(function(t){return a("a-select-option",{key:t.id,attrs:{value:t.id}},[e._v(e._s(t.name)+" ")])})),1)],1)],1),a("a-col",{attrs:{span:12,layout:"horizontal"}},[a("a-form-model-item",{attrs:{label:"办理依据"}},[a("a-textarea",{attrs:{"max-length":225},model:{value:e.formData.remark,callback:function(t){e.$set(e.formData,"remark",t)},expression:"formData.remark"}})],1)],1)],1)],1)],1)],1),a("ec-panel",{attrs:{"color-code":"002"}},[a("ec-panel-header",[a("ec-panel-item-left",{staticClass:"ec-panel-item-left"},[a("div",{staticClass:"ec-panel-title"},[a("div",{staticClass:"ec-bar bg-color-1"}),a("div",{staticClass:"ec-title",staticStyle:{color:"rgb(24, 144, 255)","font-weight":"700"}},[e._v(" 第二步：录入/编辑数量 ")])])])],1),a("ec-panel-item",[a("a-alert",{attrs:{type:"warning"}},[a("div",{staticStyle:{color:"#1890ff"},attrs:{slot:"message"},slot:"message"},[e._v(" "+e._s(e.formData.orgName)+"已分解收购计划执行量： "),a("span",{staticStyle:{color:"#1890ff","font-weight":"700"}},[e._v(e._s(e.resolveData.planTotalWeight))]),e._v(" "+e._s(e.weightUnitName)+"(其中国内："+e._s(e.resolveData.planInnerWeight)+e._s(e.weightUnitName)+"、出口备货："+e._s(e.resolveData.planExportWeight)+e._s(e.weightUnitName)+")，种植面积："+e._s(e.resolveData.planPlantArea)+e._s(e.areaUnitName)+" ")])])],1),a("ec-panel-body",[a("ec-table",{ref:"xTable",staticClass:"my-xtable-antd",attrs:{border:"","show-overflow":"","keep-source":"",loading:e.saving,data:e.tableData,"edit-config":{trigger:"click",mode:"row"}}},[a("ec-table-col",{attrs:{field:"name",title:"",align:"left",width:"150"}}),a("ec-table-colgroup",{attrs:{title:"收购计划执行量"}},[a("ec-table-col",{attrs:{field:"planTotalWeight",title:"合计",align:"center",width:"200","edit-render":{}},scopedSlots:e._u([{key:"edit",fn:function(t){var n=t.row;return["本次调整"===n.name?a("a-input-number",{attrs:{min:0,max:1e5,precision:2},on:{blur:function(t){return e.handleCurrentDataChange(n,"planTotalWeight")}},model:{value:n.planTotalWeight,callback:function(t){e.$set(n,"planTotalWeight",t)},expression:"row.planTotalWeight"}}):[e._v(e._s(n.planTotalWeight))]]}}])}),a("ec-table-col",{attrs:{field:"planInnerWeight",title:"国内",align:"center",width:"150"}}),a("ec-table-col",{attrs:{field:"planExportWeight",title:"出口备货",width:"200",align:"center","edit-render":{}},scopedSlots:e._u([{key:"edit",fn:function(t){var n=t.row;return["本次调整"===n.name?a("a-input-number",{attrs:{min:0,max:1e5,precision:2},on:{blur:function(t){return e.handleCurrentDataChange(n,"planExportWeight")}},model:{value:n.planExportWeight,callback:function(t){e.$set(n,"planExportWeight",t)},expression:"row.planExportWeight"}}):[e._v(e._s(n.planExportWeight))]]}}])})],1),a("ec-table-col",{attrs:{field:"planPlantArea",title:"种植面积","min-width":"150",align:"right","edit-render":{}},scopedSlots:e._u([{key:"edit",fn:function(t){var n=t.row;return["本次调整"===n.name?a("a-input-number",{attrs:{min:0,max:1e5,precision:2},on:{blur:function(t){return e.handleCurrentDataChange(n,"planPlantArea")}},model:{value:n.planPlantArea,callback:function(t){e.$set(n,"planPlantArea",t)},expression:"row.planPlantArea"}}):[e._v(e._s(n.planPlantArea))]]}}])})],1)],1)],1)],1),a("ec-container-footer",{attrs:{fixed:""}},[a("a-space",[a("a-button",{attrs:{type:"primary",loading:e.saving},on:{click:function(t){return e.onSave("save")}}},[e._v("保存")]),a("a-button",{on:{click:e.onclose}},[e._v("关闭")])],1)],1)],1)],1)}),d=[],u=(a("a434"),a("b0c0"),a("2ef0")),p=a.n(u),f={name:"ExecutionEnterAdjustFormManage",data:function(){return{title:"编辑",isEditor:!1,disabled:!0,tableData:[],data:{},leafTypeName:"",leafTypeCode:"",weightUnitName:"",weightUnit:1,areaUnitName:"",areaUnit:1,nowYear:"",orgCode:"",rowData:"",visible:!1,saving:!1,isShowSaveAndAdd:!0,ruleForm:{},leafTypeList:[],resolveData:{},oldObjData:{},workOptType:[{id:"2",name:"减量"},{id:"1",name:"增量"}],formData:{leafTypeCode:"",orgName:void 0,oprType:void 0,remark:void 0},beforeAjustData:{},rules:{oprType:{required:!0,message:"请选择操作类型",trigger:"blur"},orgName:{required:!0,message:"请选择单位",trigger:"blur"},leafTypeCode:{required:!0,message:"请选择烟叶类型",trigger:"blur"}}}},methods:{handleChangeOprType:function(){this.tableData.splice(this.tableData.length-1,1),this.handleAfterAdjustData()},handleGetBeforeAdjustData:function(){var e=this;return Object(o["a"])(Object(i["a"])().mark((function t(){var a,n,r;return Object(i["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=p.a.cloneDeep(e.oldObjData),a.name="调整前",a.signId="before",e.beforeAjustData=a,e.beforeAjustData=e.handleDataParse(a),n={leafTypeCode:e.leafTypeCode,orgCode:e.orgCode,busiYear:e.nowYear},console.log("分解参数数据：".concat(JSON.stringify(n))),t.next=9,e.$apis.bpm.executionEnter.getResolveData(n);case 9:r=t.sent,e.resolveData=e.handleResolveDataParse(r),console.log("分解数据：".concat(JSON.stringify(r)));case 12:case"end":return t.stop()}}),t)})))()},handleResolveDataParse:function(e){var t=e;return t.planTotalWeight=(t.planTotalWeight/this.weightUnit).toFixed(2),t.planInnerWeight=(t.planInnerWeight/this.weightUnit).toFixed(2),t.planExportWeight=(t.planExportWeight/this.weightUnit).toFixed(2),t.planPlantArea=(t.planPlantArea/this.areaUnit).toFixed(2),t},handleDataParse:function(e){var t=e;return t.planTotalWeight=t.baPlanTotalWeight?Number(t.baPlanTotalWeight/this.weightUnit).toFixed(2):"0.00",t.planInnerWeight=t.baPlanInnerWeight?Number(t.baPlanInnerWeight/this.weightUnit).toFixed(2):"0.00",t.planExportWeight=t.baPlanExportWeight?Number(t.baPlanExportWeight/this.weightUnit).toFixed(2):"0.00",t.planPlantArea=t.baPlanPlantArea?Number(t.baPlanPlantArea/this.areaUnit).toFixed(2):"0.00",t},handleCurrentDataChange:function(e,t){var a=e;if("planExportWeight"===t||"planTotalWeight"===t){var n=Number(e.planTotalWeight)||0,r=Number(e.planExportWeight)||0;if(n<r){this.$message.warn("合计不能小于出口备货"),"planTotalWeight"===t&&(a.planTotalWeight="0"),"planExportWeight"===t&&(a.planExportWeight="0");var i=Number(a.planTotalWeight)||0,o=Number(a.planExportWeight)||0,l=(i-o).toFixed(2);return void(a.planInnerWeight=l)}var s=(n-r).toFixed(2);a.planInnerWeight=s}this.tableData.splice(this.tableData.length-1,1),this.handleAfterAdjustData()},show:function(e){var t=this;return Object(o["a"])(Object(i["a"])().mark((function a(){var n,r,o;return Object(i["a"])().wrap((function(a){while(1)switch(a.prev=a.next){case 0:return t.visible=!0,t.data=e,n=e.selectedRows,t.oldObjData=p.a.cloneDeep(n),t.leafTypeName=e.leafTypeObj.leafTypeName,t.leafTypeCode=e.leafTypeObj.leafTypeCode,t.weightUnitName=e.weightUnitObj.weightUnitName,t.weightUnit=e.weightUnitObj.weightUnitCd,t.areaUnit=e.areaUnitObj.areaUnitCd,t.areaUnitName=e.areaUnitObj.areaUnitName,t.orgCode=e.selectedRows.orgCode,t.nowYear=e.nowYear,t.leafTypeList=e.leafTypeList,r=e.type,t.visible=!0,t.isShowSaveAndAdd=!0,t.isEditor=!1,t.formData={leafTypeCode:t.leafTypeCd,orgName:void 0,oprType:"1",remark:void 0},a.next=20,t.handleGetBeforeAdjustData();case 20:t.tableData.push(t.beforeAjustData),o={name:"本次调整",signId:"current",planTotalWeight:0,planInnerWeight:0,planExportWeight:0,planPlantArea:0},"edit"===r&&(t.isEditor=!0,t.title="编辑",t.formData=n,t.isShowSaveAndAdd=!1,o.planTotalWeight=n.planTotalWeight,o.planInnerWeight=n.planInnerWeight,o.planExportWeight=n.planExportWeight,o.planPlantArea=n.planPlantArea),t.tableData.push(o),console.log(t.tableData),t.handleAfterAdjustData();case 26:case"end":return a.stop()}}),a)})))()},sumNum:function(e,t){var a=0,n=this.formData.oprType;return"1"===n?e.forEach((function(e){console.log("++++++".concat(n));var r=e;r[t]=r[t]||0,a+=Number(e[t])})):e.forEach((function(e){console.log("------".concat(n));var r=e;r[t]=r[t]||0;var i=e.signId;"before"===i?a+=Number(e[t]):a-=Number(e[t])})),a.toFixed(2)},handleAfterAdjustData:function(){var e=this,t=["planTotalWeight","planInnerWeight","planExportWeight","planPlantArea"],a={name:"调整后",signId:"after"};t.forEach((function(t){a[t]=e.sumNum(e.tableData,t)})),this.tableData.push(a)},handleBeforeSaveAdjustData:function(){var e=this,t=JSON.parse(JSON.stringify(this.tableData)),a=JSON.parse(JSON.stringify(this.oldObjData));return a.remark=this.formData.remark,t.forEach((function(t){var n=t;"before"===t.signId&&(a.baPlanTotalWeight=(n.planTotalWeight*e.weightUnit).toFixed(2),a.baPlanInnerWeight=(n.planInnerWeight*e.weightUnit).toFixed(2),a.baPlanExportWeight=(n.planExportWeight*e.weightUnit).toFixed(2),a.baPlanPlantArea=(n.planPlantArea*e.areaUnit).toFixed(2)),"current"===t.signId&&(a.planTotalWeight=(n.planTotalWeight*e.weightUnit).toFixed(2),a.planInnerWeight=(n.planInnerWeight*e.weightUnit).toFixed(2),a.planExportWeight=(n.planExportWeight*e.weightUnit).toFixed(2),a.planPlantArea=(n.planPlantArea*e.areaUnit).toFixed(2)),"after"===t.signId&&(a.aaPlanTotalWeight=(n.planTotalWeight*e.weightUnit).toFixed(2),a.aaPlanInnerWeight=(n.planInnerWeight*e.weightUnit).toFixed(2),a.aaPlanExportWeight=(n.planExportWeight*e.weightUnit).toFixed(2),a.aaPlanPlantArea=(n.planPlantArea*e.areaUnit).toFixed(2))})),console.log("保存的数据处理完之后：".concat(JSON.stringify(t))),a},onSave:function(e){var t=this;this.$refs.ruleForm1.validate(function(){var a=Object(o["a"])(Object(i["a"])().mark((function a(n){var r,o;return Object(i["a"])().wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(n){a.next=2;break}return a.abrupt("return");case 2:t.saving=!0,r=t.formData,console.log("".concat(e,"===").concat(JSON.stringify(r))),o=t.handleBeforeSaveAdjustData(),t.$apis.bpm.executionEnter.updateAdjustData(o).then((function(e){console.log(JSON.stringify(e)),e.result?(t.saving=!1,t.$message.success("操作成功"),t.$emit("onQuery"),t.onclose()):(t.saving=!1,t.$message.error("操作失败"))})).catch((function(e){console.log(e),t.saving=!1}));case 7:case"end":return a.stop()}}),a)})));return function(e){return a.apply(this,arguments)}}())},onclose:function(){this.$refs.ruleForm1.resetFields(),this.tableData=[],this.formData={},this.visible=!1}}},h=f,g=a("2877"),m=Object(g["a"])(h,c,d,!1,null,null,null),y=m.exports,b=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ec-drawer",{staticClass:"ec-draw-form",attrs:{title:e.title,visible:e.visible,size:"large","is-confirm":!0},on:{close:e.onclose}},[a("ec-container",{attrs:{height:"100%",fixed:"top bottom","color-code":"007"}},[a("ec-container-body",[a("ec-panel",{attrs:{"color-code":"002"}},[a("ec-panel-header",[a("ec-panel-item-left",{staticClass:"ec-panel-item-left"},[a("div",{staticClass:"ec-panel-title"},[a("div",{staticClass:"ec-bar bg-color-1"}),a("div",{staticClass:"ec-title",staticStyle:{color:"rgb(24, 144, 255)","font-weight":"700"}},[e._v(" 第一步：选取单位、烟叶类型、操作类型 ")])])]),a("ec-panel-item-right",[a("div",{staticStyle:{display:"inline-block"}},[a("span",{staticStyle:{"margin-left":"14px"}},[e._v("种植收购年度："+e._s(e.nowYear)+"年;单位："+e._s(e.weightUnitName)+"、"+e._s(e.areaUnitName))])])])],1),a("ec-panel-item",[a("ec-form",{ref:"ruleForm1",attrs:{model:e.formData,rules:e.rules}},[a("a-row",{attrs:{type:"flex",gutter:12}},[a("a-col",{attrs:{span:8}},[a("a-form-model-item",{ref:"leafTypeCode",attrs:{prop:"leafTypeCode",label:"烟叶类型"}},[a("a-select",{attrs:{placeholder:"请选择"},on:{change:function(t){return e.handleFormChange()}},model:{value:e.formData.leafTypeCode,callback:function(t){e.$set(e.formData,"leafTypeCode",t)},expression:"formData.leafTypeCode"}},e._l(e.leafTypeList,(function(t,n){return a("a-select-option",{key:n,attrs:{value:t.leafTypeCode}},[e._v(e._s(t.leafTypeName)+" ")])})),1)],1)],1),a("a-col",{attrs:{span:8}},[a("a-form-model-item",{ref:"orgCodeList",attrs:{label:"单位名称",prop:"orgCodeList"}},[a("org-picker",{attrs:{placeholder:"请选择"},on:{ok:function(t){return e.handleFormChange()}},model:{value:e.formData.orgCodeList,callback:function(t){e.$set(e.formData,"orgCodeList",t)},expression:"formData.orgCodeList"}})],1)],1),a("a-col",{attrs:{span:8}},[a("a-form-model-item",{ref:"oprType",attrs:{prop:"oprType",label:"操作类型"}},[a("a-select",{attrs:{placeholder:"请选择"},on:{select:e.handleChangeOprType},model:{value:e.formData.oprType,callback:function(t){e.$set(e.formData,"oprType",t)},expression:"formData.oprType"}},e._l(e.workOptType,(function(t){return a("a-select-option",{key:t.id,attrs:{value:t.id}},[e._v(e._s(t.name)+" ")])})),1)],1)],1),a("a-col",{attrs:{span:12,layout:"horizontal"}},[a("a-form-model-item",{attrs:{label:"办理依据"}},[a("a-textarea",{attrs:{"max-length":225},model:{value:e.formData.remark,callback:function(t){e.$set(e.formData,"remark",t)},expression:"formData.remark"}})],1)],1)],1)],1)],1)],1),a("ec-panel",{attrs:{"color-code":"002"}},[a("ec-panel-header",[a("ec-panel-item-left",{staticClass:"ec-panel-item-left"},[a("div",{staticClass:"ec-panel-title"},[a("div",{staticClass:"ec-bar bg-color-1"}),a("div",{staticClass:"ec-title",staticStyle:{color:"rgb(24, 144, 255)","font-weight":"700"}},[e._v(" 第二步：录入/编辑数量 ")])])])],1),a("ec-panel-item",[a("a-alert",{attrs:{type:"warning"}},[a("div",{staticStyle:{color:"#1890ff"},attrs:{slot:"message"},slot:"message"},[e._v(" "+e._s(e.resolveData.orgName)+"已分解收购计划执行量： "),a("span",{staticStyle:{color:"#1890ff","font-weight":"700"}},[e._v(e._s(e.resolveData.planTotalWeight))]),e._v(" "+e._s(e.weightUnitName)+"(其中国内："+e._s(e.resolveData.planInnerWeight)+e._s(e.weightUnitName)+"、出口备货："+e._s(e.resolveData.planExportWeight)+e._s(e.weightUnitName)+")，种植面积："+e._s(e.resolveData.planPlantArea)+e._s(e.areaUnitName)+" ")])])],1),a("ec-panel-body",[a("ec-table",{ref:"table",staticClass:"my-xtable-antd",attrs:{border:"","show-overflow":"","keep-source":"",loading:e.saving,data:e.tableData,"edit-config":{trigger:"click",mode:"row"}}},[a("ec-table-col",{attrs:{field:"name",title:"",align:"left",width:"150"}}),a("ec-table-colgroup",{attrs:{title:"收购计划执行量"}},[a("ec-table-col",{attrs:{field:"planTotalWeight",title:"合计",align:"center",width:"200","edit-render":{}},scopedSlots:e._u([{key:"edit",fn:function(t){var n=t.row;return["本次调整"===n.name?a("a-input-number",{attrs:{min:0,max:1e5,precision:2},on:{blur:function(t){return e.handleCurrentDataChange(n,"planTotalWeight")}},model:{value:n.planTotalWeight,callback:function(t){e.$set(n,"planTotalWeight",t)},expression:"row.planTotalWeight"}}):[e._v(e._s(n.planTotalWeight))]]}}])}),a("ec-table-col",{attrs:{field:"planInnerWeight",title:"国内",align:"center",width:"150"}}),a("ec-table-col",{attrs:{field:"planExportWeight",title:"出口备货",width:"200",align:"center","edit-render":{}},scopedSlots:e._u([{key:"edit",fn:function(t){var n=t.row;return["本次调整"===n.name?a("a-input-number",{attrs:{min:0,max:1e5,precision:2},on:{blur:function(t){return e.handleCurrentDataChange(n,"planExportWeight")}},model:{value:n.planExportWeight,callback:function(t){e.$set(n,"planExportWeight",t)},expression:"row.planExportWeight"}}):[e._v(e._s(n.planExportWeight))]]}}])})],1),a("ec-table-col",{attrs:{field:"planPlantArea",title:"种植面积","min-width":"150",align:"right","edit-render":{}},scopedSlots:e._u([{key:"edit",fn:function(t){var n=t.row;return["本次调整"===n.name?a("a-input-number",{attrs:{min:0,max:1e5,precision:2},on:{blur:function(t){return e.handleCurrentDataChange(n,"planPlantArea")}},model:{value:n.planPlantArea,callback:function(t){e.$set(n,"planPlantArea",t)},expression:"row.planPlantArea"}}):[e._v(e._s(n.planPlantArea))]]}}])})],1)],1)],1)],1),a("ec-container-footer",{attrs:{fixed:""}},[a("a-space",[a("a-button",{attrs:{id:"saveAndAddBtn",loading:e.saving},on:{click:function(t){return e.onSave("saveAndAdd")}}},[e._v("保存并新增")]),a("a-button",{attrs:{type:"primary",loading:e.saving},on:{click:function(t){return e.onSave("save")}}},[e._v("保存")]),a("a-button",{on:{click:e.onclose}},[e._v("关闭")])],1)],1)],1)],1)},v=[],w=(a("a4e1"),a("b3a0")),x=a.n(w),T=(a("3816"),a("0ef8")),D=a.n(T),C=(a("d9e2"),{name:"ExecutionEnterAdjustFormManage",components:{OrgPicker:s.a,OrgTree:D.a,DivisionPicker:x.a},data:function(){var e=function(e,t,a){if(0===t.length)return a(new Error("请选择单位"));a()};return{title:"新增",isEditor:!1,tableData:[],data:{},leafTypeName:"",leafTypeCode:"",weightUnitName:"",weightUnit:1,areaUnitName:"",areaUnit:1,nowYear:"",orgCode:"",rowData:"",visible:!1,saving:!1,isShowSaveAndAdd:!0,ruleForm:{},leafTypeList:[],resolveData:{},oldObjData:{},workOptType:[{id:"2",name:"减量"},{id:"1",name:"增量"}],formData:{leafTypeCode:"",orgCodeList:void 0,oprType:"1",remark:void 0},beforeAjustData:{},rules:{oprType:{required:!0,message:"请选择操作类型",trigger:"blur"},orgCodeList:[{validator:e,required:!0,trigger:"change"}],leafTypeCode:{required:!0,message:"请选择烟叶类型",trigger:"blur"}}}},methods:{handleChangeOprType:function(){this.tableData.splice(this.tableData.length-1,1),this.handleAfterAdjustData()},handleFormChange:function(){var e=this;return Object(o["a"])(Object(i["a"])().mark((function t(){var a;return Object(i["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.tableData=[],t.next=3,e.handleGetBeforeAdjustData();case 3:e.tableData.push(e.beforeAjustData),a={name:"本次调整",signId:"current",planTotalWeight:0,planInnerWeight:0,planExportWeight:0,planPlantArea:0},e.tableData.push(a),e.handleAfterAdjustData();case 7:case"end":return t.stop()}}),t)})))()},handleGetBeforeAdjustData:function(){var e=this;return Object(o["a"])(Object(i["a"])().mark((function t(){var a,n,r,o;return Object(i["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=e.formData.orgCodeList,t.next=3,e.$apis.bpm.executionAudit.beforeAdjust({leafTypeCode:e.formData.leafTypeCode,orgCode:a,busiYear:e.nowYear});case 3:return n=t.sent,n.name="调整前",n.signId="before",e.beforeAjustData=e.handleDataParse(n),r={leafTypeCode:e.formData.leafTypeCode,orgCode:a,busiYear:e.nowYear},console.log("分解参数数据：".concat(JSON.stringify(r))),t.next=11,e.$apis.bpm.executionEnter.getResolveData(r);case 11:o=t.sent,e.resolveData=e.handleResolveDataParse(o),console.log("分解数据：".concat(JSON.stringify(o)));case 14:case"end":return t.stop()}}),t)})))()},handleResolveDataParse:function(e){var t=e;return t.planTotalWeight=(t.planTotalWeight/this.weightUnit).toFixed(2),t.planInnerWeight=(t.planInnerWeight/this.weightUnit).toFixed(2),t.planExportWeight=(t.planExportWeight/this.weightUnit).toFixed(2),t.planPlantArea=(t.planPlantArea/this.areaUnit).toFixed(2),t},handleDataParse:function(e){var t=e;return t.planTotalWeight=t.planTotalWeight?Number(t.planTotalWeight/this.weightUnit).toFixed(2):"0.00",t.planInnerWeight=t.planInnerWeight?Number(t.planInnerWeight/this.weightUnit).toFixed(2):"0.00",t.planExportWeight=t.planExportWeight?Number(t.planExportWeight/this.weightUnit).toFixed(2):"0.00",t.planPlantArea=t.planPlantArea?Number(t.planPlantArea/this.areaUnit).toFixed(2):"0.00",t},handleCurrentDataChange:function(e,t){var a=e;if("planExportWeight"===t||"planTotalWeight"===t){var n=Number(e.planTotalWeight)||0,r=Number(e.planExportWeight)||0;if(n<r){this.$message.warn("合计不能小于出口备货"),"planTotalWeight"===t&&(a.planTotalWeight="0"),"planExportWeight"===t&&(a.planExportWeight="0");var i=Number(a.planTotalWeight)||0,o=Number(a.planExportWeight)||0,l=(i-o).toFixed(2);return void(a.planInnerWeight=l)}var s=(n-r).toFixed(2);a.planInnerWeight=s}this.tableData.splice(this.tableData.length-1,1),this.handleAfterAdjustData()},show:function(e){var t=this;return Object(o["a"])(Object(i["a"])().mark((function a(){var n;return Object(i["a"])().wrap((function(a){while(1)switch(a.prev=a.next){case 0:t.visible=!0,t.data=e,n=e.selectedRows,t.oldObjData=JSON.parse(JSON.stringify(n)),t.leafTypeName=e.leafTypeObj.leafTypeName,t.leafTypeCode=e.leafTypeObj.leafTypeCode,t.weightUnitName=e.weightUnitObj.weightUnitName,t.weightUnit=e.weightUnitObj.weightUnitCd,t.areaUnit=e.areaUnitObj.areaUnitCd,t.areaUnitName=e.areaUnitObj.areaUnitName,t.orgCode=e.selectedRows.orgCode,t.nowYear=e.nowYear,t.leafTypeList=e.leafTypeList,t.visible=!0,t.isShowSaveAndAdd=!0,t.isEditor=!1,t.formData={leafTypeCode:t.leafTypeCode,orgCodeList:void 0,oprType:"1",remark:void 0};case 17:case"end":return a.stop()}}),a)})))()},sumNum:function(e,t){var a=0,n=this.formData.oprType;return"1"===n?e.forEach((function(e){console.log("++++++".concat(n));var r=e;r[t]=r[t]||0,a+=Number(e[t])})):e.forEach((function(e){console.log("------".concat(n));var r=e;r[t]=r[t]||0;var i=e.signId;"before"===i?a+=Number(e[t]):a-=Number(e[t])})),a.toFixed(2)},handleAfterAdjustData:function(){var e=this,t=["planTotalWeight","planInnerWeight","planExportWeight","planPlantArea"],a={name:"调整后",signId:"after"};t.forEach((function(t){a[t]=e.sumNum(e.tableData,t)})),this.tableData.push(a)},handleBeforeSaveAdjustData:function(){var e=this,t=JSON.parse(JSON.stringify(this.tableData)),a={},n=this.formData.oprType;return a.remark=this.formData.remark,a.leafTypeCode=this.formData.leafTypeCode,a.orgCode=this.formData.orgCodeList,a.oprType=n,a.busiYear=this.nowYear,a.oprSymbol="1"===n?"1":"-1",t.forEach((function(t){var n=t;"before"===t.signId&&(a.baPlanTotalWeight=(n.planTotalWeight*e.weightUnit).toFixed(2),a.baPlanInnerWeight=(n.planInnerWeight*e.weightUnit).toFixed(2),a.baPlanExportWeight=(n.planExportWeight*e.weightUnit).toFixed(2),a.baPlanPlantArea=(n.planPlantArea*e.areaUnit).toFixed(2)),"current"===t.signId&&(a.planTotalWeight=(n.planTotalWeight*e.weightUnit).toFixed(2),a.planInnerWeight=(n.planInnerWeight*e.weightUnit).toFixed(2),a.planExportWeight=(n.planExportWeight*e.weightUnit).toFixed(2),a.planPlantArea=(n.planPlantArea*e.areaUnit).toFixed(2)),"after"===t.signId&&(a.aaPlanTotalWeight=(n.planTotalWeight*e.weightUnit).toFixed(2),a.aaPlanInnerWeight=(n.planInnerWeight*e.weightUnit).toFixed(2),a.aaPlanExportWeight=(n.planExportWeight*e.weightUnit).toFixed(2),a.aaPlanPlantArea=(n.planPlantArea*e.areaUnit).toFixed(2))})),console.log("保存的数据处理完之后：".concat(JSON.stringify(t))),a},onSave:function(e){var t=this;this.$refs.ruleForm1.validate(function(){var a=Object(o["a"])(Object(i["a"])().mark((function a(n){var r,o;return Object(i["a"])().wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(n){a.next=2;break}return a.abrupt("return");case 2:t.saving=!0,r=t.formData,console.log("".concat(e,"===").concat(JSON.stringify(r))),o=t.handleBeforeSaveAdjustData(),t.$apis.bpm.executionEnter.addAdjustData(o).then((function(a){console.log(JSON.stringify(a)),a.result?(t.saving=!1,t.$message.success("操作成功"),t.handleSaveAfter(e)):(t.saving=!1,t.$message.error("操作失败"))})).catch((function(e){console.log(e),t.saving=!1}));case 7:case"end":return a.stop()}}),a)})));return function(e){return a.apply(this,arguments)}}())},handleSaveAfter:function(e){var t=this;return Object(o["a"])(Object(i["a"])().mark((function a(){var n;return Object(i["a"])().wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(t.$emit("onQuery"),t.saving=!1,"saveAndAdd"!==e){a.next=13;break}return t.tableData=[],a.next=6,t.handleGetBeforeAdjustData();case 6:t.tableData.push(t.beforeAjustData),n={name:"本次调整",signId:"current",planTotalWeight:0,planInnerWeight:0,planExportWeight:0,planPlantArea:0},t.tableData.push(n),t.handleAfterAdjustData(),t.formData={leafTypeCode:t.leafTypeCode,orgCodeList:t.formData.orgCodeList,oprType:void 0,remark:void 0},a.next=15;break;case 13:t.visible=!1,t.onclose();case 15:case"end":return a.stop()}}),a)})))()},onclose:function(){this.$refs.ruleForm1.resetFields(),this.tableData=[],this.formData={leafTypeCode:this.leafTypeCode,orgCodeList:void 0,oprType:void 0,remark:void 0},this.visible=!1}}}),S=C,k=Object(g["a"])(S,b,v,!1,null,null,null),A=k.exports,_=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ec-drawer",{staticClass:"ec-draw-form",attrs:{title:e.title,visible:e.visible,size:"large"},on:{close:e.onclose}},[a("ec-container",{attrs:{height:"auto",fixed:"top bottom","color-code":"007"}},[a("ec-container-body",[a("ec-panel",{attrs:{"color-code":"002"}},[a("ec-panel-header",[a("ec-panel-item-left",{staticClass:"ec-panel-item-left"},[a("div",{staticClass:"ec-panel-title"},[a("div",{staticClass:"ec-bar bg-color-1"}),a("div",{staticClass:"ec-title",staticStyle:{color:"rgb(24, 144, 255)","font-weight":"700"}},[e._v(" 第一步：选取单位、烟叶类型、操作类型 ")])])]),a("ec-panel-item-right",[a("div",{staticStyle:{display:"inline-block"}},[a("span",{staticStyle:{"margin-left":"14px"}},[e._v("种植收购年度："+e._s(e.nowYear)+"年;单位："+e._s(e.weightUnitName)+"、"+e._s(e.areaUnitName))])])])],1),a("ec-panel-item",[a("ec-form",{ref:"ruleForm1",attrs:{model:e.formData,rules:e.rules}},[a("a-row",{attrs:{type:"flex",gutter:12}},[a("a-col",{attrs:{span:8}},[a("a-form-model-item",{attrs:{label:"烟叶类型"}},[e._v(e._s(e.formData.leafTypeName||"--"))])],1),a("a-col",{attrs:{span:8}},[a("a-form-model-item",{attrs:{label:"单位名称"}},[e._v(e._s(e.formData.orgName||"--"))])],1),a("a-col",{attrs:{span:8}},[a("a-form-model-item",{attrs:{label:"操作类型"}},[e._v(e._s(e.formData.oprTypeName||"--"))])],1),a("a-col",{attrs:{span:12}},[a("a-form-model-item",{attrs:{label:"办理依据"}},[e._v(e._s(e.formData.remark||"--"))])],1)],1)],1)],1)],1),a("ec-panel",{attrs:{"color-code":"002"}},[a("ec-panel-header",[a("ec-panel-item-left",{staticClass:"ec-panel-item-left"},[a("div",{staticClass:"ec-panel-title"},[a("div",{staticClass:"ec-bar bg-color-1"}),a("div",{staticClass:"ec-title",staticStyle:{color:"rgb(24, 144, 255)","font-weight":"700"}},[e._v(" 第二步：录入/编辑数量 ")])])])],1),a("ec-panel-body",[a("ec-table",{ref:"xTable",staticClass:"my-xtable-antd",attrs:{border:"","show-overflow":"","keep-source":"",data:e.tableData}},[a("ec-table-col",{attrs:{field:"name",title:"",align:"left","min-width":"150"}}),a("ec-table-colgroup",{attrs:{title:"收购计划执行量"}},[a("ec-table-col",{attrs:{field:"planTotalWeight",title:"合计",align:"center",width:"200"}}),a("ec-table-col",{attrs:{field:"planInnerWeight",title:"国内",align:"center",width:"200"}}),a("ec-table-col",{attrs:{field:"planExportWeight",title:"出口备货",align:"center",width:"200"}})],1),a("ec-table-col",{attrs:{field:"planPlantArea",title:"种植面积",align:"right",width:"200"}})],1)],1)],1)],1),a("ec-container-footer",{attrs:{fixed:""}},[a("a-space",[a("a-button",{on:{click:e.onclose}},[e._v("关闭")])],1)],1)],1)],1)},O=[],U={name:"ExecutionEnterAdjustDetManage",data:function(){return{title:"新增",tableData:[],data:{},leafTypeName:"",leafTypeCode:"",weightUnitName:"",areaUnitName:"",nowYear:"",rowData:"",orgCode:"",visible:!1,isShowSaveAndAdd:!0,ruleForm:{},leafTypeList:[],workOptType:[{id:"0",name:"减量"},{id:"1",name:"增量"}],formData:{leafTypeCode:"",orgName:"",oprType:"",remark:""},beforeAjustData:{},rules:{oprType:{required:!0,message:"请选择操作类型",trigger:"blur"},orgName:{required:!0,message:"请选择单位",trigger:"blur"},leafTypeCode:{required:!0,message:"请选择烟叶类型",trigger:"blur"}}}},methods:{handleGetBeforeAdjustData:function(){var e={name:"调整前",planTotalWeight:5e5,planInnerWeight:2e5,planExportWeight:3e5,planPlantArea:6e5};this.beforeAjustData=this.handleDataParse(e)},handleDataParse:function(e){var t=e;return t.planTotalWeight=(t.planTotalWeight/this.weightUnit).toFixed(2),t.planInnerWeight=(t.planInnerWeight/this.weightUnit).toFixed(2),t.planExportWeight=(t.planExportWeight/this.weightUnit).toFixed(2),t.planPlantArea=(t.planPlantArea/this.areaUnit).toFixed(2),t},handleCurrentDataChange:function(){this.tableData.splice(this.tableData.length-1,1),this.handleAfterAdjustData()},show:function(e){this.visible=!0,this.data=e;var t=e.selectedRows;this.leafTypeName=e.leafTypeObj.leafTypeName,this.weightUnitName=e.weightUnitObj.weightUnitName,this.weightUnit=e.weightUnitObj.weightUnitCd,this.areaUnitName=e.areaUnitObj.areaUnitName,this.areaUnit=e.areaUnitObj.areaUnitCd,this.nowYear=e.nowYear,this.formData=t;var a=this.leafTypeList.find((function(e){return e.leafTypeCode===t.leafTypeCode}));this.formData.leafTypeName=null===a||void 0===a?void 0:a.leafTypeName;var n=this.workOptType.find((function(e){return e.id===t.oprType}));this.formData.oprTypeName=null===n||void 0===n?void 0:n.name,this.handleGetBeforeAdjustData(),this.tableData.push(this.beforeAjustData);var r={name:"本次调整",planTotalWeight:t.planTotalWeight||0,planInnerWeight:t.planInnerWeight||0,planExportWeight:t.planExportWeight||0,planPlantArea:t.planPlantArea||0};this.tableData.push(r),this.handleAfterAdjustData()},sumNum:function(e,t){var a=0;return e.forEach((function(e){var n=e;n[t]=n[t]||0,a+=Number(e[t])})),a.toFixed(2)},handleAfterAdjustData:function(){var e=this,t=["planTotalWeight","planInnerWeight","planExportWeight","planPlantArea"],a={name:"调整后"};t.forEach((function(t){a[t]=e.sumNum(e.tableData,t)})),this.tableData.push(a)},handleGetLeafTypeList:function(){var e=this;this.$apis.tbm.tabaccoType.query({}).then((function(t){e.leafTypeList=(null===t||void 0===t?void 0:t.rows)||[];var a=e.leafTypeList;a&&a.length>0&&(e.leafTypeCd=(a.find((function(e){return"烤烟"===e.leafTypeName}))||{}).leafTypeCode,console.log("0000000000000000000=".concat(e.formData.leafTypeCode)),e.formData.leafTypeCode=e.leafTypeCd)}))},onclose:function(){this.$refs.ruleForm1.resetFields(),this.tableData=[],this.visible=!1}}},W=U,N=Object(g["a"])(W,_,O,!1,null,null,null),j=N.exports,E={name:"ExecutionEnterAdjustManage",components:{ExecutionEnterAdjustForm:y,ExecutionEnterAdjustAdd:A,Detail:j,OrgPicker:s.a},data:function(){return{queryItems:{busiYear:"",leafTypeCode:"10",submitState:"",auditState:"",oprType:"",remark:"",orgCode:void 0},orgCodeList:[],weightUnit:5e5,areaUnit:1e4,nowYear:"",loading:!1,leafTypeCd:"",bizCode:"",leafTypeList:[{leafTypeCode:"10",leafTypeName:"烤烟"},{leafTypeCode:"20",leafTypeName:"晾晒烟(全部)"},{leafTypeCode:"2013",leafTypeName:"晾晒烟(雪茄烟叶)"}],oldDataRow:[],workSubmitState:[{id:"",name:"全部"},{id:"0",name:"未提交"},{id:"1",name:"已提交"}],workAuditState:[{id:"",name:"全部"},{id:"0",name:"未审批"},{id:"1",name:"处长审批"},{id:"2",name:"副总经理审批"},{id:"3",name:"完成"}],workOptType:[{id:"",name:"全部"},{id:"0",name:"调减"},{id:"1",name:"调增"}],weightUnitList:[{weightUnitCd:1,weightUnitName:"公斤",isSelected:!1},{weightUnitCd:50,weightUnitName:"担",isSelected:!1},{weightUnitCd:5e5,weightUnitName:"万担",isSelected:!1}],areaUnitList:[{areaUnitCd:1e4,areaUnitName:"万亩"},{areaUnitCd:1,areaUnitName:"亩"}],pagination:{pageNumber:1,pageSize:10,total:0},tableData:{rows:[]}}},computed:{appConfig:function(){return this.$store.getters.getAppConfig}},created:function(){var e=this.$router.history.current.query.appCode;this.appCode=e||"CM"},methods:{handleUnitParse:function(){var e=this,t=[],a=JSON.parse(JSON.stringify(this.oldDataRow))||[];a.forEach((function(a){var n=a;n.aaPlanTotalWeight=(n.aaPlanTotalWeight/e.weightUnit).toFixed(2),n.aaPlanInnerWeight=(n.aaPlanInnerWeight/e.weightUnit).toFixed(2),n.aaPlanExportWeight=(n.aaPlanExportWeight/e.weightUnit).toFixed(2),n.aaPlanPlantArea=(n.aaPlanPlantArea/e.areaUnit).toFixed(2),t.push(n)})),console.log(t),this.tableData.rows=t},handlePagination:function(e,t){var a=this;return Object(o["a"])(Object(i["a"])().mark((function n(){return Object(i["a"])().wrap((function(n){while(1)switch(n.prev=n.next){case 0:return a.pagination.pageNumber=e,a.pagination.pageSize=t,n.next=4,a.handleGetLeafTypeList();case 4:case"end":return n.stop()}}),n)})))()},handleGetLeafTypeList:function(){var e=this;return Object(o["a"])(Object(i["a"])().mark((function t(){var a,n,r,o,l;return Object(i["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(null!==(a=e.leafTypeList)&&void 0!==a&&a.length){t.next=6;break}return t.next=3,e.$apis.bpm.executionEnter.queryLeafType({});case 3:n=t.sent,e.leafTypeList=(null===n||void 0===n?void 0:n.rows)||[],e.leafTypeList.some((function(t){return"烤烟"===t.leafTypeName&&(e.leafTypeCd=t.leafTypeCode,e.queryItems.leafTypeCode=t.leafTypeCode,!0)}));case 6:if(e.orgCode){t.next=12;break}return t.next=9,e.$apis.bim.curOrg.get({});case 9:r=t.sent,e.bizCode=null===r||void 0===r?void 0:r.bizCode,e.orgCode=null===r||void 0===r?void 0:r.orgUniqueCode;case 12:if(!(!e.queryItems.busiYear>0)){t.next=19;break}return o={bizCode:e.appConfig.bizCode,appCode:e.appCode||"CM",yearTypeCode:"BIZ_YEAR"},t.next=16,e.$apis.bpm.executionEnter.getBuYear(o);case 16:l=t.sent,e.queryItems.busiYear=null===l||void 0===l?void 0:l.yearValue,e.nowYear=null===l||void 0===l?void 0:l.yearValue;case 19:e.onQuery();case 20:case"end":return t.stop()}}),t)})))()},onQuery:function(){var e=this;this.loading=!0;var t={pageNo:this.pagination.pageNumber,pageSize:this.pagination.pageSize,leafTypeCode:this.queryItems.leafTypeCode,submitState:this.queryItems.submitState,busiYear:this.queryItems.busiYear,auditState:this.queryItems.auditState,oprType:this.queryItems.oprType,remark:this.queryItems.remark,orgCode:this.queryItems.orgCode};console.log(t),this.$apis.bpm.executionEnter.queryAdjust(t).then((function(t){e.tableData=t;var a=e.tableData.rows;e.pagination.total=t.totalRows,e.oldDataRow=JSON.parse(JSON.stringify(a)),console.log("66666".concat(JSON.stringify(e.oldDataRow))),e.handleUnitParse()})).catch((function(e){console.log(e)})).finally((function(){e.loading=!1,e.selectedRows=[]}))},onAdd:function(){var e=this,t=this.leafTypeList.find((function(t){return t.leafTypeCode===e.queryItems.leafTypeCode})),a=this.weightUnitList.find((function(t){return t.weightUnitCd===e.weightUnit})),n=this.areaUnitList.find((function(t){return t.areaUnitCd===e.areaUnit})),r={},i=this.leafTypeList,o={type:"edit",leafTypeObj:t,leafTypeList:i,weightUnitObj:a,areaUnitObj:n,selectedRows:r,nowYear:this.queryItems.busiYear};this.$refs.ExecutionEnterAdjustAdd.show(o)},onEdit:function(e){var t=this,a=this.leafTypeList.find((function(e){return e.leafTypeCode===t.queryItems.leafTypeCode})),n=this.weightUnitList.find((function(e){return e.weightUnitCd===t.weightUnit})),r=this.areaUnitList.find((function(e){return e.areaUnitCd===t.areaUnit})),i=JSON.parse(JSON.stringify(e)),o=this.leafTypeList,l={type:"edit",leafTypeObj:a,leafTypeList:o,weightUnitObj:n,areaUnitObj:r,selectedRows:i,nowYear:this.queryItems.busiYear};this.$refs.ExecutionEnterAdjustForm.show(l)},onDetail:function(e){var t=this,a=this.leafTypeList.find((function(e){return e.leafTypeCode===t.queryItems.leafTypeCode})),n=this.weightUnitList.find((function(e){return e.weightUnitCd===t.weightUnit})),r=this.areaUnitList.find((function(e){return e.areaUnitCd===t.areaUnit})),i=JSON.parse(JSON.stringify(e)),o=this.leafTypeList,l={leafTypeObj:a,leafTypeDataSource:o,weightUnitObj:n,areaUnitObj:r,selectedRows:i,nowYear:this.queryItems.busiYear};this.$refs.Detail.show(l)},onDel:function(){var e=this,t=this.$createElement;if(!this.selectedRows||this.selectedRows.length<=0)this.$message.error("请选择一条数据再删除");else{var a=this.selectedRows.find((function(e){return"1"===e.submitState&&"0"!==e.auditState}));console.log("--".concat(JSON.stringify(a))),a?this.$message.error("存在已提交数据，不能删除！"):(console.log(JSON.stringify(this.selectedRows)),this.$confirm({title:"是否执行该操作?",content:function(){return t("div",{style:"color:red;"},["是否确认删除选中的数据，确认请点击'确认'按钮，取消点击'取消'按钮。"])},onOk:function(){e.loading=!0;for(var t=[],a=0;a<e.selectedRows.length;a++)t.push(e.selectedRows[a].oprRecordId);e.$apis.bpm.executionEnter.delete({oprRecordIds:t}).then((function(t){console.log(JSON.stringify(t)),t.result?(e.loading=!1,e.onQuery(),e.$message.success("操作成功")):e.$message.error("操作失败")}))}}))}},onSubmit:function(){var e=this,t=this.$createElement;if(!this.selectedRows||this.selectedRows.length<=0)this.$message.error("请选择一条数据再提交");else{var a=this.selectedRows.find((function(e){return"1"===e.submitState&&"0"!==e.auditState}));console.log("--".concat(JSON.stringify(a))),a?this.$message.error("存在已提交数据，请勿重复提交"):(console.log(JSON.stringify(this.selectedRows)),this.$confirm({title:"是否执行该操作?",content:function(){return t("div",{style:"color:red;"},["是否确认提交选中的数据，确认请点击'确认'按钮，取消点击'取消'按钮。"])},onOk:function(){e.loading=!0;for(var t=[],a=0;a<e.selectedRows.length;a++)t.push(e.selectedRows[a].oprRecordId);e.$apis.bpm.executionEnter.submit({oprRecordIds:t}).then((function(t){console.log(JSON.stringify(t)),t.result?(e.loading=!1,e.$message.success("操作成功"),e.onQuery()):e.$message.error("操作失败")}))}}))}},onReset:function(){this.queryItems.leafTypeCode=this.leafTypeCd,this.queryItems.busiYear=this.nowYear,this.queryItems.submitState="",this.queryItems.auditState="",this.queryItems.oprType="",this.queryItems.remark="",this.queryItems.orgName="",this.queryItems.orgCode=void 0,this.$refs.table.pageAction(1)},handleData:function(){var e=this,t=this.leafTypeList.find((function(t){return t.leafTypeCode===e.queryItems.leafTypeCode})),a=this.weightUnitList.find((function(t){return t.weightUnitCd===e.weightUnit})),n=this.areaUnitList.find((function(t){return t.areaUnitCd===e.areaUnit})),r={leafTypeObj:t,weightUnitObj:a,areaUnitObj:n,nowYear:this.queryItems.busiYear};return r},handleLeafTypeName:function(e){var t=this.leafTypeList.find((function(t){return t.leafTypeCode===e}));return null===t||void 0===t?void 0:t.leafTypeName},sumNum:function(e,t){var a=0;return e.forEach((function(e){a+=Number(e[t])})),a.toFixed(2)},footerMethod:function(e){var t=this,a=e.columns,n=e.data;return[a.map((function(e,a){return 0===a?"合计":["planTotalWeight","planInnerWeight","planExportWeight","planPlantArea"].includes(e.property)?t.sumNum(n,e.property):null}))]},selectAllEvent:function(e){var t=e.checked,a=e.records;console.log("".concat(t,"-选中所有records包含选中的所以对象----").concat(JSON.stringify(a))),this.selectedRows=a},selectRowChange:function(e){var t=e.checked,a=e.records;console.log("".concat(t,"-选择改变时会把records包含选中的所以对象----").concat(JSON.stringify(a))),this.selectedRows=a}}},P=E,I=(a("5154"),Object(g["a"])(P,n,r,!1,null,"f8a840a8",null));t["default"]=I.exports},3816:function(e,t,a){},"448a":function(e,t,a){var n=a("2236"),r=a("11b0"),i=a("6613"),o=a("0676");function l(e){return n(e)||r(e)||i(e)||o()}e.exports=l,e.exports.__esModule=!0,e.exports["default"]=e.exports},5154:function(e,t,a){"use strict";a("1d40")},"5a43":function(e,t){function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}e.exports=a,e.exports.__esModule=!0,e.exports["default"]=e.exports},63748:function(e,t,a){a("a4d3"),a("e01a"),a("d3b7"),a("d28b"),a("3ca3"),a("ddb0"),a("d9e2");var n=a("6613");function r(e,t){var a="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!a){if(Array.isArray(e)||(a=n(e))||t&&e&&"number"===typeof e.length){a&&(e=a);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,l=!0,s=!1;return{s:function(){a=a.call(e)},n:function(){var e=a.next();return l=e.done,e},e:function(e){s=!0,o=e},f:function(){try{l||null==a["return"]||a["return"]()}finally{if(s)throw o}}}}e.exports=r,e.exports.__esModule=!0,e.exports["default"]=e.exports},6613:function(e,t,a){a("fb6a"),a("d3b7"),a("b0c0"),a("a630"),a("3ca3"),a("ac1f"),a("00b4");var n=a("5a43");function r(e,t){if(e){if("string"===typeof e)return n(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?n(e,t):void 0}}e.exports=r,e.exports.__esModule=!0,e.exports["default"]=e.exports},9523:function(e,t){function a(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}e.exports=a,e.exports.__esModule=!0,e.exports["default"]=e.exports},"9b42":function(e,t,a){function n(e,t){var a=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=a){var n,r,i=[],o=!0,l=!1;try{for(a=a.call(e);!(o=(n=a.next()).done);o=!0)if(i.push(n.value),t&&i.length===t)break}catch(s){l=!0,r=s}finally{try{o||null==a["return"]||a["return"]()}finally{if(l)throw r}}return i}}a("a4d3"),a("e01a"),a("d3b7"),a("d28b"),a("3ca3"),a("ddb0"),e.exports=n,e.exports.__esModule=!0,e.exports["default"]=e.exports},c135:function(e,t){function a(e){if(Array.isArray(e))return e}e.exports=a,e.exports.__esModule=!0,e.exports["default"]=e.exports},c240:function(e,t,a){function n(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}a("d9e2"),e.exports=n,e.exports.__esModule=!0,e.exports["default"]=e.exports},c973:function(e,t,a){function n(e,t,a,n,r,i,o){try{var l=e[i](o),s=l.value}catch(c){return void a(c)}l.done?t(s):Promise.resolve(s).then(n,r)}function r(e){return function(){var t=this,a=arguments;return new Promise((function(r,i){var o=e.apply(t,a);function l(e){n(o,r,i,l,s,"next",e)}function s(e){n(o,r,i,l,s,"throw",e)}l(void 0)}))}}a("d3b7"),e.exports=r,e.exports.__esModule=!0,e.exports["default"]=e.exports},ded3:function(e,t,a){a("b64b"),a("a4d3"),a("4de4"),a("d3b7"),a("e439"),a("159b"),a("dbb4");var n=a("9523");function r(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?r(Object(a),!0).forEach((function(t){n(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}e.exports=i,e.exports.__esModule=!0,e.exports["default"]=e.exports}}]);
//# sourceMappingURL=chunk-52bbbd88.5648d599.js.map