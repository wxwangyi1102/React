(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0e8fd2"],{"8c2c":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ec-container",{attrs:{height:"100%",title:"采集批次管理",icon:"onetomany","color-code":"008"}},[a("ec-container-body",[a("ec-panel",{attrs:{auto:!1}},[a("ec-panel-toolbar",[a("ec-panel-item",[a("ec-panel-item-left",[a("a-button",{attrs:{type:"primary",disabled:e.nowYear!==e.queryItems.busiYear},on:{click:e.onAdd}},[e._v("新增")]),a("a-button",{attrs:{disabled:e.nowYear!==e.queryItems.busiYear},on:{click:e.onFinish}},[e._v("完成采集")])],1),a("ec-panel-item-right",[e._v(" 业务年度："),a("a-input-number",{attrs:{min:2e3,max:2099},on:{change:function(t){return e.$refs.table.pageAction(1)}},model:{value:e.queryItems.busiYear,callback:function(t){e.$set(e.queryItems,"busiYear",t)},expression:"queryItems.busiYear"}})],1)],1)],1),a("ec-panel-body",[a("ec-table",{ref:"table",attrs:{border:"",pagination:e.pagination,data:e.tableData.rows,loading:e.loading,"row-select":"",auto:!1,height:"100%"},on:{"page-action":e.handlePagination,"checkbox-all":e.selectAllEvent,"checkbox-change":e.selectRowChange}},[a("ec-table-col",{attrs:{type:"checkbox",width:"36",align:"center"}}),a("ec-table-col",{attrs:{width:"50",title:"序号",type:"seq",align:"center"}}),a("ec-table-col",{attrs:{field:"busiYear",title:"业务年度",align:"center","min-width":"130"}}),a("ec-table-col",{attrs:{field:"batchName",title:"采集批次",align:"left","min-width":"180"}}),a("ec-table-col",{attrs:{field:"needGatherYear",title:"采集年度",align:"center","min-width":"130"}}),a("ec-table-col",{attrs:{field:"isFlueCuredControl",title:"烤烟是否\n                计划控制",align:"center",width:"130"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return["1"===r.isFlueCuredControl?a("div",[a("span",[e._v("是")])]):a("div",[a("span",[e._v("否")])])]}}])}),a("ec-table-col",{attrs:{field:"isSunCuredControl",title:"晾晒烟是否受\n                计划控制",align:"center",width:"130"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return["1"===r.isSunCuredControl?a("div",[a("span",[e._v("是")])]):a("div",[a("span",[e._v("否")])])]}}])}),a("ec-table-col",{attrs:{field:"lisRtControl",title:"再造烟叶是否受\n                计划控制",align:"center",width:"130"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return["1"===r.lisRtControl?a("div",[a("span",[e._v("是")])]):a("div",[a("span",[e._v("否")])])]}}])}),a("ec-table-col",{attrs:{field:"finishFlag",title:"是否完成",align:"center",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return["1"===r.finishFlag?a("div",[a("span",[e._v("是")])]):a("div",[a("span",[e._v("否")])])]}}])}),a("ec-table-col",{attrs:{title:"操作",align:"center",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("a-button",{attrs:{type:"link",disabled:e.nowYear!==e.queryItems.busiYear},on:{click:function(t){return e.onEdit(r)}}},[e._v("编辑")]),a("a-popconfirm",{attrs:{title:"是否要删除此行？","ok-text":"确定","cancel-text":"取消",disabled:e.nowYear!==e.queryItems.busiYear},on:{confirm:function(t){return e.onDel(r)}}},[a("a-button",{attrs:{type:"link",disabled:e.nowYear!==e.queryItems.busiYear}},[e._v("删除")])],1)]}}])})],1)],1)],1),a("batch-manage-edit",{ref:"BatchManageEdit",attrs:{leafTypeList:e.leafTypeList},on:{onQuery:e.onQuery}})],1)],1)},n=[],o=a("c7eb"),i=a("1da1"),s=(a("e9c4"),a("7db0"),a("d3b7"),a("99af"),function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ec-modal",{staticClass:"ec-draw-form",attrs:{visible:e.visible,title:e.title,size:"large","is-confirm":!0},on:{cancel:e.onclose},scopedSlots:e._u([{key:"footer",fn:function(){return[a("a-button",{directives:[{name:"show",rawName:"v-show",value:!e.isEditor,expression:"!isEditor"}],attrs:{type:"primary",loading:e.saving},on:{click:function(t){return e.onSave("saveAndAdd")}}},[e._v("保存并新增")]),a("a-button",{attrs:{type:"primary",loading:e.saving},on:{click:e.onSave}},[e._v("保存")]),a("a-button",{on:{click:e.onclose}},[e._v("取消")])]},proxy:!0}])},[a("ec-form",{ref:"modelRef",attrs:{model:e.formData,rules:e.rules}},[a("a-row",{attrs:{type:"flex",gutter:12}},[a("a-col",{attrs:{span:12}},[a("a-form-model-item",{attrs:{label:"采集批次",prop:"batchName"}},[a("a-input",{attrs:{placeholder:"请输入采集批次",maxLength:24},model:{value:e.formData.batchName,callback:function(t){e.$set(e.formData,"batchName",t)},expression:"formData.batchName"}})],1)],1),a("a-col",{attrs:{span:12}},[a("a-form-model-item",{ref:"needGatherYearValue",attrs:{label:"采集年份",prop:"needGatherYearValue"}},[a("a-checkbox-group",{on:{change:e.onChange},model:{value:e.formData.needGatherYearValue,callback:function(t){e.$set(e.formData,"needGatherYearValue",t)},expression:"formData.needGatherYearValue"}},e._l(e.needGatherYearList,(function(t){return a("a-checkbox",{key:t.code,attrs:{label:t.name,value:t.code}},[e._v(" "+e._s(t.name)+" ")])})),1)],1)],1),a("a-col",{attrs:{span:12}},[a("a-form-model-item",{attrs:{label:"烤烟是否受计划控制",prop:"isFlueCuredControl"}},[a("a-select",{attrs:{placeholder:"请选择"},model:{value:e.formData.isFlueCuredControl,callback:function(t){e.$set(e.formData,"isFlueCuredControl",t)},expression:"formData.isFlueCuredControl"}},[a("a-select-option",{attrs:{value:"1"}},[e._v(" 是 ")]),a("a-select-option",{attrs:{value:"0"}},[e._v(" 否 ")])],1)],1)],1),a("a-col",{attrs:{span:12}},[a("a-form-model-item",{attrs:{label:"晾晒烟是否受计划控制",prop:"isSunCuredControl"}},[a("a-select",{attrs:{placeholder:"请选择"},model:{value:e.formData.isSunCuredControl,callback:function(t){e.$set(e.formData,"isSunCuredControl",t)},expression:"formData.isSunCuredControl"}},[a("a-select-option",{attrs:{value:"1"}},[e._v(" 是 ")]),a("a-select-option",{attrs:{value:"0"}},[e._v(" 否 ")])],1)],1)],1),a("a-col",{attrs:{span:12}},[a("a-form-model-item",{attrs:{label:"再造烟叶是否受计划控制",prop:"isRtControl"}},[a("a-select",{attrs:{placeholder:"请选择"},model:{value:e.formData.isRtControl,callback:function(t){e.$set(e.formData,"isRtControl",t)},expression:"formData.isRtControl"}},[a("a-select-option",{attrs:{value:"1"}},[e._v(" 是 ")]),a("a-select-option",{attrs:{value:"0"}},[e._v(" 否 ")])],1)],1)],1),a("a-col",{attrs:{span:12}},[a("a-form-model-item",{attrs:{label:"业务年度",prop:"busiYear"}},[a("a-input",{attrs:{disabled:e.isDisableYear,placeholder:"请输入业务年度"},model:{value:e.formData.busiYear,callback:function(t){e.$set(e.formData,"busiYear",t)},expression:"formData.busiYear"}})],1)],1)],1)],1)],1)}),l=[],c=(a("ac1f"),a("1276"),a("a15b"),{name:"batchManageForm",data:function(){return{visible:!1,formData:{},isEditor:!1,saving:!1,isDisableYear:!0,busiYear:"",title:"",needGatherYearList:[],rules:{batchName:{required:!0,message:"请输入采集批次",trigger:"blur"},needGatherYearValue:{required:!0,message:"请选择采集年度",trigger:"blur"},isFlueCuredControl:{required:!0,message:"请选择烤烟是否受计划控制",trigger:"blur"},isSunCuredControl:{required:!0,message:"请选择晾晒烟是否受计划控制",trigger:"blur"},isRtControl:{required:!0,message:"请选择再造烟叶是否受计划控制",trigger:"blur"},busiYear:{required:!0,message:"请输入业务年度",trigger:"blur"}}}},methods:{show:function(e){var t,a;this.visible=!0,this.formData={},this.busiYear=e.busiYear;var r=e.selectedRow;r?(this.isEditor=!0,this.title="编辑采集批次",this.formData=r):(this.isEditor=!1,this.title="新增采集批次",this.formData.busiYear=e.busiYear);for(var n=[],o=1;o<5;o++){var i={code:"".concat(this.busiYear+o),name:"".concat(this.busiYear+o)};n.push(i)}this.needGatherYearList=n,this.$set(this.formData,"needGatherYearValue",(null===(t=this.formData)||void 0===t||null===(a=t.needGatherYear)||void 0===a?void 0:a.split(","))||[]),console.log(this.formData.needGatherYearValue)},onChange:function(e){this.formData.needGatherYear=e.join()},onSave:function(e){var t=this;this.$refs.modelRef.validate(function(){var a=Object(i["a"])(Object(o["a"])().mark((function a(r){var n;return Object(o["a"])().wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(r){a.next=2;break}return a.abrupt("return");case 2:t.saving=!0,n=t.formData,console.log(n),t.isEditor?t.$apis.apm.batchManage.update(n).then((function(a){if(console.log(a),a.result)t.handleSaveAfter(e),t.$message.success("操作成功");else{var r=a.msg;t.$message.error(r),t.saving=!1}})).catch((function(e){console.log(e),t.saving=!1})):t.$apis.apm.batchManage.save(n).then((function(a){if(console.log(a),a.result)t.handleSaveAfter(e),t.$message.success("操作成功");else{var r=a.msg;t.$message.error(r),t.saving=!1}})).catch((function(e){console.log(e),t.saving=!1}));case 6:case"end":return a.stop()}}),a)})));return function(e){return a.apply(this,arguments)}}())},handleSaveAfter:function(e){this.$emit("onQuery"),this.saving=!1,"saveAndAdd"===e?this.formData={batchName:void 0,needGatherYear:void 0,isFlueCuredControl:void 0,isSunCuredControl:void 0,isRtControl:void 0,busiYear:this.busiYear}:this.onclose()},onclose:function(){this.visible=!1,this.$refs.modelRef.resetFields()}}}),u=c,d=a("2877"),f=Object(d["a"])(u,s,l,!1,null,null,null),h=f.exports,p={name:"BatchManage",components:{BatchManageEdit:h},data:function(){return{queryItems:{busiYear:""},loading:!1,leafTypeCd:"",nowYear:"",leafTypeList:[],pagination:{pageNumber:1,pageSize:10,total:0},bizCode:"",tableData:{rows:[]}}},computed:{appConfig:function(){return this.$store.getters.getAppConfig}},methods:{onQuery:function(){var e=this,t={pageNo:this.pagination.pageNumber,pageSize:this.pagination.pageSize,busiYear:this.queryItems.busiYear};this.loading=!0,this.$apis.apm.batchManage.query(t).then((function(t){e.pagination.total=t.totalRows,e.tableData.rows=t.rows,e.loading=!1})).catch((function(t){e.loading=!1,console.log(t)}))},onAdd:function(){var e=this.queryItems.busiYear,t={busiYear:e};this.$refs.BatchManageEdit.show(t)},onEdit:function(e){var t=e.finishFlag;if("1"!==t){var a=this.queryItems.busiYear,r=JSON.parse(JSON.stringify(e)),n={busiYear:a,selectedRow:r};this.$refs.BatchManageEdit.show(n)}else this.$message.error("已完成采集批次，不允许编辑！")},onDel:function(e){var t=this,a=e.finishFlag;if("1"!==a){var r={needCollectBatchId:e.needCollectBatchId};this.$apis.apm.batchManage.delete(r).then((function(e){e.result?(t.loading=!1,t.$message.success("操作成功"),t.onQuery()):t.$message.error(e.msg)})).catch((function(e){t.loading=!1,console.log(e)}))}else this.$message.error("已完成采集批次，不允许删除！")},onFinish:function(){var e=this,t=this.$createElement;if(!this.selectedRows||this.selectedRows.length<=0)this.$message.error("请选择一条数据再进行完成采集");else{var a=this.selectedRows.find((function(e){return"1"===e.finishFlag}));a?this.$message.error("选中的数据存在已完成采集，请重新选择！"):this.$confirm({title:"是否执行该操作?",content:function(){return t("div",{style:"color:red;"},["是否确认完成采集选中的数据，确认请点击'确认'按钮，取消点击'取消'按钮。"])},onOk:function(){e.loading=!0;for(var t=[],a=0;a<e.selectedRows.length;a++)t.push(e.selectedRows[a].needCollectBatchId);e.$apis.apm.batchManage.finish({ids:t}).then((function(t){console.log(JSON.stringify(t)),t.result?(e.loading=!1,e.$refs.table.pageAction(1),e.$message.success("操作成功")):e.$message.error("操作失败")})).catch((function(t){e.loading=!1,t?e.$message.error(t.message||"操作失败"):e.$message.error("操作失败")}))}})}},onReset:function(){this.queryItems.leafTypeCode=this.leafTypeCd,this.$refs.table.pageAction(1)},handleLeafTypeName:function(e){var t=this.leafTypeList.find((function(t){return t.leafTypeCode===e}));return null===t||void 0===t?void 0:t.leafTypeName},handlePagination:function(e,t){var a=this;return Object(i["a"])(Object(o["a"])().mark((function r(){return Object(o["a"])().wrap((function(r){while(1)switch(r.prev=r.next){case 0:return a.pagination.pageNumber=e,a.pagination.pageSize=t,r.next=4,a.handleGetYear();case 4:case"end":return r.stop()}}),r)})))()},handleGetYear:function(){var e=this;return Object(i["a"])(Object(o["a"])().mark((function t(){var a,r,n,i,s;return Object(o["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.orgCode){t.next=6;break}return t.next=3,e.$apis.bim.curOrg.get({});case 3:a=t.sent,e.bizCode=null===a||void 0===a?void 0:a.bizCode,e.orgCode=null===a||void 0===a?void 0:a.orgUniqueCode;case 6:if(e.appCode){t.next=12;break}return t.next=9,e.$router.history.current.query;case 9:r=t.sent,n=r.appCode,e.appCode=n||"CM";case 12:if(!(!e.queryItems.busiYear>0)){t.next=19;break}return i={bizCode:e.appConfig.bizCode,appCode:e.appCode||"CM",yearTypeCode:"BIZ_YEAR"},t.next=16,e.$apis.bpm.executionEnter.getBuYear(i);case 16:s=t.sent,e.queryItems.busiYear=null===s||void 0===s?void 0:s.yearValue,e.nowYear=null===s||void 0===s?void 0:s.yearValue;case 19:e.onQuery();case 20:case"end":return t.stop()}}),t)})))()},selectAllEvent:function(e){var t=e.checked,a=e.records;console.log("".concat(t,"-选中所有records包含选中的所以对象----").concat(JSON.stringify(a))),this.selectedRows=a},selectRowChange:function(e){var t=e.checked,a=e.records;console.log("".concat(t,"-选择改变时会把records包含选中的所以对象----").concat(JSON.stringify(a))),this.selectedRows=a}}},m=p,g=Object(d["a"])(m,r,n,!1,null,null,null);t["default"]=g.exports}}]);
//# sourceMappingURL=chunk-2d0e8fd2.cb9eb680.js.map