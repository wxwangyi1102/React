(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-7a06b64b"],{2703:function(e,t,a){},"33b6":function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ec-container",{staticClass:"info",attrs:{height:"100%","color-code":"001",title:"基地单元衔接清理","show-title":""}},[a("ec-container-body",[a("ec-panel",{attrs:{auto:!1}},[a("ec-panel-toolbar",[a("ec-query-panel",{attrs:{defaultFold:!0},on:{query:e.onQuery,reset:e.onReset},scopedSlots:e._u([{key:"inner",fn:function(){return[a("ec-query-item",{attrs:{label:"商业单位"}},[a("select-picker",{attrs:{title:"选择商业单位",lazy:!1,search:!1,fetchData:e.onFetchBusinessOrgList},model:{value:e.query.businesOrgCode,callback:function(t){e.$set(e.query,"businesOrgCode",t)},expression:"query.businesOrgCode"}})],1),a("ec-query-item",{attrs:{label:"工业单位"}},[a("select-picker",{attrs:{title:"选择工业单位",lazy:!1,search:!1,fetchData:e.onFetchIndustryOrgList},model:{value:e.query.industryOrgCode,callback:function(t){e.$set(e.query,"industryOrgCode",t)},expression:"query.industryOrgCode"}})],1),a("ec-query-item",{attrs:{label:"烟叶类型"}},[a("ec-select",{attrs:{placeholder:"请选择烟叶类型"},model:{value:e.query.leafTypeCode,callback:function(t){e.$set(e.query,"leafTypeCode",t)},expression:"query.leafTypeCode"}},e._l(e.leafTypeList,(function(t){return a("a-select-option",{key:t.leafTypeCode},[e._v(" "+e._s(t.leafTypeName)+" ")])})),1)],1),a("ec-query-item",{attrs:{label:"基地单元名称"}},[a("a-input",{attrs:{placeholder:"请输入基地单元名称"},model:{value:e.query.baseCellName,callback:function(t){e.$set(e.query,"baseCellName","string"===typeof t?t.trim():t)},expression:"query.baseCellName"}})],1),a("ec-query-item",{attrs:{label:"基地单元编码"}},[a("a-input",{attrs:{placeholder:"请输入基地单元编码"},model:{value:e.query.baseCellCode,callback:function(t){e.$set(e.query,"baseCellCode","string"===typeof t?t.trim():t)},expression:"query.baseCellCode"}})],1)]},proxy:!0}])},[a("ec-query-item",{attrs:{label:"连续年度"}},[a("a-input-number",{attrs:{placeholder:"请输入连续年度"},model:{value:e.query.seriesYear,callback:function(t){e.$set(e.query,"seriesYear","string"===typeof t?t.trim():t)},expression:"query.seriesYear"}})],1),a("ec-query-item",{attrs:{label:"调拨比例"}},[a("a-input-number",{attrs:{placeholder:"请输入调拨比例"},model:{value:e.query.asPercentTemp,callback:function(t){e.$set(e.query,"asPercentTemp","string"===typeof t?t.trim():t)},expression:"query.asPercentTemp"}})],1),a("ec-query-item",{attrs:{label:"集中交易年度"}},[a("a-input-number",{attrs:{disabled:"",placeholder:"请输入集中交易年度"},model:{value:e.query.busiYear,callback:function(t){e.$set(e.query,"busiYear","string"===typeof t?t.trim():t)},expression:"query.busiYear"}})],1)],1),a("ec-divider")],1),a("ec-panel-body",[a("ec-v-layout",{attrs:{auto:!1}},[a("ec-v-item",{attrs:{height:"auto"}},[a("ec-panel-toolbar",[a("ec-panel-item-left",[a("a-button",{attrs:{type:"primary"},on:{click:e.onClear}},[e._v("清理")]),a("a-button",{attrs:{type:"primary",ghost:""},on:{click:e.handleUpdate}},[e._v("已清理单元")]),a("a-button",{attrs:{type:"primary",ghost:""},on:{click:e.onCalculate}},[e._v("计算上一年调拨比例")])],1),a("ec-panel-item-right",[a("div",{staticClass:"unit-box"},[a("span",[e._v("集中交易年度："+e._s(e.busiYear)+"年")]),a("div",{staticClass:"select"},[e._v(" 重量单位： "),a("ec-select",{attrs:{showSearch:""},model:{value:e.weightUnit,callback:function(t){e.weightUnit="string"===typeof t?t.trim():t},expression:"weightUnit"}},e._l(e.weightUnitList,(function(t){return a("a-select-option",{key:t.enumKey},[e._v(" "+e._s(t.name)+" ")])})),1)],1),a("div",{staticClass:"select"},[e._v(" 面积单位： "),a("ec-select",{attrs:{showSearch:""},model:{value:e.areaUnit,callback:function(t){e.areaUnit="string"===typeof t?t.trim():t},expression:"areaUnit"}},e._l(e.areaUnitList,(function(t){return a("a-select-option",{key:t.enumKey},[e._v(" "+e._s(t.name)+" ")])})),1)],1)])])],1)],1),a("ec-v-item",[a("ec-table",{ref:"tableRef",attrs:{loading:e.loading,"show-overflow":"",height:"100%",auto:!1,pagination:e.pagination,data:e.tableData},on:{"page-action":e.onPageAction,"checkbox-all":e.onSelAllTableData,"checkbox-change":e.onSelTableData}},[a("ec-table-col",{attrs:{type:"checkbox",width:"60",align:"center"}}),a("ec-table-col",{attrs:{type:"seq",title:"序号",width:"50",align:"center"}}),a("ec-table-col",{attrs:{field:"busiYear",title:"创建年度",align:"center","min-width":"100"}}),a("ec-table-col",{attrs:{field:"linkBeginYear",title:"衔接年度",align:"center","min-width":"100"}}),a("ec-table-col",{attrs:{field:"provOrgName",title:"省公司",align:"center","min-width":"150"}}),a("ec-table-col",{attrs:{field:"cityOrgName",title:"市公司",align:"center","min-width":"150"}}),a("ec-table-col",{attrs:{field:"provDivisionName",title:"省",align:"center","min-width":"150"}}),a("ec-table-col",{attrs:{field:"cityDivisionName",title:"地(州、市)",align:"center","min-width":"150"}}),a("ec-table-col",{attrs:{field:"counDivisionName",title:"县(区、市)",align:"center","min-width":"150"}}),a("ec-table-col",{attrs:{field:"baseCellCode",title:"基地单元编码",align:"center","min-width":"150"}}),a("ec-table-col",{attrs:{field:"baseCellName",title:"基地单元名称",align:"center","min-width":"150"}}),a("ec-table-col",{attrs:{field:"linkInduProvOrgName",title:"省级工业公司",align:"center","min-width":"150"}}),a("ec-table-col",{attrs:{field:"linkInduOrgName",title:"对口工业企业",align:"center","min-width":"150"}}),a("ec-table-col",{attrs:{field:"brandName",title:"品牌",align:"center","min-width":"100"}}),a("ec-table-col",{attrs:{field:"leafTypeCode",title:"烟叶类型","min-width":"100",align:"left"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;return[a("div",[e._v(" "+e._s(e._f("getNameBy")(i.leafTypeCode,e.leafTypeObj))+" ")])]}}])}),a("ec-table-col",{attrs:{field:"leafVarietyName",title:"烟叶品种",align:"center","min-width":"100"}}),a("ec-table-col",{attrs:{field:"fieldArea",title:"基本烟田面积","min-width":"120",align:"left"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;return[a("div",[e._v(e._s(e._f("amountFormat")(i.fieldArea,e.areaUnit)))])]}}])}),a("ec-table-col",{attrs:{field:"plantArea",title:"种植面积","min-width":"100",align:"left"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;return[a("div",[e._v(e._s(e._f("amountFormat")(i.plantArea,e.areaUnit)))])]}}])}),a("ec-table-col",{attrs:{field:"buyWeight",title:"收购量","min-width":"100",align:"left"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;return[a("div",[e._v(e._s(e._f("amountFormat")(i.buyWeight,e.weightUnit)))])]}}])}),a("ec-table-col",{attrs:{field:"techSuppOrg",title:"技术依托单位",align:"center","min-width":"150"}})],1)],1)],1)],1)],1),a("clear-edit",{ref:"editRef",attrs:{busiYear:e.busiYear,replaceFields:e.replaceFields,businessOrgList:e.businessOrgList,leafTypeObj:e.leafTypeObj}})],1)],1)},r=[],n=a("5530"),l=a("c7eb"),s=a("1da1"),o=(a("6198"),a("6fc0")),c=a.n(o),u=(a("d81d"),a("d3b7"),function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("ec-drawer",{attrs:{title:"已清理单位",visible:e.visible,size:"large","is-confirm":!0},on:{close:e.onCancel}},[a("ec-container",{attrs:{height:"100%"}},[a("ec-container-body",[a("ec-panel",{attrs:{auto:!1}},[a("ec-panel-toolbar",[a("ec-query-panel",{attrs:{defaultFold:!0},on:{query:e.onQuery,reset:e.onReset}},[a("ec-query-item",{attrs:{label:"清理年度"}},[a("a-input-number",{attrs:{min:2e3,max:2099},model:{value:e.query.clearYear,callback:function(t){e.$set(e.query,"clearYear",t)},expression:"query.clearYear"}})],1),a("ec-query-item",{attrs:{label:"商业单位"}},[a("select-picker",{attrs:{title:"选择商业单位",lazy:!1,search:!1,fetchData:e.onFetchBusinessOrgList},model:{value:e.query.businesOrgCode,callback:function(t){e.$set(e.query,"businesOrgCode",t)},expression:"query.businesOrgCode"}})],1),a("ec-query-item",{attrs:{label:"办理依据"}},[a("a-input",{attrs:{placeholder:""},model:{value:e.query.remark,callback:function(t){e.$set(e.query,"remark","string"===typeof t?t.trim():t)},expression:"query.remark"}})],1)],1),a("ec-divider")],1),a("ec-panel-body",[a("ec-v-layout",{attrs:{auto:!1}},[a("ec-v-item",{attrs:{height:"auto"}},[a("ec-panel-toolbar",[a("ec-panel-item-left",[a("a-button",{attrs:{type:"primary"},on:{click:e.onExport}},[e._v("导出")])],1)],1)],1),a("ec-v-item",[a("ec-table",{ref:"tableRef",attrs:{loading:e.loading,"show-overflow":"",height:"100%",auto:!1,pagination:e.pagination,data:e.tableData},on:{"page-action":e.onPageAction}},[a("ec-table-col",{attrs:{type:"seq",title:"序号",width:"50",align:"center"}}),a("ec-table-col",{attrs:{field:"clearYear",title:"清理年度",align:"center","min-width":"100"}}),a("ec-table-col",{attrs:{field:"clearTime",title:"清理日期",align:"center","min-width":"100"}}),a("ec-table-col",{attrs:{field:"provOrgName",title:"省公司",align:"center","min-width":"150"}}),a("ec-table-col",{attrs:{field:"cityOrgName",title:"市公司",align:"center","min-width":"150"}}),a("ec-table-col",{attrs:{field:"provDivisionName",title:"省",align:"center","min-width":"150"}}),a("ec-table-col",{attrs:{field:"cityDivisionName",title:"地(州、市)",align:"center","min-width":"150"}}),a("ec-table-col",{attrs:{field:"counDivisionName",title:"县(区、市)",align:"center","min-width":"150"}}),a("ec-table-col",{attrs:{field:"baseCellCode",title:"基地单元编码",align:"center","min-width":"150"}}),a("ec-table-col",{attrs:{field:"baseCellName",title:"基地单元名称",align:"center","min-width":"150"}}),a("ec-table-col",{attrs:{field:"leafTypeCode",title:"烟叶类型","min-width":"100",align:"left"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;return[a("div",[e._v(" "+e._s(e._f("getNameBy")(i.leafTypeCode,e.leafTypeObj))+" ")])]}}])}),a("ec-table-col",{attrs:{field:"leatVarietyName",title:"烟叶品种",align:"center","min-width":"100"}}),a("ec-table-col",{attrs:{field:"fieldArea",title:"基本烟田面积(万亩)","min-width":"150",align:"left"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;return[a("div",[e._v(e._s(e._f("amountFormat")(i.fieldArea,e.areaUnit)))])]}}])}),a("ec-table-col",{attrs:{field:"plantArea",title:"种植面积(万亩)","min-width":"150",align:"left"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;return[a("div",[e._v(e._s(e._f("amountFormat")(i.plantArea,e.areaUnit)))])]}}])}),a("ec-table-col",{attrs:{field:"buyWeight",title:"收购量(万担)","min-width":"150",align:"left"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;return[a("div",[e._v(e._s(e._f("amountFormat")(i.buyWeight,e.weightUnit)))])]}}])}),a("ec-table-col",{attrs:{field:"remark",title:"办理依据",align:"center","min-width":"150"}})],1)],1)],1)],1)],1)],1),a("ec-container-footer",[a("a-button",{on:{click:e.onCancel}},[e._v("关闭")])],1)],1)],1)],1)}),d=[],f=(a("a9e3"),a("6ea6")),b={name:"BusinessOrgManageEdit",components:{SelectPicker:c.a},props:{businessOrgList:{type:Array,default:function(){return[]}},busiYear:{type:Number,default:0},replaceFields:{type:Object,default:function(){}},leafTypeObj:{type:Array,default:function(){return[]}}},data:function(){return{loading:!1,visible:!1,query:{},tableData:[],pagination:{pageNumber:1,pageSize:10,total:0},businesOrgCodeTemp:void 0,weightUnit:"500000",areaUnit:"10000"}},methods:{show:function(){this.visible=!0,this.query={clearYear:this.busiYear,busiYear:this.busiYear},this.onQuery()},onFetchBusinessOrgList:function(){var e=this;return new Promise((function(t){var a=Object(f["treeFormatList"])(e.businessOrgList,e.replaceFields);t(a)}))},onPageAction:function(e,t){var a=this;if(this.query.clearYear||this.query.busiYear){var i=Object(n["a"])({pageNo:e,pageSize:t},this.query);this.loading=!0,this.$apis.apm.baseClear.clearQuery(i).then((function(e){a.loading=!1,a.tableData=(null===e||void 0===e?void 0:e.rows)||[],a.pagination.total=null===e||void 0===e?void 0:e.totalRows})).catch((function(){a.loading=!1}))}},onQuery:function(){var e,t;null===(e=this.$refs)||void 0===e||null===(t=e.tableRef)||void 0===t||t.pageAction(1,10)},onReset:function(){this.query={clearYear:this.busiYear,busiYear:this.busiYear},this.onQuery()},onCancel:function(){this.visible=!1,this.onReset()},onExport:function(){}}},p=b,y=a("2877"),h=Object(y["a"])(p,u,d,!1,null,null,null),m=h.exports,g={name:"Index",components:{clearEdit:m,SelectPicker:c.a},data:function(){return{loading:!1,query:{},weightUnitList:[],areaUnitList:[],weightUnit:"500000",areaUnit:"10000",tableData:[],pagination:{pageNumber:1,pageSize:10,total:0},selTableData:[],leafTypeList:[],businessOrgList:[],industryOrgList:[],replaceFields:{pkey:"parentBizCode",title:"orgName",key:"bizCode",children:"children"},asPercentTemp:void 0}},computed:{leafTypeObj:function(){return this.leafTypeList.map((function(e){return{key:e.leafTypeCode,title:e.leafTypeName}}))},busiYear:function(){var e,t;return null===(e=this.$store.getters.getAppConfig)||void 0===e||null===(t=e.yearValueMap)||void 0===t?void 0:t.CENTER_YEAR},bizCode:function(){var e;return null===(e=this.$store.getters.getAppConfig)||void 0===e?void 0:e.bizCode}},created:function(){var e=this;return Object(s["a"])(Object(l["a"])().mark((function t(){var a;return Object(l["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=e.$router.history.current.query.appCode,e.appCode=a||"CM",e.query.busiYear=e.busiYear,e.handleGetEnum(),e.handleQueryLeafTypeList(),t.next=7,e.handleQueryBusinessOrgList();case 7:return t.next=9,e.handleQueryIndustryOrgList();case 9:case"end":return t.stop()}}),t)})))()},methods:{handleGetEnum:function(){var e=this,t={enumTypeCodes:["WEIGHT_UNIT","AREA_UNIT"]};this.$apis.bim.enumType.query(t).then((function(t){var a=(null===t||void 0===t?void 0:t.enumMap)||{};e.weightUnitList=a.WEIGHT_UNIT||[],e.areaUnitList=a.AREA_UNIT||[]}))},handleQueryLeafTypeList:function(){var e=this;this.$apis.bim.leafType.query({}).then((function(t){e.leafTypeList=(null===t||void 0===t?void 0:t.rows)||[]}))},onPageAction:function(e,t){var a=this;this.asPercentTemp&&(this.query.asPercent=this.asPercentTemp/100);var i=Object(n["a"])({pageNo:e,pageSize:t},this.query);this.loading=!0,this.$apis.apm.baseClear.query(i).then((function(e){a.loading=!1,a.tableData=(null===e||void 0===e?void 0:e.rows)||[],a.pagination.total=null===e||void 0===e?void 0:e.totalRows})).catch((function(){a.loading=!1}))},onQuery:function(){this.$refs.tableRef.pageAction(1,10)},onReset:function(){this.asPercentTemp=void 0,this.query={busiYear:this.busiYear},this.onQuery()},handleQueryBusinessOrgList:function(){var e=this;return Object(s["a"])(Object(l["a"])().mark((function t(){var a,i;return Object(l["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a={busiYear:e.busiYear,orgTypeEk:"TOBACCO",orgLevelEk:"2",parentBizCode:e.bizCode},t.next=3,e.$apis.bim.org.queryBy(a);case 3:i=t.sent,e.businessOrgList=i.rows||[];case 5:case"end":return t.stop()}}),t)})))()},onFetchBusinessOrgList:function(){var e=this;return new Promise((function(t){var a=Object(f["treeFormatList"])(e.businessOrgList,e.replaceFields);t(a)}))},handleQueryIndustryOrgList:function(){var e=this;return Object(s["a"])(Object(l["a"])().mark((function t(){var a,i;return Object(l["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a={busiYear:e.busiYear,orgTypeEk:"INDUSTRY",orgLevelEk:"2",parentBizCode:e.bizCode},t.next=3,e.$apis.bim.org.queryBy(a);case 3:i=t.sent,e.industryOrgList=i.rows||[];case 5:case"end":return t.stop()}}),t)})))()},onFetchIndustryOrgList:function(){var e=this;return new Promise((function(t){var a=Object(f["treeFormatList"])(e.industryOrgList,e.replaceFields);t(a)}))},onSelTableData:function(e){var t=e.records;this.selTableData=t},onSelAllTableData:function(e){var t=e.records;this.selTableData=t},handleUpdate:function(){this.$refs.editRef.show()},onClear:function(){var e=this,t=this.$createElement;this.selTableData.length?this.$confirm({title:"是否执行该操作?",content:function(){return t("div",{style:"color:red;"},["是否确认清理选中的数据，确认请点击'确认'按钮，取消点击'取消'按钮。"])},onOk:function(){var t={busiYear:e.busiYear,bmUnitIds:e.selTableData.map((function(e){return e.bmUnitId}))};e.loading=!0,e.$apis.apm.baseClear.clear(t).then((function(){e.loading=!1,e.$message.success("清理成功"),e.onQuery()}))}}):this.$message.error("请选择一条数据再清理")},onCalculate:function(){var e=this,t=this.$createElement;this.$confirm({title:"是否执行该操作?",content:function(){return t("div",{style:"color:red;"},["是否确认要计算上一年调拨比例，确认请点击'确认'按钮，取消点击'取消'按钮。"])},onOk:function(){var t={busiYear:e.busiYear};e.loading=!0,e.$apis.apm.baseClear.calculate(t).then((function(){e.loading=!1,e.$message.error("计算成功"),e.onQuery()}))}})}}},v=g,w=(a("93e5"),Object(y["a"])(v,i,r,!1,null,"5151ee6a",null));t["default"]=w.exports},5530:function(e,t,a){"use strict";a.d(t,"a",(function(){return n}));a("b64b"),a("a4d3"),a("4de4"),a("d3b7"),a("e439"),a("159b"),a("dbb4");function i(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function r(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function n(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?r(Object(a),!0).forEach((function(t){i(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}},"93e5":function(e,t,a){"use strict";a("2703")}}]);
//# sourceMappingURL=chunk-7a06b64b.8c10c7ba.js.map