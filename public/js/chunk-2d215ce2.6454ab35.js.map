{"version":3,"sources":["webpack:///./src/views/apm/demand/manage/Index.vue?f1e3","webpack:///src/views/apm/demand/manage/Index.vue","webpack:///./src/views/apm/demand/manage/Index.vue?7e90","webpack:///./src/views/apm/demand/manage/Index.vue"],"names":["render","_vm","this","_h","$createElement","_c","_self","attrs","on","onQuery","model","value","queryItems","callback","$$v","$set","expression","_l","item","key","batchName","_v","_s","staticClass","busiYear","weightUnitName","staticStyle","ref","tableData","rows","trigger","mode","showStatus","loading","scopedSlots","_u","fn","row","finishFlag","isFlueCuredControl","$event","handleNoValue","crudeWeight","isSunCuredControl","sunCuredWeight","isRtControl","rtPlanWeight","onSave","onReset","staticRenderFns","name","components","data","bizCode","orgCodeList","yearDisable","defaultBatchName","batchList","oldTableData","pagination","pageNumber","pageSize","total","auditStateList","id","weightUnit","computed","appConfig","created","mounted","methods","field","rowObj","itemObj","console","handleGetYear","orgObj","appCode","yearTypeCode","businessYearObj","businessYear","batchParam","respone","needCollectBatch","needCollectBatchId","query","then","catch","handleUnitParse","handleOlDataRow","obj","newTableData","pcTNeedCollectPlanAmountMasDTOS","save","onCancle","onDel","title","content","onOk","idList","delete","ids","selectAllEvent","selectRowChange","checked","JSON","component"],"mappings":"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","file":"js/chunk-2d215ce2.6454ab35.js","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('ec-container',{attrs:{\"height\":\"100%\",\"title\":\"采集批次计划量管理\",\"icon\":\"onetomany\",\"color-code\":\"008\"}},[_c('ec-container-body',[_c('ec-panel',{attrs:{\"auto\":false}},[_c('ec-panel-toolbar',[_c('ec-query-panel',{attrs:{\"showAction\":false}},[_c('ec-query-item',{attrs:{\"label\":\"采集批次\"}},[_c('a-select',{attrs:{\"placeholder\":\"请选择\"},on:{\"select\":_vm.onQuery},model:{value:(_vm.queryItems.batchName),callback:function ($$v) {_vm.$set(_vm.queryItems, \"batchName\", $$v)},expression:\"queryItems.batchName\"}},_vm._l((_vm.batchList),function(item){return _c('a-select-option',{key:item.batchName},[_vm._v(\" \"+_vm._s(item.batchName)+\" \")])}),1)],1)],1),_c('ec-divider')],1),_c('ec-panel-header',[_c('ec-panel-item',[_c('ec-panel-item-right',[_c('span',{staticClass:\"ant-form-text\"},[_vm._v(\" 业务年度： \"+_vm._s(_vm.queryItems.busiYear))]),_c('span',{staticClass:\"ant-form-text\"},[_vm._v(\" 计量单位： \"+_vm._s(_vm.weightUnitName))])])],1)],1),_c('ec-panel-body',{staticStyle:{\"overflow\":\"hidden\"}},[_c('ec-table',{ref:\"table\",attrs:{\"border\":\"\",\"data\":_vm.tableData.rows,\"edit-config\":{ trigger: 'click', mode: 'row', showStatus: true },\"loading\":_vm.loading,\"row-select\":\"\"}},[_c('ec-table-col',{attrs:{\"width\":\"70\",\"title\":\"序号\",\"type\":\"seq\",\"align\":\"center\"}}),_c('ec-table-col',{attrs:{\"field\":\"orgName\",\"title\":\"中烟工业\",\"header-align\":\"center\",\"align\":\"left\",\"min-width\":\"23%\"}}),_c('ec-table-col',{attrs:{\"field\":\"crudeWeight\",\"title\":\"烤烟计划量\",\"align\":\"right\",\"header-align\":\"center\",\"width\":\"21%\",\"edit-render\":{}},scopedSlots:_vm._u([{key:\"edit\",fn:function(ref){\nvar row = ref.row;\nreturn [(row.finishFlag === '0' && row.isFlueCuredControl === '1')?_c('a-input-number',{attrs:{\"min\":0,\"max\":100000,\"precision\":2},on:{\"blur\":function($event){return _vm.handleNoValue(row, 'crudeWeight')}},model:{value:(row.crudeWeight),callback:function ($$v) {_vm.$set(row, \"crudeWeight\", $$v)},expression:\"row.crudeWeight\"}}):[_vm._v(_vm._s(row.crudeWeight))]]}}])}),_c('ec-table-col',{attrs:{\"field\":\"sunCuredWeight\",\"title\":\"晾晒烟计划量\",\"align\":\"right\",\"header-align\":\"center\",\"width\":\"21%\",\"edit-render\":{}},scopedSlots:_vm._u([{key:\"edit\",fn:function(ref){\nvar row = ref.row;\nreturn [(row.finishFlag === '0' && row.isSunCuredControl === '1')?_c('a-input-number',{attrs:{\"min\":0,\"max\":100000,\"precision\":2},on:{\"blur\":function($event){return _vm.handleNoValue(row, 'sunCuredWeight')}},model:{value:(row.sunCuredWeight),callback:function ($$v) {_vm.$set(row, \"sunCuredWeight\", $$v)},expression:\"row.sunCuredWeight\"}}):[_vm._v(_vm._s(row.sunCuredWeight))]]}}])}),_c('ec-table-col',{attrs:{\"field\":\"rtPlanWeight\",\"title\":\"再造烟叶计划量\",\"align\":\"right\",\"header-align\":\"center\",\"width\":\"21%\",\"edit-render\":{}},scopedSlots:_vm._u([{key:\"edit\",fn:function(ref){\nvar row = ref.row;\nreturn [(row.finishFlag === '0' && row.isRtControl === '1')?_c('a-input-number',{attrs:{\"min\":0,\"max\":100000,\"precision\":2},on:{\"blur\":function($event){return _vm.handleNoValue(row, 'rtPlanWeight')}},model:{value:(row.rtPlanWeight),callback:function ($$v) {_vm.$set(row, \"rtPlanWeight\", $$v)},expression:\"row.rtPlanWeight\"}}):[_vm._v(_vm._s(row.rtPlanWeight))]]}}])})],1)],1)],1)],1),_c('ec-container-footer',{attrs:{\"fixed\":\"\"}},[_c('a-space',[_c('a-button',{attrs:{\"type\":\"primary\"},on:{\"click\":_vm.onSave}},[_vm._v(\"保存\")]),_c('a-button',{on:{\"click\":_vm.onReset}},[_vm._v(\"重置\")])],1)],1)],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n  <ec-container height=\"100%\" title=\"采集批次计划量管理\" icon=\"onetomany\" color-code=\"008\">\r\n    <ec-container-body>\r\n      <ec-panel :auto=\"false\">\r\n        <ec-panel-toolbar>\r\n          <ec-query-panel :showAction=\"false\">\r\n            <ec-query-item label=\"采集批次\">\r\n              <a-select @select=\"onQuery\" placeholder=\"请选择\" v-model=\"queryItems.batchName\">\r\n                <a-select-option v-for=\"item in batchList\" :key=\"item.batchName\">\r\n                  {{ item.batchName }}\r\n                </a-select-option>\r\n              </a-select>\r\n            </ec-query-item>\r\n          </ec-query-panel>\r\n          <ec-divider />\r\n        </ec-panel-toolbar>\r\n        <ec-panel-header>\r\n          <ec-panel-item>\r\n            <!-- <ec-panel-item-left>\r\n              <a-button type=\"primary\">导出</a-button>\r\n            </ec-panel-item-left> -->\r\n            <ec-panel-item-right>\r\n              <span class=\"ant-form-text\"> 业务年度： {{ queryItems.busiYear }}</span>\r\n              <span class=\"ant-form-text\"> 计量单位： {{ weightUnitName }}</span>\r\n            </ec-panel-item-right>\r\n          </ec-panel-item>\r\n        </ec-panel-header>\r\n        <ec-panel-body style=\"overflow: hidden\">\r\n          <ec-table\r\n            ref=\"table\"\r\n            border\r\n            :data=\"tableData.rows\"\r\n            :edit-config=\"{ trigger: 'click', mode: 'row', showStatus: true }\"\r\n            :loading=\"loading\"\r\n            row-select\r\n          >\r\n            <ec-table-col width=\"70\" title=\"序号\" type=\"seq\" align=\"center\" />\r\n            <ec-table-col\r\n              field=\"orgName\"\r\n              title=\"中烟工业\"\r\n              header-align=\"center\"\r\n              align=\"left\"\r\n              min-width=\"23%\"\r\n            />\r\n\r\n            <ec-table-col\r\n              field=\"crudeWeight\"\r\n              title=\"烤烟计划量\"\r\n              align=\"right\"\r\n              header-align=\"center\"\r\n              width=\"21%\"\r\n              :edit-render=\"{}\"\r\n            >\r\n              <template #edit=\"{ row }\">\r\n                <a-input-number\r\n                  v-if=\"row.finishFlag === '0' && row.isFlueCuredControl === '1'\"\r\n                  v-model=\"row.crudeWeight\"\r\n                  :min=\"0\"\r\n                  :max=\"100000\"\r\n                  :precision=\"2\"\r\n                  @blur=\"handleNoValue(row, 'crudeWeight')\"\r\n                ></a-input-number>\r\n                <template v-else>{{ row.crudeWeight }}</template>\r\n              </template>\r\n            </ec-table-col>\r\n\r\n            <ec-table-col\r\n              field=\"sunCuredWeight\"\r\n              title=\"晾晒烟计划量\"\r\n              align=\"right\"\r\n              header-align=\"center\"\r\n              width=\"21%\"\r\n              :edit-render=\"{}\"\r\n            >\r\n              <template #edit=\"{ row }\">\r\n                <a-input-number\r\n                  v-if=\"row.finishFlag === '0' && row.isSunCuredControl === '1'\"\r\n                  v-model=\"row.sunCuredWeight\"\r\n                  :min=\"0\"\r\n                  :max=\"100000\"\r\n                  :precision=\"2\"\r\n                  @blur=\"handleNoValue(row, 'sunCuredWeight')\"\r\n                ></a-input-number>\r\n                <template v-else>{{ row.sunCuredWeight }}</template>\r\n              </template>\r\n            </ec-table-col>\r\n\r\n            <ec-table-col\r\n              field=\"rtPlanWeight\"\r\n              title=\"再造烟叶计划量\"\r\n              align=\"right\"\r\n              header-align=\"center\"\r\n              width=\"21%\"\r\n              :edit-render=\"{}\"\r\n            >\r\n              <template #edit=\"{ row }\">\r\n                <a-input-number\r\n                  v-if=\"row.finishFlag === '0' && row.isRtControl === '1'\"\r\n                  v-model=\"row.rtPlanWeight\"\r\n                  :min=\"0\"\r\n                  :max=\"100000\"\r\n                  :precision=\"2\"\r\n                  @blur=\"handleNoValue(row, 'rtPlanWeight')\"\r\n                ></a-input-number>\r\n                <template v-else>{{ row.rtPlanWeight }}</template>\r\n              </template>\r\n            </ec-table-col>\r\n          </ec-table>\r\n          <!-- </ec-v-item>\r\n          </ec-v-layout> -->\r\n        </ec-panel-body>\r\n      </ec-panel>\r\n    </ec-container-body>\r\n    <ec-container-footer fixed>\r\n      <a-space>\r\n        <a-button type=\"primary\" @click=\"onSave\">保存</a-button>\r\n        <a-button @click=\"onReset\">重置</a-button>\r\n      </a-space>\r\n    </ec-container-footer>\r\n  </ec-container>\r\n</template>\r\n\r\n<script>\r\nimport _ from 'lodash';\r\n\r\nexport default {\r\n  name: 'BatchManage',\r\n  components: {},\r\n  data() {\r\n    return {\r\n      queryItems: {\r\n        busiYear: '',\r\n        batchName: '',\r\n      },\r\n      bizCode: '',\r\n      // isDisable: true,\r\n      orgCodeList: [],\r\n      loading: false,\r\n      yearDisable: true,\r\n      defaultBatchName: '',\r\n      batchList: [],\r\n      oldTableData: [],\r\n      pagination: {\r\n        pageNumber: 1,\r\n        pageSize: 10,\r\n        total: 0,\r\n      },\r\n      auditStateList: [\r\n        { id: '', name: '全部' },\r\n        { id: '0', name: '未上报' },\r\n        { id: '1', name: '省公司退回' },\r\n        { id: '2', name: '总公司退回' },\r\n        { id: '3', name: '省公司待确认' },\r\n        { id: '4', name: '省公司已确认' },\r\n        { id: '5', name: '总公司待审核' },\r\n        { id: '6', name: '总公司已审核' },\r\n      ],\r\n      weightUnit: 500000,\r\n      weightUnitName: '万担',\r\n      tableData: {\r\n        // 数据表格\r\n        // totalRows: 0,\r\n        rows: [],\r\n      },\r\n    };\r\n  },\r\n  computed: {\r\n    appConfig() {\r\n      return this.$store.getters.getAppConfig;\r\n    },\r\n  },\r\n  created() {\r\n    const { appCode } = this.$router.history.current.query;\r\n    this.appCode = appCode || 'CM'; // 获取当前登入信息\r\n    // await this.handleGetYear();\r\n  },\r\n  mounted() {\r\n    this.onQuery();\r\n  },\r\n  methods: {\r\n    // 处理输入空数据\r\n    handleNoValue(row, field) {\r\n      const rowObj = row;\r\n      const value = rowObj[field];\r\n      if (!value) {\r\n        rowObj[field] = '0.00';\r\n      }\r\n      this.oldTableData.forEach((item) => {\r\n        if (item.planAmountId === rowObj.planAmountId) {\r\n          const itemObj = item;\r\n          itemObj[field] = (Number(row[field]) * Number(this.weightUnit)).toFixed(2);\r\n        }\r\n      });\r\n\r\n      console.log(`tableData:${JSON.stringify(row)}`);\r\n      console.log(`oldTableData:${JSON.stringify(this.oldTableData)}`);\r\n    },\r\n    // 获取业务年度\r\n    async handleGetYear() {\r\n      if (this.queryItems.busiYear === '') {\r\n        if (!this.orgCode) {\r\n          const orgObj = await this.$apis.bim.curOrg.get({});\r\n          this.bizCode = orgObj?.bizCode;\r\n          this.orgCode = orgObj?.orgUniqueCode; // todo 写死数据\r\n        }\r\n        const data = {\r\n          bizCode: this.appConfig.bizCode, // todo 写死的数据\r\n          appCode: this.appCode,\r\n          yearTypeCode: 'BIZ_YEAR',\r\n        };\r\n        const businessYearObj = await this.$apis.bpm.executionEnter.getBuYear(data);\r\n\r\n        const businessYear = businessYearObj?.yearValue || new Date().getFullYear();\r\n        this.queryItems.busiYear = businessYear;\r\n        this.bizYear = businessYear;\r\n        console.log(`业务年度${businessYear}`);\r\n        // 获取批次列表，并设置批次的默认值\r\n        const batchParam = {\r\n          busiYear: businessYear,\r\n        };\r\n        const respone = await this.$apis.apm.demandManage.queryBatch(batchParam);\r\n        const rows = respone?.rows || [];\r\n        this.batchList = rows;\r\n        // console.log(`采集批次：${rows.split(',')}`);\r\n        const defaultBatchName = rows && rows.length > 0 ? rows[0].batchName : '';\r\n        this.queryItems.batchName = defaultBatchName;\r\n        this.defaultBatchName = defaultBatchName;\r\n      }\r\n    },\r\n    // 数据初始化\r\n    async onQuery() {\r\n      await this.handleGetYear();\r\n\r\n      const { batchName } = this.queryItems;\r\n      const needCollectBatch = this.batchList.find((item) => item.batchName === batchName);\r\n      const data = {\r\n        busiYear: this.queryItems.busiYear,\r\n        batchName,\r\n        needCollectBatchId: needCollectBatch?.needCollectBatchId,\r\n      };\r\n      this.loading = true;\r\n      console.log(`调用后端的参数：${JSON.stringify(data)}`);\r\n      this.$apis.apm.demandManage\r\n        .query(data)\r\n        .then((res) => {\r\n          const rows = res?.rows;\r\n\r\n          console.log(`计划量管理：${JSON.stringify(res)}`);\r\n          this.oldTableData = _.cloneDeep(rows);\r\n          const tableData = _.cloneDeep(rows);\r\n          this.handleUnitParse(tableData);\r\n          this.loading = false;\r\n        })\r\n        .catch((err) => {\r\n          this.loading = false;\r\n          console.log(err);\r\n        });\r\n    },\r\n    // 处理单位切换\r\n    handleUnitParse(rows) {\r\n      const newTableData = [];\r\n      const handleOlDataRow = rows;\r\n\r\n      handleOlDataRow.forEach((item) => {\r\n        const obj = item;\r\n        obj.crudeWeight = (obj.crudeWeight / this.weightUnit).toFixed(2);\r\n        obj.sunCuredWeight = (obj.sunCuredWeight / this.weightUnit).toFixed(2);\r\n        obj.rtPlanWeight = (obj.rtPlanWeight / this.weightUnit).toFixed(2);\r\n        newTableData.push(obj);\r\n      });\r\n      this.tableData.rows = newTableData;\r\n    },\r\n    // 保存\r\n    onSave() {\r\n      this.saving = true;\r\n      const data = {\r\n        pcTNeedCollectPlanAmountMasDTOS: this.oldTableData,\r\n      };\r\n\r\n      console.log(`===${JSON.stringify(data)}`);\r\n\r\n      this.$apis.apm.demandManage\r\n        .save(data)\r\n        .then((res) => {\r\n          console.log(JSON.stringify(res));\r\n          if (res.result) {\r\n            this.saving = false;\r\n            this.$message.success('操作成功');\r\n            this.onQuery();\r\n          } else {\r\n            this.saving = false;\r\n            this.$message.error('操作失败');\r\n          }\r\n        })\r\n        .catch((err) => {\r\n          console.log(err);\r\n          this.saving = false;\r\n        });\r\n    },\r\n\r\n    // 取消\r\n    onCancle() {},\r\n\r\n    // 按钮删除\r\n    onDel() {\r\n      if (!this.selectedRows || this.selectedRows.length <= 0) {\r\n        this.$message.error('请选择一条数据再删除');\r\n        return;\r\n      }\r\n      this.$confirm({\r\n        title: '是否执行该操作?',\r\n        content: () => (\r\n          <div style=\"color:red;\">\r\n            是否确认删除选中的数据，确认请点击'确认'按钮，取消点击'取消'按钮。\r\n          </div>\r\n        ),\r\n        onOk: () => {\r\n          this.loading = true;\r\n          const idList = [];\r\n          for (let i = 0; i < this.selectedRows.length; i++) {\r\n            idList.push(this.selectedRows[i].leafColorId);\r\n          }\r\n          this.$apis.tbm.tabaccoColor\r\n            .delete({ ids: idList })\r\n            .then((res) => {\r\n              console.log(JSON.stringify(res));\r\n              if (res.result) {\r\n                this.loading = false;\r\n                this.$refs.table.pageAction(1);\r\n                this.$message.success('操作成功');\r\n              } else {\r\n                this.$message.error('操作失败');\r\n              }\r\n            })\r\n            .catch((error) => {\r\n              this.loading = false;\r\n              if (error) {\r\n                this.$message.error(error.message || '操作失败');\r\n              } else {\r\n                this.$message.error('操作失败');\r\n              }\r\n            });\r\n        },\r\n      });\r\n    },\r\n\r\n    // 重置\r\n    onReset() {\r\n      // this.queryItems.batchName = this.defaultBatchName;\r\n      this.onQuery();\r\n    },\r\n\r\n    // 选中所有列表\r\n    selectAllEvent({ checked, records }) {\r\n      console.log(`${checked}-选中所有records包含选中的所以对象----${JSON.stringify(records)}`);\r\n      this.selectedRows = records;\r\n    },\r\n\r\n    // 选中列表\r\n    selectRowChange({ checked, records }) {\r\n      console.log(\r\n        `${checked}-选择改变时会把records包含选中的所以对象----${JSON.stringify(records)}`,\r\n      );\r\n      this.selectedRows = records;\r\n    },\r\n  },\r\n};\r\n</script>\r\n","import mod from \"-!../../../../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../../../../node_modules/thread-loader/dist/cjs.js!../../../../../node_modules/@vue/cli-plugin-babel/node_modules/babel-loader/lib/index.js!../../../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Index.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../../../../node_modules/thread-loader/dist/cjs.js!../../../../../node_modules/@vue/cli-plugin-babel/node_modules/babel-loader/lib/index.js!../../../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Index.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./Index.vue?vue&type=template&id=38516700&\"\nimport script from \"./Index.vue?vue&type=script&lang=js&\"\nexport * from \"./Index.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports"],"sourceRoot":""}