(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-759e7d8e","chunk-21c187d7"],{"0ef8":function(e,t,a){var n=a("448a").default,r=a("63748").default,i=a("7ec2").default,l=a("c973").default,o=a("9523").default,s=a("ded3").default;a("99af"),a("b0c0"),a("a9e3"),a("ac1f"),a("841c"),a("d3b7"),a("4de4"),a("d81d"),a("caad"),a("2532"),a("3ca3"),a("ddb0"),a("4ec9"),a("159b"),a("a630"),a("6062"),a("00b4"),a("a15b"),a("ac16"),a("f8c9"),function(){"use strict";var t={483:function(e,t,a){function n(e,t,a,n,r,i,l,o){var s,c="function"===typeof e?e.options:e;if(t&&(c.render=t,c.staticRenderFns=a,c._compiled=!0),n&&(c.functional=!0),i&&(c._scopeId="data-v-"+i),l?(s=function(e){e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,e||"undefined"===typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),r&&r.call(this,e),e&&e._registeredComponents&&e._registeredComponents.add(l)},c._ssrRegister=s):r&&(s=o?function(){r.call(this,(c.functional?this.parent:this).$root.$options.shadowRoot)}:r),s)if(c.functional){c._injectStyles=s;var u=c.render;c.render=function(e,t){return s.call(t),u(e,t)}}else{var d=c.beforeCreate;c.beforeCreate=d?[].concat(d,s):[s]}return{exports:e,options:c}}a.d(t,{Z:function(){return n}})},51:function(e,t,a){a.d(t,{H_:function(){return i},Qb:function(){return l}});var n="Ecm",r="$ecm",i=function(e){var t;return null!==(t=null===e||void 0===e?void 0:e.componentPrefix)&&void 0!==t?t:n},l=function(e,t){var a,n=e;t&&t.classPrefix&&(n.prototype[r]=s(s({},null!==(a=n.prototype[r])&&void 0!==a?a:{}),{},{classPrefix:t.classPrefix}))}},657:function(e,t,a){var c;a.d(t,{default:function(){return w}});var u=function(){var e=this,t=e._self._c;return t("div",{staticClass:"tree-search"},[e._t("title"),e.isSearch?t("div",{staticClass:"tree-search-select",style:{padding:e.searchPadding}},[t("a-select",{staticStyle:{width:"100%"},attrs:{"show-search":"",value:e.selectedValue,placeholder:e.placeholder,"default-active-first-option":!1,"show-arrow":!1,"filter-option":!1,"not-found-content":null},on:{search:e.onSelectSearch,select:e.onSelectChange,rightClick:e.oRightClick}},e._l(e.selectOption,(function(a){return t("a-select-option",{key:a.key,attrs:{value:a.key,title:"".concat(a.title)}},[t("a-row",[t("a-col",{staticClass:"ellipsis",attrs:{span:e.isShowParent?18:24,title:a.title}},[e._v(e._s(a.title))]),t("a-col",{staticClass:"ellipsis",staticStyle:{color:"#ccc","font-size":"12px"},attrs:{span:e.isShowParent?6:0,title:e.getNameBy(e.tmpSearchOption,a.pkey)}},[e._v(e._s(e.getNameBy(e.tmpSearchOption,a.pkey)))])],1)],1)})),1)],1):e._e(),e.isSearch?t("a-divider",{staticStyle:{margin:"8px 0"}}):e._e(),t("div",{staticClass:"tree-search-tree"},[t("a-spin",{staticClass:"spin",attrs:{spinning:e.fetching}}),e.lazy?t("a-tree",e._b({ref:"treeRef",attrs:{blockNode:!0,multiple:e.multiple,checkedKeys:e.treeCheckedKeys,checkable:e.checkable,selectable:e.selectable,expandedKeys:e.treeExpandedKeys,selectedKeys:e.treeSelectedKeys,loadedKeys:e.treeLoadedKeys,"tree-data":e.treeData,loadData:e.handleLoadLazyData},on:{select:e.onSelectTree,check:e.onCheckTree,expand:e.onExpandTree,load:e.onLazyLoad,rightClick:e.oRightClick},scopedSlots:e._u([{key:"title",fn:function(a){return[t("span",{attrs:{id:"".concat(e.treeType,"_").concat(a.key)}},[e._v(e._s(a.title))]),e._t("action",null,{action:a})]}}],null,!0)},"a-tree",e.$attrs,!1)):t("a-tree",e._b({ref:"treeRef",attrs:{blockNode:!0,checkable:e.checkable,selectable:e.selectable,multiple:e.multiple,checkedKeys:e.treeCheckedKeys,expandedKeys:e.treeExpandedKeys,selectedKeys:e.treeSelectedKeys,"tree-data":e.treeData,replaceFields:e.replaceFields},on:{select:e.onSelectTree,check:e.onCheckTree,expand:e.onExpandTree},scopedSlots:e._u([{key:"title",fn:function(a){return[t("span",{attrs:{id:"".concat(e.treeType,"_").concat(a.key)}},[e._v(e._s(a.title))]),e._t("action",null,{action:a})]}}],null,!0)},"a-tree",e.$attrs,!1)),e.fetching||e.treeData&&(!Array.isArray(e.treeData)||0!==e.treeData.length)?e._e():t("a-empty",{staticClass:"spin"})],1)],2)},d=[],f=a(632),h=a(142),p={inheritAttrs:!1,name:"SelectTree",components:(c={},o(c,h.Select.name,h.Select),o(c,h.Row.name,h.Row),o(c,h.Col.name,h.Col),o(c,h.Divider.name,h.Divider),o(c,h.Spin.name,h.Spin),o(c,h.Empty.name,h.Empty),o(c,h.Tree.name,h.Tree),c),props:{treeType:{type:String,default:"st"},selectedKeys:{type:Array,default:null},checkedKeys:{type:Array,default:null},expandedKeys:{type:Array,default:null},lazy:{type:Boolean,default:!0},selectable:{type:Boolean,default:!0},checkable:{type:Boolean,default:!1},searchPadding:{type:String,default:"12px 12px 6px"},placeholder:{type:String,default:"请输入关键词筛选"},multiple:{type:Boolean,default:!1},join:{type:[String,Boolean],default:","},isShowParent:{type:Boolean,default:!1},replaceFields:{type:Object,default:function(){return{pkey:"pkey",title:"title",key:"key",children:"children"}}},search:{type:Boolean,default:!0},activeFirst:{type:Boolean,default:!1},beforeSelect:{type:Function,default:null},beforeCheck:{type:Function,default:null},initLevel:{type:Number,default:2},fetchData:{type:Function,required:!0},fetchDataById:{type:Function},fetchDataByName:{type:Function},valueField:{type:String,default:"key"},params:{type:Object,default:function(){return{}}}},data:function(){return this.onSelectSearch=(0,f.debounce)(this.onSelectSearch,500),{fetching:!1,selectedValue:void 0,treeCheckedKeys:[],treeSelectedKeys:[],treeExpandedKeys:[],treeLoadedKeys:[],treeData:[],selectOption:[],tmpSearchOption:[]}},computed:{isSearch:function(){return this.search&&(this.treeData||Array.isArray(this.treeData)&&0!==this.treeData.length)}},watch:{params:{handler:function(e,t){(0,f.isRefEqual)(e,t)||this.handleTreeData(e)},deep:!0,immediate:!0},checkedKeys:{handler:function(e){this.treeCheckedKeys=e},deep:!0,immediate:!0},selectedKeys:{handler:function(e){this.treeSelectedKeys=e},deep:!0,immediate:!0},expandedKeys:{handler:function(e){this.treeExpandedKeys=e},deep:!0,immediate:!0}},methods:{getNameBy:f.getNameBy,handleTreeData:function(e){var t=this;this.fetching=!0,this.treeLoadedKeys=[],this.treeExpandedKeys=[],this.treeData=[];try{this.fetchData(e).then(function(){var e=l(i().mark((function e(a){var n,r,l;return i().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n=(0,f.cloneDeep)(a).filter((function(e){return!e.pkey}))[0],t.treeData=(0,f.listFormatTree)(a,t.replaceFields),r=a.map((function(e){return e.key})).filter((function(e){return e})),l=(t.selectedKeys||[]).filter((function(e){return!r.includes(e)})),Array.isArray(t.treeData)&&0!==t.treeData.length&&(t.treeExpandedKeys=[n.key],t.$emit("expand",t.treeExpandedKeys),t.activeFirst&&t.onSelectTreeFn(n.key)),e.t0=0!==l.length,!e.t0){e.next=8;break}return e.next=8,t.handleTreeByCode(l);case 8:Array.isArray(t.treeSelectedKeys)&&0!==t.treeSelectedKeys.length&&setTimeout((function(){t.onScrollIntoView(t.treeSelectedKeys[0])}),500);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).finally((function(){t.fetching=!1}))}catch(a){this.treeData=[]}},handleTreeByCode:function(e){var t=this;return l(i().mark((function a(){var l,o,c,u,d,h,p,m,y,v,g,b;return i().wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(l=Array.isArray(e)?e:[e],t.fetching=!0,a.prev=2,!t.lazy){a.next=20;break}o=[],c=r(l);try{for(c.s();!(u=c.n()).done;)d=u.value,d&&o.push(t.fetchDataById(s(s({},t.params),{},{code:d})))}catch(i){c.e(i)}finally{c.f()}return a.next=9,Promise.all(o);case 9:if(h=a.sent,p=(0,f.treeFormatList)(t.treeData,t.replaceFields),m=(0,f.flattenDeep)(h),y=p.map((function(e){return e.key})).filter((function(e){return e})),v=m.filter((function(e){return!y.includes(e.key)})),g=v.map((function(e){return e.pkey})),b=(0,f.uniqueBy)(g),a.t0=0!==b.length,!a.t0){a.next=20;break}return a.next=20,t.handleLoadMore(b);case 20:l.forEach((function(e){var a=(0,f.getExpandedKeys)(t.treeData,e,t.replaceFields);t.treeExpandedKeys=Array.from(new Set([].concat(n(a),n(t.treeExpandedKeys))))})),a.next=25;break;case 23:a.prev=23,a.t1=a["catch"](2);case 25:t.fetching=!1;case 26:case"end":return a.stop()}}),a,null,[[2,23]])})))()},handleLoadMore:function(e){var t=this;return l(i().mark((function a(){var l,o,c,u,d,h,p,m;return i().wrap((function(a){while(1)switch(a.prev=a.next){case 0:t.fetching=!0,l=[],o=r(e);try{for(o.s();!(c=o.n()).done;)u=c.value,u&&l.push(t.fetchData(s(s({},t.params),{},{code:u})))}catch(i){o.e(i)}finally{o.f()}return a.next=6,Promise.all(l);case 6:d=a.sent,h=(0,f.flattenDeep)(d),p=(0,f.treeFormatList)(t.treeData),m=(0,f.uniqueBy)([].concat(n(p),n(h))),t.treeData=(0,f.listFormatTree)(m,t.replaceFields),t.fetching=!1;case 11:case"end":return a.stop()}}),a)})))()},handleLoadLazyData:function(e){var t=this,a=e;return new Promise((function(e){a.dataRef.children?e():t.fetchData(s(s({},t.params),{},{code:a.dataRef.key})).then((function(r){var i=(0,f.uniqueBy)(r,"key");a.dataRef.children=n(i),t.treeData=n(t.treeData),e(i)})).finally((function(){t.fetching=!1}))}))},onSelectSearch:function(e){/^\s*$/.test(e)||(this.handlerSearch(e),this.$emit("search",e))},handlerSearch:function(e){var t=this;return l(i().mark((function a(){var n,r;return i().wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(!t.lazy){a.next=8;break}return a.next=3,t.fetchDataByName(s(s({},t.params),{},{name:e})).catch((function(e){}));case 3:n=a.sent,r=(0,f.uniqueBy)(n,"key"),t.tmpSearchOption=(0,f.cloneDeep)(r)||[],t.selectOption=r.filter((function(t){return String(null===t||void 0===t?void 0:t.title).indexOf(e)>-1})),a.next=9;break;case 8:t.selectOption=(0,f.filterList)(t.treeData,(function(t){return String(null===t||void 0===t?void 0:t.title).indexOf(e)>-1}),t.replaceFields);case 9:case"end":return a.stop()}}),a)})))()},handleReturnValue:function(e){return Array.isArray(e)&&this.multiple?e:Array.isArray(e)&&0!==e.length?e[0]:Array.isArray(e)&&0===e.length?this.multiple?e:null:e},onSelectChange:function(e){var t=this;return l(i().mark((function a(){var r,l,o,s,c,u,d,h;return i().wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(l=Array.isArray(e)?e:[e],o=(0,f.cloneDeep)(t.selectOption).filter((function(e){return l.includes(e.key)})),!t.lazy){a.next=7;break}if(s=(0,f.treeFormatList)(t.treeData,t.replaceFields),c=s.map((function(e){return e.key})).filter((function(e){return e})),u=t.tmpSearchOption.filter((function(e){return!c.includes(e.key)})),d=u.map((function(e){return e.pkey})),a.t0=0!==d.length,!a.t0){a.next=7;break}return a.next=7,t.handleLoadMore(d);case 7:h=(0,f.getExpandedKeys)(t.treeData,Array.isArray(e)&&0!==e.length?e[0]:e,t.replaceFields),t.multiple?!t.treeSelectedKeys.includes(l)&&(r=t.treeSelectedKeys).push.apply(r,n(l)):t.treeSelectedKeys=l,Object.assign(t,{selectedValue:l,treeExpandedKeys:h,selectOption:o,fetching:!1}),t.onSelectTreeFn(e);case 9:case"end":return a.stop()}}),a)})))()},onExpandTree:function(e,t){this.treeExpandedKeys=Array.isArray(e)?e:[e],this.$emit("expand",this.treeExpandedKeys,t)},onSelectTreeFn:function(e){var t=this;return l(i().mark((function a(){var r,l,o,s,c,u,d,h,p;return i().wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(r=Array.isArray(e)?e:[e],l=Array.isArray(e)&&0!==e.length?e[0]:e,o=(0,f.treeFormatList)(t.treeData,t.replaceFields),s=o.map((function(e){return e.key})).filter((function(e){return e})),s.includes(l)){a.next=11;break}return a.next=4,t.fetchDataById({code:l});case 4:return c=a.sent,a.next=7,(0,f.uniqueBy)([].concat(n(o),n(c)));case 7:return u=a.sent,a.next=10,(0,f.listFormatTree)(u);case 10:t.treeData=a.sent;case 11:d=(0,f.getNodeBy)(t.treeData,l),h=(0,f.getExpandedKeys)(t.treeData,l),p=Array.from(new Set(t.multiple?[].concat(n(t.treeSelectedKeys),n(r)):r)),t.expandedKeys=[].concat(n(t.expandedKeys),n(h)),t.onSelectTree(p,{event:"select",selected:!0,node:{dataRef:d}});case 13:case"end":return a.stop()}}),a)})))()},onScrollIntoView:function(e){var t=this;this.$nextTick((function(){var a,n,r=document.querySelector(".select-picker-modal");r?null===(a=document.querySelector(".select-picker-modal #".concat(t.treeType,"_").concat(e)))||void 0===a||a.scrollIntoView({behavior:"smooth",block:"center"}):null===(n=document.getElementById("".concat(t.treeType,"_").concat(e)))||void 0===n||n.scrollIntoView({behavior:"smooth",block:"center"})}))},onSelectTree:function(e,t){var a=this;return l(i().mark((function n(){var r,l,o,s,c,u,d,h;return i().wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(n.t0=a.beforeSelect,!n.t0){n.next=4;break}return n.next=4,a.beforeSelect(e,t);case 4:r=Array.isArray(e)?e:[e],l=t.node.dataRef.key,Object.assign(a,{treeSelectedKeys:r}),o=(0,f.uniqueBy)((0,f.filterList)(a.treeData,(function(e){return a.treeSelectedKeys.includes(e.key)}),a.replaceFields)),s=[],a.join&&(s=o.map((function(e){var t={};for(var n in e)n&&(t[n]=(0,f.getSelectedBy)(a.treeData,l,n,a.replaceFields).join("string"===typeof a.join?a.join:","));return t}))),c=o.map((function(e){return e[a.valueField]})),u=a.handleReturnValue(c),d=a.handleReturnValue(o),h=a.handleReturnValue(s),a.$emit("select",{treeSelectedKeys:u,selectOption:d,joinSelectOption:h,treeData:(0,f.cloneDeep)(a.treeData)},t),Array.isArray(a.selectedValue)&&0!==a.selectedValue.length&&a.selectedValue[0]!==l&&(a.selectedValue=void 0,a.selectOption=[]),a.onScrollIntoView(l);case 11:case"end":return n.stop()}}),n)})))()},onCheckTree:function(e,t){var a=this;return l(i().mark((function n(){var r,l,o,s;return i().wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(n.t0=a.beforeCheck,!n.t0){n.next=4;break}return n.next=4,a.beforeCheck(e,t);case 4:r=Array.isArray(e)?e:[e],l=t.node.dataRef.key,Object.assign(a,{treeCheckedKeys:r}),o=(0,f.uniqueBy)((0,f.filterList)(a.treeData,(function(e){return a.treeCheckedKeys.includes(e.key)}),a.replaceFields)),s=o.map((function(e){return e[a.valueField]})),a.$emit("check",{treeCheckedKeys:s,checkOption:o,treeData:(0,f.cloneDeep)(a.treeData)},t),Array.isArray(a.selectedValue)&&0!==a.selectedValue.length&&a.selectedValue[0]!==l&&(a.selectedValue=void 0,a.selectOption=[]),a.onScrollIntoView(l);case 8:case"end":return n.stop()}}),n)})))()},oRightClick:function(e){this.$emit("rightClick",e)},onLazyLoad:function(e){this.treeLoadedKeys=e}}},m=p,y=a(483),v=(0,y.Z)(m,u,d,!1,null,null,null),g=v.exports,b=a(51);g.install=function(e,t){(0,b.Qb)(e,t);var a=(0,b.H_)(t);e.component(a+g.name,g)};var w=g},632:function(e){e.exports=a("6ea6")},142:function(e){e.exports=a("f23d")}},c={};function u(e){var a=c[e];if(void 0!==a)return a.exports;var n=c[e]={exports:{}};return t[e](n,n.exports,u),n.exports}!function(){u.d=function(e,t){for(var a in t)u.o(t,a)&&!u.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})}}(),function(){u.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}();var d={};!function(){u.d(d,{default:function(){return h}});var e=function(){var e=this,t=e._self._c;return t("SelectTree",e._g(e._b({ref:"org",attrs:{treeType:"ort",lazy:e.lazy,join:e.join,search:e.search,activeFirst:e.activeFirst,multiple:e.multiple,initLevel:e.initLevel,fetchData:e.fetchGetTree,fetchDataById:e.fetchGetTreeById,fetchDataByName:e.fetchGetTreeByName,replaceFields:e.replaceFields,valueField:e.valueField,isShowParent:e.isShowParent,params:e.params},on:{select:e.onSelectTreeData}},"SelectTree",e.$attrs,!1),e.$listeners),[t("template",{slot:"title"},[e._t("title")],2)],2)},t=[],a=u(657),n=u(632),r={inheritAttrs:!1,name:"OrgTree",components:{SelectTree:a["default"]},props:{baseUrl:{type:String,default:"/dts/bim"},treeApi:{type:String,default:"/q/cmTOrgMain/getCmTOrgMainTreeDataList/v1"},treeApiById:{type:String,default:"/q/cmTOrgMain/getCmTOrgMainTreeParentByOrgUniqueCode/v1"},treeApiByName:{type:String,default:"/q/cmTOrgMain/getCmTOrgMainTreeParentByOrgName/v1"},placeholder:{type:String,default:"请选择关键词搜索"},multiple:{type:Boolean,default:!1},isShowParent:{type:Boolean,default:!1},activeFirst:{type:Boolean,default:!1},allowClear:{type:Boolean,default:!1},initLevel:{type:[Number,null],default:2},limitLevel:{type:[Number,String,null],validator:function(e){return[1,2,3,4,5,6].includes(Number(e))},default:null},replaceFields:{type:Object,default:function(){return{pkey:"pkey",title:"title",key:"key",children:"children"}}},valueField:{type:String,default:"key"},join:{type:[String,Boolean],default:!1},search:{type:Boolean,default:!0},lazy:{type:Boolean,default:!0},params:{type:Object,default:function(){}}},data:function(){return{otherParams:{}}},methods:{fetchGetTree:function(e){var t=this;return new Promise((function(a,r){var i=null===e||void 0===e?void 0:e.code;i&&Reflect.deleteProperty(e,"code"),$ec.http.send(t.baseUrl+t.treeApi,s(s({orgLevelNum:t.limitLevel,bizCode:i},e),t.otherParams)).then((function(e){var r=e.rows,i=(0,n.treeFormatList)(r,t.replaceFields);a(i)})).catch((function(e){r(e)})).finally((function(){}))}))},fetchGetTreeById:function(e){var t=this;return new Promise((function(a,r){var i=null===e||void 0===e?void 0:e.code;i&&Reflect.deleteProperty(e,"code"),$ec.http.send(t.baseUrl+t.treeApiById,s(s({orgLevelNum:t.limitLevel,bizCode:i},e),t.otherParams)).then((function(e){var r=e.rows,i=(0,n.treeFormatList)(r,t.replaceFields);a(i)})).catch((function(e){r(e)})).finally((function(){}))}))},fetchGetTreeByName:function(e){var t=this;return new Promise((function(a,r){var i=null===e||void 0===e?void 0:e.name;i&&Reflect.deleteProperty(e,"name"),$ec.http.send(t.baseUrl+t.treeApiByName,s(s({orgLevelNum:t.limitLevel,orgName:i},e),t.otherParams)).then((function(e){var r=e.rows,i=(0,n.treeFormatList)(r,t.replaceFields);a(i)})).catch((function(e){r(e)})).finally((function(){}))}))},onSelectTreeData:function(e){var t=e.treeSelectedKeys,a=e.treeData,n=e.selectOption;Object.assign(this,{selectedKeys:t,selectOption:n,treeData:a})},onRefreshTree:function(e){this.otherParams=e,this.$refs.org&&this.$refs.org.handleTreeData(e)},onSelectTreeFn:function(e){this.$refs.org&&this.$refs.org.onSelectTreeFn(e)}}},i=r,l=u(483),o=(0,l.Z)(i,e,t,!1,null,null,null),c=o.exports,f=u(51);c.install=function(e,t){(0,f.Qb)(e,t);var a=(0,f.H_)(t);e.component(a+c.name,c)};var h=c}(),e.exports=d["default"]}()},3816:function(e,t,a){},a4e1:function(e,t,a){},b3a0:function(e,t,a){var n=a("63748").default,r=a("7ec2").default,i=a("448a").default,l=a("c973").default,o=a("278c").default,s=a("9523").default,c=a("ded3").default;a("99af"),a("a15b"),a("ac1f"),a("841c"),a("b0c0"),a("a9e3"),a("466d"),a("4ec9"),a("d3b7"),a("3ca3"),a("ddb0"),a("caad"),a("2532"),a("00b4"),a("d81d"),a("4de4"),a("159b"),a("a630"),a("6062"),a("ac16"),a("f8c9"),function(){"use strict";var t={483:function(e,t,a){function n(e,t,a,n,r,i,l,o){var s,c="function"===typeof e?e.options:e;if(t&&(c.render=t,c.staticRenderFns=a,c._compiled=!0),n&&(c.functional=!0),i&&(c._scopeId="data-v-"+i),l?(s=function(e){e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,e||"undefined"===typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),r&&r.call(this,e),e&&e._registeredComponents&&e._registeredComponents.add(l)},c._ssrRegister=s):r&&(s=o?function(){r.call(this,(c.functional?this.parent:this).$root.$options.shadowRoot)}:r),s)if(c.functional){c._injectStyles=s;var u=c.render;c.render=function(e,t){return s.call(t),u(e,t)}}else{var d=c.beforeCreate;c.beforeCreate=d?[].concat(d,s):[s]}return{exports:e,options:c}}a.d(t,{Z:function(){return n}})},51:function(e,t,a){a.d(t,{H_:function(){return i},Qb:function(){return l}});var n="Ecm",r="$ecm",i=function(e){var t;return null!==(t=null===e||void 0===e?void 0:e.componentPrefix)&&void 0!==t?t:n},l=function(e,t){var a,n=e;t&&t.classPrefix&&(n.prototype[r]=c(c({},null!==(a=n.prototype[r])&&void 0!==a?a:{}),{},{classPrefix:t.classPrefix}))}},338:function(e,t,a){var u;a.d(t,{default:function(){return L}});var d=function(){var e=this,t=e._self._c;return t("div",{staticClass:"select-picker"},[t("a-input-group",{staticClass:"picker-wrapper",attrs:{compact:""}},[t("a-select",{staticClass:"picker-wrapper-select",staticStyle:{width:"200px"},attrs:{value:e.selectedValue,"show-search":"","allow-clear":e.allowClear,placeholder:e.placeholder,mode:e.multiple?"multiple":"default",disabled:e.disabled,"show-arrow":!1,"filter-option":!1,maxTagCount:e.maxTagCount,"default-active-first-option":!1,"not-found-content":e.fetching?void 0:null},on:{search:e.onSelectSearch,change:e.onChange}},[e.fetching?t("a-spin",{attrs:{slot:"notFoundContent",size:"small"},slot:"notFoundContent"}):e._e(),e._l(e.selectOption,(function(a){return t("a-select-option",{key:a[e.valueField],attrs:{title:"".concat(a.title),value:a[e.valueField]}},[e._v(" "+e._s(a.title)+" ")])}))],2),t("div",{staticClass:"picker-btn-wrapper"},[t("a-button",{staticClass:"picker-wrapper-btn",attrs:{icon:"more",disabled:e.disabled},on:{click:e.onOpenModal}})],1)],1),t("a-modal",{attrs:{wrapClassName:"select-picker-modal",title:e.title,visible:e.visible,width:e.widthed,height:e.height,bodyStyle:{height:parseInt(e.height,10)-108+"px"},top:e.top,centered:e.centered,keyboard:!1,"mask-closable":!1},on:{cancel:e.onCancel,ok:e.onOk}},[e.visible?t("SelectTree",{ref:"SelectTree",staticClass:"select-picker-tree",attrs:{lazy:e.lazy,searchPadding:e.searchPadding,join:e.join,search:e.search,treeType:e.treeType,initLevel:e.initLevel,multiple:e.multiple,selectedKeys:e.selectedKeys,expandedKeys:e.expandedKeys,fetchData:e.fetchData,fetchDataById:e.fetchDataById,fetchDataByName:e.fetchDataByName,replaceFields:e.replaceFields,valueField:e.valueField,isShowParent:e.isShowParent,params:e.params},on:{select:e.onSelectTreeData}}):e._e(),Array.isArray(e.selectedKeys)&&e.multiple?t("a-divider",{staticStyle:{height:"100%"},attrs:{type:"vertical"}}):e._e(),Array.isArray(e.selectedKeys)&&e.multiple?t("div",{staticClass:"select-picker-wrap"},[t("div",{staticStyle:{height:"30px","line-height":"30px","font-size":"12px","text-align":"right"}},[e._v(" 已选择："),t("strong",[e._v(e._s(e.selectedKeys.length))]),e._v("项 ")]),t("div",{staticClass:"select-picker-list"},[e._l(e.treeSelectOption,(function(a){return t("div",{key:a.key},[t("a-tag",{key:a.key,attrs:{color:"blue",closable:!0,size:"large"},on:{close:function(t){return e.onRemoveOption(a.key)}}},[e._v(e._s(a.title))])],1)})),!e.selectedKeys||Array.isArray(e.selectedKeys)&&0===e.selectedKeys.length?t("a-empty",{staticClass:"spin"}):e._e()],2)]):e._e()],1)],1)},f=[],h=a(657),p=a(142),m=a(632),y={name:"SelectPicker",components:(u={SelectTree:h["default"]},s(u,p.Modal.name,p.Modal),s(u,p.Tag.name,p.Tag),s(u,p.Input.name,p.Input),s(u,p.Button.name,p.Button),s(u,p.Select.name,p.Select),s(u,p.Row.name,p.Row),s(u,p.Col.name,p.Col),s(u,p.Divider.name,p.Divider),s(u,p.Spin.name,p.Spin),s(u,p.Empty.name,p.Empty),s(u,p.Tree.name,p.Tree),u),model:{prop:"value",event:"change"},props:{value:{type:[String,Array],default:null},treeType:{type:String,default:"sp"},maxTagCount:{type:Number,default:1},placeholder:{type:String,default:"请选择关键词搜索"},lazy:{type:Boolean,default:!0},multiple:{type:Boolean,default:!1},searchPadding:{type:String,default:"6px 0"},isShowParent:{type:Boolean,default:!0},allowClear:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},title:{type:String,default:"选择器"},width:{type:[String,Number],default:"425px"},height:{type:[String,Number],default:"370px"},top:{type:[String,Number],default:"100px"},centered:{type:Boolean,default:!1},join:{type:[String,Boolean],default:!1},search:{type:Boolean,default:!0},initLevel:{type:Number,default:2},replaceFields:{type:Object,default:function(){return{pkey:"pkey",title:"title",key:"key",children:"children"}}},beforeOk:{type:Function,default:null},valueField:{type:String,default:"key"},fetchData:{type:Function,required:!0},fetchDataById:{type:Function},fetchDataByName:{type:Function},params:{type:Object,default:function(){return{}}}},data:function(){return this.onSelectSearch=(0,m.debounce)(this.onSelectSearch,300),{visible:!1,fetching:!1,treeData:[],selectedValue:[],expandedKeys:[],selectOption:[],joinSelectOption:[],selectedKeys:[],treeSelectOption:[]}},computed:{widthed:function(){var e=String(this.width).match(/[a-z]+|[^a-z]+/gi),t=o(e,2),a=t[0],n=t[1];return this.multiple?Number(a)+140+n:this.width}},watch:{value:{handler:function(e,t){(0,m.isRefEqual)(e,t)||this.handleListByCode(e)},deep:!0,immediate:!0}},methods:{handleTreeByName:function(e){var t=this;return l(r().mark((function a(){var n,l,o;return r().wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(t.fetching=!0,a.prev=1,!t.lazy){a.next=10;break}return a.next=5,t.fetchDataByName(c(c({},t.params),{},{name:e}),e);case 5:n=a.sent,l=(0,m.filterList)(n,(function(t){return String(null===t||void 0===t?void 0:t.title).indexOf(e)>-1}),t.replaceFields),t.selectOption=(0,m.uniqueBy)([].concat(i(t.selectOption),i(l)),"key"),a.next=14;break;case 10:return a.next=12,t.fetchData(c({},t.params));case 12:o=a.sent,t.treeData=(0,m.listFormatTree)(o,t.replaceFields),t.selectOption=(0,m.filterList)(o,(function(t){return String(null===t||void 0===t?void 0:t.title).indexOf(e)>-1}),t.replaceFields);case 14:a.next=18;break;case 16:a.prev=16,a.t0=a["catch"](1);case 18:t.fetching=!1;case 19:case"end":return a.stop()}}),a,null,[[1,16]])})))()},handleListByCode:function(e){var t=this;return l(r().mark((function a(){var l,o,s,u,d,f,h,p,y,v;return r().wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(l=[],!e){a.next=25;break}if(l=Array.isArray(e)?e:[e],t.fetching=!0,a.prev=3,!t.lazy){a.next=16;break}o=[],s=n(l);try{for(s.s();!(u=s.n()).done;)d=u.value,d&&o.push(t.fetchDataById(c(c({},t.params),{},{code:d}),e))}catch(r){s.e(r)}finally{s.f()}return a.next=10,Promise.all(o);case 10:f=a.sent,h=(0,m.flattenDeep)(f),p=(0,m.filterList)(h,(function(e){return l.includes(e.key)}),t.replaceFields),t.selectOption=(0,m.uniqueBy)(p),t.treeSelectOption=(0,m.cloneDeep)(t.selectOption),a.next=21;break;case 16:return a.next=18,t.fetchData(c({},t.params));case 18:y=a.sent,v=(0,m.uniqueBy)(y),t.treeData=(0,m.listFormatTree)(v,t.replaceFields),t.selectOption=(0,m.filterList)(v,(function(t){return String(null===t||void 0===t?void 0:t.key).indexOf(e)>-1}),t.replaceFields);case 21:a.next=25;break;case 23:a.prev=23,a.t0=a["catch"](3);case 25:t.selectedValue=i(l),t.selectedKeys=i(l),t.fetching=!1;case 26:case"end":return a.stop()}}),a,null,[[3,23]])})))()},handleReturnValue:function(e){return Array.isArray(e)&&this.multiple?e:Array.isArray(e)&&0!==e.length?e[0]:Array.isArray(e)&&0===e.length?this.multiple?e:null:e},onSelectSearch:function(e){/^\s*$/.test(e)||this.handleTreeByName(e)},onChange:function(e,t){var a=this;if(this.join){var n=this.selectOption.map((function(e){var t={};for(var n in e)n&&(t[n]=(0,m.getSelectedBy)(a.treeData,e.key,n,a.replaceFields).join("string"===typeof a.join?a.join:","));return t}));Object.assign(this,{joinSelectOption:n})}this.$emit("change",e,t)},onOpenModal:function(){this.visible=!0},onScrollIntoView:function(e){var t=this;this.$nextTick((function(){t.$ref.SelectTree.onScrollIntoView(e)}))},onSelectTreeData:function(e){var t=e.treeSelectedKeys,a=e.treeData,n=e.selectOption,r=e.joinSelectOption;Array.isArray(t)?this.selectedKeys=t:this.$set(this.selectedKeys,"0",t),Array.isArray(n)?this.treeSelectOption=n:this.$set(this.treeSelectOption,"0",n),Object.assign(this,{joinSelectOption:r,treeData:a})},onRemoveOption:function(e){this.selectedKeys=this.selectedKeys.filter((function(t){return t!==e})),this.treeSelectOption=this.treeSelectOption.filter((function(t){return t.key!==e})),this.onScrollIntoView(e)},onOk:function(){var e=this;if(null===this.selectedKeys||Array.isArray(this.selectedKeys)&&0===this.selectedKeys.length)return this.$message.info("请先选择单位");Object.assign(this,{selectedValue:this.selectedKeys,selectOption:this.treeSelectOption}),this.$nextTick(l(r().mark((function t(){var a,n;return r().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(a=e.handleReturnValue(e.selectOption),n=e.handleReturnValue(e.selectedValue),t.t0=e.beforeOk&&"function"===typeof e.beforeOk,!t.t0){t.next=5;break}return t.next=5,e.beforeOk({selectedValue:n,selectOption:a,joinSelectOption:e.joinSelectOption,treeData:e.treeData});case 5:e.visible=!1,e.$emit("change",n,a),e.$emit("ok",{selectedValue:n,selectOption:a,joinSelectOption:e.joinSelectOption,treeData:e.treeData});case 8:case"end":return t.stop()}}),t)}))))},onCancel:function(){this.visible=!1},onRefreshTree:function(e){this.$ref.SelectTree&&this.$ref.SelectTree.handleTreeData(e)}}},v=y,g=a(483),b=(0,g.Z)(v,d,f,!1,null,null,null),w=b.exports,k=a(51);w.install=function(e,t){(0,k.Qb)(e,t);var a=(0,k.H_)(t);e.component(a+w.name,w)};var L=w},657:function(e,t,a){var o;a.d(t,{default:function(){return w}});var u=function(){var e=this,t=e._self._c;return t("div",{staticClass:"tree-search"},[e._t("title"),e.isSearch?t("div",{staticClass:"tree-search-select",style:{padding:e.searchPadding}},[t("a-select",{staticStyle:{width:"100%"},attrs:{"show-search":"",value:e.selectedValue,placeholder:e.placeholder,"default-active-first-option":!1,"show-arrow":!1,"filter-option":!1,"not-found-content":null},on:{search:e.onSelectSearch,select:e.onSelectChange,rightClick:e.oRightClick}},e._l(e.selectOption,(function(a){return t("a-select-option",{key:a.key,attrs:{value:a.key,title:"".concat(a.title)}},[t("a-row",[t("a-col",{staticClass:"ellipsis",attrs:{span:e.isShowParent?18:24,title:a.title}},[e._v(e._s(a.title))]),t("a-col",{staticClass:"ellipsis",staticStyle:{color:"#ccc","font-size":"12px"},attrs:{span:e.isShowParent?6:0,title:e.getNameBy(e.tmpSearchOption,a.pkey)}},[e._v(e._s(e.getNameBy(e.tmpSearchOption,a.pkey)))])],1)],1)})),1)],1):e._e(),e.isSearch?t("a-divider",{staticStyle:{margin:"8px 0"}}):e._e(),t("div",{staticClass:"tree-search-tree"},[t("a-spin",{staticClass:"spin",attrs:{spinning:e.fetching}}),e.lazy?t("a-tree",e._b({ref:"treeRef",attrs:{blockNode:!0,multiple:e.multiple,checkedKeys:e.treeCheckedKeys,checkable:e.checkable,selectable:e.selectable,expandedKeys:e.treeExpandedKeys,selectedKeys:e.treeSelectedKeys,loadedKeys:e.treeLoadedKeys,"tree-data":e.treeData,loadData:e.handleLoadLazyData},on:{select:e.onSelectTree,check:e.onCheckTree,expand:e.onExpandTree,load:e.onLazyLoad,rightClick:e.oRightClick},scopedSlots:e._u([{key:"title",fn:function(a){return[t("span",{attrs:{id:"".concat(e.treeType,"_").concat(a.key)}},[e._v(e._s(a.title))]),e._t("action",null,{action:a})]}}],null,!0)},"a-tree",e.$attrs,!1)):t("a-tree",e._b({ref:"treeRef",attrs:{blockNode:!0,checkable:e.checkable,selectable:e.selectable,multiple:e.multiple,checkedKeys:e.treeCheckedKeys,expandedKeys:e.treeExpandedKeys,selectedKeys:e.treeSelectedKeys,"tree-data":e.treeData,replaceFields:e.replaceFields},on:{select:e.onSelectTree,check:e.onCheckTree,expand:e.onExpandTree},scopedSlots:e._u([{key:"title",fn:function(a){return[t("span",{attrs:{id:"".concat(e.treeType,"_").concat(a.key)}},[e._v(e._s(a.title))]),e._t("action",null,{action:a})]}}],null,!0)},"a-tree",e.$attrs,!1)),e.fetching||e.treeData&&(!Array.isArray(e.treeData)||0!==e.treeData.length)?e._e():t("a-empty",{staticClass:"spin"})],1)],2)},d=[],f=a(632),h=a(142),p={inheritAttrs:!1,name:"SelectTree",components:(o={},s(o,h.Select.name,h.Select),s(o,h.Row.name,h.Row),s(o,h.Col.name,h.Col),s(o,h.Divider.name,h.Divider),s(o,h.Spin.name,h.Spin),s(o,h.Empty.name,h.Empty),s(o,h.Tree.name,h.Tree),o),props:{treeType:{type:String,default:"st"},selectedKeys:{type:Array,default:null},checkedKeys:{type:Array,default:null},expandedKeys:{type:Array,default:null},lazy:{type:Boolean,default:!0},selectable:{type:Boolean,default:!0},checkable:{type:Boolean,default:!1},searchPadding:{type:String,default:"12px 12px 6px"},placeholder:{type:String,default:"请输入关键词筛选"},multiple:{type:Boolean,default:!1},join:{type:[String,Boolean],default:","},isShowParent:{type:Boolean,default:!1},replaceFields:{type:Object,default:function(){return{pkey:"pkey",title:"title",key:"key",children:"children"}}},search:{type:Boolean,default:!0},activeFirst:{type:Boolean,default:!1},beforeSelect:{type:Function,default:null},beforeCheck:{type:Function,default:null},initLevel:{type:Number,default:2},fetchData:{type:Function,required:!0},fetchDataById:{type:Function},fetchDataByName:{type:Function},valueField:{type:String,default:"key"},params:{type:Object,default:function(){return{}}}},data:function(){return this.onSelectSearch=(0,f.debounce)(this.onSelectSearch,500),{fetching:!1,selectedValue:void 0,treeCheckedKeys:[],treeSelectedKeys:[],treeExpandedKeys:[],treeLoadedKeys:[],treeData:[],selectOption:[],tmpSearchOption:[]}},computed:{isSearch:function(){return this.search&&(this.treeData||Array.isArray(this.treeData)&&0!==this.treeData.length)}},watch:{params:{handler:function(e,t){(0,f.isRefEqual)(e,t)||this.handleTreeData(e)},deep:!0,immediate:!0},checkedKeys:{handler:function(e){this.treeCheckedKeys=e},deep:!0,immediate:!0},selectedKeys:{handler:function(e){this.treeSelectedKeys=e},deep:!0,immediate:!0},expandedKeys:{handler:function(e){this.treeExpandedKeys=e},deep:!0,immediate:!0}},methods:{getNameBy:f.getNameBy,handleTreeData:function(e){var t=this;this.fetching=!0,this.treeLoadedKeys=[],this.treeExpandedKeys=[],this.treeData=[];try{this.fetchData(e).then(function(){var e=l(r().mark((function e(a){var n,i,l;return r().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n=(0,f.cloneDeep)(a).filter((function(e){return!e.pkey}))[0],t.treeData=(0,f.listFormatTree)(a,t.replaceFields),i=a.map((function(e){return e.key})).filter((function(e){return e})),l=(t.selectedKeys||[]).filter((function(e){return!i.includes(e)})),Array.isArray(t.treeData)&&0!==t.treeData.length&&(t.treeExpandedKeys=[n.key],t.$emit("expand",t.treeExpandedKeys),t.activeFirst&&t.onSelectTreeFn(n.key)),e.t0=0!==l.length,!e.t0){e.next=8;break}return e.next=8,t.handleTreeByCode(l);case 8:Array.isArray(t.treeSelectedKeys)&&0!==t.treeSelectedKeys.length&&setTimeout((function(){t.onScrollIntoView(t.treeSelectedKeys[0])}),500);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).finally((function(){t.fetching=!1}))}catch(a){this.treeData=[]}},handleTreeByCode:function(e){var t=this;return l(r().mark((function a(){var l,o,s,u,d,h,p,m,y,v,g,b;return r().wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(l=Array.isArray(e)?e:[e],t.fetching=!0,a.prev=2,!t.lazy){a.next=20;break}o=[],s=n(l);try{for(s.s();!(u=s.n()).done;)d=u.value,d&&o.push(t.fetchDataById(c(c({},t.params),{},{code:d})))}catch(r){s.e(r)}finally{s.f()}return a.next=9,Promise.all(o);case 9:if(h=a.sent,p=(0,f.treeFormatList)(t.treeData,t.replaceFields),m=(0,f.flattenDeep)(h),y=p.map((function(e){return e.key})).filter((function(e){return e})),v=m.filter((function(e){return!y.includes(e.key)})),g=v.map((function(e){return e.pkey})),b=(0,f.uniqueBy)(g),a.t0=0!==b.length,!a.t0){a.next=20;break}return a.next=20,t.handleLoadMore(b);case 20:l.forEach((function(e){var a=(0,f.getExpandedKeys)(t.treeData,e,t.replaceFields);t.treeExpandedKeys=Array.from(new Set([].concat(i(a),i(t.treeExpandedKeys))))})),a.next=25;break;case 23:a.prev=23,a.t1=a["catch"](2);case 25:t.fetching=!1;case 26:case"end":return a.stop()}}),a,null,[[2,23]])})))()},handleLoadMore:function(e){var t=this;return l(r().mark((function a(){var l,o,s,u,d,h,p,m;return r().wrap((function(a){while(1)switch(a.prev=a.next){case 0:t.fetching=!0,l=[],o=n(e);try{for(o.s();!(s=o.n()).done;)u=s.value,u&&l.push(t.fetchData(c(c({},t.params),{},{code:u})))}catch(r){o.e(r)}finally{o.f()}return a.next=6,Promise.all(l);case 6:d=a.sent,h=(0,f.flattenDeep)(d),p=(0,f.treeFormatList)(t.treeData),m=(0,f.uniqueBy)([].concat(i(p),i(h))),t.treeData=(0,f.listFormatTree)(m,t.replaceFields),t.fetching=!1;case 11:case"end":return a.stop()}}),a)})))()},handleLoadLazyData:function(e){var t=this,a=e;return new Promise((function(e){a.dataRef.children?e():t.fetchData(c(c({},t.params),{},{code:a.dataRef.key})).then((function(n){var r=(0,f.uniqueBy)(n,"key");a.dataRef.children=i(r),t.treeData=i(t.treeData),e(r)})).finally((function(){t.fetching=!1}))}))},onSelectSearch:function(e){/^\s*$/.test(e)||(this.handlerSearch(e),this.$emit("search",e))},handlerSearch:function(e){var t=this;return l(r().mark((function a(){var n,i;return r().wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(!t.lazy){a.next=8;break}return a.next=3,t.fetchDataByName(c(c({},t.params),{},{name:e})).catch((function(e){}));case 3:n=a.sent,i=(0,f.uniqueBy)(n,"key"),t.tmpSearchOption=(0,f.cloneDeep)(i)||[],t.selectOption=i.filter((function(t){return String(null===t||void 0===t?void 0:t.title).indexOf(e)>-1})),a.next=9;break;case 8:t.selectOption=(0,f.filterList)(t.treeData,(function(t){return String(null===t||void 0===t?void 0:t.title).indexOf(e)>-1}),t.replaceFields);case 9:case"end":return a.stop()}}),a)})))()},handleReturnValue:function(e){return Array.isArray(e)&&this.multiple?e:Array.isArray(e)&&0!==e.length?e[0]:Array.isArray(e)&&0===e.length?this.multiple?e:null:e},onSelectChange:function(e){var t=this;return l(r().mark((function a(){var n,l,o,s,c,u,d,h;return r().wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(l=Array.isArray(e)?e:[e],o=(0,f.cloneDeep)(t.selectOption).filter((function(e){return l.includes(e.key)})),!t.lazy){a.next=7;break}if(s=(0,f.treeFormatList)(t.treeData,t.replaceFields),c=s.map((function(e){return e.key})).filter((function(e){return e})),u=t.tmpSearchOption.filter((function(e){return!c.includes(e.key)})),d=u.map((function(e){return e.pkey})),a.t0=0!==d.length,!a.t0){a.next=7;break}return a.next=7,t.handleLoadMore(d);case 7:h=(0,f.getExpandedKeys)(t.treeData,Array.isArray(e)&&0!==e.length?e[0]:e,t.replaceFields),t.multiple?!t.treeSelectedKeys.includes(l)&&(n=t.treeSelectedKeys).push.apply(n,i(l)):t.treeSelectedKeys=l,Object.assign(t,{selectedValue:l,treeExpandedKeys:h,selectOption:o,fetching:!1}),t.onSelectTreeFn(e);case 9:case"end":return a.stop()}}),a)})))()},onExpandTree:function(e,t){this.treeExpandedKeys=Array.isArray(e)?e:[e],this.$emit("expand",this.treeExpandedKeys,t)},onSelectTreeFn:function(e){var t=this;return l(r().mark((function a(){var n,l,o,s,c,u,d,h,p;return r().wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(n=Array.isArray(e)?e:[e],l=Array.isArray(e)&&0!==e.length?e[0]:e,o=(0,f.treeFormatList)(t.treeData,t.replaceFields),s=o.map((function(e){return e.key})).filter((function(e){return e})),s.includes(l)){a.next=11;break}return a.next=4,t.fetchDataById({code:l});case 4:return c=a.sent,a.next=7,(0,f.uniqueBy)([].concat(i(o),i(c)));case 7:return u=a.sent,a.next=10,(0,f.listFormatTree)(u);case 10:t.treeData=a.sent;case 11:d=(0,f.getNodeBy)(t.treeData,l),h=(0,f.getExpandedKeys)(t.treeData,l),p=Array.from(new Set(t.multiple?[].concat(i(t.treeSelectedKeys),i(n)):n)),t.expandedKeys=[].concat(i(t.expandedKeys),i(h)),t.onSelectTree(p,{event:"select",selected:!0,node:{dataRef:d}});case 13:case"end":return a.stop()}}),a)})))()},onScrollIntoView:function(e){var t=this;this.$nextTick((function(){var a,n,r=document.querySelector(".select-picker-modal");r?null===(a=document.querySelector(".select-picker-modal #".concat(t.treeType,"_").concat(e)))||void 0===a||a.scrollIntoView({behavior:"smooth",block:"center"}):null===(n=document.getElementById("".concat(t.treeType,"_").concat(e)))||void 0===n||n.scrollIntoView({behavior:"smooth",block:"center"})}))},onSelectTree:function(e,t){var a=this;return l(r().mark((function n(){var i,l,o,s,c,u,d,h;return r().wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(n.t0=a.beforeSelect,!n.t0){n.next=4;break}return n.next=4,a.beforeSelect(e,t);case 4:i=Array.isArray(e)?e:[e],l=t.node.dataRef.key,Object.assign(a,{treeSelectedKeys:i}),o=(0,f.uniqueBy)((0,f.filterList)(a.treeData,(function(e){return a.treeSelectedKeys.includes(e.key)}),a.replaceFields)),s=[],a.join&&(s=o.map((function(e){var t={};for(var n in e)n&&(t[n]=(0,f.getSelectedBy)(a.treeData,l,n,a.replaceFields).join("string"===typeof a.join?a.join:","));return t}))),c=o.map((function(e){return e[a.valueField]})),u=a.handleReturnValue(c),d=a.handleReturnValue(o),h=a.handleReturnValue(s),a.$emit("select",{treeSelectedKeys:u,selectOption:d,joinSelectOption:h,treeData:(0,f.cloneDeep)(a.treeData)},t),Array.isArray(a.selectedValue)&&0!==a.selectedValue.length&&a.selectedValue[0]!==l&&(a.selectedValue=void 0,a.selectOption=[]),a.onScrollIntoView(l);case 11:case"end":return n.stop()}}),n)})))()},onCheckTree:function(e,t){var a=this;return l(r().mark((function n(){var i,l,o,s;return r().wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(n.t0=a.beforeCheck,!n.t0){n.next=4;break}return n.next=4,a.beforeCheck(e,t);case 4:i=Array.isArray(e)?e:[e],l=t.node.dataRef.key,Object.assign(a,{treeCheckedKeys:i}),o=(0,f.uniqueBy)((0,f.filterList)(a.treeData,(function(e){return a.treeCheckedKeys.includes(e.key)}),a.replaceFields)),s=o.map((function(e){return e[a.valueField]})),a.$emit("check",{treeCheckedKeys:s,checkOption:o,treeData:(0,f.cloneDeep)(a.treeData)},t),Array.isArray(a.selectedValue)&&0!==a.selectedValue.length&&a.selectedValue[0]!==l&&(a.selectedValue=void 0,a.selectOption=[]),a.onScrollIntoView(l);case 8:case"end":return n.stop()}}),n)})))()},oRightClick:function(e){this.$emit("rightClick",e)},onLazyLoad:function(e){this.treeLoadedKeys=e}}},m=p,y=a(483),v=(0,y.Z)(m,u,d,!1,null,null,null),g=v.exports,b=a(51);g.install=function(e,t){(0,b.Qb)(e,t);var a=(0,b.H_)(t);e.component(a+g.name,g)};var w=g},632:function(e){e.exports=a("6ea6")},142:function(e){e.exports=a("f23d")}},u={};function d(e){var a=u[e];if(void 0!==a)return a.exports;var n=u[e]={exports:{}};return t[e](n,n.exports,d),n.exports}!function(){d.d=function(e,t){for(var a in t)d.o(t,a)&&!d.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})}}(),function(){d.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}();var f={};!function(){d.d(f,{default:function(){return h}});var e=function(){var e=this,t=e._self._c;return t("SelectPicker",e._g(e._b({attrs:{treeType:"dip",title:e.title,value:e.value,search:e.search,"allow-clear":e.allowClear,placeholder:e.placeholder,multiple:e.multiple,disabled:e.disabled,join:e.join,fetchData:e.fetchGetTree,fetchDataById:e.fetchGetTreeById,fetchDataByName:e.fetchGetTreeByName,params:e.params}},"SelectPicker",e.$attrs,!1),e.$listeners))},t=[],a=d(338),n=d(632),r={inheritAttrs:!1,name:"DivisionPicker",components:{SelectPicker:a["default"]},model:{prop:"value",event:"change"},props:{value:{type:[String,Array,null],default:null},baseUrl:{type:String,default:"/dts/bim"},treeApi:{type:String,default:"/q/cmOmDivision/getCmOmDivisionTreeDataList/v1"},treeApiById:{type:String,default:"/q/cmOmDivision/getCmOmDivisionTreeParentById/v1"},treeApiByName:{type:String,default:"/q/cmOmDivision/getCmOmDivisionTreeParentByIName/v1"},placeholder:{type:String,default:"请选择关键词搜索"},multiple:{type:Boolean,default:!1},allowClear:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},title:{type:String,default:"行政区域选择器"},search:{type:Boolean,default:!0},width:{type:[String,Number],default:"425px"},height:{type:[String,Number],default:"370px"},top:{type:[String,Number],default:"100px"},centered:{type:Boolean,default:!1},limitLevel:{type:[Number,null],default:null},replaceFields:{type:Object,default:function(){return{pkey:"pkey",title:"title",key:"key",children:"children"}}},join:{type:[String,Boolean],default:!1},params:{type:Object,default:function(){}}},methods:{fetchGetTree:function(e){var t=this;return new Promise((function(a,r){var i=null===e||void 0===e?void 0:e.code;i&&Reflect.deleteProperty(e,"code"),$ec.http.send(t.baseUrl+t.treeApi,c({divisionLevelNum:t.limitLevel,divisionUniqueCode:i},e)).then((function(e){var r=e.rows,i=(0,n.treeFormatList)(r,t.replaceFields);a(i)})).catch((function(e){r(e)})).finally((function(){}))}))},fetchGetTreeById:function(e){var t=this;return new Promise((function(a,r){var i=null===e||void 0===e?void 0:e.code;i&&Reflect.deleteProperty(e,"code"),$ec.http.send(t.baseUrl+t.treeApiById,c({divisionLevelNum:t.limitLevel,divisionUniqueCode:i},e)).then((function(e){var r=e.rows,i=(0,n.treeFormatList)(r,t.replaceFields);a(i)})).catch((function(e){r(e)})).finally((function(){}))}))},fetchGetTreeByName:function(e){var t=this;return new Promise((function(a,r){var i=null===e||void 0===e?void 0:e.name;i&&Reflect.deleteProperty(e,"name"),$ec.http.send(t.baseUrl+t.treeApiByName,c({divisionLevelNum:t.limitLevel,divisionName:i},e)).then((function(e){var r=e.rows,i=(0,n.treeFormatList)(r,t.replaceFields);a(i)})).catch((function(e){r(e)})).finally((function(){}))}))}}},i=r,l=d(483),o=(0,l.Z)(i,e,t,!1,null,null,null),s=o.exports,u=d(51);s.install=function(e,t){(0,u.Qb)(e,t);var a=(0,u.H_)(t);e.component(a+s.name,s)};var h=s}(),e.exports=f["default"]}()},d1bf:function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ec-container",{attrs:{height:"100%",title:"需求提报",icon:"onetomany","color-code":"008"}},[a("ec-container-body",[a("ec-panel",{attrs:{auto:!1}},[a("ec-panel-toolbar",[a("ec-query-panel",{on:{query:function(t){return e.$refs.table.pageAction(1)},reset:e.onReset}},[a("ec-query-item",{attrs:{label:"采集批次"}},[a("a-select",{attrs:{"allow-clear":"",placeholder:"请选择"},model:{value:e.queryItems.batchName,callback:function(t){e.$set(e.queryItems,"batchName",t)},expression:"queryItems.batchName"}},e._l(e.batchList,(function(t){return a("a-select-option",{key:t.batchName},[e._v(" "+e._s(t.batchName)+" ")])})),1)],1),a("ec-query-item",{attrs:{label:"供方单位"}},[a("select-picker",{attrs:{title:"选择供方单位",lazy:!1,search:!1,fetchData:e.onFetchBusinessOrgList},model:{value:e.queryItems.supplyOrgCode,callback:function(t){e.$set(e.queryItems,"supplyOrgCode",t)},expression:"queryItems.supplyOrgCode"}})],1),a("ec-query-item",{attrs:{label:"确认状态"}},[a("a-select",{attrs:{"allow-clear":"",placeholder:"请选择"},model:{value:e.queryItems.auditState,callback:function(t){e.$set(e.queryItems,"auditState",t)},expression:"queryItems.auditState"}},e._l(e.auditStateList,(function(t){return a("a-select-option",{key:t.id},[e._v(" "+e._s(t.name)+" ")])})),1)],1)],1),a("ec-divider")],1),a("ec-panel-header",[a("ec-panel-item",[a("ec-panel-item-left",[a("a-button",{attrs:{type:"primary"},on:{click:e.onAdd}},[e._v("新增")]),a("a-button",{on:{click:e.onDel}},[e._v("删除")]),a("a-button",{on:{click:e.onUpload}},[e._v("上报")])],1),a("ec-panel-item-right",[a("span",{staticClass:"ant-form-text"},[e._v(" 业务年度： "+e._s(e.queryItems.businessYear))]),a("span",{staticClass:"ant-form-text"},[e._v(" 计量单位： "+e._s(e.weightUnitName))])])],1)],1),a("ec-panel-body",[a("ec-table",{ref:"table",attrs:{border:"",height:"100%",auto:!1,pagination:e.pagination,data:e.tableData.rows,loading:e.loading,"row-select":"","show-footer":"","footer-method":e.footerMethod},on:{"page-action":e.handlePagination,"checkbox-all":e.selectAllEvent,"checkbox-change":e.selectRowChange}},[a("ec-table-col",{attrs:{type:"checkbox",width:"50",align:"center"}}),a("ec-table-col",{attrs:{title:"序号",type:"seq",width:"70",align:"center"}}),a("ec-table-col",{attrs:{field:"batchName",title:"采集批次","header-align":"center",align:"left","min-width":"150"}}),a("ec-table-col",{attrs:{field:"supplyOrgName",title:"供方单位","header-align":"center",align:"left","min-width":"150"}}),a("ec-table-col",{attrs:{field:"weight1",title:e.weight1Title,"header-align":"center",align:"right",width:"150"}}),a("ec-table-col",{attrs:{field:"weight2",title:e.weight2Title,"header-align":"center",align:"right",width:"150"}}),a("ec-table-col",{attrs:{field:"weight3",title:e.weight3Title,"header-align":"center",align:"right",width:"150"}}),a("ec-table-col",{attrs:{field:"weight4",title:e.weight4Title,"header-align":"center",align:"right",width:"150"}}),a("ec-table-col",{attrs:{field:"auditState",title:"状态","header-align":"center",align:"left",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.row;return["5"===n.auditState?a("div",[a("span",[e._v("总公司已审核")])]):"1"===n.auditState?a("div",[a("span",[e._v("省公司待确认")])]):"2"===n.auditState?a("div",[a("span",[e._v("省公司退回")])]):"3"===n.auditState?a("div",[a("span",[e._v("总公司待审核")])]):"4"===n.auditState?a("div",[a("span",[e._v("总公司退回")])]):a("div",[a("span",[e._v("未上报")])])]}}])}),a("ec-table-col",{attrs:{title:"操作",align:"center","min-width":"130"},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.row;return[a("a-button",{attrs:{type:"link"},on:{click:function(t){return e.onEdit(n)}}},[e._v("编辑")]),a("a-button",{attrs:{type:"link"},on:{click:function(t){return e.onDetail(n)}}},[e._v("详细")])]}}])})],1)],1)],1),a("demand-submit-edit",{ref:"DemandSubmitEdit",on:{onQuery:e.onQuery}}),a("demand-submit-add",{ref:"DemandSubmitAdd",on:{onQuery:e.onQuery}}),a("detail",{ref:"Detail"})],1)],1)},r=[],i=a("c7eb"),l=a("1da1"),o=(a("6198"),a("6fc0")),s=a.n(o),c=(a("e906"),a("dd14")),u=a.n(c),d=(a("d3b7"),a("159b"),a("ac1f"),a("1276"),a("e9c4"),a("a9e3"),a("b680"),a("7db0"),a("d81d"),a("caad"),a("99af"),function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ec-drawer",{staticClass:"ec-draw-form",attrs:{title:"需求提报详细",visible:e.visible,size:"large"},on:{close:e.cancel}},[a("ec-container",{attrs:{height:"auto",fixed:"top bottom","color-code":"007"}},[a("ec-container-body",[a("ec-panel",{attrs:{title:"需求主信息","color-code":"001"}},[a("ec-panel-item",[a("ec-form",{ref:"ruleForm1",attrs:{model:e.formData,rules:e.rules}},[a("a-row",{attrs:{type:"flex",gutter:12}},[a("a-col",{attrs:{span:8}},[a("a-form-model-item",{attrs:{label:"供方单位"}},[e._v(e._s(e.formData.supplyOrgName||"--"))])],1),a("a-col",{attrs:{span:8}},[a("a-form-model-item",{attrs:{label:"采集批次"}},[e._v(e._s(e.formData.batchName||"--"))])],1),a("a-col",{attrs:{span:8}},[a("a-form-model-item",{attrs:{label:"业务年度"}},[e._v(e._s(e.formData.busiYear||"--"))])],1),a("a-col",{attrs:{span:8}},[a("a-form-model-item",{attrs:{label:"录入日期"}},[e._v(" "+e._s(e.formatDate(e.formData.createTime)||"--")+" ")])],1)],1)],1)],1)],1),a("ec-panel",[a("ec-panel-toolbar",[a("ec-panel-item-right",[a("span",[e._v("计量单位："+e._s(e.weightUnitName))])])],1),a("ec-panel-body",[a("ec-table",{ref:"table",attrs:{border:"","keep-source":"","show-footer":"","row-select":"","edit-rules":e.validRules,"footer-method":e.footerMethod,data:e.tableData}},[a("ec-table-col",{attrs:{width:"70",title:"序号",type:"seq",align:"center"}}),a("ec-table-col",{attrs:{field:"leafTypeName",title:"烟叶类型","min-width":"180",align:"left","edit-render":{}},scopedSlots:e._u([{key:"edit",fn:function(t){var n=t.row;return[a("a-select",{attrs:{"filter-option":e.filterOption},on:{select:function(t){return e.handleGetLeafLevel(n)}},model:{value:n.leafTypeName,callback:function(t){e.$set(n,"leafTypeName",t)},expression:"row.leafTypeName"}},e._l(e.leafTypeList,(function(t){return a("a-select-option",{key:t.leafTypeCode,attrs:{value:t.leafTypeName}},[e._v(e._s(t.leafTypeName))])})),1)]}}])}),a("ec-table-col",{attrs:{field:"leafLevelName",title:"小等级","min-width":"180",align:"left","edit-render":{}},scopedSlots:e._u([{key:"edit",fn:function(t){var n=t.row;return[a("a-select",{attrs:{"filter-option":e.filterOption},on:{select:function(t){return e.handleLeafLevelCode(n)}},model:{value:n.leafLevelName,callback:function(t){e.$set(n,"leafLevelName",t)},expression:"row.leafLevelName"}},e._l(n.leafLevelList,(function(t){return a("a-select-option",{key:t.leafLevelCode,attrs:{value:t.leafLevelName}},[e._v(e._s(t.leafLevelName))])})),1)]}}])}),a("ec-table-col",{attrs:{field:"weight1",title:e.weight1Title,align:"right","min-width":"180","edit-render":{}},scopedSlots:e._u([{key:"edit",fn:function(t){var n=t.row;return[a("a-input-number",{attrs:{min:0,precision:2},on:{blur:function(t){return e.handleNoValue(n,"weight1")}},model:{value:n.weight1,callback:function(t){e.$set(n,"weight1",t)},expression:"row.weight1"}})]}}])}),a("ec-table-col",{attrs:{field:"weight2",title:e.weight2Title,align:"right","min-width":"180","edit-render":{}},scopedSlots:e._u([{key:"edit",fn:function(t){var n=t.row;return[a("a-input-number",{attrs:{min:0,precision:2},on:{blur:function(t){return e.handleNoValue(n,"weight2")}},model:{value:n.weight2,callback:function(t){e.$set(n,"weight2",t)},expression:"row.weight2"}})]}}])}),a("ec-table-col",{attrs:{field:"weight3",title:e.weight3Title,align:"right","min-width":"180","edit-render":{}},scopedSlots:e._u([{key:"edit",fn:function(t){var n=t.row;return[a("a-input-number",{attrs:{min:0,precision:2},on:{blur:function(t){return e.handleNoValue(n,"weight3")}},model:{value:n.weight3,callback:function(t){e.$set(n,"weight3",t)},expression:"row.weight3"}})]}}])}),a("ec-table-col",{attrs:{field:"weight4",title:e.weight4Title,align:"right","min-width":"180","edit-render":{}},scopedSlots:e._u([{key:"edit",fn:function(t){var n=t.row;return[a("a-input-number",{attrs:{min:0,precision:2},on:{blur:function(t){return e.handleNoValue(n,"weight4")}},model:{value:n.weight4,callback:function(t){e.$set(n,"weight4",t)},expression:"row.weight4"}})]}}])})],1)],1)],1)],1),a("ec-container-footer",{attrs:{fixed:""}},[a("a-space",[a("a-button",{on:{click:e.cancel}},[e._v("关闭")])],1)],1)],1)],1)}),f=[],h=(a("a4e1"),a("b3a0")),p=a.n(h),m=(a("3816"),a("0ef8")),y=a.n(m),v=(a("d9e2"),a("a434"),a("c1df")),g=a.n(v),b=a("2ef0"),w=a.n(b),k={name:"AdminOrgManageEdit",components:{OrgPicker:u.a,OrgTree:y.a,DivisionPicker:p.a,moment:g.a},data:function(){var e=function(e,t,a){if(0===t.length)return a(new Error("请选择供方单位"));a()};return{title:"",isDisableYear:!0,isEdit:!1,rowData:"",visible:!1,checked:!1,ruleForm:{},formData:{},yearDemandList:[],leafTypeList:[],totalLeafLevelList:[],orgCodeList:[],businessYear:"",weightUnitName:"",weightUnit:"",tableConfig:[],weight1Title:"",weight2Title:"",weight3Title:"",weight4Title:"",needYearListFormat:{},needGatherYear:"",weightColunm:["weight1","weight2","weight3","weight4"],tableData:[],oldTableData:[],mergeTableData:[],currentLeafLevelList:[],data:{},validRules:{leafTypeName:[{required:!0,message:"请选择烟叶类型"}],leafLevelName:[{required:!0,message:"请选择小等级"}]},rules:{orgCodeList:[{validator:e,required:!0,trigger:"change"}]}}},methods:{moment:g.a,formatDate:function(e){return g()(e).format("YYYY-MM-DD")},filterOption:function(e,t){return t.componentOptions.children[0].text.toLowerCase().indexOf(e.toLowerCase())>=0},handleNoValue:function(e,t){var a=e,n=a[t];n||(a[t]="0.00")},show:function(e){var t=this;return Object(l["a"])(Object(i["a"])().mark((function a(){var n,r,l,o,s,c,u,d,f;return Object(i["a"])().wrap((function(a){while(1)switch(a.prev=a.next){case 0:return t.visible=!0,a.next=3,t.handleGetLeafTypeList();case 3:return t.weightUnit=e.weightUnitObj.weightUnit,t.weightUnitName=e.weightUnitObj.weightUnitName,r=e.businessYear>0?e.businessYear:(new Date).getFullYear(),t.businessYear=r,t.needGatherYear=e.needGatherYear||"",l=t.needGatherYear.split(","),t.needGatherYearArr=l,t.title="需求提报编辑",t.isEdit=!0,o=null===e||void 0===e?void 0:e.selectedRows,s=null===o||void 0===o?void 0:o.supplyOrgCode,c=[],s&&c.push(s),u=e.weightTitleObj||{},t.weight1Title=u.weight1Title,t.weight2Title=u.weight2Title,t.weight3Title=u.weight3Title,t.weight4Title=u.weight4Title,t.needYearListFormat=e.needYearListFormat,t.formData=null===e||void 0===e?void 0:e.selectedRows,console.log(t.formData),t.formData.orgCodeList=c,d=null===e||void 0===e||null===(n=e.selectedRows)||void 0===n?void 0:n.pcTNeedCollectDetlDTOS,a.next=28,t.handleMergeDetData(d);case 28:return f=a.sent,t.mergeTableData=w.a.cloneDeep(f),a.next=32,t.handleUnitParse(f);case 32:case"end":return a.stop()}}),a)})))()},handleMergeDetData:function(e){var t=this;return Object(l["a"])(Object(i["a"])().mark((function a(){var n;return Object(i["a"])().wrap((function(a){while(1)switch(a.prev=a.next){case 0:return n=[],e.forEach(function(){var e=Object(l["a"])(Object(i["a"])().mark((function e(a){var r,l,o,s,c,u,d;return Object(i["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:r=a,l=n.find((function(e){return e.leafLevelCode===a.leafLevelCode})),l?l.detlList.push(r):(o=r.leafTypeCode,s=t.leafTypeList.find((function(e){return e.leafTypeCode===o})),c=r.leafLevelCode,u=t.totalLeafLevelList.find((function(e){return e.leafLevelCode===c})),d={leafTypeName:null===s||void 0===s?void 0:s.leafTypeName,leafLevelName:null===u||void 0===u?void 0:u.leafLevelName,leafLevelCode:c,leafTypeCode:o,leafLevelList:r.leafLevelList,detlList:[r]},n.push(d));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),t.weightColunm.forEach((function(e){return t.$refs.table.hideColumn(t.$refs.table.getColumnByField(e))})),console.log("pppppppppppppppppppppppppppp"),console.log(n),n.forEach((function(e){var a=e,n=(null===e||void 0===e?void 0:e.detlList)||[],r=t.needGatherYear||"",i=r.split(",");i.forEach((function(e){var r=e,i=t.needYearListFormat||{},l=i[e],o=0;n.forEach((function(e){r==="".concat(e.needYear)&&(o+=Number(e.weight||0))})),a[l]=o.toFixed(2),t.$refs.table.showColumn(t.$refs.table.getColumnByField(l))}))})),console.log("-----------合并后的数据：".concat(JSON.stringify(n))),a.abrupt("return",n);case 8:case"end":return a.stop()}}),a)})))()},handleUnitParse:function(e){var t=this;return Object(l["a"])(Object(i["a"])().mark((function a(){var n,r;return Object(i["a"])().wrap((function(a){while(1)switch(a.prev=a.next){case 0:n=[],r=e,r&&r.length>0&&(r.forEach((function(e){var a=e;a.weight1=a.weight1?(Number(a.weight1)/t.weightUnit).toFixed(2):"0.00",a.weight2=a.weight2?(Number(a.weight2)/t.weightUnit).toFixed(2):"0.00",a.weight3=a.weight3?(Number(a.weight3)/t.weightUnit).toFixed(2):"0.00",a.weight4=a.weight4?(Number(a.weight4)/t.weightUnit).toFixed(2):"0.00",n.push(a)})),t.tableData=n);case 3:case"end":return a.stop()}}),a)})))()},handleGetLeafTypeList:function(){var e=this;return Object(l["a"])(Object(i["a"])().mark((function t(){var a,n,r,l,o;return Object(i["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(null!==(a=e.leafTypeList)&&void 0!==a&&a.length){t.next=5;break}return t.next=3,e.$apis.bpm.executionEnter.queryAllLeafType({});case 3:r=t.sent,e.leafTypeList=(null===r||void 0===r?void 0:r.rows)||[];case 5:if(null!==(n=e.totalLeafLevelList)&&void 0!==n&&n.length){t.next=11;break}return l={leafTypeCode:""},t.next=9,e.$apis.apm.demandSubmit.queryAllLevel(l);case 9:o=t.sent,e.totalLeafLevelList=(null===o||void 0===o?void 0:o.rows)||[];case 11:case"end":return t.stop()}}),t)})))()},handleLeafLevelCode:function(e){var t=e,a=e.leafLevelList||[];a.forEach((function(a){var n=a;n.leafLevelName===e.leafLevelName&&(t.leafLevelCode=n.leafLevelCode)}))},handleGetLeafLevel:function(e){var t=this;return Object(l["a"])(Object(i["a"])().mark((function a(){var n,r,l,o;return Object(i["a"])().wrap((function(a){while(1)switch(a.prev=a.next){case 0:return n=e,r=t.leafTypeList,r.forEach((function(t){var a=t;a.leafTypeName===e.leafTypeName&&(n.leafTypeCode=a.leafTypeCode)})),l={pageNo:1,pageSize:100,leafTypeCode:e.leafTypeCode||""},a.next=6,t.$apis.apm.demandSubmit.queryAllLevel(l);case 6:o=a.sent,n.leafLevelCode="",n.leafLevelName="",n.leafLevelList=null===o||void 0===o?void 0:o.rows;case 10:case"end":return a.stop()}}),a)})))()},addRow:function(){var e=this;return Object(l["a"])(Object(i["a"])().mark((function t(){var a;return Object(i["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:a={leafTypeCode:"",leafTypeName:"",leafLevelCode:"",leafLevelName:"",leafLevelList:[],weight1:"0.00",weight2:"0.00",weight3:"0.00",weight4:"0.00",dataState:"1",busiYear:e.businessYear},e.tableData.push(a);case 2:case"end":return t.stop()}}),t)})))()},onDel:function(e){this.tableData.splice(e,1)},footerMethod:function(e){var t=this,a=e.columns,n=e.data;return[a.map((function(e,a){return 0===a?"合计":["weight1","weight2","weight3","weight4"].includes(e.property)?t.sumNum(n,e.property):null}))]},sumNum:function(e,t){var a=0;return e.forEach((function(e){a+=Number(e[t]?e[t]:0)})),a.toFixed(2)},handleBeforeSaveData:function(){var e=this,t=this.formData,a=w.a.cloneDeep(this.tableData),n=[];if(this.isHasLeafLevel=!1,a.forEach((function(t){var a=t,r=a.leafLevelCode,i=n.find((function(e){return e===r}));i&&i.length>0?(e.isHasLeafLevel=!0,e.$message.error("存在重复的小等级[".concat(a.leafLevelName,"]"))):n.push(r)})),!this.isHasLeafLevel){var r=t.orgCodeList,i=r.length>0?r[0]:"",l=this.formData;l.supplyOrgCode=i;var o=[];return console.log("---------------------tableData------------------"),console.log(a),a.forEach((function(t){var a=t,n=e.needGatherYearArr||[];n&&n.length>0&&n.forEach((function(n){var r=n,i=e.needYearListFormat||{},l=i[r],s=t[l]||0,c=(Number(s)*e.weightUnit).toFixed(2),u={weight:c,needYear:r,leafTypeCode:a.leafTypeCode,leafLevelCode:a.leafLevelCode,busiYear:e.businessYear,dataState:"1"};o.push(u)}))})),l.pcTNeedCollectDetlDTOS=o,console.log(this.formData),console.log("---------------------save------------------"),console.log(l),l}},onSave:function(e){var t=this;return Object(l["a"])(Object(i["a"])().mark((function a(){var n,r;return Object(i["a"])().wrap((function(a){while(1)switch(a.prev=a.next){case 0:return n=t.$refs.table,a.next=3,n.validate(!0).catch((function(e){return e}));case 3:r=a.sent,r?t.$message.error("校验不通过！"):t.$refs.modelRef.validate(function(){var a=Object(l["a"])(Object(i["a"])().mark((function a(n){var r;return Object(i["a"])().wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(n){a.next=2;break}return a.abrupt("return");case 2:if(t.saving=!0,r=t.handleBeforeSaveData(),r){a.next=6;break}return a.abrupt("return");case 6:console.log(r),t.$message.success("操作成功"),"saveAndAdd"===e?(t.formData.orgCodeList=[],t.tableData=[]):t.cancel();case 9:case"end":return a.stop()}}),a)})));return function(e){return a.apply(this,arguments)}}());case 5:case"end":return a.stop()}}),a)})))()},cancel:function(){this.visible=!1,this.$refs.modelRef.resetFields(),this.formData.orgCodeList=[],this.tableData=[]}}},L=k,x=a("2877"),D=Object(x["a"])(L,d,f,!1,null,null,null),S=D.exports,O=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ec-drawer",{staticClass:"ec-draw-form",attrs:{title:"需求提报编辑",visible:e.visible,size:"large","is-confirm":!0},on:{close:e.cancel}},[a("ec-container",{attrs:{auto:!1,height:"100%",fixed:"top bottom","color-code":"007"}},[a("ec-container-body",{staticStyle:{overflow:"hidden"}},[a("ec-panel",{attrs:{title:"需求主信息","color-code":"001"}},[a("ec-panel-item",[a("ec-form",{ref:"modelRef",attrs:{model:e.formData,rules:e.rules}},[a("a-row",{attrs:{type:"flex",gutter:12}},[a("a-col",{attrs:{span:6}},[a("a-form-model-item",{ref:"supplyOrgCode",attrs:{label:"供方单位",prop:"supplyOrgCode"}},[a("select-picker",{attrs:{title:"选择供方单位",lazy:!1,search:!1,fetchData:e.onFetchBusinessOrgList},model:{value:e.formData.supplyOrgCode,callback:function(t){e.$set(e.formData,"supplyOrgCode",t)},expression:"formData.supplyOrgCode"}})],1)],1),a("a-col",{attrs:{span:6}},[a("a-form-model-item",{attrs:{label:"采集批次"}},[a("a-input",{attrs:{disabled:e.isDisableYear,placeholder:"请输入采集批次"},model:{value:e.formData.batchName,callback:function(t){e.$set(e.formData,"batchName",t)},expression:"formData.batchName"}})],1)],1),a("a-col",{attrs:{span:6}},[a("a-form-model-item",{attrs:{label:"业务年度"}},[a("a-input",{attrs:{disabled:e.isDisableYear,placeholder:"请输入业务年度"},model:{value:e.formData.busiYear,callback:function(t){e.$set(e.formData,"busiYear",t)},expression:"formData.busiYear"}})],1)],1),a("a-col",{attrs:{span:6}},[a("a-form-model-item",{attrs:{label:"录入日期"}},[a("a-date-picker",{attrs:{disabled:e.isDisableYear,format:"YYYY-MM-DD",valueFormat:"YYYY-MM-DD",type:"date",defaultValue:e.moment(new Date,"YYYY-MM-DD"),placeholder:"请选择日期"},model:{value:e.formData.checkDate,callback:function(t){e.$set(e.formData,"checkDate",t)},expression:"formData.checkDate"}})],1)],1)],1)],1)],1)],1),a("ec-panel",{attrs:{auto:!1}},[a("ec-panel-toolbar",[a("ec-panel-item-left",[a("a-button",{attrs:{type:"primary"},on:{click:function(t){return e.addRow()}}},[e._v("新增行")])],1),a("ec-panel-item-right",[a("span",[e._v("计量单位："+e._s(e.weightUnitName))])])],1),a("ec-panel-body",[a("ec-table",{ref:"table",attrs:{border:"","keep-source":"","show-footer":"","row-select":"",auto:!1,height:"100%","edit-rules":e.validRules,"footer-method":e.footerMethod,"edit-config":{trigger:"click",mode:"row",showStatus:!0},data:e.tableData}},[a("ec-table-col",{attrs:{width:"70",title:"序号",type:"seq",align:"center"}}),a("ec-table-col",{attrs:{field:"leafTypeName",title:"烟叶类型","min-width":"180",align:"left","edit-render":{}},scopedSlots:e._u([{key:"edit",fn:function(t){var n=t.row;return[a("a-select",{on:{select:function(t){return e.handleGetLeafLevel(n)}},model:{value:n.leafTypeName,callback:function(t){e.$set(n,"leafTypeName",t)},expression:"row.leafTypeName"}},e._l(e.leafTypeList,(function(t){return a("a-select-option",{key:t.leafTypeCode,attrs:{value:t.leafTypeName}},[e._v(e._s(t.leafTypeName))])})),1)]}}])}),a("ec-table-col",{attrs:{field:"leafLevelName",title:"小等级","min-width":"180",align:"left","edit-render":{}},scopedSlots:e._u([{key:"edit",fn:function(t){var n=t.row;return[a("a-select",{on:{focus:function(t){return e.handleLeafLevelList(n)},select:function(t){return e.handleLeafLevelCode(n)}},model:{value:n.leafLevelName,callback:function(t){e.$set(n,"leafLevelName",t)},expression:"row.leafLevelName"}},e._l(n.leafLevelList,(function(t){return a("a-select-option",{key:t.leafLevelCode,attrs:{value:t.leafLevelName}},[e._v(e._s(t.leafLevelName))])})),1)]}}])}),a("ec-table-col",{attrs:{field:"weight1",title:e.weight1Title,align:"right","min-width":"180","edit-render":{}},scopedSlots:e._u([{key:"edit",fn:function(t){var n=t.row;return[a("a-input-number",{attrs:{min:0,max:1e5,precision:2},on:{blur:function(t){return e.handleNoValue(n,"weight1")}},model:{value:n.weight1,callback:function(t){e.$set(n,"weight1",t)},expression:"row.weight1"}})]}}])}),a("ec-table-col",{attrs:{field:"weight2",title:e.weight2Title,align:"right","min-width":"180","edit-render":{}},scopedSlots:e._u([{key:"edit",fn:function(t){var n=t.row;return[a("a-input-number",{attrs:{min:0,max:1e5,precision:2},on:{blur:function(t){return e.handleNoValue(n,"weight2")}},model:{value:n.weight2,callback:function(t){e.$set(n,"weight2",t)},expression:"row.weight2"}})]}}])}),a("ec-table-col",{attrs:{field:"weight3",title:e.weight3Title,align:"right","min-width":"180","edit-render":{}},scopedSlots:e._u([{key:"edit",fn:function(t){var n=t.row;return[a("a-input-number",{attrs:{min:0,max:1e5,precision:2},on:{blur:function(t){return e.handleNoValue(n,"weight3")}},model:{value:n.weight3,callback:function(t){e.$set(n,"weight3",t)},expression:"row.weight3"}})]}}])}),a("ec-table-col",{attrs:{field:"weight4",title:e.weight4Title,align:"right","min-width":"180","edit-render":{}},scopedSlots:e._u([{key:"edit",fn:function(t){var n=t.row;return[a("a-input-number",{attrs:{min:0,max:1e5,precision:2},on:{blur:function(t){return e.handleNoValue(n,"weight4")}},model:{value:n.weight4,callback:function(t){e.$set(n,"weight4",t)},expression:"row.weight4"}})]}}])}),a("ec-table-col",{attrs:{title:"操作",align:"center","min-width":"130"},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.row;return[a("a-popconfirm",{attrs:{title:"是否要删除此行？","ok-text":"确定","cancel-text":"取消"},on:{confirm:function(t){return e.onDel(n)}}},[a("a-button",{attrs:{type:"link"}},[e._v("删除")])],1)]}}])})],1)],1)],1)],1),a("ec-container-footer",{attrs:{fixed:""}},[a("a-space",[a("a-button",{attrs:{type:"primary",loading:e.saving},on:{click:function(t){return e.onSave("save")}}},[e._v("保存")]),a("a-button",{on:{click:e.cancel}},[e._v("取消")])],1)],1)],1)],1)},T=[],C=a("6ea6"),N={name:"AdminOrgManageEdit",components:{OrgPicker:u.a,SelectPicker:s.a,moment:g.a},data:function(){var e=function(e,t,a){if(0===t.length)return a(new Error("请选择供方单位"));a()};return{title:"",isDisableYear:!0,isEdit:!1,rowData:"",visible:!1,saving:!1,checked:!1,ruleForm:{},formData:{},yearDemandList:[],leafTypeList:[],totalLeafLevelList:[],orgCodeList:[],businessYear:"",weightUnitName:"",weightUnit:"",tableConfig:[],weight1Title:"",weight2Title:"",weight3Title:"",weight4Title:"",needYearListFormat:{},needGatherYear:"",weightColunm:["weight1","weight2","weight3","weight4"],tableData:[],oldTableData:[],mergeTableData:[],currentLeafLevelList:[],bizCode:"",businessOrgList:[],replaceFields:{pkey:"parentBizCode",title:"orgName",key:"bizCode",children:"children"},data:{},validRules:{leafTypeName:[{required:!0,message:"请选择烟叶类型"}],leafLevelName:[{required:!0,message:"请选择小等级"}]},rules:{supplyOrgCode:[{validator:e,required:!0,trigger:"change"}]}}},methods:{moment:g.a,handleQueryBusinessOrgList:function(){var e=this;return Object(l["a"])(Object(i["a"])().mark((function t(){var a,n;return Object(i["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a={busiYear:e.businessYear,orgTypeEk:"TOBACCO",orgLevelEk:"3",parentBizCode:e.bizCode},t.next=3,e.$apis.common.index.queryTreeByCode(a);case 3:n=t.sent,e.businessOrgList=n.rows||[];case 5:case"end":return t.stop()}}),t)})))()},onFetchBusinessOrgList:function(){var e=this;return new Promise((function(t){var a=Object(C["treeFormatList"])(e.businessOrgList,e.replaceFields);t(a)}))},handleLeafLevelList:function(e){var t=this;return Object(l["a"])(Object(i["a"])().mark((function a(){var n,r,l,o;return Object(i["a"])().wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(n=e,r=n.leafLevelList||[],null!==r&&void 0!==r&&r.legth||!n.leafTypeCode){a.next=8;break}return l={pageNo:1,pageSize:100,leafTypeCode:n.leafTypeCode},a.next=6,t.$apis.apm.demandSubmit.queryLevel(l);case 6:o=a.sent,n.leafLevelList=(null===o||void 0===o?void 0:o.rows)||[];case 8:case"end":return a.stop()}}),a)})))()},handleNoValue:function(e,t){var a=e,n=a[t];n||(a[t]="0.00")},show:function(e){var t=this;return Object(l["a"])(Object(i["a"])().mark((function a(){var n,r,l,o,s,c,u;return Object(i["a"])().wrap((function(a){while(1)switch(a.prev=a.next){case 0:return t.visible=!0,a.next=3,t.handleGetLeafTypeList();case 3:return t.weightUnit=e.weightUnitObj.weightUnit,t.weightUnitName=e.weightUnitObj.weightUnitName,l=e.businessYear>0?e.businessYear:(new Date).getFullYear(),t.businessYear=l,t.needGatherYear=e.needGatherYear||"",o=t.needGatherYear.split(","),t.needGatherYearArr=o,t.businessOrgList=e.businessOrgList||[],t.bizCode=e.bizCode||"",null!==(n=t.businessOrgList)&&void 0!==n&&n.length||t.handleQueryBusinessOrgList(),t.isEdit=!0,s=e.weightTitleObj||{},t.weight1Title=s.weight1Title,t.weight2Title=s.weight2Title,t.weight3Title=s.weight3Title,t.weight4Title=s.weight4Title,t.needYearListFormat=e.needYearListFormat,t.formData=null===e||void 0===e?void 0:e.selectedRows,c=null===e||void 0===e||null===(r=e.selectedRows)||void 0===r?void 0:r.pcTNeedCollectDetlDTOS,a.next=24,t.handleMergeDetData(c);case 24:return u=a.sent,t.mergeTableData=w.a.cloneDeep(u),a.next=28,t.handleUnitParse(u);case 28:case"end":return a.stop()}}),a)})))()},handleMergeDetData:function(e){var t=this;return Object(l["a"])(Object(i["a"])().mark((function a(){var n;return Object(i["a"])().wrap((function(a){while(1)switch(a.prev=a.next){case 0:return n=[],e.forEach(function(){var e=Object(l["a"])(Object(i["a"])().mark((function e(a){var r,l,o,s,c,u,d;return Object(i["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:r=a,l=n.find((function(e){return e.leafLevelCode===a.leafLevelCode})),l?l.detlList.push(r):(o=r.leafTypeCode,s=t.leafTypeList.find((function(e){return e.leafTypeCode===o})),c=r.leafLevelCode,u=t.totalLeafLevelList.find((function(e){return e.leafLevelCode===c})),d={leafTypeName:null===s||void 0===s?void 0:s.leafTypeName,leafLevelName:null===u||void 0===u?void 0:u.leafLevelName,leafLevelCode:c,leafTypeCode:o,leafLevelList:r.leafLevelList,detlList:[r]},n.push(d));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),t.weightColunm.forEach((function(e){return t.$refs.table.hideColumn(t.$refs.table.getColumnByField(e))})),n.forEach((function(e){var a=e,n=(null===e||void 0===e?void 0:e.detlList)||[],r=t.needGatherYear||"",i=r.split(",");i.forEach((function(e){var r=e,i=t.needYearListFormat||{},l=i[e],o=0;n.forEach((function(e){r==="".concat(e.needYear)&&(o+=Number(e.weight||0))})),a[l]=o.toFixed(2),t.$refs.table.showColumn(t.$refs.table.getColumnByField(l))}))})),a.abrupt("return",n);case 5:case"end":return a.stop()}}),a)})))()},handleUnitParse:function(e){var t=this;return Object(l["a"])(Object(i["a"])().mark((function a(){var n,r;return Object(i["a"])().wrap((function(a){while(1)switch(a.prev=a.next){case 0:n=[],r=e,r&&r.length>0&&(r.forEach((function(e){var a=e;a.weight1=a.weight1?(Number(a.weight1)/t.weightUnit).toFixed(2):"0.00",a.weight2=a.weight2?(Number(a.weight2)/t.weightUnit).toFixed(2):"0.00",a.weight3=a.weight3?(Number(a.weight3)/t.weightUnit).toFixed(2):"0.00",a.weight4=a.weight4?(Number(a.weight4)/t.weightUnit).toFixed(2):"0.00",n.push(a)})),t.tableData=n);case 3:case"end":return a.stop()}}),a)})))()},handleGetLeafTypeList:function(){var e=this;return Object(l["a"])(Object(i["a"])().mark((function t(){var a,n,r,l,o;return Object(i["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(null!==(a=e.leafTypeList)&&void 0!==a&&a.length){t.next=5;break}return t.next=3,e.$apis.bpm.executionEnter.queryAllLeafType({});case 3:r=t.sent,e.leafTypeList=(null===r||void 0===r?void 0:r.rows)||[];case 5:if(null!==(n=e.totalLeafLevelList)&&void 0!==n&&n.length){t.next=11;break}return l={leafTypeCode:""},t.next=9,e.$apis.apm.demandSubmit.queryAllLevel(l);case 9:o=t.sent,e.totalLeafLevelList=(null===o||void 0===o?void 0:o.rows)||[];case 11:case"end":return t.stop()}}),t)})))()},handleLeafLevelCode:function(e){var t=e,a=e.leafLevelList||[];a.forEach((function(a){var n=a;n.leafLevelName===e.leafLevelName&&(t.leafLevelCode=n.leafLevelCode)}))},handleGetLeafLevel:function(e){var t=this;return Object(l["a"])(Object(i["a"])().mark((function a(){var n,r,l,o;return Object(i["a"])().wrap((function(a){while(1)switch(a.prev=a.next){case 0:return n=e,r=t.leafTypeList,r.forEach((function(t){var a=t;a.leafTypeName===e.leafTypeName&&(n.leafTypeCode=a.leafTypeCode)})),l={pageNo:1,pageSize:150,leafTypeCode:e.leafTypeCode||""},a.next=6,t.$apis.apm.demandSubmit.queryLevel(l);case 6:o=a.sent,n.leafLevelCode="",n.leafLevelName="",n.leafLevelList=null===o||void 0===o?void 0:o.rows;case 10:case"end":return a.stop()}}),a)})))()},addRow:function(){var e=this;return Object(l["a"])(Object(i["a"])().mark((function t(){var a;return Object(i["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:a={leafTypeCode:"",leafTypeName:"",leafLevelCode:"",leafLevelName:"",leafLevelList:[],weight1:"0.00",weight2:"0.00",weight3:"0.00",weight4:"0.00",dataState:"1",busiYear:e.businessYear},e.tableData.push(a);case 2:case"end":return t.stop()}}),t)})))()},onDel:function(e){this.tableData.splice(e,1)},footerMethod:function(e){var t=this,a=e.columns,n=e.data;return[a.map((function(e,a){return 0===a?"合计":["weight1","weight2","weight3","weight4"].includes(e.property)?t.sumNum(n,e.property):null}))]},sumNum:function(e,t){var a=0;return e.forEach((function(e){a+=Number(e[t]?e[t]:0)})),a.toFixed(2)},handleBeforeSaveData:function(){var e=this,t=w.a.cloneDeep(this.tableData),a=[];if(this.isHasLeafLevel=!1,t.forEach((function(t){var n=t,r=n.leafLevelCode,i=a.find((function(e){return e===r}));i&&i.length>0?(e.isHasLeafLevel=!0,e.$message.error("存在重复的小等级[".concat(n.leafLevelName,"]"))):a.push(r)})),!this.isHasLeafLevel){var n=this.formData,r=[];return t.forEach((function(t){var a=t,n=e.needGatherYearArr||[];n&&n.length>0&&n.forEach((function(n){var i=n,l=e.needYearListFormat||{},o=l[i],s=t[o]||0,c=(Number(s)*e.weightUnit).toFixed(2),u={weight:c,needYear:i,leafTypeCode:a.leafTypeCode,leafLevelCode:a.leafLevelCode,busiYear:e.businessYear,dataState:"1"};r.push(u)}))})),n.pcTNeedCollectDetlDTOS=r,n}},onSave:function(e){var t=this;return Object(l["a"])(Object(i["a"])().mark((function a(){var n,r;return Object(i["a"])().wrap((function(a){while(1)switch(a.prev=a.next){case 0:return n=t.$refs.table,a.next=3,n.validate(!0).catch((function(e){return e}));case 3:r=a.sent,r?t.$message.error("校验不通过！"):t.$refs.modelRef.validate(function(){var a=Object(l["a"])(Object(i["a"])().mark((function a(n){var r,l;return Object(i["a"])().wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(n){a.next=2;break}return a.abrupt("return");case 2:if(t.saving=!0,r=t.handleBeforeSaveData(),r){a.next=7;break}return t.saving=!1,a.abrupt("return");case 7:if(l=r.pcTNeedCollectDetlDTOS||[],null!==l&&void 0!==l&&l.length){a.next=12;break}return t.$message.error("表格数据不能为空！"),t.saving=!1,a.abrupt("return");case 12:console.log(r),t.$apis.apm.demandSubmit.save(r).then((function(a){if(console.log(JSON.stringify(a)),a.result)t.saving=!1,t.$message.success("操作成功"),"saveAndAdd"===e?(t.formData.supplyOrgCode=void 0,t.tableData=[],t.$emit("onQuery")):(t.$emit("onQuery"),t.cancel());else{t.saving=!1;var n=(null===a||void 0===a?void 0:a.msg)||"操作失败";t.$message.error(n)}})).catch((function(e){console.log(e),t.saving=!1}));case 14:case"end":return a.stop()}}),a)})));return function(e){return a.apply(this,arguments)}}());case 5:case"end":return a.stop()}}),a)})))()},cancel:function(){this.visible=!1,this.$refs.modelRef.resetFields(),this.formData.supplyOrgCode=void 0,this.tableData=[]}}},_=N,F=Object(x["a"])(_,O,T,!1,null,null,null),$=F.exports,j=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ec-drawer",{staticClass:"ec-draw-form",attrs:{title:"需求提报新增",visible:e.visible,size:"large","is-confirm":!0},on:{close:e.cancel}},[a("ec-container",{attrs:{auto:!1,height:"100%",fixed:"top bottom","color-code":"007"}},[a("ec-container-body",{staticStyle:{overflow:"hidden"}},[a("ec-panel",{attrs:{title:"需求主信息","color-code":"001"}},[a("ec-panel-item",[a("ec-form",{ref:"modelRef",attrs:{model:e.formData,rules:e.rules}},[a("a-row",{attrs:{type:"flex",gutter:12}},[a("a-col",{attrs:{span:6}},[a("a-form-model-item",{ref:"supplyOrgCode",attrs:{label:"供方单位",prop:"supplyOrgCode"}},[a("select-picker",{attrs:{lazy:!1,search:!1,title:"选择供方单位",fetchData:e.onFetchBusinessOrgList},on:{ok:e.handleSupplyData},model:{value:e.formData.supplyOrgCode,callback:function(t){e.$set(e.formData,"supplyOrgCode",t)},expression:"formData.supplyOrgCode"}})],1)],1),a("a-col",{attrs:{span:6}},[a("a-form-model-item",{attrs:{label:"采集批次"}},[a("a-input",{attrs:{disabled:e.isDisableYear,placeholder:"请输入采集批次"},model:{value:e.formData.batchName,callback:function(t){e.$set(e.formData,"batchName",t)},expression:"formData.batchName"}})],1)],1),a("a-col",{attrs:{span:6}},[a("a-form-model-item",{attrs:{label:"业务年度"}},[a("a-input",{attrs:{disabled:e.isDisableYear,placeholder:"请输入业务年度"},model:{value:e.formData.busiYear,callback:function(t){e.$set(e.formData,"busiYear",t)},expression:"formData.busiYear"}})],1)],1),a("a-col",{attrs:{span:6}},[a("a-form-model-item",{attrs:{label:"录入日期"}},[a("a-date-picker",{attrs:{disabled:e.isDisableYear,format:"YYYY-MM-DD",valueFormat:"YYYY-MM-DD",type:"date",defaultValue:e.moment(new Date,"YYYY-MM-DD"),placeholder:"请选择日期"},model:{value:e.formData.checkDate,callback:function(t){e.$set(e.formData,"checkDate",t)},expression:"formData.checkDate"}})],1)],1)],1)],1)],1)],1),a("ec-panel",{attrs:{auto:!1}},[a("ec-panel-toolbar",[a("ec-panel-item-left",[a("a-button",{attrs:{type:"primary"},on:{click:function(t){return e.addRow()}}},[e._v("新增行")])],1),a("ec-panel-item-right",[a("span",[e._v("计量单位："+e._s(e.weightUnitName))])])],1),a("ec-panel-body",[a("ec-table",{ref:"table",attrs:{border:"","keep-source":"","show-footer":"",auto:!1,"row-select":"",height:"70%","edit-rules":e.validRules,"footer-method":e.footerMethod,"edit-config":{trigger:"click",mode:"row",showStatus:!0},data:e.tableData}},[a("ec-table-col",{attrs:{width:"70",title:"序号",type:"seq",align:"center"}}),a("ec-table-col",{attrs:{field:"leafTypeName",title:"烟叶类型","min-width":"180",align:"left","edit-render":{}},scopedSlots:e._u([{key:"edit",fn:function(t){var n=t.row;return[a("a-select",{attrs:{"filter-option":e.filterOption},on:{select:function(t){return e.handleGetLeafLevelList(n)}},model:{value:n.leafTypeName,callback:function(t){e.$set(n,"leafTypeName",t)},expression:"row.leafTypeName"}},e._l(e.leafTypeList,(function(t){return a("a-select-option",{key:t.leafTypeCode,attrs:{value:t.leafTypeName}},[e._v(e._s(t.leafTypeName))])})),1)]}}])}),a("ec-table-col",{attrs:{field:"leafLevelName",title:"小等级","min-width":"180",align:"left","edit-render":{}},scopedSlots:e._u([{key:"edit",fn:function(t){var n=t.row;return[a("a-select",{on:{focus:function(t){return e.handleLeafLevelList(n)},select:function(t){return e.handleLeafLevelCode(n)}},model:{value:n.leafLevelName,callback:function(t){e.$set(n,"leafLevelName",t)},expression:"row.leafLevelName"}},e._l(n.leafLevelList,(function(t){return a("a-select-option",{key:t.leafLevelCode,attrs:{value:t.leafLevelName}},[e._v(e._s(t.leafLevelName))])})),1)]}}])}),a("ec-table-col",{attrs:{field:"weight1",title:e.weight1Title,align:"right","min-width":"180","edit-render":{}},scopedSlots:e._u([{key:"edit",fn:function(t){var n=t.row;return[a("a-input-number",{attrs:{min:0,max:1e5,precision:2},on:{blur:function(t){return e.handleNoValue(n,"weight1")}},model:{value:n.weight1,callback:function(t){e.$set(n,"weight1",t)},expression:"row.weight1"}})]}}])}),a("ec-table-col",{attrs:{field:"weight2",title:e.weight2Title,align:"right","min-width":"180","edit-render":{}},scopedSlots:e._u([{key:"edit",fn:function(t){var n=t.row;return[a("a-input-number",{attrs:{min:0,max:1e5,precision:2},on:{blur:function(t){return e.handleNoValue(n,"weight2")}},model:{value:n.weight2,callback:function(t){e.$set(n,"weight2",t)},expression:"row.weight2"}})]}}])}),a("ec-table-col",{attrs:{field:"weight3",title:e.weight3Title,align:"right","min-width":"180","edit-render":{}},scopedSlots:e._u([{key:"edit",fn:function(t){var n=t.row;return[a("a-input-number",{attrs:{min:0,max:1e5,precision:2},on:{blur:function(t){return e.handleNoValue(n,"weight3")}},model:{value:n.weight3,callback:function(t){e.$set(n,"weight3",t)},expression:"row.weight3"}})]}}])}),a("ec-table-col",{attrs:{field:"weight4",title:e.weight4Title,align:"right","min-width":"180","edit-render":{}},scopedSlots:e._u([{key:"edit",fn:function(t){var n=t.row;return[a("a-input-number",{attrs:{min:0,max:1e5,precision:2},on:{blur:function(t){return e.handleNoValue(n,"weight4")}},model:{value:n.weight4,callback:function(t){e.$set(n,"weight4",t)},expression:"row.weight4"}})]}}])}),a("ec-table-col",{attrs:{title:"操作",align:"center","min-width":"130"},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.row;return[a("a-popconfirm",{attrs:{title:"是否要删除此行？","ok-text":"确定","cancel-text":"取消"},on:{confirm:function(t){return e.onDel(n)}}},[a("a-button",{attrs:{type:"link"}},[e._v("删除")])],1)]}}])})],1)],1)],1)],1),a("ec-container-footer",{attrs:{fixed:""}},[a("a-space",[a("a-button",{attrs:{type:"primary",loading:e.saving},on:{click:function(t){return e.onSave("saveAndAdd")}}},[e._v("保存并新增")]),a("a-button",{attrs:{type:"primary",loading:e.saving},on:{click:function(t){return e.onSave("save")}}},[e._v("保存")]),a("a-button",{on:{click:e.cancel}},[e._v("取消")])],1)],1)],1)],1)},B=[],Y={name:"AdminOrgManageEdit",components:{OrgPicker:u.a,OrgTree:y.a,DivisionPicker:p.a,SelectPicker:s.a,moment:g.a},data:function(){var e=function(e,t,a){if(0===t.length)return a(new Error("请选择供方单位"));a()};return{title:"",isDisableYear:!0,isEdit:!1,rowData:"",visible:!1,saving:!1,checked:!1,ruleForm:{},formData:{},yearDemandList:[],leafTypeList:[],orgCodeList:[],businessYear:"",weightUnitName:"",weightUnit:"",tableConfig:[],weight1Title:"",weight2Title:"",weight3Title:"",weight4Title:"",needYearListFormat:{},needGatherYear:"",needCollectBatchId:"",orgName:"",weightColunm:["weight1","weight2","weight3","weight4"],tableData:[],oldTableData:[],businessOrgList:[],replaceFields:{pkey:"parentBizCode",title:"orgName",key:"bizCode",children:"children"},data:{},validRules:{leafTypeName:[{required:!0,message:"请选择烟叶类型"}],leafLevelName:[{required:!0,message:"请选择小等级"}]},rules:{supplyOrgCode:[{validator:e,required:!0,trigger:"change"}]}}},methods:{moment:g.a,handleQueryBusinessOrgList:function(){var e=this;return Object(l["a"])(Object(i["a"])().mark((function t(){var a,n;return Object(i["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a={busiYear:e.businessYear,orgTypeEk:"TOBACCO",orgLevelEk:"3",parentBizCode:e.bizCode},t.next=3,e.$apis.common.index.queryTreeByCode(a);case 3:n=t.sent,e.businessOrgList=n.rows||[];case 5:case"end":return t.stop()}}),t)})))()},onFetchBusinessOrgList:function(){var e=this;return new Promise((function(t){var a=Object(C["treeFormatList"])(e.businessOrgList,e.replaceFields);t(a)}))},filterOption:function(e,t){return t.componentOptions.children[0].text.toLowerCase().indexOf(e.toLowerCase())>=0},handleLeafLevelList:function(e){var t=this;return Object(l["a"])(Object(i["a"])().mark((function a(){var n,r,l,o;return Object(i["a"])().wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(n=e,r=n.leafLevelList||[],null!==r&&void 0!==r&&r.legth||!n.leafTypeCode){a.next=8;break}return l={pageNo:1,pageSize:100,leafTypeCode:n.leafTypeCode},a.next=6,t.$apis.apm.demandSubmit.queryLevel(l);case 6:o=a.sent,n.leafLevelList=(null===o||void 0===o?void 0:o.rows)||[];case 8:case"end":return a.stop()}}),a)})))()},handleSupplyData:function(e){var t;this.orgName=null===e||void 0===e||null===(t=e.selectOption)||void 0===t?void 0:t.title},handleNoValue:function(e,t){var a=e,n=a[t];n||(a[t]="0.00")},show:function(e){var t=this;return Object(l["a"])(Object(i["a"])().mark((function a(){var n,r,l,o,s,c;return Object(i["a"])().wrap((function(a){while(1)switch(a.prev=a.next){case 0:return t.visible=!0,t.data=e,t.handleGetLeafTypeList(),t.weightUnit=e.weightUnitObj.weightUnit,t.weightUnitName=e.weightUnitObj.weightUnitName,r=e.businessYear>0?e.businessYear:(new Date).getFullYear(),t.businessYear=r,t.needCollectBatchId=e.needCollectBatchId,t.formData={batchName:e.batchName,checkDate:g()(new Date,"YYYY-MM-DD"),busiYear:r,supplyOrgCode:""},t.bizCode=e.bizCode||"",null!==(n=t.businessOrgList)&&void 0!==n&&n.length||t.handleQueryBusinessOrgList(),t.needGatherYear=e.needGatherYear||"",l=[],a.next=15,t.handleUnitParse(l);case 15:console.log("新增".concat(t.isEdit)),t.title="需求提报新增",o=e.weightTitleObj||{},t.weight1Title=o.weight1Title,t.weight2Title=o.weight2Title,t.weight3Title=o.weight3Title,t.weight4Title=o.weight4Title,t.needYearListFormat=e.needYearListFormat,s=["weight1","weight2","weight3","weight4"],s.forEach((function(e){return t.$refs.table.hideColumn(t.$refs.table.getColumnByField(e))})),c=t.needGatherYear.split(","),t.needGatherYearArr=c,c.forEach((function(e){var a=t.needYearListFormat||{},n=a[e];t.$refs.table.showColumn(t.$refs.table.getColumnByField(n))}));case 28:case"end":return a.stop()}}),a)})))()},handleUnitParse:function(e){var t=this;return Object(l["a"])(Object(i["a"])().mark((function a(){var n,r;return Object(i["a"])().wrap((function(a){while(1)switch(a.prev=a.next){case 0:n=[],r=e,r&&r.length>0&&(r.forEach((function(e){var a=e;a.weight1=a.weight1?(Number(a.weight1)/t.weightUnit).toFixed(2):"0.00",a.weight2=a.weight2?(Number(a.weight2)/t.weightUnit).toFixed(2):"0.00",a.weight3=a.weight3?(Number(a.weight3)/t.weightUnit).toFixed(2):"0.00",a.weight4=a.weight4?(Number(a.weight4)/t.weightUnit).toFixed(2):"0.00",n.push(a)})),t.tableData=n);case 3:case"end":return a.stop()}}),a)})))()},handleGetLeafTypeList:function(){var e=this;return Object(l["a"])(Object(i["a"])().mark((function t(){var a,n;return Object(i["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(null!==(a=e.leafTypeList)&&void 0!==a&&a.length){t.next=5;break}return t.next=3,e.$apis.bpm.executionEnter.queryAllLeafType({});case 3:n=t.sent,e.leafTypeList=(null===n||void 0===n?void 0:n.rows)||[];case 5:case"end":return t.stop()}}),t)})))()},handleLeafLevelCode:function(e){var t=e,a=e.leafLevelList||[];a.forEach((function(a){var n=a;n.leafLevelName===e.leafLevelName&&(t.leafLevelCode=n.leafLevelCode)}))},handleGetLeafLevelList:function(e){var t=this;return Object(l["a"])(Object(i["a"])().mark((function a(){var n,r,l,o;return Object(i["a"])().wrap((function(a){while(1)switch(a.prev=a.next){case 0:return console.log(e),n=e,r=t.leafTypeList,r.forEach((function(t){var a=t;a.leafTypeName===e.leafTypeName&&(n.leafTypeCode=a.leafTypeCode)})),l={pageNo:1,pageSize:150,leafTypeCode:e.leafTypeCode||""},a.next=7,t.$apis.apm.demandSubmit.queryLevel(l);case 7:o=a.sent,n.leafLevelCode="",n.leafLevelName="",n.leafLevelList=null===o||void 0===o?void 0:o.rows;case 11:case"end":return a.stop()}}),a)})))()},addRow:function(){var e=this;return Object(l["a"])(Object(i["a"])().mark((function t(){var a;return Object(i["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:a={leafTypeCode:"",leafTypeName:"",leafLevelCode:"",leafLevelName:"",leafLevelList:[],weight1:"0.00",weight2:"0.00",weight3:"0.00",weight4:"0.00",dataState:"1",busiYear:e.businessYear},e.tableData.push(a);case 2:case"end":return t.stop()}}),t)})))()},onDel:function(e){this.tableData.splice(e,1)},footerMethod:function(e){var t=this,a=e.columns,n=e.data;return[a.map((function(e,a){return 0===a?"合计":["weight1","weight2","weight3","weight4"].includes(e.property)?t.sumNum(n,e.property):null}))]},sumNum:function(e,t){var a=0;return e.forEach((function(e){a+=Number(e[t]?e[t]:0)})),a.toFixed(2)},handleBeforeSaveData:function(){var e=this,t=this.formData,a=this.needGatherYear,n=w.a.cloneDeep(this.tableData),r=[];if(this.isHasLeafLevel=!1,n.forEach((function(t){var a=t,n=a.leafLevelCode,i=r.find((function(e){return e===n}));i&&i.length>0?(e.isHasLeafLevel=!0,e.$message.error("存在重复的小等级[".concat(a.leafLevelName,"]"))):r.push(n)})),!this.isHasLeafLevel){var i={supplyOrgCode:t.supplyOrgCode,supplyOrgName:this.orgName,busiYear:this.businessYear,dataState:"1",needYear:a,needCollectBatchId:this.needCollectBatchId,batchName:t.batchName},l=[];return n.forEach((function(t){var a=t,n=e.needGatherYearArr||[];n&&n.length>0&&n.forEach((function(n){var r=n,i=e.needYearListFormat||{},o=i[r],s=t[o]||0,c=(Number(s)*e.weightUnit).toFixed(2),u={weight:c,needYear:r,leafTypeCode:a.leafTypeCode,leafLevelCode:a.leafLevelCode,busiYear:e.businessYear,dataState:"1"};l.push(u)}))})),i.pcTNeedCollectDetlDTOS=l,i}},onSave:function(e){var t=this;return Object(l["a"])(Object(i["a"])().mark((function a(){var n,r;return Object(i["a"])().wrap((function(a){while(1)switch(a.prev=a.next){case 0:return n=t.$refs.table,a.next=3,n.validate(!0).catch((function(e){return e}));case 3:r=a.sent,r?t.$message.error("校验不通过！"):t.$refs.modelRef.validate(function(){var a=Object(l["a"])(Object(i["a"])().mark((function a(n){var r,l;return Object(i["a"])().wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(n){a.next=2;break}return a.abrupt("return");case 2:if(t.saving=!0,r=t.handleBeforeSaveData(),r){a.next=7;break}return t.saving=!1,a.abrupt("return");case 7:if(l=r.pcTNeedCollectDetlDTOS||[],null!==l&&void 0!==l&&l.length){a.next=12;break}return t.$message.error("表格数据不能为空！"),t.saving=!1,a.abrupt("return");case 12:console.log(r),t.$apis.apm.demandSubmit.save(r).then((function(a){if(console.log(JSON.stringify(a)),a.result)t.saving=!1,t.$message.success("操作成功"),"saveAndAdd"===e?(t.formData.supplyOrgCode=void 0,t.tableData=[],t.$emit("onQuery")):(t.$emit("onQuery"),t.cancel());else{t.saving=!1;var n=(null===a||void 0===a?void 0:a.msg)||"操作失败";t.$message.error(n)}})).catch((function(e){console.log(e),t.saving=!1}));case 14:case"end":return a.stop()}}),a)})));return function(e){return a.apply(this,arguments)}}());case 5:case"end":return a.stop()}}),a)})))()},cancel:function(){this.visible=!1,this.$refs.modelRef.resetFields(),this.formData.supplyOrgCode=void 0,this.tableData=[]}}},A=Y,K=Object(x["a"])(A,j,B,!1,null,null,null),E=K.exports,R={name:"BatchManage",components:{Detail:S,DemandSubmitEdit:$,DemandSubmitAdd:E,OrgPicker:u.a,SelectPicker:s.a},data:function(){return{queryItems:{supplyOrgCode:void 0,businessYear:"",batchName:"",auditState:"",orgCode:""},busiYear:"",bizCode:"",weight1Title:"",weight2Title:"",weight3Title:"",weight4Title:"",loading:!1,yearDisable:!0,needYearListFormat:{},weightColunm:["weight1","weight2","weight3","weight4"],needGatherYear:"",defaultBatchName:"",defaultNeedGatherYear:"",batchList:[],mergeDataList:[],pagination:{pageNumber:1,pageSize:10,total:0},businessOrgList:[],replaceFields:{pkey:"parentBizCode",title:"orgName",key:"bizCode",children:"children"},auditStateList:[{id:"",name:"全部"},{id:"0",name:"未上报"},{id:"1",name:"省公司待确认"},{id:"2",name:"省公司退回"},{id:"3",name:"总公司待审核"},{id:"4",name:"总公司退回"},{id:"5",name:"总公司已审核"}],oldTableData:[],weightUnit:5e5,weightUnitName:"万担",tableData:{rows:[]}}},created:function(){var e=this.$router.history.current.query.appCode;this.appCode=e||"CM"},computed:{appConfig:function(){return this.$store.getters.getAppConfig}},methods:{cellStyle:function(){return"text-align:right"},handleQueryBusinessOrgList:function(){var e=this;return Object(l["a"])(Object(i["a"])().mark((function t(){var a,n;return Object(i["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a={busiYear:e.busiYear,orgTypeEk:"TOBACCO",orgLevelEk:"3",parentBizCode:e.bizCode},t.next=3,e.$apis.common.index.queryTreeByCode(a);case 3:n=t.sent,e.businessOrgList=n.rows||[];case 5:case"end":return t.stop()}}),t)})))()},onFetchBusinessOrgList:function(){var e=this;return new Promise((function(t){var a=Object(C["treeFormatList"])(e.businessOrgList,e.replaceFields);t(a)}))},handlePagination:function(e,t){var a=this;return Object(l["a"])(Object(i["a"])().mark((function n(){return Object(i["a"])().wrap((function(n){while(1)switch(n.prev=n.next){case 0:return a.pagination.pageNumber=e,a.pagination.pageSize=t,n.next=4,a.handleGetYear();case 4:case"end":return n.stop()}}),n)})))()},handleGetYear:function(){var e=this;return Object(l["a"])(Object(i["a"])().mark((function t(){var a,n,r,l,o,s,c,u,d,f;return Object(i["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(""!==e.queryItems.businessYear){t.next=34;break}if(e.orgCode){t.next=7;break}return t.next=4,e.$apis.bim.curOrg.get({});case 4:n=t.sent,e.bizCode=null===n||void 0===n?void 0:n.bizCode,e.orgCode=null===n||void 0===n?void 0:n.orgUniqueCode;case 7:return r={bizCode:e.appConfig.bizCode,appCode:e.appCode,yearTypeCode:"BIZ_YEAR"},t.next=10,e.$apis.bpm.executionEnter.getBuYear(r);case 10:return l=t.sent,e.busiYear=null===l||void 0===l?void 0:l.yearValue,o=(null===l||void 0===l?void 0:l.yearValue)||(new Date).getFullYear(),e.queryItems.businessYear=o,console.log("---------".concat(o)),s={},e.weight1Title="".concat(o+1,"年需求"),s[o+1]="weight1",e.weight2Title="".concat(o+2,"年需求"),s[o+2]="weight2",e.weight3Title="".concat(o+3,"年需求"),s[o+3]="weight3",e.weight4Title="".concat(o+4,"年需求"),s[o+4]="weight4",e.needYearListFormat=s,c={busiYear:e.queryItems.businessYear},t.next=28,e.$apis.apm.demandManage.queryBatch(c);case 28:u=t.sent,d=(null===u||void 0===u?void 0:u.rows)||[],e.batchList=d,f=d&&d.length>0?d[0].batchName:"",e.queryItems.batchName=f,e.defaultBatchName=f;case 34:return t.next=36,e.handleNeedYearColumn();case 36:if(null!==(a=e.businessOrgList)&&void 0!==a&&a.length){t.next=39;break}return t.next=39,e.handleQueryBusinessOrgList();case 39:return t.next=41,e.onQuery();case 41:case"end":return t.stop()}}),t)})))()},handleNeedYearColumn:function(){var e=this;return Object(l["a"])(Object(i["a"])().mark((function t(){var a,n,r,l,o,s;return Object(i["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=e,e.weightColunm.forEach((function(t){return e.$refs.table.hideColumn(e.$refs.table.getColumnByField(t))})),n=e.queryItems.batchName,r={batchName:n,busiYear:e.queryItems.businessYear},t.next=6,e.$apis.apm.demandManage.queryNeedGatherYear(r);case 6:l=t.sent,o=(null===l||void 0===l?void 0:l.needGatherYear)||"",""===a.defaultNeedGatherYear&&(a.defaultNeedGatherYear=o),console.log("采集年度：".concat(null===l||void 0===l?void 0:l.needGatherYear)),e.needGatherYear=o,s=o.split(","),s.forEach((function(t){var a=e.needYearListFormat||{},n=a[t];e.$refs.table.showColumn(e.$refs.table.getColumnByField(n))}));case 13:case"end":return t.stop()}}),t)})))()},onQuery:function(){var e=this;return Object(l["a"])(Object(i["a"])().mark((function t(){var a;return Object(i["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:a={pageNo:e.pagination.pageNumber,pageSize:e.pagination.pageSize,busiYear:e.queryItems.businessYear,supplyOrgCode:e.queryItems.supplyOrgCode,batchName:e.queryItems.batchName,auditState:e.queryItems.auditState},console.log("-----------参数：".concat(JSON.stringify(a))),e.loading=!0,e.$apis.apm.demandSubmit.query(a).then((function(t){e.loading=!1;var a=(null===t||void 0===t?void 0:t.rows)||[];e.pagination.total=t.totalRows;var n=w.a.cloneDeep(a);e.oldTableData=n;var r=e.handleMergeDetData(a);e.handleUnitParse(r)})).catch((function(t){e.loading=!1,console.log(t)}));case 4:case"end":return t.stop()}}),t)})))()},handleMergeDetData:function(e){var t=this;return console.log("-----------合并前的数据：".concat(JSON.stringify(e))),e.forEach((function(e){var a=e,n=(null===e||void 0===e?void 0:e.pcTNeedCollectDetlDTOS)||[],r=t.needGatherYear||"",i=r.split(",");i.forEach((function(e){var r=e,i=t.needYearListFormat||{},l=i[e],o=0;n.forEach((function(e){r==="".concat(e.needYear)&&(o+=Number(e.weight||0))})),a[l]=o.toFixed(2)}))})),e},handleUnitParse:function(e){var t=this,a=[],n=e;n.forEach((function(e){var n=e;n.weight1=n.weight1?(n.weight1/t.weightUnit).toFixed(2):"0.00",n.weight2=n.weight2?(n.weight2/t.weightUnit).toFixed(2):"0.00",n.weight3=n.weight3?(n.weight3/t.weightUnit).toFixed(2):"0.00",n.weight4=n.weight4?(n.weight4/t.weightUnit).toFixed(2):"0.00",a.push(n)})),this.tableData.rows=a},onAdd:function(){var e=this;if(this.batchList&&this.batchList.length>0){var t=this.batchList,a=t.find((function(t){return t.batchName===e.defaultBatchName})),n=null===a||void 0===a?void 0:a.needCollectBatchId,r=this.handleToViewData(null,"add");r.needGatherYear=this.defaultNeedGatherYear,r.batchName=this.defaultBatchName,r.needCollectBatchId=n,r.businessOrgList=this.businessOrgList,r.bizCode=this.bizCode,console.log(r),this.$refs.DemandSubmitAdd.show(r)}else this.$message.error("请先制定采集批次!")},onDetail:function(e){var t=this.handleToViewData(e,"detail");t.needGatherYear=this.needGatherYear,t.batchName=this.queryItems.batchName,this.$refs.Detail.show(t)},onEdit:function(e){var t=this,a=this.batchList,n=a.find((function(e){return e.batchName===t.defaultBatchName})),r=null===n||void 0===n?void 0:n.needCollectBatchId,i=this.handleToViewData(e,"editor");i.needGatherYear=this.needGatherYear,i.batchName=this.queryItems.batchName,i.needCollectBatchId=r,i.businessOrgList=this.businessOrgList,i.bizCode=this.bizCode,this.$refs.DemandSubmitEdit.show(i)},handleToViewData:function(e,t){var a=this,n=this,r={weightUnit:this.weightUnit,weightUnitName:this.weightUnitName},i=w.a.cloneDeep(e);n.mergeDataList=[],"editor"===t&&function(){var e=i.pcTNeedCollectDetlDTOS||[];a.mergeDataList=e;for(var t=function(t){var r=e[t];a.$apis.apm.demandSubmit.queryLevel({pageNo:1,pageSize:100,leafTypeCode:r.leafTypeCode}).then((function(e){a.$set(r,"leafLevelList",e.rows)})).then((function(){t===e.length-1&&(n.mergeDataList=r)}))},r=0;r<e.length;r++)t(r);i.pcTNeedCollectDetlDTOS=n.mergeDataList}();var l={weight1Title:this.weight1Title,weight2Title:this.weight2Title,weight3Title:this.weight3Title,weight4Title:this.weight4Title},o=this.needYearListFormat,s={weightUnitObj:r,businessYear:this.queryItems.businessYear,selectedRows:i,weightTitleObj:l,needYearListFormat:o,type:t};return s},onUpload:function(){var e=this,t=this.$createElement;if(!this.selectedRows||this.selectedRows.length<=0)this.$message.error("请选择一条数据再上报");else{var a=this.selectedRows.find((function(e){return"0"!==e.auditState}));console.log("--".concat(JSON.stringify(a))),a?this.$message.error("存在已上报数据，不能重复上报！"):this.$confirm({title:"是否执行该操作?",content:function(){return t("div",{style:"color:red;"},["是否确认上报选中的数据，确认请点击'确认'按钮，取消点击'取消'按钮。"])},onOk:function(){e.loading=!0;for(var t=[],a=0;a<e.selectedRows.length;a++)t.push(e.selectedRows[a].needCollectMasId);e.$apis.apm.demandSubmit.upload({needCollectMasIds:t}).then((function(t){console.log(JSON.stringify(t)),t.result?(e.loading=!1,e.$refs.table.pageAction(1),e.$message.success("操作成功")):(e.loading=!1,e.$message.error("操作失败"))})).catch((function(t){e.loading=!1,t?e.$message.error(t.message||"操作失败"):e.$message.error("操作失败")}))}})}},onDel:function(){var e=this,t=this.$createElement;if(!this.selectedRows||this.selectedRows.length<=0)this.$message.error("请选择一条数据再删除");else{var a=this.selectedRows.find((function(e){return"1"===e.auditState||"3"===e.auditState||"5"===e.auditState}));console.log("--".concat(JSON.stringify(a))),a?this.$message.error("存在正在审核或已审核记录，不能删除！"):this.$confirm({title:"是否执行该操作?",content:function(){return t("div",{style:"color:red;"},["是否确认删除选中的数据，确认请点击'确认'按钮，取消点击'取消'按钮。"])},onOk:function(){e.loading=!0;for(var t=[],a=0;a<e.selectedRows.length;a++)t.push(e.selectedRows[a].needCollectMasId);e.$apis.apm.demandSubmit.delete({needCollectMasIds:t}).then((function(t){console.log(JSON.stringify(t)),t.result?(e.loading=!1,e.$refs.table.pageAction(1),e.$message.success("操作成功")):(e.loading=!1,e.$message.error("操作失败"))})).catch((function(t){e.loading=!1,t?e.$message.error(t.message||"操作失败"):e.$message.error("操作失败")}))}})}},onReset:function(){this.queryItems.auditState="",this.queryItems.batchName=this.defaultBatchName,this.queryItems.supplyOrgCode=void 0,this.$refs.table.pageAction(1)},sumNum:function(e,t){var a=0;return e.forEach((function(e){a+=Number(e[t]||0)})),a.toFixed(2)},footerMethod:function(e){var t=this,a=e.columns,n=e.data;return[a.map((function(e,a){return 0===a?"合计":["weight1","weight2","weight3","weight4"].includes(e.property)?t.sumNum(n,e.property):null}))]},selectAllEvent:function(e){var t=e.checked,a=e.records;console.log("".concat(t,"-选中所有records包含选中的所以对象----").concat(JSON.stringify(a))),this.selectedRows=a},selectRowChange:function(e){var t=e.checked,a=e.records;console.log("".concat(t,"-选择改变时会把records包含选中的所以对象----").concat(JSON.stringify(a))),this.selectedRows=a}}},q=R,P=Object(x["a"])(q,n,r,!1,null,null,null);t["default"]=P.exports}}]);
//# sourceMappingURL=chunk-759e7d8e.34fefd2a.js.map