(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-07ba37d6"],{"320a":function(e,t,a){"use strict";a.r(t);var o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ec-container",[a("ec-container-header",[a("ec-panel-item",[a("ec-panel-item-left",[a("ec-header",{attrs:{title:"收购升损申请",icon:"onetomany","color-code":"008"}})],1)],1)],1),a("ec-container-body",[a("ec-panel",[a("ec-panel-toolbar",[a("ec-query-panel",{on:{query:e.handleQuery,reset:e.handleReset},scopedSlots:e._u([{key:"inner",fn:function(){return[a("ec-query-item",{attrs:{label:"单位"}},[a("a-input",{attrs:{placeholder:"请输入单位"},model:{value:e.queryData.orgName,callback:function(t){e.$set(e.queryData,"orgName",t)},expression:"queryData.orgName"}})],1),a("ec-query-item",{attrs:{label:"单据日期范围"}},[a("a-range-picker",{model:{value:e.billDates,callback:function(t){e.billDates=t},expression:"billDates"}},[a("template",{slot:"renderExtraFooter"},[e._v(" extra footer ")])],2)],1),a("ec-query-item",{attrs:{label:"调拨年度"}},[a("a-input-number",{attrs:{disabled:e.disabled,placeholder:"请输入调拨年度"},model:{value:e.queryData.busiYear,callback:function(t){e.$set(e.queryData,"busiYear",t)},expression:"queryData.busiYear"}})],1)]},proxy:!0}])},[a("ec-query-item",{attrs:{label:"状态"}},[a("ec-select",{attrs:{showSearch:"",allowClear:"",placeholder:"请选择"},model:{value:e.queryData.auditState,callback:function(t){e.$set(e.queryData,"auditState",t)},expression:"queryData.auditState"}},e._l(e.stateList,(function(t){return a("a-select-option",{key:t.auditStateCode},[e._v(" "+e._s(t.auditStateName)+" ")])})),1)],1),a("ec-query-item",{attrs:{label:"业务类型"}},[a("ec-select",{attrs:{showSearch:"",allowClear:"",placeholder:"请选择"},model:{value:e.queryData.busiTypeCode,callback:function(t){e.$set(e.queryData,"busiTypeCode",t)},expression:"queryData.busiTypeCode"}},e._l(e.businessTypeList,(function(t){return a("a-select-option",{key:t.busiTypeCode,attrs:{value:t.busiTypeCode}},[e._v(" "+e._s(t.busiTypeName)+" ")])})),1)],1),a("ec-query-item",{attrs:{label:"烟叶类型"}},[a("ec-select",{attrs:{showSearch:"",allowClear:"",placeholder:"请选择"},model:{value:e.queryData.leafTypeCode,callback:function(t){e.$set(e.queryData,"leafTypeCode",t)},expression:"queryData.leafTypeCode"}},e._l(e.leafTypeList,(function(t){return a("a-select-option",{key:t.leafTypeCode},[e._v(" "+e._s(t.leafTypeName)+" ")])})),1)],1)],1),a("ec-divider")],1),a("ec-panel-body",[a("ec-v-layout",[a("ec-v-item",[a("ec-panel-item",[a("ec-panel-item-left",[a("a-button",{attrs:{type:"primary"},on:{click:function(t){return e.onEdit(e.b,e.prodYear)}}},[e._v("新增")]),a("a-button",{on:{click:e.onDel}},[e._v("删除")]),a("a-button",{on:{click:e.onReported}},[e._v("上报")])],1),a("ec-panel-item-right",[a("a-space",{attrs:{size:15}},[a("span",[e._v("业务年度："+e._s(e.busiYear)+"年")]),a("span",[e._v("重量单位："),a("ec-select",{staticStyle:{width:"150px"},attrs:{showSearch:"",allowClear:"",placeholder:"请选择"},on:{select:function(t){return e.handleUnitParse()}},model:{value:e.weightUnit,callback:function(t){e.weightUnit=t},expression:"weightUnit"}},e._l(e.weightUnitList,(function(t){return a("a-select-option",{key:t.weightUnitCd},[e._v(" "+e._s(t.weightUnitName)+" ")])})),1)],1)])],1)],1)],1),a("ec-v-item",[a("ec-table",{ref:"table",attrs:{"show-overflow":"",loading:e.loading,data:e.tableData,pagination:e.pagination,"checkbox-config":{trigger:"row",highlight:!0,range:!0}},on:{"page-action":e.pageAction,"checkbox-all":e.selectAllEvent,"checkbox-change":e.selectRowChange}},[a("ec-table-col",{attrs:{type:"checkbox",width:"50",align:"center"}}),a("ec-table-col",{attrs:{field:"billDate",title:"单据日期"}}),a("ec-table-col",{attrs:{field:"orgName",title:"单位",align:"left",width:"150"}}),a("ec-table-col",{attrs:{field:"busiTypeName",title:"业务类型",align:"center"}}),a("ec-table-col",{attrs:{field:"leafTypeName",title:"烟叶类型",align:"center"}}),a("ec-table-col",{attrs:{field:"leafFormName",title:"烟叶形态",align:"center"}}),a("ec-table-col",{attrs:{field:"confFlag",title:"罚没烟",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var o=t.row;return["0"===o.confFlag?a("div",[a("span",[e._v("非罚没烟")])]):"1"===o.confFlag?a("div",[a("span",[e._v("罚没烟")])]):e._e()]}}])}),a("ec-table-col",{attrs:{field:"busiYear",title:"调拨年度",align:"center"}}),a("ec-table-col",{attrs:{field:"prodYear",title:"生产年度",align:"center"}}),a("ec-table-col",{attrs:{field:"totalWeight",title:"重量",align:"right"}}),a("ec-table-col",{attrs:{field:"auditState",title:"状态",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var o=t.row;return["0"===o.auditState?a("div",[a("span",[e._v("未上报")])]):"1"===o.auditState?a("div",[a("span",[e._v("省公司待审核")])]):"2"===o.auditState?a("div",[a("span",[e._v("省公司退回")])]):a("div",[a("span",[e._v("完成")])])]}}])}),a("ec-table-col",{attrs:{field:"field",title:"操作",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var o=t.row;return[a("a-button",{attrs:{type:"link",disabled:"0"!=o.auditState&&"2"!=o.auditState},on:{click:function(t){return e.onEdit(o)}}},[e._v("编辑")])]}}])})],1)],1)],1)],1)],1),a("edit-modal",{ref:"editModalRef",on:{finish:e.handleReset}})],1)],1)},r=[],l=a("5530"),i=(a("e9c4"),a("d3b7"),a("159b"),a("b680"),function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ec-drawer",{staticClass:"ec-draw-form",attrs:{title:e.formData.lossReportQtyId?"编辑":"新增",visible:e.visible,size:"small","is-confirm":!0},on:{close:e.onclose}},[a("ec-container",{attrs:{height:"auto",fixed:"top bottom","color-code":"007"}},[a("ec-container-body",[a("ec-panel",{attrs:{"color-code":"001",title:"基本信息"}},[a("ec-panel-item",[a("ec-form",{ref:"formRef",attrs:{model:e.formData,rules:e.formRules}},[a("a-row",{attrs:{type:"flex",gutter:12}},[a("a-col",{attrs:{span:12}},[a("a-form-model-item",{attrs:{label:"单据日期",prop:"billDate"}},[a("a-date-picker",{attrs:{format:e.dateFormat},model:{value:e.formData.billDate,callback:function(t){e.$set(e.formData,"billDate",t)},expression:"formData.billDate"}})],1)],1),a("a-col",{attrs:{span:12}},[a("a-form-model-item",{attrs:{label:"业务类型",prop:"busiTypeName"}},[a("ec-select",{attrs:{showSearch:"",allowClear:"",placeholder:"请选择"},model:{value:e.formData.busiTypeName,callback:function(t){e.$set(e.formData,"busiTypeName",t)},expression:"formData.busiTypeName"}},e._l(e.businessTypeList,(function(t){return a("a-select-option",{key:t.busiTypeCode,attrs:{value:t.busiTypeName}},[e._v(" "+e._s(t.busiTypeName)+" ")])})),1)],1)],1),a("a-col",{attrs:{span:12}},[a("a-form-model-item",{attrs:{label:"烟叶类型",prop:"leafTypeName"}},[a("ec-select",{attrs:{showSearch:"",allowClear:"",placeholder:"请选择"},model:{value:e.formData.leafTypeName,callback:function(t){e.$set(e.formData,"leafTypeName",t)},expression:"formData.leafTypeName"}},e._l(e.leafTypeList,(function(t){return a("a-select-option",{key:t.leafTypeCode,attrs:{value:t.leafTypeName}},[e._v(" "+e._s(t.leafTypeName)+" ")])})),1)],1)],1),a("a-col",{attrs:{span:12}},[a("a-form-model-item",{attrs:{label:"烟叶形态",prop:"leafFormName"}},[a("ec-select",{attrs:{showSearch:"",allowClear:"",placeholder:"请选择"},model:{value:e.formData.leafFormName,callback:function(t){e.$set(e.formData,"leafFormName",t)},expression:"formData.leafFormName"}},e._l(e.leafFormList,(function(t){return a("a-select-option",{key:t.leafFormCode,attrs:{value:t.leafFormName}},[e._v(" "+e._s(t.leafFormName)+" ")])})),1)],1)],1),a("a-col",{attrs:{span:12}},[a("a-form-model-item",{attrs:{label:"罚没烟",prop:"confFlag"}},[a("ec-select",{attrs:{showSearch:"",allowClear:"",placeholder:"请选择"},model:{value:e.formData.confFlag,callback:function(t){e.$set(e.formData,"confFlag",t)},expression:"formData.confFlag"}},e._l(e.confiscationSmokeList,(function(t){return a("a-select-option",{key:t.confFlag},[e._v(" "+e._s(t.confFlagName)+" ")])})),1)],1)],1),a("a-col",{attrs:{span:12}},[a("a-form-model-item",{attrs:{label:"生产年度",prop:"prodYear"}},[a("a-input",{model:{value:e.formData.prodYear,callback:function(t){e.$set(e.formData,"prodYear",t)},expression:"formData.prodYear"}})],1)],1),a("a-col",{attrs:{span:12}},[a("a-form-model-item",{attrs:{label:"调拨年度",prop:"busiYear"}},[a("a-input",{model:{value:e.formData.busiYear,callback:function(t){e.$set(e.formData,"busiYear",t)},expression:"formData.busiYear"}})],1)],1),a("a-col",{attrs:{span:12}},[a("a-form-model-item",{attrs:{label:"重量",prop:"totalWeight"}},[a("a-input-number",{model:{value:e.formData.totalWeight,callback:function(t){e.$set(e.formData,"totalWeight",t)},expression:"formData.totalWeight"}})],1)],1)],1)],1)],1)],1)],1),a("ec-container-footer",{attrs:{fixed:""}},[a("a-space",[a("a-button",{attrs:{loading:e.loading,type:"primary"},on:{click:e.onSave}},[e._v("保存")]),a("a-button",{on:{click:e.onclose}},[e._v("关闭")])],1)],1)],1)],1)}),s=[],n={name:"EditModal",components:{},data:function(){return{value:"",businessTypeList:[{busiTypeCode:"",busiTypeName:"全部"},{busiTypeCode:"YW9401",busiTypeName:"升溢"},{busiTypeCode:"YW9402",busiTypeName:"损耗"}],leafTypeList:[{leafTypeCode:"10",leafTypeName:"烤烟"},{leafTypeCode:"20",leafTypeName:"晾晒烟"}],leafFormList:[{leafFormCode:"101",leafFormName:"原烟"}],confiscationSmokeList:[{confFlag:"0",confFlagName:"非罚没烟"}],prodYear:"",busiYear:"",userInfo:{},dateFormat:"YYYY-MM-DD   ",visible:!1,loading:!1,formData:{orgCode:"",orgName:"",bizCode:"",levelCode:"",billDate:"",busiTypeCode:"",leafTypeCode:"",leafFormName:"",leafFormCode:"",confFlag:"",prodYear:"",busiYear:"",totalWeight:""},formRules:{billDate:{required:!0,message:"请选择单据日期",trigger:""},busiTypeName:{required:!0,message:"请选择业务类型",trigger:"blur"},leafTypeName:{required:!0,message:"请选择烟叶类型",trigger:"blur"},leafFormName:{required:!0,message:"请选择烟叶形态",trigger:"blur"},confFlag:{required:!0,message:"请选择",trigger:"blur"},prodYear:{required:!0,message:"请选择生产年度",trigger:"blur"},busiYear:{required:!0,message:"请选择调拨年度",trigger:"blur"},totalWeight:{required:!0,message:"请输入重量",trigger:"blur"}}}},created:function(){this.getUserInfoHandler()},methods:{show:function(e){this.visible=!0,this.formData=e||{busiYear:this.busiYear},this.prodYear=e.prodYear,this.busiYear=e.busiYear},getUserInfoHandler:function(){var e=this;this.$apis.common.user.get({}).then((function(t){e.userInfo=t||{},e.formData.orgCode=t.orgCode,e.formData.orgName=t.orgName,e.formData.bizCode=t.bizCode,e.formData.levelCode=t.cmTOrgMain.levelCode}))},onSave:function(){var e=this;this.$refs.formRef.validate((function(t){var a;if(t)if(null!==(a=e.formData)&&void 0!==a&&a.lossReportQtyId){e.loading=!0;var o=Object(l["a"])(Object(l["a"])({},e.formData),{},{leafFormcode:"原烟"===e.formData.leafFormName?"101":"",leafTypeCode:"烤烟"===e.formData.leafTypeName?"10":"20",busiTypeCode:"升溢"===e.formData.busiTypeName?"YW9401":"YW9402",orgCode:e.userInfo.orgCode,orgName:e.userInfo.orgName,levelCode:e.userInfo.cmTOrgMain.levelCode,auditState:"0"});e.$apis.bpm.lossReportApply.onChange(o).then((function(){e.$message.success("操作成功"),e.$emit("finish"),e.onclose()})).finally((function(){e.loading=!1}))}else{e.loading=!0;var r=Object(l["a"])(Object(l["a"])({},e.formData),{},{leafTypeName:"10"===e.formData.leafTypeCode?"烤烟":"晾晒烟",leafFormcode:"原烟"===e.formData.leafFormName?"101":"",leafTypeCode:"烤烟"===e.formData.leafTypeName?"10":"20",busiTypeCode:"升溢"===e.formData.busiTypeName?"YW9401":"YW9402",orgCode:e.userInfo.orgCode,orgName:e.userInfo.orgName,levelCode:e.userInfo.cmTOrgMain.levelCode,auditState:"0"});r.billDate=r.billDate.format("YYYY-MM-DD"),e.$apis.bpm.lossReportApply.add(r).then((function(){e.$message.success("操作成功"),e.$emit("finish"),e.onclose(),e.loading=!1})).finally((function(){e.loading=!1}))}else e.$message.error("验证不通过")}))},onclose:function(){this.$refs.formRef.resetFields(),this.formData={},this.visible=!1}}},c=n,u=a("2877"),d=Object(u["a"])(c,i,s,!1,null,"4c55153d",null),f=d.exports,p=a("2ef0"),m=a.n(p),b={components:{EditModal:f},data:function(){return{tableData:[],billDates:"",queryData:{busiYear:""},leafTypeList:[{leafTypeCode:"",leafTypeName:"全部"},{leafTypeCode:"10",leafTypeName:"烤烟"},{leafTypeCode:"20",leafTypeName:"晾晒烟"}],businessTypeList:[{busiTypeCode:"YW9401",busiTypeName:"升溢"},{busiTypeCode:"YW9402",busiTypeName:"损耗"}],stateList:[{auditStateCode:"",auditStateName:"全部"},{auditStateCode:"0",auditStateName:"未上报"},{auditStateCode:"1",auditStateName:"省公司待审核"},{auditStateCode:"2",auditStateName:"省公司退回"},{auditStateCode:"5",auditStateName:"完成"}],weightList:[{name:"万担",id:"万担"},{name:"担",id:"担"},{name:"公斤",id:"公斤"}],weightUnitList:[{weightUnitCd:5e5,weightUnitName:"万担",isSelected:!1},{weightUnitCd:50,weightUnitName:"担",isSelected:!1},{weightUnitCd:1,weightUnitName:"公斤",isSelected:!1}],busiYear:"2022",prodYear:"",userInfo:{},weightUnit:50,oldDataRow:[],pagination:{pageNumber:1,pageSize:10,total:0},selectedRows:[],initBizCode:"",orgLevelEk:""}},created:function(){this.onQuery(),this.getUserInfoHandler(),this.handleReset()},methods:{handlerSelect:function(e){var t=e.treeSelectedKeys,a=e.selectOption,o=e.joinSelectOption,r=e.treeData;console.log(t,a,o,r)},handleReset:function(){this.queryData={},this.billDates="",this.onQuery()},onQuery:function(){var e=this;this.$apis.bpm.lossReportApply.query({}).then((function(t){e.tableData=t.rows,e.pagination.total=t.rows.length,e.busiYear=t.rows[0].busiYear,e.prodYear=t.rows[0].prodYear,e.oldDataRow=JSON.parse(JSON.stringify(t.rows)),e.handleUnitParse()}))},handleUnitParse:function(){var e=this,t=[],a=JSON.parse(JSON.stringify(this.oldDataRow))||[];a.forEach((function(a){var o=a;o.totalWeight=(o.totalWeight/e.weightUnit).toFixed(2),t.push(o)})),console.log(t),this.tableData=t},handleQuery:function(){var e=this;console.log(this.queryData);var t=Object(l["a"])(Object(l["a"])({},this.queryData),{},{billBeginDate:this.billDates[0],billEndDate:this.billDates[1]});this.$apis.bpm.lossReportApply.query(t).then((function(t){e.tableData=t.rows,e.pagination.total=t.rows.length,e.oldDataRow=JSON.parse(JSON.stringify(t.rows)),e.loading=!1,e.handleUnitParse()}))},onEdit:function(e){this.$refs.editModalRef.show(m.a.cloneDeep(e))},onDel:function(){var e=this,t=this.$createElement;!this.selectedRows||this.selectedRows.length<=0?this.$message.error("请选择一条数据再删除"):this.$confirm({title:"是否执行该操作?",content:function(){return t("div",{style:"color:red;"},["是否确认删除选中的数据，确认请点击'确认'按钮，取消点击'取消'按钮。"])},onOk:function(){e.loading=!0;for(var t=[],a=[],o=0;o<e.selectedRows.length;o++)t.push(e.selectedRows[o].lossReportQtyId),a.push(e.selectedRows[o].auditState);e.$apis.bpm.lossReportApply.onDelete({lossReportQtyIds:t}).then((function(t){t.result?(e.loading=!1,e.onQuery(),e.$message.success("操作成功")):e.$message.error("操作失败,仅未上报和退回状态可删除")}))}})},onReported:function(){var e=this,t=this.$createElement;!this.selectedRows||this.selectedRows.length<=0?this.$message.error("请选择一条数据再上报"):this.$confirm({title:"是否执行该操作?",content:function(){return t("div",{style:"color:red;"},["是否确认操作选中的数据，确认请点击'确认'按钮，取消点击'取消'按钮。"])},onOk:function(){e.loading=!0;for(var t=[],a=[],o=0;o<e.selectedRows.length;o++)t.push(e.selectedRows[o].lossReportQtyId),a.push(e.selectedRows[o].auditState);var r={lossReportQtyIds:t,orgCode:e.userInfo.orgCode,busiYear:e.busiYear};e.$apis.bpm.lossReportApply.onReported(r).then((function(t){t.result?(e.loading=!1,e.onQuery(),e.$message.success("操作成功")):e.$message.error("操作失败，仅未上报状态可操作")}))}})},selectAllEvent:function(e){var t=e.records;this.selectedRows=t},selectRowChange:function(e){var t=e.records;this.selectedRows=t},isSelectTableData:function(e){return(0===(null===e||void 0===e?void 0:e.length)||!e)&&(this.$message.error("请选择一条数据再操作"),!0)},getUserInfoHandler:function(){var e=this;this.$apis.common.user.get({}).then((function(t){e.userInfo=t,e.initBizCode=t.bizCode,e.orgLevelEk=t.orgLevelEk}))}}},g=b,h=Object(u["a"])(g,o,r,!1,null,null,null);t["default"]=h.exports},5530:function(e,t,a){"use strict";a.d(t,"a",(function(){return l}));a("b64b"),a("a4d3"),a("4de4"),a("d3b7"),a("e439"),a("159b"),a("dbb4");function o(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function r(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,o)}return a}function l(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?r(Object(a),!0).forEach((function(t){o(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}}}]);
//# sourceMappingURL=chunk-07ba37d6.408f069d.js.map