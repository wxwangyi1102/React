(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6aee0f1c"],{"1d35":function(e,t,a){},2505:function(e,t,a){"use strict";a("ccae")},4866:function(e,t,a){"use strict";a("1d35")},5530:function(e,t,a){"use strict";a.d(t,"a",(function(){return o}));a("b64b"),a("a4d3"),a("4de4"),a("d3b7"),a("e439"),a("159b"),a("dbb4");function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function n(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?n(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):n(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}},adb9:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ec-container",{attrs:{height:"100%"}},[a("ec-container-header",[a("ec-panel-toolbar",[a("ec-panel-item-left",[a("ec-header",{attrs:{title:"交易衔接量申请",icon:"onetomany","color-code":"003"}})],1),a("ec-panel-item-right",[a("div",[e._v("集中交易年度："+e._s(e.busiYear)+"年")])])],1)],1),a("ec-container-body",[a("ec-panel",{attrs:{auto:!1}},[a("ec-panel-toolbar",[a("ec-query-panel",{attrs:{defaultFold:!0},on:{query:e.init,reset:e.resetHandle},scopedSlots:e._u([{key:"inner",fn:function(){return[a("ec-query-item",{attrs:{label:"单据编号"}},[a("a-input",{attrs:{placeholder:""},model:{value:e.queryItems.billNo,callback:function(t){e.$set(e.queryItems,"billNo",t)},expression:"queryItems.billNo"}})],1),a("ec-query-item",{attrs:{label:"供方单位"}},[a("select-picker",{attrs:{title:"选择单位",lazy:!1,search:!1,fetchData:e.getfetchData},on:{ok:function(t){return e.handlepickerValue(t,"supplyOrgCode")}},model:{value:e.supplyOrgCode_temporary,callback:function(t){e.supplyOrgCode_temporary=t},expression:"supplyOrgCode_temporary"}})],1),a("ec-query-item",{attrs:{label:"需方单位"}},[a("select-picker",{attrs:{title:"选择单位",lazy:!1,search:!1,fetchData:e.getfetchData},on:{ok:function(t){return e.handlepickerValue(t,"demandOrgCode")}},model:{value:e.demandOrgCode_temporary,callback:function(t){e.demandOrgCode_temporary=t},expression:"demandOrgCode_temporary"}})],1),a("ec-query-item",{attrs:{label:"烟叶类型"}},[a("a-cascader",{attrs:{options:e.tabaccoTypeOptions,"change-on-select":"",placeholder:""},model:{value:e.queryItems.leafTypeCode,callback:function(t){e.$set(e.queryItems,"leafTypeCode",t)},expression:"queryItems.leafTypeCode"}})],1)]},proxy:!0}])},[a("ec-query-item",{attrs:{label:"业务类型"}},[a("a-cascader",{attrs:{options:e.businessTypeOptions,placeholder:"请选择"},model:{value:e.queryItems.apprTypeCode,callback:function(t){e.$set(e.queryItems,"apprTypeCode",t)},expression:"queryItems.apprTypeCode"}})],1),a("ec-query-item",{attrs:{label:"状态"}},[a("a-select",{attrs:{showSearch:"","allow-clear":"",placeholder:"请选择"},model:{value:e.queryItems.circleSate,callback:function(t){e.$set(e.queryItems,"circleSate",t)},expression:"queryItems.circleSate"}},e._l(e.StatesOptions,(function(t){return a("a-select-option",{key:t.value},[e._v(" "+e._s(t.label)+" ")])})),1)],1),a("ec-query-item",{staticClass:"org",attrs:{label:"计量单位"}},[a("a-select",{attrs:{"allow-clear":"",placeholder:"请选择"},model:{value:e.unitstr,callback:function(t){e.unitstr=t},expression:"unitstr"}},e._l(e.unitstrOptions,(function(t){return a("a-select-option",{key:t.id},[e._v(" "+e._s(t.name)+" ")])})),1)],1)],1),a("ec-divider")],1),a("ec-panel-item",[e.islock?a("ec-panel-item-left",[a("a-button",{attrs:{type:"primary"},on:{click:function(t){return t.stopPropagation(),e.handleAdd(t)}}},[e._v("新增")]),a("a-button",{on:{click:e.handleDelete}},[e._v("删除")]),a("a-button",{on:{click:e.handleReport}},[e._v("上报")])],1):e._e()],1),a("ec-panel-body",[a("ec-v-layout",[a("ec-v-item",[a("ec-table",{ref:"xTable1",attrs:{height:e.height?"300":"200","show-overflow":"","header-align":"center",align:"center",data:e.tableData,pagination:e.pagination},on:{"page-action":e.queryPagination,"checkbox-all":e.selectRowChange,"checkbox-change":e.selectRowChange,"cell-click":e.onDetailsList}},[a("ec-table-col",{attrs:{type:"checkbox",width:"60",align:"center"}}),a("ec-table-col",{attrs:{type:"seq",title:"序号",width:"50"}}),a("ec-table-col",{attrs:{field:"billNo",title:"单据编号"}}),a("ec-table-col",{attrs:{field:"supplyOrgName",title:"供方单位"}}),a("ec-table-col",{attrs:{field:"demandOrgName",title:"需方单位"}}),a("ec-table-col",{attrs:{field:"circleSate",title:"状态"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(e._s(e.onGetstatusLaael(a.circleSate)))]}}])}),a("ec-table-col",{attrs:{title:"操作",width:"190",align:"right"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[e.islock?a("a-button",{attrs:{type:"link"},on:{click:function(t){return t.stopPropagation(),e.handleAdd(r,"update")}}},[e._v("编辑")]):e._e(),a("a-button",{attrs:{type:"link"},on:{click:function(t){return t.stopPropagation(),e.handleAdd(r,"view")}}},[e._v("详情")])]}}])})],1)],1),a("ec-v-item",[a("h2",{staticClass:"details-bg"},[e._v("详细")]),a("ec-table",{ref:"xTable2",attrs:{height:"216","show-overflow":"","header-align":"center",align:"center","show-footer":"","cell-style":e.cellStyle,data:e.FocusDealDetailData,"footer-method":e.footerMethod}},[a("ec-table-col",{attrs:{type:"seq",title:"序号",width:"50"}}),a("ec-table-col",{attrs:{field:"apprTypeCode",title:"业务类型"}}),a("ec-table-col",{attrs:{field:"leafTypeName",title:"烟叶类型"}}),a("ec-table-col",{attrs:{field:"leafFormName",title:"烟叶形态"}}),a("ec-table-col",{attrs:{field:"supplyWeight",title:"供方提报量"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(e._s(e.handlerWeightcalculate(a.supplyWeight,e.unitstr)))]}}])}),a("ec-table-col",{attrs:{field:"demandWeight",title:"需方提报量"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(e._s(e.handlerWeightcalculate(a.demandWeight,e.unitstr)))]}}])}),a("ec-table-col",{attrs:{field:"finalWeight",title:"总公司审核量"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(e._s(e.handlerWeightcalculate(a.finalWeight,e.unitstr)))]}}])}),a("ec-table-col",{attrs:{title:"操作",width:"190"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("a-button",{attrs:{type:"link"},on:{click:function(t){return e.viewOpenDetails(r)}}},[e._v("详情")])]}}])})],1)],1)],1)],1)],1),a("admin-org-manage-edit",{ref:"editRef",model:{value:e.childrenData,callback:function(t){e.childrenData=t},expression:"childrenData"}})],1)],1)},n=[],o=a("2909"),i=a("c7eb"),l=a("1da1"),s=a("5530"),c=(a("6198"),a("6fc0")),u=a.n(c),d=(a("d3b7"),a("d81d"),a("159b"),a("a9e3"),a("caad"),a("7db0"),function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ec-drawer",{staticClass:"ec-draw-form",attrs:{title:"新增",visible:e.visible,size:"large"},on:{close:e.cancel}},[a("ec-container",{attrs:{height:"auto",fixed:"top bottom","color-code":"007"}},[a("ec-container-header",[a("ec-panel-toolbar",[a("ec-panel-item-left",[e._v(" 主信息 ")]),a("ec-panel-item-right",[a("code",[e._v("集中交易年度："+e._s(e.busiYear)+"年计量单位："+e._s("50"===e.unitstr?"担":"万担"))])])],1)],1),a("ec-container-body",[a("ec-panel",[a("ec-panel-item",[a("ec-form",{ref:"ruleForm2",attrs:{model:e.ruleForm,rules:e.rules}},[a("a-row",{attrs:{type:"flex",gutter:12}},[a("a-col",{attrs:{span:6}},[a("a-form-model-item",{attrs:{label:"单据编号"}},[a("a-input",{attrs:{placeholder:"保存后自动生成",autocomplete:"off",disabled:""},model:{value:e.ruleForm.billNo,callback:function(t){e.$set(e.ruleForm,"billNo",t)},expression:"ruleForm.billNo"}})],1)],1),a("a-col",{attrs:{span:6}},[a("a-form-model-item",{attrs:{label:"供方单位",prop:"supplyOrgCode"}},[a("select-picker",{attrs:{title:"选择单位",lazy:!1,search:!1,disabled:"view"===e.isbuttonshow,placeholder:"请输入供方单位",fetchData:e.getfetchData},on:{ok:e.orgValueChange},model:{value:e.ruleForm.supplyOrgCode,callback:function(t){e.$set(e.ruleForm,"supplyOrgCode",t)},expression:"ruleForm.supplyOrgCode"}})],1)],1),a("a-col",{attrs:{span:6}},[a("a-form-model-item",{attrs:{label:"需方单位",prop:"demandOrgCode"}},[a("select-picker",{attrs:{title:"选择单位",lazy:!1,search:!1,disabled:"view"===e.isbuttonshow,placeholder:"请输入需方单位",fetchData:e.getfetchData},on:{ok:e.orgValueChange},model:{value:e.ruleForm.demandOrgCode,callback:function(t){e.$set(e.ruleForm,"demandOrgCode",t)},expression:"ruleForm.demandOrgCode"}})],1)],1),a("a-col",{attrs:{span:6}},[a("a-form-model-item",{attrs:{label:"录入日期",prop:"demandCreateDate"}},[a("a-date-picker",{attrs:{"show-time":"",disabled:"view"===e.isbuttonshow,format:"YYYY-MM-DD","value-format":"YYYY-MM-DD"},model:{value:e.ruleForm.demandCreateDate,callback:function(t){e.$set(e.ruleForm,"demandCreateDate",t)},expression:"ruleForm.demandCreateDate"}})],1)],1)],1)],1)],1),a("ec-panel-item",[a("a-row",{attrs:{type:"flex",gutter:6}},[a("a-col",{attrs:{span:9}},[a("span",{staticStyle:{color:"blue"}},[e._v("明细")]),"view"!==e.isbuttonshow?a("vxe-toolbar",{scopedSlots:e._u([{key:"buttons",fn:function(){return[a("div",{staticClass:"span-color"},[a("a-button",{staticStyle:{border:"0"},attrs:{icon:"plus"},on:{click:e.handleAddRow}},[e._v("新增")])],1)]},proxy:!0}],null,!1,4139288976)}):e._e(),a("vxe-table",{ref:"detailTable",attrs:{border:"",stripe:"","show-footer":"","show-overflow":"",height:"view"===e.isbuttonshow?"450":"400","highlight-hover-row":"","header-align":"center",align:"center","cell-style":e.cellStyleleft,"export-config":{},"footer-method":e.footerMethod,data:e.DetailData}},[a("vxe-column",{attrs:{width:"60",type:"seq",title:"序号",align:"center"}}),a("vxe-column",{attrs:{title:"业务类型",field:"apprTypeCode"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(e.onGetapprTypeCode(a.apprTypeCode)))]}}])}),a("vxe-column",{attrs:{title:"烟叶类型",field:"leafTypeCode"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(e.onGetleafTypeCode(a.leafTypeCode)))]}}])}),a("vxe-column",{attrs:{title:"交易衔接量",field:"weight"}}),"view"!==e.isbuttonshow?a("vxe-column",{attrs:{title:"操作",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("a-button",{attrs:{type:"link"},on:{click:function(t){return e.handleEditRow(r)}}},[e._v("编辑")]),a("a-button",{attrs:{type:"link"},on:{click:function(t){return e.handleDeleteRow(r)}}},[e._v("删除")])]}}],null,!1,1645878676)}):e._e()],1)],1),a("a-col",{attrs:{span:15}},[a("span",{staticStyle:{color:"blue"}},[e._v("基地单元明细")]),a("vxe-table",{ref:"utilTable",attrs:{border:"",stripe:"","show-footer":"","show-overflow":"",height:"450","highlight-hover-row":"","header-align":"center",align:"center","cell-style":e.cellStyle,"footer-method":e.footerMethod,data:e.BaseDealDetailList,"edit-config":"view"!==e.isbuttonshow?{trigger:"click",mode:"row"}:{}}},[a("vxe-column",{attrs:{width:"60",type:"seq",title:"序号",align:"center"}}),a("vxe-column",{attrs:{title:"基地单元",field:"baseCellName"}}),a("vxe-column",{attrs:{title:"烟叶类型",field:"leafTypeName"}}),a("vxe-column",{attrs:{title:"计划量",field:"limitWeight"}}),a("vxe-column",{attrs:{title:"交易衔接量",field:"weight","edit-render":{name:"input",immediate:!0}},scopedSlots:e._u([{key:"edit",fn:function(t){var r=t.row;return[a("a-input-number",{attrs:{type:"text",min:0},on:{blur:function(t){return e.onValueChange(r)}},model:{value:r.weight,callback:function(t){e.$set(r,"weight",t)},expression:"row.weight"}})]}},{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.weight)+" ")]}}])})],1)],1)],1)],1)],1),a("a-modal",{attrs:{width:"26%",title:"新增明细数据"},scopedSlots:e._u([{key:"footer",fn:function(){return[a("a-button",{attrs:{type:"primary"},on:{click:e.handleSubmit}},[e._v("保存")]),a("a-button",{on:{click:e.cancelDetails}},[e._v("关闭")])]},proxy:!0}]),model:{value:e.open,callback:function(t){e.open=t},expression:"open"}},[a("ec-form",{ref:"ruleForm1",attrs:{model:e.formData,rules:e.formDataRules}},[a("a-row",{attrs:{type:"flex"}},[a("a-col",{attrs:{span:24}},[a("a-form-model-item",{attrs:{prop:"apprTypeCode",label:"业务类型"}},[a("a-select",{attrs:{allowClear:"",placeholder:"请选择卷烟档次"},model:{value:e.formData.apprTypeCode,callback:function(t){e.$set(e.formData,"apprTypeCode",t)},expression:"formData.apprTypeCode"}},e._l(e.apprTypeCodeTptions,(function(t){return a("a-select-option",{key:t.value,attrs:{value:t.value}},[e._v(e._s(t.label))])})),1)],1)],1),a("a-col",{attrs:{span:24}},[a("a-form-model-item",{attrs:{prop:"leafTypeCode",label:"烟叶类型"}},[a("a-select",{attrs:{allowClear:"",placeholder:"请选择卷烟档次"},model:{value:e.formData.leafTypeCode,callback:function(t){e.$set(e.formData,"leafTypeCode",t)},expression:"formData.leafTypeCode"}},e._l(e.leafTypeCodeOtions,(function(t){return a("a-select-option",{key:t.leafTypeCode},[e._v(e._s(t.leafTypeName))])})),1)],1)],1),a("a-col",{attrs:{span:24}},[a("a-form-model-item",{attrs:{prop:"remark1",label:"烟叶形态"}},[a("a-input",{attrs:{disabled:""},model:{value:e.remark1,callback:function(t){e.remark1=t},expression:"remark1"}})],1)],1),a("a-col",{attrs:{span:24}},[a("a-form-model-item",{attrs:{prop:"weight",label:"交易衔接量"}},[a("a-input",{attrs:{placeholder:"请输入交易衔接量"},model:{value:e.formData.weight,callback:function(t){e.$set(e.formData,"weight",t)},expression:"formData.weight"}})],1)],1)],1)],1)],1)],1),a("ec-container-footer",{attrs:{fixed:""}},[a("a-space",["add"===e.isbuttonshow?a("a-button",{attrs:{type:"primary"},on:{click:function(t){return e.handleSave("save")}}},[e._v("保存并新增")]):e._e(),"view"!==e.isbuttonshow?a("a-button",{attrs:{type:"primary"},on:{click:e.handleSave}},[e._v("保存")]):e._e(),a("a-button",{on:{click:e.cancel}},[e._v("取消")])],1)],1)],1)],1)}),p=[],f=(a("a434"),a("6ea6")),h=a("fa7d"),y=a("c1df"),m=a.n(y),b={name:"applicationEdit",props:{type:{type:String,default:"0"},parentDefaultData:{type:Object,default:function(){}}},components:{SelectPicker:u.a},data:function(){return{orgType:null,orgCode:null,busiYear:null,unitstr:null,asFocusDealMasId:null,isbuttonshow:"add",remark1:"原烟",ratio60:!0,open:!1,isedit:!1,iscreatestatus:!0,visible:!1,treeData:null,DetailData:[],BaseDealDetailList:[],ruleForm:{demandCreateDate:m()(new Date,"YYYY-MM-DD")},formData:{apprTypeCode:"HT1101",leafTypeCode:"10"},formDataRules:{weight:{required:!0,message:"请输入交易核定量"}},rules:{supplyOrgCode:{required:!0,message:"请先选择供方单位"},demandOrgCode:{required:!0,message:"请先选择需方单位"}},apprTypeCodeTptions:[{label:"工商普通购销",value:"HT1101"},{label:"出口备货普通购销",value:"HT1201"}],leafTypeCodeOtions:[]}},computed:{_apis:function(){return this.$apis.centre.apply}},created:function(){var e=this;this._apis.getLeafTypeOptions({}).then((function(t){e.leafTypeCodeOtions=t.rows}))},methods:{moment:m.a,show:function(e,t){this.refresh();var a=t||{},r=a.orgType,n=a.orgCode,o=a.busiYear,i=a.unitstr,l=a.res,s=a.billNo,c=a.demandOrgCode,u=a.supplyOrgCode,d=a.pcAsFocusDealDetailList,p=a.pcAsFocusBaseDealDetailList,f=a.asFocusDealMasId,y=a.createDate,b=a.treeData;if("add"===e)"I"===r?this.ruleForm.demandOrgCode=n:"O"===r&&(this.ruleForm.supplyOrgCode=n),null!==l&&void 0!==l&&l.ruleForm&&(this.ruleForm=l.ruleForm,this.DetailData=l.DetailData,this.BaseDealDetailList=l.BaseDealDetailList),this.iscreatestatus=!0;else{this.ratio60=!1,this.ruleForm={billNo:s,supplyOrgCode:u,demandOrgCode:c},this.ruleForm.demandCreateDate=m()(y,"YYYY-MM-DD");var g=Object(h["c"])(["weight"],d,i,"/"),v=Object(h["c"])(["weight"],p,i,"/");this.DetailData=g,this.BaseDealDetailList=v,this.iscreatestatus=!1}this.treeData=b,this.orgType=r,this.orgCode=n,this.busiYear=o,this.unitstr=i,this.isbuttonshow=e,this.asFocusDealMasId=f,this.visible=!0},handleAddRow:function(){this.formData={apprTypeCode:"HT1101",leafTypeCode:"10"},this.isedit=!1,this.open=!0},handleDeleteRow:function(e){var t=this;this.DetailData.forEach((function(a,r){a._X_ID===e._X_ID&&t.DetailData.splice(r,1)}))},handleEditRow:function(e){this.formData=Object(s["a"])({},e),this.isedit=!0,this.open=!0},handleSubmit:function(){var e=this;this.$refs.ruleForm1.validate().then((function(t){if(t){var a=Object(s["a"])({},e.formData);a.leafTypeName=e.onGetleafTypeCode(a.leafTypeCode),e.isedit?e.DetailData=e.DetailData.map((function(e){return e._X_ID===a._X_ID?a:e})):e.DetailData.push(a),e.open=!1}else e.$message.error("验证未通过")}))},cancelDetails:function(){this.open=!1},handleSave:function(e){var t=this;this.$refs.ruleForm2.validate().then((function(a){if(a){$ec.showLoading();var r="prov",n=Object(h["c"])(["weight"],t.DetailData,t.unitstr,"*"),o=Object(h["c"])(["weight"],t.BaseDealDetailList,t.unitstr,"*"),i=Object(s["a"])(Object(s["a"])({orgType:r},t.ruleForm),{},{pcAsFocusDealDetailList:n,pcAsFocusBaseDealDetailList:o,asFocusDealMasId:t.asFocusDealMasId});i.demandCreateDate&&(i.supplyCreateDate=i.demandCreateDate),"I"===t.orgType?delete i.supplyCreateDate:"O"===t.orgType&&delete i.demandCreateDate,t._apis.add(i).then((function(a){a.ifCanSave?(t.$message.success("操作成功！"),"save"!==e&&(t.$emit("input","refresh"),t.visible=!1)):t.$message.error(a.returnMessage)})).finally((function(){$ec.hideLoading()}))}else t.$message.error("验证未通过")}))},cancel:function(e){var t=this,a=this.$createElement;if(e&&this.iscreatestatus)return this.$confirm({title:"是否执行该操作?",content:function(){return a("div",{style:"color:red;"},["是否保存新增数据？确认请点击'确认'按钮，取消点击'取消'按钮。"])},onOk:function(){var e={};e.ruleForm=t.ruleForm,e.DetailData=t.DetailData,e.BaseDealDetailList=t.BaseDealDetailList,t.$emit("input",e),t.visible=!1},onCancel:function(){t.$emit("input",{}),t.visible=!1}}),!1;this.visible=!1},onGetapprTypeCode:function(e){var t,a=Object(o["a"])(this.apprTypeCodeTptions);return null===(t=a.find((function(t){return t.value===e})))||void 0===t?void 0:t.label},onGetleafTypeCode:function(e){var t,a=Object(o["a"])(this.leafTypeCodeOtions);return null===(t=a.find((function(t){return t.value===e})))||void 0===t?void 0:t.label},orgValueChange:function(){var e=this,t=this.ruleForm,a=t.supplyOrgCode,r=t.demandOrgCode;if(a&&r){if(a!==this.orgCode&&r!==this.orgCode)return void this.$message.error("供需方单位必须一方为登陆单位");$ec.showLoading();var n={busiYear:this.busiYear,supplyOrgCode:a&&Array.isArray(a)?a[0]:a,demandOrgCode:r&&Array.isArray(r)?r[0]:r};this._apis.querybaseList(n).then((function(t){var a;e.BaseDealDetailList=Object(o["a"])(null===t||void 0===t||null===(a=t.rows)||void 0===a?void 0:a.pcAsFocusBaseDealDetailList)})).finally((function(){$ec.hideLoading()}))}},onValueChange:function(e){this.ratio60=!1;var t=e.limitWeight,a=e.weight;if(t){var r=a/t;r<=.6&&0!==Number(a)&&(this.ratio60=!0,this.$message.error("申请量必须大于大于收购规模量60%，请确认！"))}else this.$message.error("当前计划量不满足条件,请先设定计划量!")},refresh:function(){this.ruleForm={},this.DetailData=[],this.BaseDealDetailList=[],this.orgType=null,this.orgCode=null,this.busiYear=null,this.unitstr=null,this.asFocusDealMasId=null,this.isbuttonshow="add"},footerMethod:function(e){var t=this,a=e.columns,r=e.data;return[a.map((function(e,a){return 1===a?"合计":["num","lvl"].includes(e.property)?t.sumNum(r,e.property):null}))]},sumNum:function(e,t){var a=0;return e.forEach((function(e){a+=Number(e[t])})),a},getfetchData:function(){var e=this;return new Promise((function(t){t(Object(f["cloneDeep"])(e.treeData))}))},handlerWeightcalculate:function(e,t){return e/t},cellStyleleft:function(e){var t=e.$columnIndex;if(3===t)return{textAlign:"right"}},cellStyle:function(e){var t=e.$columnIndex;if(4===t||3===t)return{textAlign:"right"}}}},g=b,v=(a("2505"),a("2877")),D=Object(v["a"])(g,d,p,!1,null,"a7c0d23a",null),k=D.exports,C={name:"AdminOrgManage",components:{AdminOrgManageEdit:k,SelectPicker:u.a},data:function(){return{supplyOrgCode_temporary:null,demandOrgCode_temporary:null,demandOrgCode:null,supplyOrgCode:null,treeData:null,treeParams:{bizCode:"11000001000000000000",orgTypeEk:"EXPORT,INDUSTRY,TOBACCO",orgLevelEk:"3",paramMap:{isCorporation:"1"}},orgType:"",orgCode:"",appCode:"",unitstr:"50",height:!0,islock:!0,records:[],businessTypeOptions:[{value:"0",label:"业务类型",children:[{value:"1",label:"购销",children:[{value:"1-1",label:"工商购销",children:[{value:"HT1101",label:"工商普通购销"},{value:"HT1104",label:"基地烟"}]},{value:"1-2",label:"出口备货购销",children:[{value:"HT1201",label:"出口备货普通购销"}]}]}]}],StatesOptions:[{label:"未上报",value:"0"},{label:"省公司退回",value:"2"},{label:"总公司退回",value:"5"},{label:"省公司待确认",value:"1"},{label:"省公司已确认",value:"3"},{label:"总公司待审核",value:"4"},{label:"总公司已审核",value:"6"}],tabaccoTypeOptions:[{value:"10",label:"烤烟"},{value:"20",label:"晾晒烟",children:[{value:"2013",label:"雪茄烟叶"}]}],unitstrOptions:[{name:"担",id:"50"},{name:"万担",id:"500000"}],statusList:[{name:"启用",id:0},{name:"停用",id:1}],childrenData:null,queryItems:{pageNumber:1,pageSize:10,leafTypeCode:["10"],searchType:"cityType",apprTypeCode:null},rules:{},tableData:[],FocusDealDetailData:[],pagination:{pageNumber:1,pageSize:10,total:0}}},computed:{_apis:function(){return this.$apis.centre.apply},appConfig:function(){return this.$store.getters.getAppConfig},busiYear:function(){var e,t;return null===(e=this.$store.getters.getAppConfig)||void 0===e||null===(t=e.yearValueMap)||void 0===t?void 0:t.CENTER_YEAR}},watch:{childrenData:{handler:function(e){"refresh"===e&&this.init()}}},created:function(){this.onGetuserinfo()},methods:{init:function(){var e,t=this;$ec.showLoading(),this.records=[],this.FocusDealDetailData=[];var a=Object(s["a"])({},this.queryItems);a.orgCode=this.orgCode,a.busiYear=this.busiYear,!a.apprTypeCode&&delete a.apprTypeCode,a.apprTypeCode&&0!==a.apprTypeCode.length&&(a.apprTypeCode=a.apprTypeCode.reverse()[0]),a.leafTypeCode&&0!==(null===(e=a.leafTypeCode)||void 0===e?void 0:e.length)&&(a.leafTypeCode=a.leafTypeCode.reverse()[0]),this._apis.query(a).then((function(e){t.tableData=e.rows,t.pagination.total=e.totalRows})).finally((function(){$ec.hideLoading()}))},resetHandle:function(){this.unitstr="50",this.demandOrgCode="",this.supplyOrgCode="",this.queryItems={pageNumber:1,pageSize:10,demandOrgCode:"",supplyOrgCode:"",circleSate:"",billNo:"",leafTypeCode:["10"],searchType:"cityType",apprTypeCode:""},this.init()},handleAdd:function(e,t){var a=this;return Object(l["a"])(Object(i["a"])().mark((function r(){var n,o,l,c;return Object(i["a"])().wrap((function(r){while(1)switch(r.prev=r.next){case 0:if($ec.showLoading(),"update"!==t){r.next=14;break}if(n=e.circleSate,"0"!==n&&"2"!==n&&"5"!==n){r.next=10;break}return r.next=6,a.onqueryGetbaselist(e);case 6:o=r.sent,a.$refs.editRef.show("update",Object(s["a"])(Object(s["a"])({},o),{},{orgType:a.orgType,treeData:a.treeData})),r.next=11;break;case 10:a.$message.error("当前状态不允许修改");case 11:$ec.hideLoading(),r.next=25;break;case 14:if("view"!==t){r.next=22;break}return r.next=17,a.onqueryGetbaselist(e);case 17:l=r.sent,a.$refs.editRef.show("view",Object(s["a"])(Object(s["a"])({},l),{},{orgType:a.orgType,treeData:a.treeData})),$ec.hideLoading(),r.next=25;break;case 22:c={orgCode:a.orgCode,orgType:a.orgType,busiYear:a.busiYear,unitstr:a.unitstr,res:a.childrenData,treeData:a.treeData},a.$refs.editRef.show("add",c),$ec.hideLoading();case 25:case"end":return r.stop()}}),r)})))()},handleReport:function(){if(0===this.records.length)return this.$message.error("请选中数据后再进行上报!"),!1;this.$message.error("请对退回单据进行编辑保存后，再上报！")},handleDelete:function(){if(0===this.records.length)return this.$message.error("请选中数据后再进行删除!"),!1;var e=this.records.some((function(e){return"1"===e.circleSate||"3"===e.circleSate||"4"===e.circleSate||"6"===e.circleSate}));if(e)this.$message.error("该交易衔接量已上报，不允许删除！");else{var t=this.records.map((function(e){return e.asFocusDealMasId}))||[];this._apis.delete({asFocusDealMasIds:t}).then((function(){}))}},queryPagination:function(e,t){this.queryItems.pageNumber=e,this.queryItems.pageSize=t,this.init()},selectRowChange:function(e){var t=e.records;this.records=t},handlepickerValue:function(e,t){var a=e.selectOption.val;this.queryItems[t]=a},onDetailsList:function(e){var t=this,a=e.row,r={orgType:"city",billNo:a.billNo,busiYear:this.busiYear};this._apis.querySelectRows(r).then((function(e){t.FocusDealDetailData=e.rows||[]}))},viewOpenDetails:function(e){var t=e.asFocusDealMasId,a={asFocusDealMasId:t,busiYear:this.busiYear};this._apis.queryDetails(a).then((function(e){console.log(e)}))},onqueryGetbaselist:function(e){var t=this;return Object(l["a"])(Object(i["a"])().mark((function a(){var r,n,o;return Object(i["a"])().wrap((function(a){while(1)switch(a.prev=a.next){case 0:return r=e.supplyOrgCode,n=e.demandOrgCode,o={supplyOrgCode:r,demandOrgCode:n,busiYear:t.busiYear},a.next=4,t._apis.querybaseList(o);case 4:return a.abrupt("return",a.sent);case 5:case"end":return a.stop()}}),a)})))()},sumNum:function(e,t){var a=0;return e.forEach((function(e){a+=Number(e[t])})),a},treeGetlist:function(){var e=this;return Object(l["a"])(Object(i["a"])().mark((function t(){var a,r,n;return Object(i["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r={pkey:"parentOrgUniqueCode",title:"orgName",key:"orgUniqueCode",children:"children"},e.treeParams.bizCode=null===(a=e.appConfig)||void 0===a?void 0:a.bizCode,t.next=4,e._apis.getreeDate(e.treeParams);case 4:n=t.sent,e.treeData=Object(f["treeFormatList"])(null===n||void 0===n?void 0:n.rows,r);case 6:case"end":return t.stop()}}),t)})))()},onGetuserinfo:function(){var e=this;return Object(l["a"])(Object(i["a"])().mark((function t(){var a,r,n;return Object(i["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$apis.bpm.executionEnter.getOrgCode({});case 2:return a=t.sent,r=a.orgCode,n=a.orgTypeEk,e.orgCode=r,e.orgType="TOBACCO"===n?"O":"I",e.treeParams.bizYear=e.busiYear,t.next=10,e.treeGetlist();case 10:e.init();case 11:case"end":return t.stop()}}),t)})))()},footerMethod:function(e){var t=this,a=e.columns,r=e.data;return[a.map((function(e,a){return 1===a?"合计":["demandWeight","supplyWeight","finalWeight"].includes(e.property)?t.sumNum(r,e.property):null}))]},getfetchData:function(){var e=this;return new Promise((function(t){var a=Object(f["cloneDeep"])(e.treeData);t(a)}))},onGetstatusLaael:function(e){var t,a=Object(o["a"])(this.StatesOptions);return null===(t=a.find((function(t){return t.value===e})))||void 0===t?void 0:t.label},handlerWeightcalculate:function(e,t){return e/t},cellStyle:function(e){var t=e.$columnIndex;if(4===t||5===t||6===t)return{textAlign:"right"}}}},w=C,O=(a("4866"),Object(v["a"])(w,r,n,!1,null,"71310881",null));t["default"]=O.exports},ccae:function(e,t,a){},f2be:function(e,t,a){"use strict";a.d(t,"f",(function(){return s})),a.d(t,"g",(function(){return c})),a.d(t,"a",(function(){return u})),a.d(t,"h",(function(){return d})),a.d(t,"b",(function(){return p})),a.d(t,"e",(function(){return f})),a.d(t,"d",(function(){return h})),a.d(t,"c",(function(){return y}));var r=a("2909"),n=(a("d3b7"),a("159b"),a("ac16"),a("f8c9"),a("4de4"),a("4ec9"),a("3ca3"),a("ddb0"),a("d9e2"),a("a630"),a("6062"),a("0644")),o=a.n(n),i=a("60ed"),l=a.n(i);function s(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{pkey:"pkey",key:"key",title:"title",children:"children"},a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{pkey:"pkey",children:"children"};if(!Array.isArray(e))return console.error("请传入一个list数组");e.forEach((function(r){var n=r[a.pkey];n&&e.forEach((function(e){var i=e;if(t)for(var l in t)String(l)!==String(t[l])&&(Array.isArray(i[t[l]])||i[t[l]]instanceof Object?i[l]=o()(i[t[l]]):i[l]=i[t[l]],Reflect.deleteProperty(i,t[l]));i&&i.key===n&&(i[a.children]=i[a.children]||[],i[a.children].push(r))}))}));var r=e.every((function(e){return e[t.pkey]}));return r?console.error("至少有一个根节点pid为null数组或传入一个空数组",e):e.filter((function(e){return!e[a.pkey]}))}function c(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{pkey:"pkey",key:"key",title:"title"},a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"children";if(!Array.isArray(e))return console.error("请传入一个tree数组");var n=[],i=o()(e),l=Object(r["a"])(i);while(l.length){var s=l.shift(),c=s[a];if(c&&l.push.apply(l,Object(r["a"])(c)),t)for(var u in t)String(u)!==String(t[u])&&(Array.isArray(s[t[u]])||s[t[u]]instanceof Object?s[u]=o()(s[t[u]]):s[u]=s[t[u]],Reflect.deleteProperty(s,t[u]));Reflect.deleteProperty(s,a),n.push(s)}return 0===n.length?e:n}function u(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){return!0},a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{pkey:"pkey",key:"key",title:"title"};if(!Array.isArray(e))return console.error("请传入一个tree数组");var r=o()(e),n=c(r,a);return n.filter((function(e){return!!t(e)}))}function d(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"key";if(!Array.isArray(e))return console.error("请传入一个数组");if(!e||0===e.length||!l()(e[0]))return Array.from(new Set(e));var a=new Map;return e.forEach((function(e){if(!e[t])throw new Error("prop参数不匹配，在节点找不到对应的值");a.set(e[t],e)})),0!==a.size?Array.from(a.values()):void 0}function p(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{pkey:"pkey",key:"key",title:"title"},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{pkey:"pkey",key:"key"};if(!Array.isArray(e))return console.error("请传入一个tree数组");var n=new Set,o=c(e,a);function i(e,t){e.forEach((function(a){String(a[r.key])===String(t)&&(n.add(a[r.key]),a.isLeaf&&n.delete(a[r.key]),i(e,a[r.pkey]))}))}return i(o,t),Array.from(n).reverse().filter((function(e){return e!==t}))}function f(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"key",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{pkey:"pkey",key:"key",title:"title"},n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{pkey:"pkey",key:"key"};if(!Array.isArray(e))return console.error("请传入一个tree数组");var o=new Set,i=c(e,r);function l(e,t){e.forEach((function(r){String(r[n.key])===String(t)&&(o.add(r[a]),l(e,r[n.pkey]))}))}return l(i,t),Array.from(o).reverse()}function h(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"key",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{pkey:"pkey",key:"key",title:"title"};if(!Array.isArray(e))return console.error("请传入一个tree数组");var n=c(e,r),o=n.filter((function(e){return String(e[a])===String(t)}));return Array.isArray(o)&&1===o.length?o[0]:null}function y(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{key:"key",label:"title"};if(!Array.isArray(e))return console.error("请传入一个字典数组");var r=e.filter((function(e){return String(e[a.key])===String(t)}));return r&&0!==r.length?r[0][a.label]:""}},fa7d:function(e,t,a){"use strict";a.d(t,"c",(function(){return o})),a.d(t,"a",(function(){return i}));var r=a("5530"),n=(a("2909"),a("d3b7"),a("b64b"),a("ddb0"),a("13d5"),a("4ec9"),a("3ca3"),a("2b3d"),a("9861"),a("d81d"),a("caad"),a("2532"),a("a9e3"),a("f2be"));a.d(t,"b",(function(){return n["c"]}));Object.prototype.toString,function(){document.addEventListener}(),function(){document.removeEventListener}();var o=function(e,t,a,n){return null===t||void 0===t?void 0:t.map((function(t){var o=Object(r["a"])({},t);for(var i in t)e.includes(i)&&("/"===n?o[i]/=a:o[i]*=a);return o}))},i=function(e,t){if(e){var a=document.createElement("a");a.style.display="none",a.href=e,a.setAttribute("download",t),document.body.appendChild(a),a.click(),document.body.removeChild(a)}}}}]);
//# sourceMappingURL=chunk-6aee0f1c.3866f81a.js.map