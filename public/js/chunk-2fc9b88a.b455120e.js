(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2fc9b88a"],{4593:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ec-container",{attrs:{height:"100%",title:"交易衔接量申请",icon:"onetomany","color-code":"001"}},[a("ec-container-body",[a("ec-panel",{attrs:{auto:!1}},[a("ec-panel-header",[a("ec-panel-item-left",{staticClass:"title"},[e._v("主信息")]),a("ec-panel-item-right",{staticStyle:{"font-size":"16px"}},[a("span",{staticClass:"topSpan"},[e._v("业务年度: "+e._s(e.busiYear))]),a("span",{staticClass:"topSpan"},[e._v("计量单位: 担")])])],1),a("ec-panel-toolbar",[a("ec-panel-item",[a("ec-form",{ref:"modelAddForm",attrs:{model:e.ruleForm,rules:e.rules}},[a("a-row",{attrs:{type:"flex",gutter:12}},[a("a-col",{attrs:{span:6}},[a("a-form-model-item",{attrs:{label:"申请日期",prop:"applyDate"}},[a("a-input",{attrs:{disabled:""},model:{value:e.ruleForm.applyDate,callback:function(t){e.$set(e.ruleForm,"applyDate",t)},expression:"ruleForm.applyDate"}})],1)],1),a("a-col",{attrs:{span:6}},[a("a-form-model-item",{attrs:{label:"业务类型",prop:"apprTypeCode"}},[a("a-cascader",{attrs:{options:e.apprTypeCodeList,placeholder:"请选择"},on:{change:e.handlerApprTypeChange},model:{value:e.ruleForm.apprTypeCode,callback:function(t){e.$set(e.ruleForm,"apprTypeCode",t)},expression:"ruleForm.apprTypeCode"}})],1)],1),a("a-col",{attrs:{span:6}},[a("a-form-model-item",{attrs:{label:"新烟/陈烟",prop:"newOrOldLeaf"}},[a("ec-select",{attrs:{allowClear:"",disabled:e.isapprTypeCodeOk},model:{value:e.ruleForm.newOrOldLeaf,callback:function(t){e.$set(e.ruleForm,"newOrOldLeaf",t)},expression:"ruleForm.newOrOldLeaf"}},e._l(e.newOrOldLeafList,(function(t){return a("a-select-option",{key:t.enumKey},[e._v(" "+e._s(t.name)+" ")])})),1)],1)],1),a("a-col",{attrs:{span:6}},[a("a-form-model-item",{attrs:{label:"操作类型",prop:"operateType"}},[a("ec-select",{attrs:{showSearch:"",allowClear:"",placeholder:"请选择"},model:{value:e.ruleForm.operateType,callback:function(t){e.$set(e.ruleForm,"operateType",t)},expression:"ruleForm.operateType"}},e._l(e.operateTypeList,(function(t){return a("a-select-option",{key:t.enumKey},[e._v(" "+e._s(t.name)+" ")])})),1)],1)],1),a("a-col",{attrs:{span:6}},[a("a-form-model-item",{attrs:{label:"是否转为结转业务",prop:"isCheckBusi"}},[a("a-radio-group",{attrs:{name:"radioGroup"},model:{value:e.ruleForm.isCheckBusi,callback:function(t){e.$set(e.ruleForm,"isCheckBusi",t)},expression:"ruleForm.isCheckBusi"}},[a("a-radio",{attrs:{value:"0"}},[e._v(" 否 ")]),a("a-radio",{attrs:{value:"1"}},[e._v(" 是 ")])],1)],1)],1),a("a-col",{attrs:{span:6}},[a("a-form-model-item",{attrs:{label:"供方单位",prop:"supplyOrgCode"}},[a("SelectPicker",{attrs:{title:"选择单位",lazy:!1,search:!1,disabled:e.isapprTypeCodeOk,fetchData:e.getfetchData},on:{ok:function(t){return e.handlerGetparentbizCode(t,"PresupplyOrgCode")}},model:{value:e.ruleForm.supplyOrgCode,callback:function(t){e.$set(e.ruleForm,"supplyOrgCode","string"===typeof t?t.trim():t)},expression:"ruleForm.supplyOrgCode"}})],1)],1),e.isapprTypeCodeOk?a("a-col",{attrs:{span:6}},[a("a-form-model-item",{attrs:{label:"-",prop:"baseCellName"}},[a("a-input",{attrs:{type:"text",disabled:""},model:{value:e.ruleForm.baseCellName,callback:function(t){e.$set(e.ruleForm,"baseCellName",t)},expression:"ruleForm.baseCellName"}})],1)],1):e._e(),e.isWarehouseShow?a("a-col",{attrs:{span:6}},[a("a-form-model-item",{attrs:{label:"供方单位仓库",prop:"supplyOrgCode1"}},[a("ec-select",{attrs:{showSearch:"",allowClear:"",placeholder:"请选择"},model:{value:e.ruleForm.supplyOrgCode1,callback:function(t){e.$set(e.ruleForm,"supplyOrgCode1",t)},expression:"ruleForm.supplyOrgCode1"}},e._l(e.demandWarehouseList,(function(t){return a("a-select-option",{key:t.storeId},[e._v(" "+e._s(t.storeName)+" ")])})),1)],1)],1):e._e(),a("a-col",{attrs:{span:6}},[a("a-form-model-item",{attrs:{label:"需方单位",prop:"demandOrgCode"}},[a("SelectPicker",{attrs:{title:"选择单位",lazy:!1,search:!1,disabled:e.isapprTypeCodeOk,fetchData:e.getfetchData},on:{ok:function(t){return e.handlerGetparentbizCode(t,"PredemandOrgCode")}},model:{value:e.ruleForm.demandOrgCode,callback:function(t){e.$set(e.ruleForm,"demandOrgCode","string"===typeof t?t.trim():t)},expression:"ruleForm.demandOrgCode"}})],1)],1),e.isWarehouseShow?a("a-col",{attrs:{span:6}},[a("a-form-model-item",{attrs:{label:"需方单位仓库",prop:"supplyOrgCode2"}},[a("ec-select",{attrs:{showSearch:"",allowClear:"",placeholder:"请选择"},model:{value:e.ruleForm.supplyOrgCode2,callback:function(t){e.$set(e.ruleForm,"supplyOrgCode2",t)},expression:"ruleForm.supplyOrgCode2"}},e._l(e.demandWarehouseList,(function(t){return a("a-select-option",{key:t.storeId},[e._v(" "+e._s(t.storeName)+" ")])})),1)],1)],1):e._e(),e.isAawSmokeCanShow?a("a-col",{attrs:{span:6}},[a("a-form-model-item",{attrs:{label:"原烟量",prop:"crudeWeight"}},[a("a-input",{attrs:{type:"text"},model:{value:e.ruleForm.crudeWeight,callback:function(t){e.$set(e.ruleForm,"crudeWeight",t)},expression:"ruleForm.crudeWeight"}})],1)],1):e._e(),e.isCanEdit2?a("a-col",{attrs:{span:6}},[a("a-form-model-item",{attrs:{label:"成品返回量",prop:"productReturnWeight"}},[a("a-input",{attrs:{type:"text"},model:{value:e.ruleForm.productReturnWeight,callback:function(t){e.$set(e.ruleForm,"productReturnWeight",t)},expression:"ruleForm.productReturnWeight"}})],1)],1):e._e()],1)],1)],1)],1),a("ec-panel-body",[a("a-row",{staticStyle:{margin:"0 0 6px 0"}},[a("a-col",{attrs:{span:12}},[a("span",{staticClass:"middle-title"},[e._v("明细信息")])]),a("a-col",{attrs:{span:12}},[a("span",{staticClass:"middle-title"},[e._v("申请原因")])])],1),a("div",{staticClass:"flex"},[a("div",{staticClass:"table-container"},[a("div",{staticClass:"col"},[a("ec-table",{ref:"xTable",attrs:{border:"",auto:!1,"show-overflow":"","show-footer":"",height:"100%",data:e.tableData,"cell-style":e.cellStyle,"edit-rules":e.validRules,"footer-method":e.footerMethod,"edit-config":{trigger:"click",mode:"cell"}}},[a("ec-table-col",{attrs:{title:"序号",width:"80",type:"seq",align:"center"}}),a("ec-table-col",{attrs:{title:"烟叶类型",field:"leafTypeName",align:"center","edit-render":{name:"leafTypeName"}},scopedSlots:e._u([{key:"edit",fn:function(t){var r=t.row;return[a("a-select",{attrs:{showSearch:"",allowClear:"",disabled:e.isLeafTypeEnable},on:{select:function(t){return e.onSelectChange(r)}},model:{value:r.leafTypeName,callback:function(t){e.$set(r,"leafTypeName","string"===typeof t?t.trim():t)},expression:"row.leafTypeName"}},e._l(e.leafTypeCodeList,(function(t){return a("a-select-option",{key:t.leafTypeCode,attrs:{value:t.leafTypeName}},[e._v(" "+e._s(t.leafTypeName)+" ")])})),1)]}}])}),a("ec-table-col",{attrs:{title:"烟叶形态",field:"leafFormName",align:"center","edit-render":{name:"leafFormName"}},scopedSlots:e._u([{key:"edit",fn:function(t){var r=t.row;return[a("ec-select",{attrs:{showSearch:"",allowClear:""},on:{select:function(t){return e.onSelectChange(r)}},model:{value:r.leafFormName,callback:function(t){e.$set(r,"leafFormName","string"===typeof t?t.trim():t)},expression:"row.leafFormName"}},e._l(e.leafFormCodeList,(function(t){return a("a-select-option",{key:t.leafFormCode,attrs:{value:t.leafFormName}},[e._v(" "+e._s(t.leafFormName)+" ")])})),1)]}}])}),a("ec-table-col",{attrs:{title:"交易衔接量",field:"apprWeight","edit-render":{name:"apprWeight"}},scopedSlots:e._u([{key:"edit",fn:function(t){var r=t.row;return[a("a-input",{on:{blur:function(t){return e.Norepetition(r)}},model:{value:r.apprWeight,callback:function(t){e.$set(r,"apprWeight",t)},expression:"row.apprWeight"}})]}}])})],1)],1),a("div",{staticClass:"upload-slot"},[a("span",{staticClass:"middle-title"},[e._v("申请凭据附件: ")]),a("a-upload",{attrs:{action:"/dts/plm/c/file/uploadPcTAsAttachFile/v1","file-list":e.fileList,data:e.fileParams,size:5210,remove:e.handleRemoveFile,"before-upload":e.beforeUpload},on:{change:e.handlerResfiled},model:{value:e.ruleForm.file,callback:function(t){e.$set(e.ruleForm,"file",t)},expression:"ruleForm.file"}},[a("a-button",{attrs:{icon:"upload",loading:e.uploading}},[e._v("上传文件")])],1),a("p",{staticClass:"tips"},[e._v(" 支持扩展名：.doc, .docx. xls, .xlsx, .pdf, .zip, .rar 文件大小不超过50M ")])],1)]),a("div",{staticClass:"upload-container"},[a("div",{staticClass:"main"},[a("a-textarea",{attrs:{rows:19},model:{value:e.ruleForm.applyReasion,callback:function(t){e.$set(e.ruleForm,"applyReasion",t)},expression:"ruleForm.applyReasion"}})],1),a("div",{staticClass:"footer"},[a("a-space",[e.saveloading?a("a-button",{attrs:{type:"primary",loading:""}},[e._v("保存中...")]):a("a-button",{attrs:{type:"primary"},on:{click:e.handleSave}},[e._v("保存")]),a("a-button",{on:{click:e.handleReset}},[e._v("重置")])],1)],1)])]),a("BaseModel",{ref:"basemodelRef",on:{select:e.baseSelect}})],1)],1)],1)],1)},o=[],i=a("c7eb"),l=a("5530"),s=a("1da1"),n=a("2909"),p=(a("6198"),a("6fc0")),u=a.n(p),d=(a("caad"),a("2532"),a("d3b7"),a("13d5"),a("b0c0"),a("ac1f"),a("00b4"),a("4d63"),a("c607"),a("2c3e"),a("25f0"),a("1276"),a("fb6a"),a("a434"),a("c740"),a("3ca3"),a("ddb0"),a("7db0"),a("d81d"),a("4de4"),a("e9c4"),a("159b"),a("a9e3"),a("b680"),a("99af"),a("6ea6")),c=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("a-modal",{staticClass:"ec-draw-form",attrs:{title:"选择基地单元",width:"80%",footer:null,visible:e.visible}},[a("ec-container",{attrs:{height:"auto",fixed:"top bottom","color-code":"007"}},[a("ec-container-body",[a("ec-panel",{attrs:{auto:!1}},[a("ec-panel-item",[a("ec-panel-item-right",[a("ec-query-item",{attrs:{label:"基地单元名称"}},[a("a-input",{attrs:{type:"text"},model:{value:e.baseCellName,callback:function(t){e.baseCellName=t},expression:"baseCellName"}})],1),a("a-button",{attrs:{type:"primary"},on:{click:e.queryList}},[e._v("查询")])],1)],1)],1),a("ec-table",{ref:"xTable",attrs:{border:"","show-overflow":"","highlight-hover-row":"",height:"300",loading:e.loading,"header-align":"center",align:"center",data:e.tableData,pagination:e.pagination},on:{"page-action":e.queryPagination,"radio-change":e.selectcolumn}},[a("ec-table-col",{attrs:{type:"radio",width:"60",align:"center"}}),a("ec-table-col",{attrs:{type:"seq",width:"60",align:"center",title:"序号"}}),a("ec-table-col",{attrs:{title:"省公司",field:"provOrgName"}}),a("ec-table-col",{attrs:{title:"市公司",field:"cityOrgName"}}),a("ec-table-col",{attrs:{title:"基地单元编码",field:"baseCellCode"}}),a("ec-table-col",{attrs:{title:"基地单元名称",field:"baseCellName"}}),a("ec-table-col",{attrs:{title:"工业单位",field:"linkInduOrgName"}}),a("ec-table-col",{attrs:{title:"烟叶类型",field:"leafTypeCode"}}),a("ec-table-col",{attrs:{title:"计划核定量(担)",field:"apprWeight"}})],1)],1),a("ec-container-footer",{attrs:{fixed:""}},[a("a-space",[a("a-button",{attrs:{type:"primary"},on:{click:e.handlerOK}},[e._v("确定")]),a("a-button",{on:{click:e.onclose}},[e._v("关闭")])],1)],1)],1)],1)},f=[],m={name:"BaseModel",data:function(){return{records:[],tableData:[],queryItems:{pageNumber:1,pageSize:10},baseCellName:"",orgTypeEk:"",busiYear:null,bizCode:null,pagination:{pageNumber:1,pageSize:10,total:0},visible:!1,loading:!1}},computed:{_apis:function(){return this.$apis.apm.dailyApply}},methods:{show:function(e){this.orgTypeEk=e.orgTypeEk,this.busiYear=e.bizYear,this.bizCode=e.bizCode,this.queryList(),this.visible=!0},queryList:function(){var e=this;if(this.bizCode){this.loading=!0;var t=Object(l["a"])(Object(l["a"])({},this.queryItems),{},{baseCellName:this.baseCellName,busiYear:this.busiYear});"INDUSTRY"===this.orgTypeEk?t.linkInduOrgCode=this.bizCode:t.cityOrgCode=this.bizCode,!t.baseCellName&&delete t.baseCellName,this._apis.queryBaseState(t).then((function(t){e.tableData=t.rows,e.pagination.total=t.totalRows})).finally((function(){e.loading=!1}))}},handlerOK:function(){this.records.length?(this.$emit("select",this.records[0]),this.onclose()):this.$message.error("请先选择数据！")},selectcolumn:function(e){var t=e.newValue;this.records=[t]},queryPagination:function(e,t){this.queryItems.pageNumber=e,this.queryItems.pageSize=t,this.queryList()},onclose:function(){this.tableData=[],this.visible=!1}}},h=m,g=(a("8462"),a("2877")),y=Object(g["a"])(h,c,f,!1,null,"13020e95",null),b=y.exports,C={name:"dailyImport",components:{SelectPicker:u.a,BaseModel:b},data:function(){return{UPLOAD_RESTRICT:51200,PresupplyOrgCode:"",PredemandOrgCode:"",isAawSmokeCanShow:!1,saveloading:!1,isapprTypeCodeOk:!1,isWarehouseShow:!1,isCanEdit2:!1,isLeafTypeEnable:!1,StateFromSupplyorg:null,uploading:!1,addfilestatus:!0,fileParams:{},uploadIds:[],fileList:[],treeData:[],tableData:[],totalLeafNum:0,billNo:"",ruleForm:{applyDate:(new Date).getFullYear(),apprTypeCode:null,demandOrgCode:null,supplyOrgCode:null,newOrOldLeaf:null,operateType:null,isCheckBusi:"0"},rules:{apprTypeCode:[{required:!0,message:"请选择业务类型"}],newOrOldLeaf:[{required:!0,message:"请选择"}],operateType:[{required:!0,message:"请选择操作类型"}],isCheckBusi:[{required:!0,message:"请选择是否为结转业务"}],supplyOrgCode:[{required:!0,message:"请选择供方单位"}],demandOrgCode:[{required:!0,message:"请选择需方单位"}]},validRules:{leafFormName:[{required:!0,message:"请选择烟叶类型"}],leafTypeName:[{required:!0,message:"请选择烟叶形态"}],apprWeight:[{required:!0,message:"请输入交易衔接量"}]},apprTypeCodeList:[],apprTypeCodeListed:[],isCheckBusiList:[{id:"0",label:"否"},{id:"1",label:"是"}],newOrOldLeafList:[],operateTypeList:[],leafTypeCodeList:[],leafFormCodeList:[],demandWarehouseList:[],loading:!1}},computed:{_apis:function(){return this.$apis.apm.dailyApply},appConfig:function(){return this.$store.getters.getAppConfig},busiYear:function(){var e,t;return null===(e=this.$store.getters.getAppConfig)||void 0===e||null===(t=e.yearValueMap)||void 0===t?void 0:t.DAILY_YEAR},orgTypeEk:function(){var e;return null===(e=this.$store.getters.getAppConfig)||void 0===e?void 0:e.orgTypeEk}},created:function(){this.initBillNo(),this.init(),this.getTableData(),this.fullRuleForm()},methods:{getTableData:function(){this.tableData=[];for(var e=0;e<8;e++)this.tableData.push({})},handleReset:function(){this.fileList=[],this.uploadIds=[],this.isWarehouseShow=!1,this.isapprTypeCodeOk=!1,this.isCanEdit2=!1,this.ruleForm={applyDate:(new Date).getFullYear(),apprTypeCode:null,demandOrgCode:null,supplyOrgCode:null,newOrOldLeaf:null,supplyOrgCode1:null,supplyOrgCode2:null,operateType:null,isCheckBusi:"0"},this.initBillNo(),this.getTableData(),this.fullRuleForm()},handlerApprTypeChange:function(e){var t,a=this,r=null===(t=Object(n["a"])(e))||void 0===t?void 0:t.reverse()[0];if(this.isWarehouseShow=!1,this.isapprTypeCodeOk=!1,this.isLeafTypeEnable=!1,this.isCanEdit2=!1,this.ruleForm.baseCellName="",this.ruleForm.newOrOldLeaf="",this.ruleForm.supplyOrgCode="",this.ruleForm.demandOrgCode="",this.ruleForm.supplyOrgCode1="",this.ruleForm.supplyOrgCode2="",this.getTableData(),r)if(-1!==e.indexOf("HT15"))this.ruleForm.apprTypeCode=[""],this.$message.error("业务类型为进口购销的核定量不在此模块进行申请！");else if(-1!==e.indexOf("HT1104")){this.tableData=[],this.ruleForm.newOrOldLeaf="1",this.ruleForm.demandOrgCode=null,this.ruleForm.supplyOrgCode=null,this.isapprTypeCodeOk=!0;var o=this.appConfig,i=o.orgTypeEk,l=o.bizCode;this.$refs.basemodelRef.show({bizYear:this.busiYear,orgTypeEk:i,bizCode:l})}else if("HT3104"===r||"HT3105"===r)this._apis.queryOrgWarehouseLise({busiYear:this.busiYear}).then((function(e){var t=e.rows;a.demandWarehouseList=t||[],a.ruleForm.supplyOrgCode=a.appConfig.bizCode,a.ruleForm.demandOrgCode=a.appConfig.bizCode,a.isWarehouseShow=!0}));else if("HT2201"===r){var s=this.ruleForm,p=s.supplyOrgCode,u=s.demandOrgCode;this.isCanEdit2=p===u}},baseSelect:function(e){this.ruleForm.baseCellName=e.baseCellName,this.ruleForm.supplyOrgCode=e.cityOrgCode,this.ruleForm.demandOrgCode=e.linkInduOrgCode;var t="";"20"!==e.leafTypeCode&&(t="晾晒烟",this.isLeafTypeEnable=!1);var a={leafTypeName:t,leafFormName:"原烟",apprWeight:e.apprWeight};this.tableData.push(a)},handlerGetparentbizCode:function(e,t){var a=this,r=e.selectOption,o=r.pkey,i=r.key,l=r.orgTypeEk,s=this.ruleForm.apprTypeCode;if(this[t]=o,this.StateFromSupplyorg=[],"PresupplyOrgCode"===t){if(null===s||void 0===s||!s.length)return;if(!i)return this.ruleForm.supplyOrgCode2="",void((s.includes("HT3104")||s.includes("HT3105"))&&(this.ruleForm.demandOrgCode=""));var n=["HT1301","HT1101"],p=n.some((function(e){return s.includes(e)}));p&&"INDUSTRY"===l&&this._apis.getStateFromSupplyorg({industryOrgCode:i}).then((function(e){var t=e.rows;a.StateFromSupplyorg=t}))}},initBillNo:function(){var e=this;this._apis.getBillNo({}).then((function(t){e.billNo=t}))},getfileparams:function(e,t){var a=this.$route.meta,r=a.permission,o=a.title,i={moduleCode:r,moduleName:o,busiYear:e,orgCode:t,relBillNo:this.billNo};this.fileParams=i},handlerResfiled:function(e){var t=e.file,a=e.fileList;if(this.addfilestatus&&(this.fileList=a),"done"===t.status){var r=t.response,o=r.code,i=r.data,l=r.message;"200"===o?(this.uploading=!1,this.fileList=a,this.uploadIds.push([i.fileId,t]),this.$message.success(i.fileName)):this.$message.error(l)}},beforeUpload:function(e){var t;this.uploading=!0,this.addfilestatus=!0;var a=null===(t=this.fileList)||void 0===t?void 0:t.reduce((function(e,t){return e+t.size}),0);if(a>this.UPLOAD_RESTRICT)return this.uploading=!1,this.addfilestatus=!1,this.$message.error("总文件大小不能超过50MB"),!1;var r=e.name,o=["doc","docx","xls","xlsx","pdf","zip","rar"],i=o.some((function(e){return new RegExp("".concat(e,"$"),"i").test(r)}));return i||(this.uploading=!1,this.addfilestatus=!1,this.$message.error("不支持.".concat(null===r||void 0===r?void 0:r.split(".")[1],"模式"))),i},handleRemoveFile:function(e){var t=this.fileList.indexOf(e);if(-1!==t){var a=this.fileList.slice();a.splice(t,1),this.fileList=a;var r=this.uploadIds.findIndex((function(t){return t[1].uid===e.uid}));this.uploadIds.splice(r,1)}},fullRuleForm:function(){this.ruleForm.applyDate=this.handleTime()},handleSave:function(){var e=this;return Object(s["a"])(Object(i["a"])().mark((function t(){var a,r,o,s,n,p;return Object(i["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(a=e.saveBefore(),a){t.next=3;break}return t.abrupt("return");case 3:return r=e.getfilterEdTable(),o=function(){return new Promise((function(t,a){if(r.length)t();else{var o=e.$refs.xTable;o.validate(!0).catch((function(e){console.log(e)})),e.$message.error("无法保存，明细数据不能为空,请至少保证一条数据"),a()}}))},s=[e.$refs.modelAddForm.validate(),o()],t.prev=6,t.next=9,Promise.all(s);case 9:if(n=t.sent,n){t.next=12;break}return t.abrupt("return");case 12:p=e.getfilterParams(Object(l["a"])(Object(l["a"])({},e.ruleForm),{},{billNo:e.billNo,busiYear:e.busiYear,paramListPcTAsDailyDealDetls:r})),e.saveloading=!0,e._apis.saveMasAndDetail(p).then((function(t){t?(e.$message.success("保存成功"),e.handleReset()):e.$message.error("操作失败")})).finally((function(){e.saveloading=!1})),t.next=20;break;case 17:t.prev=17,t.t0=t["catch"](6),console.log(t.t0);case 20:case"end":return t.stop()}}),t,null,[[6,17]])})))()},saveBefore:function(){var e=this,t=this.$createElement,a=this.ruleForm,r=a.supplyOrgCode,o=a.demandOrgCode,i=a.apprTypeCode,l=a.applyReasion,s=a.supplyOrgCode1,p=a.supplyOrgCode2,u=this.appConfig,d=u.bizCode,c=u.orgTypeEk,f=["BA11000001000000000171","BA11000001000000000156","BA11000001000000000184"];if(-1!==i.indexOf("HT1104")&&!this.ruleForm.baseCellName)return this.$message.error("当前基地单元信息为空,请选择基地单元信息！"),void this.$confirm({title:"操作提示?",content:function(){return t("div",{style:"color:red;"},["是否打开基地单元信息',确认请点击确认'按钮，取消点击'取消'按钮"])},onOk:function(){e.$refs.basemodelRef.show({bizYear:e.busiYear,orgTypeEk:c,bizCode:d})}});var m=Array.isArray(r)?Object(n["a"])(r).reverse()[0]:r;if(f.includes(m)&&-1!==i.indexOf("HT1101")){var h=1,g=this.ruleForm.crudeWeight*h;if(this.totalLeafNum>g)return void this.$message.error("烤烟片烟量不能超过原烟量！")}if(l)if(l.length>1e3)this.$message.error("不能超过1000个字节！");else{if(r===d||o===d||r[0]===d||o[0]===d||-1!==i.indexOf("HT1104")){if(-1===i.indexOf("HT3104")&&-1===i.indexOf("HT3105")&&-1===i.indexOf("HT22")){if(r===o)return void this.$message.error("供方单位不能与需方单位相同！")}else if(-1!==i.indexOf("HT3104")&&-1!==i.indexOf("HT3105")){if(r!==o)return void this.$message.error("业务类型为内部调运时供方单位必须与需方单位相同！");if(!p)return void this.$message.error("调入仓库不能为空！");if(!s)return void this.$message.error("调出仓库不能为空！");if(s===p)return void this.$message.error("调入仓库不能与调出仓库相同！")}return!0}this.$message.error("供方单位与需方单位必须至少有一个是当前单位！")}else this.$message.error("申请原因不能为空！")},getfilterParams:function(e){var t,a,r,o,i=Object(d["cloneDeep"])(e);return i.apprTypeCode&&i.apprTypeCode.length&&(i.apprTypeCode=Object(n["a"])(i.apprTypeCode).reverse()[0]),i.newOrOldLeafName=(null===(t=this.newOrOldLeafList.find((function(e){return e.enumKey===i.newOrOldLeaf})))||void 0===t?void 0:t.name)||"",i.apprTypeName=(null===(a=this.apprTypeCodeListed.find((function(e){return e.contTypeCode===i.apprTypeCode})))||void 0===a?void 0:a.contTypeName)||"",null!==(r=this.StateFromSupplyorg)&&void 0!==r&&r.length&&(i.StateFromSupplyorg=this.StateFromSupplyorg),this.uploadIds.length&&(i.fileIds=null===(o=this.uploadIds)||void 0===o?void 0:o.map((function(e){return e[0]}))),i},getfilterEdTable:function(){var e=this,t=this.tableData.filter((function(e){return e.leafTypeName&&e.leafFormName&&e.apprWeight})).map((function(t){var a,r;return t.leafFormCode=null===(a=e.leafFormCodeList.find((function(e){return e.leafFormName===t.leafFormName})))||void 0===a?void 0:a.leafFormCode,t.leafTypeCode=null===(r=e.leafTypeCodeList.find((function(e){return e.leafTypeName===t.leafTypeName})))||void 0===r?void 0:r.leafTypeCode,delete t._X_ID,t}))||[];return t.filter((function(t){if("201"!==t.leafFormCode&&"202"!==t.leafFormCode||"10"!==t.leafTypeCode){if("801"===t.leafTypeCode&&"X1"!==t.leafFormCode&&"505"!==t.leafFormCode&&"506"!==t.leafFormCode)return e.$message.error("明细数据中，烟叶类型选择薄片时，烟叶形态只能选择薄片（片）或者薄片丝或者再造梗丝！"),!1}else e.totalLeafNum+=t.apprWeight;return"801"!==t.leafTypeCode||"X1"!==t.leafFormCode&&"505"!==t.leafFormCode&&"506"!==t.leafFormCode?"203"===t.leafFormCode&&"20211"!==t.leafTypeCode&&"20212"!==t.leafTypeCode?(e.$message.error("明细数据中，烟叶形态为混配片烟时，烟叶类型只能选择香料烟B型和香料烟S型！"),!1):"202"!==t.leafFormCode||"20211"!==t.leafTypeCode&&"20212"!==t.leafTypeCode||(e.$message.error("明细数据中，烟叶形态为混打片烟时，烟叶类型不能选择香料烟B型和香料烟S型！"),!1):(e.$message.error("明细数据中，烟叶类型选择非薄片时，烟叶形态不能选择薄片（片）或者薄片丝或者再造梗丝！"),!1)}))},init:function(){this.treeGetlist(this.busiYear,d["treeFormatList"],this.$apis.centre.apply),this.getfileparams(this.busiYear,this.appConfig.bizCode),this.getEnumType(),this.querySpinnerLeafType(),this.querySpinnerLeafForm(),this.querygetBusinessType()},getEnumType:function(){var e=this;return Object(s["a"])(Object(i["a"])().mark((function t(){var a,r;return Object(i["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a={enumTypeCodes:["OPERATE_TYPE","NEW_OR_OLD_LEAF"]},t.next=3,e.$apis.enum.index.getEnumType(a);case 3:r=t.sent,r&&(e.operateTypeList=r.enumMap.OPERATE_TYPE,e.newOrOldLeafList=r.enumMap.NEW_OR_OLD_LEAF);case 5:case"end":return t.stop()}}),t)})))()},querySpinnerLeafType:function(){var e=this;this._apis.querySpinnerLeafType({}).then((function(t){e.leafTypeCodeList=t.rows}))},querySpinnerLeafForm:function(){var e=this;this._apis.querySpinnerLeafForm({}).then((function(t){e.leafFormCodeList=t.rows}))},querygetBusinessType:function(){var e=this;this.$apis.common.index.queryContType({contTypeCode:"2"}).then((function(t){var a=t.rows;e.apprTypeCodeListed=a,e.apprTypeCodeList=e.getTree(a,"higherContTypeCode","contTypeCode","contTypeName","children","0")}))},getTree:function(e,t,a,r,o,i){console.time();var l=function e(i,l){return i.filter((function(s){return s[t]===l&&((s.value=s[a])(s.label=s[r])(s[o]=e(i,s[a])),!0)}))},s=l(e,i);return console.timeEnd(),s},treeGetlist:function(e,t,a){var r=this;return Object(s["a"])(Object(i["a"])().mark((function o(){var l,s,n,p;return Object(i["a"])().wrap((function(o){while(1)switch(o.prev=o.next){case 0:if(l={bizYear:e,bizCode:"BA20111000001000000000000",orgTypeEk:"EXPORT,INDUSTRY,TOBACCO",orgLevelEk:"3",paramMap:{isCorporation:"1"}},s={pkey:"parentBizCode",title:"orgName",key:"bizCode",children:"children"},$ec.showLoading(),n=JSON.parse(localStorage.getItem("apprlist"))||[],!n.length){o.next=9;break}$ec.showLoading(),r.treeData=t(n,s),o.next=15;break;case 9:return o.next=11,a.getreeDate(l);case 11:p=o.sent,localStorage.setItem("apprlist",JSON.stringify(p.rows)),$ec.showLoading(),r.treeData=t(null===p||void 0===p?void 0:p.rows,s);case 15:case"end":return o.stop()}}),o)})))()},getfetchData:function(){var e=this;return new Promise((function(t){var a=Object(d["cloneDeep"])(e.treeData);t(a)}))},sumNum:function(e,t){var a=0;return e.forEach((function(e){a+=Number(e[t])})),a?a.toFixed(2):0},footerMethod:function(e){var t=this,a=e.columns,r=e.data;return[a.map((function(e,a){return 0===a?"合计":["apprWeight"].includes(e.property)?t.sumNum(r,e.property):null}))]},handleTime:function(){var e=new Date,t=e.getFullYear(),a=e.getMonth(),r=a<10?"0".concat(a+1):a+1,o=e.getDate(),i=o<10?"0".concat(o):o;return"".concat(t,"-").concat(r,"-").concat(i)},cellStyle:function(e){var t=e.$columnIndex;if(3===t)return{textAlign:"right"}},getFormAndTypeName:function(e,t,a,r){var o,i,l=null===(o=e.find((function(e){return e.leafFormName===a})))||void 0===o?void 0:o.leafFormCode,s=null===(i=t.find((function(e){return e.leafTypeName===r})))||void 0===i?void 0:i.leafTypeCode;return{leafFormCode:l,leafTypeCode:s}},onSelectChange:function(e){this.Norepetition(e);var t=e.leafTypeName,a=e.leafFormName,r=this.getFormAndTypeName(this.leafFormCodeList,this.leafTypeCodeList,a,t),o=r.leafFormCode,i=r.leafTypeCode;this.isAawSmokeCanShow=!1,o&&i&&"10"===i&&("201"!==o&&"202"!==o||this.initBtnShow())},Norepetition:function(e){var t=e._X_ID,a=function(e){return e.leafTypeName&&e.leafFormName&&e.apprWeight},r=this.tableData.filter(a);if(r.length>1){var o,i,s=(null===(o=r[0])||void 0===o?void 0:o.leafTypeName)+(null===(i=r[0])||void 0===i?void 0:i.leafFormName),n=function(e){return e.leafTypeName+e.leafFormName===s||e.leafFormName+e.leafTypeName===s},p=r.slice(1,r.length),u=p.some(n);u&&(this.$message.error("明细中的烟叶类型与烟叶形态的组合不能重复！"),this.tableData=this.tableData.map((function(e){var a=Object(l["a"])({},e);return a._X_ID===t&&(a={_X_ID:t}),a})))}},initBtnShow:function(){this.ruleForm.crudeWeight="";var e=this.ruleForm,t=(e.supplyOrgCode,e.apprTypeCode),a=!0;this.isAawSmokeCanShow=a&&"-1"!==t.indexOf("HT1101")}}},v=C,O=(a("9147"),Object(g["a"])(v,r,o,!1,null,"5b33981a",null));t["default"]=O.exports},"4d5b":function(e,t,a){},5530:function(e,t,a){"use strict";a.d(t,"a",(function(){return i}));a("b64b"),a("a4d3"),a("4de4"),a("d3b7"),a("e439"),a("159b"),a("dbb4");function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}},8462:function(e,t,a){"use strict";a("4d5b")},9147:function(e,t,a){"use strict";a("fa20")},fa20:function(e,t,a){}}]);
//# sourceMappingURL=chunk-2fc9b88a.b455120e.js.map