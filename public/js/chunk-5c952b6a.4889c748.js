(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5c952b6a"],{5530:function(e,t,a){"use strict";a.d(t,"a",(function(){return r}));a("b64b"),a("a4d3"),a("4de4"),a("d3b7"),a("e439"),a("159b"),a("dbb4");function n(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function r(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){n(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}},9025:function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ec-container",{attrs:{height:"100%"}},[a("ec-container-header",[a("ec-panel-item",[a("ec-panel-item-left",[a("ec-header",{attrs:{title:"收购计划执行量下达",icon:"onetomany","color-code":"008"}})],1)],1)],1),a("ec-container-body",[a("ec-panel",{attrs:{auto:!1}},[a("ec-panel-toolbar",[a("ec-query-panel",{on:{query:function(t){return e.$refs.table.pageAction(1)},reset:e.onReset}},[a("ec-query-item",{attrs:{label:"烟叶类型"}},[a("ec-select",{attrs:{showSearch:"",allowClear:"",placeholder:"请选择"},model:{value:e.queryItems.leafTypeCode,callback:function(t){e.$set(e.queryItems,"leafTypeCode",t)},expression:"queryItems.leafTypeCode"}},e._l(e.leafTypeList,(function(t){return a("a-select-option",{key:t.leafTypeCode},[e._v(" "+e._s(t.leafTypeName)+" ")])})),1)],1),a("ec-query-item",{attrs:{label:"下达状态"}},[a("a-select",{attrs:{"allow-clear":"",placeholder:"请选择"},model:{value:e.queryItems.releaseState,callback:function(t){e.$set(e.queryItems,"releaseState",t)},expression:"queryItems.releaseState"}},e._l(e.workIssuedState,(function(t){return a("a-select-option",{key:t.id},[e._v(" "+e._s(t.name)+" ")])})),1)],1)],1),a("ec-divider")],1),a("ec-panel-header",[a("ec-panel-item",[a("ec-panel-item-left",[a("a-button",{attrs:{type:"primary"},on:{click:e.onIssued}},[e._v("下达")]),a("a-button",{on:{click:e.onExport}},[e._v("导出")])],1),a("ec-panel-item-right",[a("a-space",{attrs:{size:15}},[a("span",[e._v("种植收购年度："+e._s(e.queryItems.busiYear)+"年")]),a("span",[e._v("重量单位："),a("ec-select",{staticStyle:{width:"150px"},attrs:{showSearch:"",allowClear:"",placeholder:"请选择"},on:{select:function(t){return e.handleUnitParse()}},model:{value:e.weightUnit,callback:function(t){e.weightUnit=t},expression:"weightUnit"}},e._l(e.weightUnitList,(function(t){return a("a-select-option",{key:t.weightUnitCd},[e._v(" "+e._s(t.weightUnitName)+" ")])})),1)],1),a("span",[e._v("面积单位："),a("ec-select",{staticStyle:{width:"150px"},attrs:{showSearch:"",allowClear:"",placeholder:"请选择"},on:{select:function(t){return e.handleUnitParse()}},model:{value:e.areaUnit,callback:function(t){e.areaUnit=t},expression:"areaUnit"}},e._l(e.areaUnitList,(function(t){return a("a-select-option",{key:t.areaUnitCd},[e._v(" "+e._s(t.areaUnitName)+" ")])})),1)],1)])],1)],1)],1),a("ec-panel-body",[a("ec-table",{ref:"table",attrs:{border:"",height:"100%",auto:!1,pagination:e.pagination,data:e.tableData.rows,loading:e.loading,"show-footer":"","footer-method":e.footerMethod,"highlight-current-row":""},on:{"page-action":e.handlePagination,"checkbox-all":e.selectAllEvent,"checkbox-change":e.selectRowChange}},[a("ec-table-col",{attrs:{type:"checkbox",width:"50",align:"center"}}),a("ec-table-col",{attrs:{title:"序号",type:"seq",width:"70",align:"center"}}),a("ec-table-col",{attrs:{field:"orgName",title:"单位名称",align:"left","min-width":"200"}}),a("ec-table-colgroup",{attrs:{title:"收购计划执行量"}},[a("ec-table-col",{attrs:{field:"planTotalWeight",title:"合计",align:"center",width:"130"}}),a("ec-table-col",{attrs:{field:"planInnerWeight",title:"国内",align:"center",width:"130"}}),a("ec-table-col",{attrs:{field:"planExportWeight",title:"出口备货",align:"center",width:"130"}})],1),a("ec-table-col",{attrs:{field:"planPlantArea",title:"种植面积",align:"right",width:"130"}}),a("ec-table-col",{attrs:{field:"remark",title:"办理依据",align:"left",width:"150"}}),a("ec-table-col",{attrs:{field:"releaseState",title:"下达状态",align:"center",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.row;return["1"===n.releaseState?a("div",[a("span",[e._v("已下达")])]):a("div",[a("span",[e._v("未下达")])])]}}])}),a("ec-table-col",{attrs:{field:"releaseTime",title:"下达日期",align:"center",width:"160"}})],1)],1)],1)],1)],1)},i=[],r=a("5530"),o=a("c7eb"),l=a("1da1"),s=(a("e9c4"),a("d3b7"),a("159b"),a("b680"),a("7db0"),a("a9e3"),a("d81d"),a("caad"),a("99af"),{name:"ExecutionAuditManage",components:{},data:function(){return{queryItems:{busiYear:"",leafTypeCode:"10",releaseState:"0"},weightUnit:5e5,areaUnit:1e4,nowYear:"",loading:!1,leafTypeCd:"",leafTypeList:[{leafTypeCode:"10",leafTypeName:"烤烟"},{leafTypeCode:"20",leafTypeName:"晾晒烟(全部)"},{leafTypeCode:"2013",leafTypeName:"晾晒烟(雪茄烟叶)"}],oldDataRow:[],workIssuedState:[{id:"0",name:"未下达"},{id:"1",name:"已下达"}],weightUnitList:[{weightUnitCd:1,weightUnitName:"公斤",isSelected:!1},{weightUnitCd:50,weightUnitName:"担",isSelected:!1},{weightUnitCd:5e5,weightUnitName:"万担",isSelected:!1}],areaUnitList:[{areaUnitCd:1e4,areaUnitName:"万亩"},{areaUnitCd:1,areaUnitName:"亩"}],bizCode:"",pagination:{pageNumber:1,pageSize:10,total:0},tableData:{rows:[]}}},computed:{appConfig:function(){return this.$store.getters.getAppConfig}},created:function(){var e=this.$router.history.current.query.appCode;this.appCode=e||"CM"},methods:{handleUnitParse:function(){var e=this,t=[];console.log("單位：".concat(this.weightUnit));var a=JSON.parse(JSON.stringify(this.oldDataRow))||[];a.forEach((function(a){var n=a;n.planTotalWeight=(n.planTotalWeight/e.weightUnit).toFixed(2),n.planInnerWeight=(n.planInnerWeight/e.weightUnit).toFixed(2),n.planExportWeight=(n.planExportWeight/e.weightUnit).toFixed(2),n.planPlantArea=(n.planPlantArea/e.areaUnit).toFixed(2),t.push(n)})),console.log(t),this.tableData.rows=t},onQuery:function(){var e=this;this.loading=!0;var t={pageNo:this.pagination.pageNumber,pageSize:this.pagination.pageSize,leafTypeCode:this.queryItems.leafTypeCode,releaseState:this.queryItems.releaseState,busiYear:this.queryItems.busiYear};console.log(t),this.$apis.bpm.executionIssued.query(t).then((function(t){e.tableData=t;var a=e.tableData.rows;e.pagination.total=t.totalRows,e.oldDataRow=JSON.parse(JSON.stringify(a)),console.log("66666".concat(JSON.stringify(e.oldDataRow))),e.handleUnitParse()})).catch((function(e){console.log(e)})).finally((function(){e.loading=!1,e.selectedRows=[]}))},handlePagination:function(e,t){var a=this;return Object(l["a"])(Object(o["a"])().mark((function n(){return Object(o["a"])().wrap((function(n){while(1)switch(n.prev=n.next){case 0:return a.pagination.pageNumber=e,a.pagination.pageSize=t,n.next=4,a.handleGetLeafTypeList();case 4:case"end":return n.stop()}}),n)})))()},handleGetLeafTypeList:function(){var e=this;return Object(l["a"])(Object(o["a"])().mark((function t(){var a,n,i,r,l;return Object(o["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(null!==(a=e.leafTypeList)&&void 0!==a&&a.length){t.next=6;break}return t.next=3,e.$apis.bpm.executionEnter.queryLeafType({});case 3:n=t.sent,e.leafTypeList=(null===n||void 0===n?void 0:n.rows)||[],e.leafTypeList.some((function(t){return"烤烟"===t.leafTypeName&&(e.leafTypeCd=t.leafTypeCode,e.queryItems.leafTypeCode=t.leafTypeCode,!0)}));case 6:if(e.orgCode){t.next=12;break}return t.next=9,e.$apis.bim.curOrg.get({});case 9:i=t.sent,e.bizCode=null===i||void 0===i?void 0:i.bizCode,e.orgCode=null===i||void 0===i?void 0:i.orgUniqueCode;case 12:if(!(!e.queryItems.busiYear>0)){t.next=19;break}return r={bizCode:e.appConfig.bizCode,appCode:e.appCode||"CM",yearTypeCode:"BIZ_YEAR"},t.next=16,e.$apis.bpm.executionEnter.getBuYear(r);case 16:l=t.sent,e.queryItems.busiYear=null===l||void 0===l?void 0:l.yearValue,e.nowYear=null===l||void 0===l?void 0:l.yearValue;case 19:e.onQuery();case 20:case"end":return t.stop()}}),t)})))()},onExport:function(){var e,t,a=Object(r["a"])({},this.queryItems);switch(this.weightUnit){case 1:a.weightUnit="1";break;case 50:a.weightUnit="2";break;default:a.weightUnit="3";break}a.areaUnit=1===this.areaUnit?"1":"2",a.leafTypeName=(null===(e=this.leafTypeList)||void 0===e||null===(t=e.find((function(e){return e.leafTypeCode===a.leafTypeCode})))||void 0===t?void 0:t.leafTypeName)||"",this.$apis.bpm.executionIssued.Export(a).then((function(e){var t=new Blob([e]);console.log(e,t,"/////////////////////////////")}))},onIssued:function(){var e=this,t=this.$createElement;if(!this.selectedRows||this.selectedRows.length<=0)this.$message.error("请选择一条数据再下达");else{var a=this.selectedRows.find((function(e){return"1"===e.releaseState}));a?this.$message.error("存在已下达数据，请勿重复下达"):this.$confirm({title:"是否执行该操作?",content:function(){return t("div",{style:"color:red;"},["是否确认下达选中的数据，确认请点击'确认'按钮，取消点击'取消'按钮。"])},onOk:function(){e.loading=!0;for(var t=[],a=0;a<e.selectedRows.length;a++)t.push(e.selectedRows[a].oprRecordId);var n={leafTypeCode:e.queryItems.leafTypeCode,busiYear:e.nowYear,oprRecordIds:t};console.log("参数：".concat(JSON.stringify(t))),e.$apis.bpm.executionIssued.issued(n).then((function(t){console.log(JSON.stringify(t)),t.result?(e.loading=!1,e.onQuery(),e.$message.success("操作成功")):e.$message.error("操作失败")}))}})}},onReset:function(){this.queryItems.leafTypeCode=this.leafTypeCd,this.queryItems.busiYear=this.nowYear,this.queryItems.releaseState="0",this.$refs.table.pageAction(1)},handleData:function(){var e=this,t=this.leafTypeList.find((function(t){return t.leafTypeCode===e.queryItems.leafTypeCode})),a=this.weightUnitList.find((function(t){return t.weightUnitCd===e.weightUnit})),n=this.areaUnitList.find((function(t){return t.areaUnitCd===e.areaUnit})),i={leafTypeObj:t,weightUnitObj:a,areaUnitObj:n,nowYear:this.queryItems.busiYear};return i},handleLeafTypeName:function(e){var t=this.leafTypeList.find((function(t){return t.leafTypeCode===e}));return null===t||void 0===t?void 0:t.leafTypeName},sumNum:function(e,t){var a=0;return e.forEach((function(e){a+=Number(e[t])})),a.toFixed(2)},footerMethod:function(e){var t=this,a=e.columns,n=e.data;return[a.map((function(e,a){return 0===a?"合计":["planTotalWeight","planInnerWeight","planExportWeight","planPlantArea"].includes(e.property)?t.sumNum(n,e.property):null}))]},selectAllEvent:function(e){var t=e.checked,a=e.records;console.log("".concat(t,"-选中所有records包含选中的所以对象----").concat(JSON.stringify(a))),this.selectedRows=a},selectRowChange:function(e){var t=e.checked,a=e.records;console.log("".concat(t,"-选择改变时会把records包含选中的所以对象----").concat(JSON.stringify(a))),this.selectedRows=a}}}),c=s,u=(a("ce3c"),a("2877")),d=Object(u["a"])(c,n,i,!1,null,"472ebf01",null);t["default"]=d.exports},ce3c:function(e,t,a){"use strict";a("e042")},e042:function(e,t,a){}}]);
//# sourceMappingURL=chunk-5c952b6a.4889c748.js.map