(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-338084a0"],{"1d801":function(e,t,r){"use strict";r("7ad5")},"2b52":function(e,t,r){"use strict";r.r(t);var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("ec-container",{attrs:{height:"auto"}},[r("ec-container-header",[r("ec-panel-toolbar",[r("ec-panel-item-left",[r("ec-header",{attrs:{title:"调拨计划量管理",icon:"onetomany","color-code":"003"}})],1),r("ec-panel-item-right",[r("div",[e._v("集中交易年度: "+e._s(e.busiYear)+"年")])])],1)],1),r("ec-container-body",[r("ec-panel",[e.operate?r("ec-panel-toolbar",[r("ec-query-panel",{attrs:{defaultFold:!0},on:{query:e.init,reset:e.resetHandle}},[r("ec-query-item",{attrs:{label:"单位类型"}},[r("a-select",{attrs:{allowClear:"","show-search":"",placeholder:"请选择单位类型"},on:{select:e.init},model:{value:e.queryItems.memberOrgType,callback:function(t){e.$set(e.queryItems,"memberOrgType",t)},expression:"queryItems.memberOrgType"}},e._l(e.unitType,(function(t){return r("a-select-option",{key:t.id},[e._v(" "+e._s(t.name)+" ")])})),1)],1),r("ec-query-item",{attrs:{label:"烟叶类型"}},[r("a-cascader",{attrs:{options:e.statusValOptions,disabled:e.disabled,"change-on-select":"",placeholder:"请选择"},on:{change:e.selectedStatusList},model:{value:e.queryItems.leafTypeCode,callback:function(t){e.$set(e.queryItems,"leafTypeCode",t)},expression:"queryItems.leafTypeCode"}})],1),r("ec-query-item",{attrs:{label:"计量单位"}},[r("a-select",{attrs:{"allow-clear":"",placeholder:"请选择"},model:{value:e.unitstr,callback:function(t){e.unitstr=t},expression:"unitstr"}},e._l(e.unitstrOptions,(function(t){return r("a-select-option",{key:t.id},[e._v(" "+e._s(t.name)+" ")])})),1)],1)],1),r("ec-divider")],1):e._e(),r("ec-panel-body",[r("ec-v-layout",[r("ec-v-item",[r("ec-panel-item",[r("ec-panel-item-left",[e.operate?[e.ispush?r("a-button",{attrs:{type:"primary"},on:{click:function(t){e.operate=!1}}},[e._v("编辑")]):e._e(),r("a-button",{on:{click:e.exportFile}},[e._v("导出")])]:[r("a-button",{attrs:{type:"primary"},on:{click:e.handleSubmit}},[e._v("保存")]),r("a-button",{on:{click:e.handleCancel}},[e._v("取消")])]],2),r("ec-panel-item-right",[e.operate?e._e():r("div",[e._v(" 集中交易年度:2021年; 正在编辑的烟叶类型:"+e._s(e.label)+";计量单位:"+e._s("50"===e.unitstr?"担":"万担")+" ")])])],1)],1),r("ec-v-item",[r("Dytable",{attrs:{tableState:e.tableData,memberOrgType:e.queryItems.memberOrgType,operate:e.operate,loading:e.loading,unitstr:e.unitstr,busiYear:e.busiYear},model:{value:e.tableDataChildren,callback:function(t){e.tableDataChildren=t},expression:"tableDataChildren"}})],1)],1)],1)],1)],1)],1)},i=[],a=r("2909"),o=r("c7eb"),l=r("1da1"),u=r("5530"),c=(r("d3b7"),r("d81d"),r("caad"),r("159b"),function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("vxe-table",{ref:"xTable",staticClass:"editable-footer",attrs:{border:"",stripe:"",resizable:"","header-align":"center",align:"center","cell-style":e.cellStyle,"show-footer":"","show-overflow":"","highlight-hover-row":"",height:e.operate?620:720,"footer-method":e.footerMethod,loading:e.loading,data:e.tableData,"edit-config":e.operate?{}:{trigger:"click",mode:"cell"},"mouse-config":{selected:!0},"keyboard-config":{isArrow:!0,isDel:!0,isEnter:!0,isTab:!0,isEdit:!0,enterToTab:!0,editMethod:e.editMethod}},on:{"edit-closed":e.editClosedEvent}},[r("vxe-column",{attrs:{width:"60",title:"序号",type:"seq",align:"center"}}),r("vxe-column",{attrs:{title:"会员单位",field:"memberOrgName"}}),r("vxe-column",{attrs:{title:"总计",field:"total"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[e._v(e._s(e.getTotal(r)))]}}])}),r("vxe-colgroup",{key:Math.random(),attrs:{title:"国内计划核定量",align:"center"}},[r("vxe-column",{attrs:{field:"zhej",title:"合计","edit-render":{name:"input",immediate:!0}},scopedSlots:e._u([{key:"edit",fn:function(t){var n=t.row;return[r("a-input-number",{attrs:{type:"text",min:0},on:{blur:function(t){return e.handlerzhejChange(n)}},model:{value:n.zhej,callback:function(t){e.$set(n,"zhej",t)},expression:"row.zhej"}})]}},{key:"default",fn:function(t){var r=t.row;return[e._v(" "+e._s(r.zhej)+" ")]}}])}),r("vxe-column",{attrs:{field:"gsptgx",title:"工商普通购销"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[e._v(e._s(e.getGsptgx(r)))]}}])}),r("vxe-column",{attrs:{field:"jdy",title:"基地烟"}})],1),"INDUSTRY"!=e.memberOrgType?r("vxe-colgroup",{key:Math.random(),attrs:{title:"出口调拨计划量"}},[r("vxe-column",{attrs:{field:"ckbhgx",title:"出口备货普通购销","edit-render":{name:"input",immediate:!0}},scopedSlots:e._u([{key:"edit",fn:function(t){var n=t.row;return[r("a-input-number",{attrs:{type:"text",min:0},model:{value:n.ckbhgx,callback:function(t){e.$set(n,"ckbhgx",t)},expression:"row.ckbhgx"}})]}},{key:"default",fn:function(t){var r=t.row;return[e._v(" "+e._s(r.ckbhgx)+" ")]}}],null,!1,2317154319)})],1):e._e(),r("vxe-column",{attrs:{title:"办理依据",field:"remark","edit-render":{name:"input",immediate:!0}},scopedSlots:e._u([{key:"edit",fn:function(t){var n=t.row;return[r("a-input",{attrs:{type:"text"},model:{value:n.remark,callback:function(t){e.$set(n,"remark",t)},expression:"row.remark"}})]}},{key:"default",fn:function(t){var r=t.row;return[e._v(" "+e._s(r.remark)+" ")]}}])}),r("vxe-colgroup",{key:Math.random(),attrs:{title:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.row;return[r("a-button",{attrs:{type:"link"},on:{click:function(t){return e.handleGetdetails(n)}}},[e._v("基地烟详情")])]}}])})],1),r("Detail",{ref:"detailRef"})],1)}),s=[],d=(r("a9e3"),function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("ec-drawer",{staticClass:"ec-draw-form",attrs:{title:"详情",visible:e.visible,size:"large","is-confirm":!0},on:{close:e.onclose}},[r("ec-container",[r("ec-container-body",[r("div",{staticClass:"detailTitle"},[e._v(" 集中交易年度："+e._s(e.busiYear)+"年 "),r("span",{staticClass:"detailUtil"},[e._v("计量单位："+e._s("50"===e.unitstr?"担":"万担"))])]),r("vxe-table",{ref:"xTable",staticClass:"editable-footer",attrs:{border:"","show-footer":"","show-overflow":"","highlight-hover-row":"",height:"400","export-config":{},"footer-method":e.footerMethod,data:e.tableData}},[r("vxe-column",{attrs:{width:"60",type:"seq",title:"序号",align:"center"}}),r("vxe-column",{attrs:{title:"会员单位",field:"memberOrgName"}}),r("vxe-column",{attrs:{title:"基地单元",field:"baseCellName"}}),r("vxe-column",{attrs:{title:"烟叶类型",field:"leafTypeCode"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[e._v(e._s("20"===r.leafTypeCode?"晾晒烟":"10"===r.leafTypeCode?"烤烟":"雪茄烟叶"))]}}])}),r("vxe-column",{attrs:{title:"收购量",field:"buyWeight"}}),r("vxe-column",{attrs:{title:"计划核定量",field:"apprWeight"}})],1)],1),r("ec-container-footer",{attrs:{fixed:""}},[r("a-space",[r("a-button",{on:{click:e.onclose}},[e._v("关闭")])],1)],1)],1)],1)}),f=[],p={name:"transferDetail",data:function(){return{unitstr:"50",busiYear:"",tableData:[],visible:!1,unitTypeId:"1",unitOptions:[{name:"全部",id:"1"},{name:"特色单元",id:"2"},{name:"标准单元",id:"3"}]}},methods:{show:function(e){var t=e.rows,r=e.unitstr,n=e.busiYear;this.unitstr=r,this.busiYear=n,this.tableData=Object(a["a"])(t).map((function(e){var t=Object(u["a"])({},e),n=Number(r);return t.buyWeight=Number(t.buyWeight)/n,t.apprWeight=Number(t.apprWeight)/n,t})),this.visible=!0},onclose:function(){this.tableData=[],this.visible=!1},handleUnitType:function(){},sumNum:function(e,t){var r=0;return e.forEach((function(e){r+=Number(e[t])})),r},footerMethod:function(e){var t=this,r=e.columns,n=e.data;return[r.map((function(e,r){return 1===r?"合计":["buyWeight","apprWeight"].includes(e.property)?t.sumNum(n,e.property):null}))]}}},h=p,b=(r("b04f"),r("2877")),y=Object(b["a"])(h,d,f,!1,null,"0ee5aeb7",null),m=y.exports,v={name:"Dytable",components:{Detail:m},props:{tableState:{type:Array,default:function(){return[]}},operate:{type:Boolean,default:!0},loading:{type:Boolean,default:!0},memberOrgType:{type:String,default:""},unitstr:{type:String,default:""},busiYear:{type:Number,default:2022}},data:function(){return{tableData:[]}},computed:{_apis:function(){return this.$apis.centre.transfer}},watch:{tableState:{handler:function(e){this.tableData=e}}},methods:{handleGetdetails:function(e){var t=this,r=e.memberLevelCode,n=e.leafTypeCode,i={busiYear:this.busiYear,memberLevelCode:r,leafTypeCode:n};this._apis.queryDetails(i).then((function(e){var r=Object(u["a"])({},e);r.unitstr=t.unitstr,r.busiYear=t.busiYear,t.$refs.detailRef.show(r)}))},getTotal:function(e){return e.total=Math.floor(1e4*(Number(e.zhej)+Number(e.ckbhgx)))/1e4,e.total},getGsptgx:function(e){return e.gsptgx=Number(e.zhej)-Number(e.jdy),e.gsptgx},editMethod:function(e){var t=e.row,r=e.column,n=this.$refs.xTable;n.setActiveCell(t,r)},sumNum:function(e,t){var r=0;return e.forEach((function(e){r+=Number(e[t])})),r},footerMethod:function(e){var t=this,r=e.columns,n=e.data;return[r.map((function(e,r){return 0===r?"合计":["total","zhej","gsptgx","jdy","ckbhgx"].includes(e.property)?t.sumNum(n,e.property):null}))]},cellStyle:function(e){var t=e.$columnIndex;if(2===t||3===t||4===t||5===t||6===t)return{textAlign:"right"}},handlerzhejChange:function(e){Number(e.zhej)<Number(e.jdy)&&(e.zhej=e.jdy,this.$message.error("合计量 不能小于基地烟合计量"))},editClosedEvent:function(){this.$emit("input",this.tableData)}}},g=v,k=Object(b["a"])(g,c,s,!1,null,"78ec69e1",null),x=k.exports,w=r("fa7d"),O={name:"transfer",components:{Dytable:x},data:function(){return{code:"",ispush:!0,orgCode:"",loading:!0,operate:!0,disabled:!1,unitstr:"50",label:"烤烟",unitType:[{name:"商业企业",id:"TOBACCO"},{name:"工业企业",id:"INDUSTRY"}],statusValOptions:[{value:"10",label:"烤烟"},{value:"20",label:"晾晒烟",children:[{value:"2013",label:"雪茄烟叶"}]}],unitstrOptions:[{name:"担",id:"50"},{name:"万担",id:"500000"}],queryItems:{memberOrgType:"TOBACCO",leafTypeCode:["10"],busiYear:""},tableData:[],tableDataChildren:[]}},computed:{_apis:function(){return this.$apis.centre.transfer},appConfig:function(){return this.$store.getters.getAppConfig},busiYear:function(){var e,t;return null===(e=this.$store.getters.getAppConfig)||void 0===e||null===(t=e.yearValueMap)||void 0===t?void 0:t.CENTER_YEAR}},watch:{queryItems:{handler:function(e){"INDUSTRY"===e.memberOrgType?this.disabled=!0:this.disabled=!1},deep:!0,immediate:!0}},created:function(){this.onGetuserinfo()},methods:{init:function(){var e,t=this,r=Object(u["a"])({},this.queryItems);r.busiYear=this.busiYear,r.leafTypeCode&&0!==(null===(e=r.leafTypeCode)||void 0===e?void 0:e.length)&&(r.leafTypeCode=r.leafTypeCode.reverse()[0]),this._apis.query(r).then((function(e){var r=e.rows,n=["zhej","gsptgx","jdy","ckbhgx"],i=Object(w["c"])(n,r,t.unitstr,"/"),a=i.map((function(e){for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t)){var r=e[t];n.includes(t)&&!r&&(e[t]=0)}return e.zhej=e.jdy+e.gsptgx,e}));t.tableData=a})).finally((function(){t.loading=!1}))},resetHandle:function(){this.brandId=void 0,this.init()},footerCellClassName:function(e){var t=e.$rowIndex,r=e.columnIndex;return 1===r&&0===t?"col-blue":2===r&&1===t?"col-red":void 0},updateFooterEvent:function(){var e=this.$refs.xTable;e.updateFooter()},selectedStatusList:function(e){this.findlabel(e[e.length-1])},exportFile:function(){},handleSubmit:function(){var e=this,t=Object(w["c"])(["zhej","gsptgx","jdy","ckbhgx","total"],this.tableDataChildren,this.unitstr,"*");t.length>0?($ec.showLoading(),this._apis.update(t).then((function(){setTimeout((function(){e.operate=!0}),800)})).finally((function(){e.init(),$ec.hideLoading()}))):(this.$message.warning("取消编辑"),this.operate=!0)},handleCancel:function(){this.operate=!0,this.init()},onGetuserinfo:function(){var e=this;return Object(l["a"])(Object(o["a"])().mark((function t(){var r,n,i,a;return Object(o["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$apis.bpm.executionEnter.getOrgCode({});case 2:return r=t.sent,n=r.orgCode,i=r.orgTypeEk,t.next=7,e._apis.getParamsByCode();case 7:a=t.sent,e.ispush="0"===a,e.orgCode=n,e.orgType="TOBACCO"===i?"O":"I",e.init();case 12:case"end":return t.stop()}}),t)})))()},findlabel:function(e){var t,r=Object(a["a"])(this.statusValOptions);function n(e,r){e.forEach((function(e){return e.value===r?(t=e.label,!1):"children"in e&&void n(e.children,r)}))}n(r,e),this.label=t}}},_=O,j=(r("1d801"),Object(b["a"])(_,n,i,!1,null,"b36e6b50",null));t["default"]=j.exports},5530:function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));r("b64b"),r("a4d3"),r("4de4"),r("d3b7"),r("e439"),r("159b"),r("dbb4");function n(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function a(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach((function(t){n(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}},"7ad5":function(e,t,r){},a0a9:function(e,t,r){},b04f:function(e,t,r){"use strict";r("a0a9")},f2be:function(e,t,r){"use strict";r.d(t,"f",(function(){return u})),r.d(t,"g",(function(){return c})),r.d(t,"a",(function(){return s})),r.d(t,"h",(function(){return d})),r.d(t,"b",(function(){return f})),r.d(t,"e",(function(){return p})),r.d(t,"d",(function(){return h})),r.d(t,"c",(function(){return b}));var n=r("2909"),i=(r("d3b7"),r("159b"),r("ac16"),r("f8c9"),r("4de4"),r("4ec9"),r("3ca3"),r("ddb0"),r("d9e2"),r("a630"),r("6062"),r("0644")),a=r.n(i),o=r("60ed"),l=r.n(o);function u(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{pkey:"pkey",key:"key",title:"title",children:"children"},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{pkey:"pkey",children:"children"};if(!Array.isArray(e))return console.error("请传入一个list数组");e.forEach((function(n){var i=n[r.pkey];i&&e.forEach((function(e){var o=e;if(t)for(var l in t)String(l)!==String(t[l])&&(Array.isArray(o[t[l]])||o[t[l]]instanceof Object?o[l]=a()(o[t[l]]):o[l]=o[t[l]],Reflect.deleteProperty(o,t[l]));o&&o.key===i&&(o[r.children]=o[r.children]||[],o[r.children].push(n))}))}));var n=e.every((function(e){return e[t.pkey]}));return n?console.error("至少有一个根节点pid为null数组或传入一个空数组",e):e.filter((function(e){return!e[r.pkey]}))}function c(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{pkey:"pkey",key:"key",title:"title"},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"children";if(!Array.isArray(e))return console.error("请传入一个tree数组");var i=[],o=a()(e),l=Object(n["a"])(o);while(l.length){var u=l.shift(),c=u[r];if(c&&l.push.apply(l,Object(n["a"])(c)),t)for(var s in t)String(s)!==String(t[s])&&(Array.isArray(u[t[s]])||u[t[s]]instanceof Object?u[s]=a()(u[t[s]]):u[s]=u[t[s]],Reflect.deleteProperty(u,t[s]));Reflect.deleteProperty(u,r),i.push(u)}return 0===i.length?e:i}function s(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){return!0},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{pkey:"pkey",key:"key",title:"title"};if(!Array.isArray(e))return console.error("请传入一个tree数组");var n=a()(e),i=c(n,r);return i.filter((function(e){return!!t(e)}))}function d(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"key";if(!Array.isArray(e))return console.error("请传入一个数组");if(!e||0===e.length||!l()(e[0]))return Array.from(new Set(e));var r=new Map;return e.forEach((function(e){if(!e[t])throw new Error("prop参数不匹配，在节点找不到对应的值");r.set(e[t],e)})),0!==r.size?Array.from(r.values()):void 0}function f(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{pkey:"pkey",key:"key",title:"title"},n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{pkey:"pkey",key:"key"};if(!Array.isArray(e))return console.error("请传入一个tree数组");var i=new Set,a=c(e,r);function o(e,t){e.forEach((function(r){String(r[n.key])===String(t)&&(i.add(r[n.key]),r.isLeaf&&i.delete(r[n.key]),o(e,r[n.pkey]))}))}return o(a,t),Array.from(i).reverse().filter((function(e){return e!==t}))}function p(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"key",n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{pkey:"pkey",key:"key",title:"title"},i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{pkey:"pkey",key:"key"};if(!Array.isArray(e))return console.error("请传入一个tree数组");var a=new Set,o=c(e,n);function l(e,t){e.forEach((function(n){String(n[i.key])===String(t)&&(a.add(n[r]),l(e,n[i.pkey]))}))}return l(o,t),Array.from(a).reverse()}function h(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"key",n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{pkey:"pkey",key:"key",title:"title"};if(!Array.isArray(e))return console.error("请传入一个tree数组");var i=c(e,n),a=i.filter((function(e){return String(e[r])===String(t)}));return Array.isArray(a)&&1===a.length?a[0]:null}function b(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{key:"key",label:"title"};if(!Array.isArray(e))return console.error("请传入一个字典数组");var n=e.filter((function(e){return String(e[r.key])===String(t)}));return n&&0!==n.length?n[0][r.label]:""}},fa7d:function(e,t,r){"use strict";r.d(t,"c",(function(){return a})),r.d(t,"a",(function(){return o}));var n=r("5530"),i=(r("2909"),r("d3b7"),r("b64b"),r("ddb0"),r("13d5"),r("4ec9"),r("3ca3"),r("2b3d"),r("9861"),r("d81d"),r("caad"),r("2532"),r("a9e3"),r("f2be"));r.d(t,"b",(function(){return i["c"]}));Object.prototype.toString,function(){document.addEventListener}(),function(){document.removeEventListener}();var a=function(e,t,r,i){return null===t||void 0===t?void 0:t.map((function(t){var a=Object(n["a"])({},t);for(var o in t)e.includes(o)&&("/"===i?a[o]/=r:a[o]*=r);return a}))},o=function(e,t){if(e){var r=document.createElement("a");r.style.display="none",r.href=e,r.setAttribute("download",t),document.body.appendChild(r),r.click(),document.body.removeChild(r)}}}}]);
//# sourceMappingURL=chunk-338084a0.adee859e.js.map