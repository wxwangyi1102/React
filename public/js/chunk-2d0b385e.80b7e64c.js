(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0b385e"],{2978:function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ec-container",{attrs:{height:"100%",title:"采集批次计划量查询",icon:"onetomany","color-code":"008"}},[a("ec-container-body",[a("ec-panel",{attrs:{auto:!1}},[a("ec-panel-toolbar",[a("ec-query-panel",{on:{query:function(t){return e.$refs.table.pageAction(1)},reset:e.onReset}},[a("ec-query-item",{attrs:{label:"业务年度"}},[a("a-input-number",{attrs:{min:2e3,max:2099},model:{value:e.queryItems.busiYear,callback:function(t){e.$set(e.queryItems,"busiYear",t)},expression:"queryItems.busiYear"}})],1),a("ec-query-item",{attrs:{label:"采集批次"}},[a("a-select",{attrs:{"allow-clear":"",placeholder:"请选择"},model:{value:e.queryItems.batchName,callback:function(t){e.$set(e.queryItems,"batchName",t)},expression:"queryItems.batchName"}},e._l(e.batchList,(function(t){return a("a-select-option",{key:t.batchName},[e._v(" "+e._s(t.batchName)+" ")])})),1)],1),a("ec-query-item",{attrs:{label:"中烟工业"}},[a("a-select",{attrs:{placeholder:"请选择"},model:{value:e.queryItems.demandOrgCid,callback:function(t){e.$set(e.queryItems,"demandOrgCid",t)},expression:"queryItems.demandOrgCid"}},e._l(e.industryUnitList,(function(t){return a("a-select-option",{key:t.demandOrgCode},[e._v(" "+e._s(t.demandOrgName)+" ")])})),1)],1)],1),a("ec-divider")],1),a("ec-panel-header",[a("ec-v-item",[a("ec-panel-item",[a("ec-panel-item-right",[a("span",{staticClass:"ant-form-text"},[e._v(" 计量单位： "+e._s(e.weightUnitName))])])],1)],1)],1),a("ec-panel-body",[a("ec-table",{ref:"table",attrs:{border:"",height:"100%",auto:!1,pagination:e.pagination,data:e.tableData.rows,loading:e.loading,"row-select":"","show-footer":"","footer-method":e.footerMethod},on:{"page-action":e.handlePagination,"checkbox-all":e.selectAllEvent,"checkbox-change":e.selectRowChange}},[a("ec-table-col",{attrs:{width:"70",title:"序号",type:"seq",align:"center"}}),a("ec-table-col",{attrs:{field:"busiYear",title:"业务年度",align:"center",width:"130"}}),a("ec-table-col",{attrs:{field:"batchName",title:"采集批次",align:"left","min-width":"150"}}),a("ec-table-col",{attrs:{field:"orgName",title:"中烟工业",align:"left","min-width":"150"}}),a("ec-table-col",{attrs:{field:"crudeWeight",title:"烤烟计划量",align:"right",width:"150"}}),a("ec-table-col",{attrs:{field:"sunCuredWeight",title:"晾晒烟计划量",align:"right",width:"150"}}),a("ec-table-col",{attrs:{field:"rtPlanWeight",title:"再造烟叶计划量",align:"right",width:"150"}})],1)],1)],1)],1)],1)},i=[],r=a("c7eb"),o=a("1da1"),s=(a("7db0"),a("d3b7"),a("159b"),a("b680"),a("e9c4"),a("a9e3"),a("d81d"),a("caad"),a("99af"),a("2ef0")),c=a.n(s),l={name:"BatchManage",components:{},data:function(){return{queryItems:{busiYear:"",batchName:"",demandOrgCid:void 0},orgCodeList:[],yearList:[],bizYear:"",loading:!1,batchList:[],industryUnitList:[],industryUnitTreeData:[],fieldNames:{label:"orgAbbr",value:"orgUniqueCode",children:"children"},pagination:{pageNumber:1,pageSize:10,total:0},bizCode:"",oldRows:[],weightUnit:5e5,weightUnitName:"万担",tableData:{rows:[]}}},computed:{appConfig:function(){return this.$store.getters.getAppConfig}},created:function(){var e=this.$router.history.current.query.appCode;this.appCode=e||"CM"},methods:{onQuery:function(){var e=this,t=this.queryItems.batchName,a="全部"===t?"":t,n=this.batchList.find((function(e){return e.batchName===t})),i=this.industryUnitList.find((function(t){return t.demandOrgCode===e.queryItems.demandOrgCid})),r={pageNo:this.pagination.pageNumber,pageSize:this.pagination.pageSize,busiYear:this.queryItems.busiYear,batchName:a,demandOrgCode:(null===i||void 0===i?void 0:i.demandOrgCode)||"",needCollectBatchId:(null===n||void 0===n?void 0:n.needCollectBatchId)||""};this.loading=!0,this.$apis.apm.demandQuery.query(r).then((function(t){e.pagination.total=t.totalRows;var a=null===t||void 0===t?void 0:t.rows,n=c.a.cloneDeep(a);e.handleUnitParse(n),e.loading=!1})).catch((function(t){e.loading=!1,console.log(t)}))},handleUnitParse:function(e){var t=this,a=[],n=e;n.forEach((function(e){var n=e;n.crudeWeight=(n.crudeWeight/t.weightUnit).toFixed(2),n.sunCuredWeight=(n.sunCuredWeight/t.weightUnit).toFixed(2),n.rtPlanWeight=(n.rtPlanWeight/t.weightUnit).toFixed(2),a.push(n)})),this.tableData.rows=a},onAdd:function(){this.$refs.BatchManageForm.show()},onEdit:function(e){var t=Object.assign({},e);this.$refs.BatchManageForm.show(t)},onDel:function(){var e=this,t=this.$createElement;!this.selectedRows||this.selectedRows.length<=0?this.$message.error("请选择一条数据再删除"):this.$confirm({title:"是否执行该操作?",content:function(){return t("div",{style:"color:red;"},["是否确认删除选中的数据，确认请点击'确认'按钮，取消点击'取消'按钮。"])},onOk:function(){e.loading=!0;for(var t=[],a=0;a<e.selectedRows.length;a++)t.push(e.selectedRows[a].leafColorId);e.$apis.tbm.tabaccoColor.delete({ids:t}).then((function(t){console.log(JSON.stringify(t)),t.result?(e.loading=!1,e.$refs.table.pageAction(1),e.$message.success("操作成功")):e.$message.error("操作失败")})).catch((function(t){e.loading=!1,t?e.$message.error(t.message||"操作失败"):e.$message.error("操作失败")}))}})},onReset:function(){this.queryItems.busiYear=this.bizYear,this.queryItems.demandOrgCid=void 0,this.queryItems.batchName=this.defaultBatchName,this.orgCodeList=[],this.$refs.table.pageAction(1)},handlePagination:function(e,t){var a=this;return Object(o["a"])(Object(r["a"])().mark((function n(){return Object(r["a"])().wrap((function(n){while(1)switch(n.prev=n.next){case 0:return a.pagination.pageNumber=e,a.pagination.pageSize=t,n.next=4,a.handleGetYear();case 4:case"end":return n.stop()}}),n)})))()},handleGetYear:function(){var e=this;return Object(o["a"])(Object(r["a"])().mark((function t(){var a,n,i,o,s,c,l,d,u,h;return Object(r["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(""!==e.queryItems.busiYear){t.next=30;break}if(e.orgCode){t.next=7;break}return t.next=4,e.$apis.bim.curOrg.get({});case 4:a=t.sent,e.bizCode=null===a||void 0===a?void 0:a.bizCode,e.orgCode=null===a||void 0===a?void 0:a.orgUniqueCode;case 7:return n={bizCode:e.appConfig.bizCode,appCode:e.appCode,yearTypeCode:"BIZ_YEAR"},t.next=10,e.$apis.bpm.executionEnter.getBuYear(n);case 10:return i=t.sent,o=(null===i||void 0===i?void 0:i.yearValue)||(new Date).getFullYear(),e.queryItems.busiYear=o,e.bizYear=o,console.log("业务年度".concat(o)),s={busiYear:o},t.next=18,e.$apis.apm.demandManage.queryBatch(s);case 18:return c=t.sent,l=(null===c||void 0===c?void 0:c.rows)||[],l&&l.length>0&&l.unshift({batchName:"全部"}),e.batchList=l,d=l&&l.length>0?l[0].batchName:"",e.queryItems.batchName=d,e.defaultBatchName=d,u={busiYear:o,pageStatus:"amount"},t.next=28,e.$apis.apm.demandQuery.queryIndustry(u);case 28:h=t.sent,e.industryUnitList=h.rows||[];case 30:return t.next=32,e.onQuery();case 32:case"end":return t.stop()}}),t)})))()},handleListToTree:function(e){var t={};e.forEach((function(e){t[e.orgUniqueCode]=e}));var a=[];return e.forEach((function(e){var n=t[e.parentOrgUniqueCode];n?(n.children=n.children||[],n.children.push(e)):a.push(e)})),1===a.length?a[0].children:a},sumNum:function(e,t){var a=0;return e.forEach((function(e){a+=Number(e[t]||0)})),a.toFixed(2)},footerMethod:function(e){var t=this,a=e.columns,n=e.data;return[a.map((function(e,a){return 0===a?"合计":["cruedWeight","sunCuredWeight","rtPlanWeight"].includes(e.property)?t.sumNum(n,e.property):null}))]},selectAllEvent:function(e){var t=e.checked,a=e.records;console.log("".concat(t,"-选中所有records包含选中的所以对象----").concat(JSON.stringify(a))),this.selectedRows=a},selectRowChange:function(e){var t=e.checked,a=e.records;console.log("".concat(t,"-选择改变时会把records包含选中的所以对象----").concat(JSON.stringify(a))),this.selectedRows=a}}},d=l,u=a("2877"),h=Object(u["a"])(d,n,i,!1,null,null,null);t["default"]=h.exports}}]);
//# sourceMappingURL=chunk-2d0b385e.80b7e64c.js.map