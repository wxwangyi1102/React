(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d21aadf"],{bd18:function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ec-container",{attrs:{height:"100%","color-code":"001",title:"基地单元数量设置","show-title":"",icon:"com-zhifuguanli"}},[a("ec-container-body",[a("ec-panel",{attrs:{auto:!1}},[a("ec-panel-toolbar",[a("ec-query-panel",{attrs:{defaultFold:!0},on:{query:function(t){return e.$refs.xTable.pageAction(1)},reset:e.resetHandle}},[a("ec-query-item",{attrs:{label:"工/商业"}},[a("ec-select",{attrs:{showSearch:"",allowClear:"",placeholder:"商业公司"},model:{value:e.query.orgTypeEk,callback:function(t){e.$set(e.query,"orgTypeEk","string"===typeof t?t.trim():t)},expression:"query.orgTypeEk"}},e._l(e.companyList,(function(t){return a("a-select-option",{key:t.id,attrs:{value:t.id}},[e._v(" "+e._s(t.name)+" ")])})),1)],1),a("ec-query-item",{attrs:{label:"集中交易年度"}},[a("a-input-number",{attrs:{disabled:""},on:{change:function(t){return e.$refs.xTable.pageAction(1)}},model:{value:e.query.busiYear,callback:function(t){e.$set(e.query,"busiYear",t)},expression:"query.busiYear"}})],1)],1),a("ec-divider")],1),a("ec-panel-body",[a("ec-v-layout",{attrs:{auto:!1}},[a("ec-v-item",{attrs:{height:"auto"}},[a("ec-panel-toolbar",[a("ec-panel-item-left",[a("a-button",{attrs:{type:"primary",ghost:""},on:{click:e.sendHandle}},[e._v("下发")])],1)],1)],1),a("ec-v-item",[a("ec-table",{ref:"xTable",attrs:{height:"100%","show-overflow":"",auto:!1,loading:e.loading,data:e.tableData,"edit-config":{trigger:"click",mode:"row"},"checkbox-config":{checkMethod:e.checCheckboxkMethod},"row-select":""},on:{"page-action":e.onQuery,"checkbox-all":e.selectAllEvent,"checkbox-change":e.selectRowChange}},[a("ec-table-col",{attrs:{type:"checkbox",width:"60",align:"center"}}),a("ec-table-col",{attrs:{type:"seq",title:"序号",width:"50",align:"center"}}),a("ec-table-col",{attrs:{field:"orgName",title:"单位名称",align:"center"}}),a("ec-table-col",{attrs:{field:"baseUnitCnt",title:"新建单元数量",align:"center","edit-render":{}},scopedSlots:e._u([{key:"edit",fn:function(t){var n=t.row;return[a("a-input",{model:{value:n.baseUnitCnt,callback:function(t){e.$set(n,"baseUnitCnt",t)},expression:"row.baseUnitCnt"}})]}}])}),a("ec-table-col",{attrs:{field:"remark",title:"办理依据",align:"center","edit-render":{}},scopedSlots:e._u([{key:"edit",fn:function(t){var n=t.row;return[a("a-input",{model:{value:n.remark,callback:function(t){e.$set(n,"remark",t)},expression:"row.remark"}})]}}])}),a("ec-table-col",{attrs:{field:"issuedState",title:"下发状态",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(0==a.issuedState?"未下发":"已下发")+" ")]}}])})],1)],1)],1)],1)],1)],1),a("ec-container-footer",[a("a-button",{attrs:{type:"primary"},on:{click:e.onSave}},[e._v("保存")]),a("a-button",{on:{click:e.handleRest}},[e._v("重置")])],1)],1)},r=[],s=a("c7eb"),i=a("1da1"),o=(a("d81d"),a("d3b7"),{name:"PanelSupple",data:function(){return{query:{busiYear:"",orgTypeEk:"TOBACCO"},companyList:[{name:"商业公司",id:"TOBACCO"},{name:"工业公司",id:"INDUSTRY"}],tableData:[],loading:!1,appCode:void 0,busiYear:0}},computed:{appConfig:function(){return this.$store.getters.getAppConfig}},created:function(){var e=this;return Object(i["a"])(Object(s["a"])().mark((function t(){var a;return Object(s["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=e.$router.history.current.query.appCode,e.appCode=a||"CM",t.next=4,e.handleGetYear();case 4:case"end":return t.stop()}}),t)})))()},methods:{onQuery:function(){var e=this;this.loading=!0,this.$apis.apm.baseSetting.query(this.query).then((function(t){e.tableData=t.rows,e.loading=!1})).catch((function(){e.loading=!1}))},handleGetYear:function(){var e=this;return Object(i["a"])(Object(s["a"])().mark((function t(){var a,n,r;return Object(s["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$apis.common.user.get({});case 2:return a=t.sent,n={bizCode:a.orgCode,yearTypeCode:"CENTER_YEAR",appCode:e.appCode},t.next=6,e.$apis.apm.baseSetting.getBuYear(n);case 6:r=t.sent,e.query.busiYear=r.yearValue,e.busiYear=r.yearValue,e.$refs.xTable.pageAction(1);case 10:case"end":return t.stop()}}),t)})))()},resetHandle:function(){this.query.orgTypeEk="TOBACCO",this.$refs.xTable.pageAction(1)},sendHandle:function(){var e=this;if(!this.selectedRows||this.selectedRows.length<=0)this.$message.error("请选择一条数据再下发");else{var t=this.selectedRows.map((function(e){return e.bmUnitPlanId}));if(t.some((function(e){return""===e})))this.$message.warning("暂无符合下发条件！");else{var a={bmUnitPlanIds:t};this.$apis.apm.baseSetting.send(a).then((function(t){!0===t.result&&(e.$message.success("下发成功！"),e.$refs.xTable.pageAction(1))}))}}},checCheckboxkMethod:function(e){var t=e.row;return"0"===t.issuedState},onSave:function(){var e=this,t={busiYear:this.busiYear,saveUnitList:this.tableData};this.$apis.apm.baseSetting.save(t).then((function(t){!0===t.result&&(e.$message.success("保存成功！"),e.$refs.xTable.pageAction(1))}))},handleRest:function(){this.$refs.xTable.pageAction(1)},selectAllEvent:function(e){var t=e.records;this.selectedRows=t},selectRowChange:function(e){var t=e.records;this.selectedRows=t}}}),c=o,l=a("2877"),u=Object(l["a"])(c,n,r,!1,null,"4fb4b90e",null);t["default"]=u.exports}}]);
//# sourceMappingURL=chunk-2d21aadf.a7e077ec.js.map