(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-410154b8"],{"01d0":function(e,t,a){},"4fbc":function(e,t,a){"use strict";a("8c06")},5530:function(e,t,a){"use strict";a.d(t,"a",(function(){return o}));a("b64b"),a("a4d3"),a("4de4"),a("d3b7"),a("e439"),a("159b"),a("dbb4");function i(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function n(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?n(Object(a),!0).forEach((function(t){i(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):n(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}},"8c06":function(e,t,a){},b557:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ec-container",{staticClass:"info",attrs:{height:"100%","color-code":"001",title:"基地单元信息维护","show-title":""}},[a("ec-container-body",[a("ec-panel",{attrs:{auto:!1}},[a("ec-panel-toolbar",[a("ec-query-panel",{attrs:{defaultFold:!0},on:{query:e.onQuery,reset:e.resetHandle}},[a("ec-query-item",{attrs:{label:"基地单元名称"}},[a("a-input",{attrs:{placeholder:"请输入基地单元名称"},model:{value:e.query.baseCellName,callback:function(t){e.$set(e.query,"baseCellName","string"===typeof t?t.trim():t)},expression:"query.baseCellName"}})],1)],1),a("ec-divider")],1),a("ec-panel-body",[a("ec-v-layout",{attrs:{auto:!1}},[a("ec-v-item",{attrs:{height:"auto"}},[a("ec-panel-toolbar",["1"!==e.appConfig.orgLevelEk?a("ec-panel-item-left",[a("a-button",{attrs:{type:"primary"},on:{click:function(t){return e.handleUpdate(null)}}},[e._v("新增")]),a("a-button",{attrs:{type:"primary",ghost:""},on:{click:e.onDel}},[e._v("删除")])],1):e._e(),a("ec-panel-item-right",[a("div",{staticClass:"unit-box"},[a("span",[e._v("集中交易年度："+e._s(e.busiYear)+"年")]),a("div",{staticClass:"select"},[e._v(" 重量单位： "),a("ec-select",{attrs:{showSearch:""},model:{value:e.weightUnit,callback:function(t){e.weightUnit="string"===typeof t?t.trim():t},expression:"weightUnit"}},e._l(e.weightUnitList,(function(t){return a("a-select-option",{key:t.enumKey},[e._v(" "+e._s(t.name)+" ")])})),1)],1),a("div",{staticClass:"select"},[e._v(" 面积单位： "),a("ec-select",{attrs:{showSearch:""},model:{value:e.areaUnit,callback:function(t){e.areaUnit="string"===typeof t?t.trim():t},expression:"areaUnit"}},e._l(e.areaUnitList,(function(t){return a("a-select-option",{key:t.enumKey},[e._v(" "+e._s(t.name)+" ")])})),1)],1)])])],1)],1),"1"!==e.appConfig.orgLevelEk?a("ec-v-item",{attrs:{height:"auto"}},[a("div",{staticClass:"side-info"},[a("p",[a("strong",[e._v("辅助信息")]),e._v("国家局设置新建单元数据为："),a("strong",[e._v(e._s(e.sideInfo.baseUnitCnt))]),e._v("个，已增加："),a("strong",[e._v(e._s(e.sideInfo.baseUnitCntSet))]),e._v("个，剩余："),a("strong",[e._v(e._s(e.sideInfo.baseUnitCntUnSet))]),e._v("个。 ")])])]):e._e(),a("ec-v-item",[a("ec-table",{ref:"tableRef",attrs:{loading:e.loading,"show-overflow":"",height:"100%",auto:!1,pagination:e.pagination,data:e.tableData},on:{"page-action":e.pageAction,"checkbox-all":e.selectAllEvent,"checkbox-change":e.selectRowChange}},[a("ec-table-col",{attrs:{type:"checkbox",width:"60",align:"center"}}),a("ec-table-col",{attrs:{type:"seq",title:"序号",width:"50",align:"center"}}),a("ec-table-col",{attrs:{field:"provOrgName",title:"省公司","min-width":"150",align:"left"}}),a("ec-table-col",{attrs:{field:"cityOrgName",title:"市公司","min-width":"150",align:"left"}}),a("ec-table-col",{attrs:{field:"provDivisionName",title:"省","min-width":"150",align:"left"}}),a("ec-table-col",{attrs:{field:"cityDivisionName",title:"地(州、市)","min-width":"150",align:"left"}}),a("ec-table-col",{attrs:{field:"counDivisionName",title:"县(区、市)","min-width":"150",align:"left"}}),a("ec-table-col",{attrs:{field:"baseCellCode",title:"基地单元编码","min-width":"150",align:"left"}}),a("ec-table-col",{attrs:{field:"baseCellName",title:"基地单元名称","min-width":"150",align:"left"}}),a("ec-table-col",{attrs:{field:"linkInduProvOrgName",title:"省级工业公司","min-width":"150",align:"left"}}),a("ec-table-col",{attrs:{field:"linkInduOrgName",title:"对口工业企业","min-width":"150",align:"left"}}),a("ec-table-col",{attrs:{field:"leafTypeCode",title:"烟叶类型","min-width":"150",align:"left"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;return[a("div",[e._v(" "+e._s(e._f("getNameBy")(i.leafTypeCode,e.leafTypeObj))+" ")])]}}])}),a("ec-table-col",{attrs:{field:"fieldArea",title:"基本烟田面积","min-width":"150",align:"left"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;return[a("div",[e._v(e._s(e._f("amountFormat")(i.fieldArea,e.areaUnit)))])]}}])}),a("ec-table-col",{attrs:{field:"plantArea",title:"种植面积","min-width":"150",align:"left"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;return[a("div",[e._v(e._s(e._f("amountFormat")(i.plantArea,e.areaUnit)))])]}}])}),a("ec-table-col",{attrs:{field:"buyWeight",title:"收购量","min-width":"150",align:"left"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;return[a("div",[e._v(e._s(e._f("amountFormat")(i.buyWeight,e.weightUnit)))])]}}])}),a("ec-table-col",{attrs:{field:"techSuppOrg",title:"技术依托单位","min-width":"150",align:"left"}}),a("ec-table-col",{attrs:{field:"unitProp",title:"单元属性","min-width":"150",align:"left"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;return[a("div",[e._v(" "+e._s(e._f("getNameBy")(i.unitProp,e.unitPropList,{key:"enumKey",label:"name"}))+" ")])]}}])}),a("ec-table-col",{attrs:{field:"linkUpState",title:"状态",width:"100",align:"left"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;return[a("div",[e._v(" "+e._s(e._f("getNameBy")(i.linkUpState,e.linkUpStateObj))+" ")])]}}])}),"1"===e.appConfig.orgLevelEk||"2"===e.appConfig.orgLevelEk?a("ec-table-col",{attrs:{title:"操作",width:"80",align:"right"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;return[a("a-button",{attrs:{type:"link"},on:{click:function(t){return e.onEdit(i)}}},[e._v("编辑")])]}}],null,!1,4157271804)}):e._e()],1)],1)],1)],1)],1),a("business-org-manage-edit",{ref:"editRef",attrs:{orgList:e.orgList,busiYear:e.busiYear,leafTypeList:e.leafTypeList,sideInfo:e.sideInfo},on:{onQuery:e.onQuery}})],1)],1)},n=[],o=a("c7eb"),r=a("5530"),l=a("1da1"),s=(a("d81d"),a("b0c0"),function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("ec-drawer",{attrs:{title:e.formData.bmUnitLinkRecId?"编辑":"新增",visible:e.visible,size:"small","is-confirm":!0},on:{close:e.handleCancel}},[a("ec-container",{attrs:{height:"auto"}},[a("ec-container-body",[a("ec-panel",[a("ec-panel-item",[a("ec-v-item",{attrs:{height:"auto"}},[a("div",{staticClass:"side-info"},[a("p",[a("strong",[e._v("辅助信息")]),e._v("国家局设置新建单元数据为："),a("strong",[e._v(e._s(e.sideInfo.baseUnitCnt))]),e._v("个，已增加："),a("strong",[e._v(e._s(e.sideInfo.baseUnitCntSet))]),e._v("个，剩余："),a("strong",[e._v(e._s(e.sideInfo.baseUnitCntUnSet))]),e._v("个。 ")])])]),a("ec-form",{ref:"ruleForm",attrs:{model:e.formData,rules:e.rules}},[a("a-row",{attrs:{type:"flex",gutter:12}},[a("a-col",{attrs:{span:12}},[a("a-form-model-item",{attrs:{label:"商业单位",prop:"counOrgCode"}},[a("select-picker",{attrs:{join:"",title:"选择商业单位",lazy:!1,search:!1,fetchData:e.fetchGetTree,placeholder:"请选择商业名称",beforeOk:e.onBeforeOkOrg},on:{ok:e.onSelOrg},model:{value:e.formData.counOrgCode,callback:function(t){e.$set(e.formData,"counOrgCode",t)},expression:"formData.counOrgCode"}})],1)],1),a("a-col",{attrs:{span:12}},[a("a-form-model-item",{attrs:{label:"所在行政区划",prop:"counDivisionCode"}},[a("division-picker",{attrs:{join:"",beforeOk:e.onBeforeOkDivision,placeholder:"请选择"},on:{ok:e.onSelDivision},model:{value:e.formData.counDivisionCode,callback:function(t){e.$set(e.formData,"counDivisionCode","string"===typeof t?t.trim():t)},expression:"formData.counDivisionCode"}})],1)],1),a("a-col",{attrs:{span:12}},[a("a-form-model-item",{attrs:{label:"基地单元编码",prop:"baseCellCode"}},[a("a-input",{attrs:{placeholder:"保存后自动生成",autocomplete:"off",disabled:""},model:{value:e.formData.baseCellCode,callback:function(t){e.$set(e.formData,"baseCellCode",t)},expression:"formData.baseCellCode"}})],1)],1),a("a-col",{attrs:{span:12}},[a("a-form-model-item",{attrs:{label:"基地单元名称",prop:"baseCellName"}},[a("a-input",{attrs:{placeholder:"请输入基地单元名称",autocomplete:"off"},model:{value:e.formData.baseCellName,callback:function(t){e.$set(e.formData,"baseCellName",t)},expression:"formData.baseCellName"}})],1)],1),a("a-col",{attrs:{span:12}},[a("a-form-model-item",{attrs:{label:"烟叶类型",prop:"leafTypeCode"}},[a("ec-select",{attrs:{showSearch:"",allowClear:"",placeholder:"请选择烟叶类型"},model:{value:e.formData.leafTypeCode,callback:function(t){e.$set(e.formData,"leafTypeCode","string"===typeof t?t.trim():t)},expression:"formData.leafTypeCode"}},e._l(e.leafTypeList,(function(t){return a("a-select-option",{key:t.leafTypeCode},[e._v(" "+e._s(t.leafTypeName)+" ")])})),1)],1)],1),a("a-col",{attrs:{span:12}},[a("a-form-model-item",{attrs:{label:"技术依托单位",prop:"techSuppOrg"}},[a("a-input",{attrs:{autocomplete:"off",placeholder:"请输入技术依托单位"},model:{value:e.formData.techSuppOrg,callback:function(t){e.$set(e.formData,"techSuppOrg",t)},expression:"formData.techSuppOrg"}})],1)],1),a("a-col",{attrs:{span:12}},[a("a-form-model-item",{attrs:{label:"基本烟田面积（万亩）",prop:"fieldAreaTemp"}},[a("a-input-number",{attrs:{placeholder:"请输入基本烟田面积",autocomplete:"off"},model:{value:e.formData.fieldAreaTemp,callback:function(t){e.$set(e.formData,"fieldAreaTemp",t)},expression:"formData.fieldAreaTemp"}})],1)],1),a("a-col",{attrs:{span:12}},[a("a-form-model-item",{attrs:{label:"种植面积（万亩）",prop:"plantAreaTemp"}},[a("a-input-number",{attrs:{placeholder:"请输入种植面积",autocomplete:"off"},model:{value:e.formData.plantAreaTemp,callback:function(t){e.$set(e.formData,"plantAreaTemp",t)},expression:"formData.plantAreaTemp"}})],1)],1),a("a-col",{attrs:{span:12}},[a("a-form-model-item",{attrs:{label:"收购量（万担）",prop:"buyWeightTemp"}},[a("a-input-number",{attrs:{placeholder:"请输入收购量",autocomplete:"off"},model:{value:e.formData.buyWeightTemp,callback:function(t){e.$set(e.formData,"buyWeightTemp",t)},expression:"formData.buyWeightTemp"}})],1)],1),a("a-col",{attrs:{span:12}},[a("a-form-model-item",{attrs:{label:"创建年度",prop:"createYear"}},[a("a-input-number",{attrs:{disabled:""},model:{value:e.formData.createYear,callback:function(t){e.$set(e.formData,"createYear",t)},expression:"formData.createYear"}})],1)],1)],1)],1)],1)],1)],1),a("ec-container-footer",[a("a-button",{attrs:{type:"primary"},on:{click:e.handleSubmit}},[e._v("保存")]),a("a-button",{on:{click:e.handleCancel}},[e._v("关闭")])],1)],1)],1)],1)}),c=[],u=(a("a4e1"),a("b3a0")),f=a.n(u),d=(a("6198"),a("6fc0")),p=a.n(d),m=(a("a9e3"),a("d3b7"),a("6ea6")),h={name:"BusinessOrgManageEdit",components:{SelectPicker:p.a,DivisionPicker:f.a},props:{busiYear:{type:Number,default:0},orgList:{type:Array,default:function(){return[]}},leafTypeList:{type:Array,default:function(){return[]}},sideInfo:{type:Object,default:function(){}}},data:function(){return{visible:!1,formData:{citcOrgCode:"",counOrgCode:""},rules:{counOrgCode:{required:!0,message:"请选择商业单位"},counDivisionCode:{required:!0,message:"请选择所在行政区划"},baseCellName:{required:!0,message:"请输入基地单元名称"},leafTypeCode:{required:!0,message:"请选择烟叶类型"},fieldAreaTemp:{required:!0,message:"请输入基本烟田面积"},plantAreaTemp:{required:!0,message:"请输入种植面积"},buyWeightTemp:{required:!0,message:"请输入收购量"}},buyWeightTemp:void 0}},methods:{show:function(e){this.visible=!0,e?(this.formData=e,this.$set(this.formData,"fieldAreaTemp",Number(this.formData.fieldArea)/1e4),this.$set(this.formData,"plantAreaTemp",Number(this.formData.plantArea)/1e4),this.$set(this.formData,"buyWeightTemp",Number(this.formData.buyWeight)/5e5),this.buyWeightTemp=e.buyWeight):(this.formData.busiYear=this.busiYear,this.formData.createYear=this.busiYear)},onSelDivision:function(e){var t=null===e||void 0===e?void 0:e.selectOption,a=(null===e||void 0===e?void 0:e.treeData)||[],i=Object(m["getSelectedBy"])(a,t.key);this.formData.provDivisionCode=i[1],this.formData.cityDivisionCode=i[2],this.formData.counDivisionCode=i[3]},onSelOrg:function(e){var t=null===e||void 0===e?void 0:e.selectOption,a=(null===e||void 0===e?void 0:e.treeData)||[],i=Object(m["getSelectedBy"])(a,t.key);this.formData.provOrgCode=i[0],this.formData.cityOrgCode=i[1],this.formData.counOrgCode=i[2]},fetchGetTree:function(){var e=this;return new Promise((function(t){var a={pkey:"parentBizCode",title:"orgName",key:"bizCode",children:"children"},i=Object(m["treeFormatList"])(e.orgList,a);t(i)}))},handleSubmit:function(){var e=this;this.$refs.ruleForm.validate((function(t){t?(e.formData.fieldArea=1e4*Number(e.formData.fieldAreaTemp),e.formData.plantArea=1e4*Number(e.formData.plantAreaTemp),e.formData.buyWeight=5e5*Number(e.formData.buyWeightTemp),e.formData.ifUpdateBuyWeight=e.buyWeightTemp===e.formData.buyWeight?void 0:"1",$ec.showLoading(),e.formData.bmUnitLinkRecId?e.$apis.apm.baseMaintain.update(e.formData).then((function(){$ec.hideLoading(),e.$emit("onQuery"),e.$message.success("保存成功！"),e.handleCancel()})):e.$apis.apm.baseMaintain.add(e.formData).then((function(){$ec.hideLoading(),e.$emit("onQuery"),e.$message.success("保存成功！"),e.handleCancel()}))):e.$message.error("验证不通过")}))},onBeforeOkOrg:function(e){var t;if("4"!==(null===(t=e.selectOption)||void 0===t?void 0:t.orgLevelEk))return this.$message.error("请选择县级商业单位"),!1},onBeforeOkDivision:function(e){var t;if("4"!==(null===(t=e.selectOption)||void 0===t?void 0:t.divisionLevel))return this.$message.error("请选择县级行政区划"),!1},handleCancel:function(){this.visible=!1,this.$refs.ruleForm.resetFields()}}},b=h,g=(a("4fbc"),a("2877")),v=Object(g["a"])(b,s,c,!1,null,"21d79bec",null),y=v.exports,C=a("2ef0"),D=a.n(C),_={name:"PanelSupple",components:{BusinessOrgManageEdit:y},data:function(){return{isEdit:!1,query:{},weightUnitList:[],areaUnitList:[],weightUnit:"500000",areaUnit:"10000",unitPropList:[],linkUpState:[],sideInfo:{baseUnitCnt:"",baseUnitCntSet:"",baseUnitCntUnSet:""},loading:!1,tableData:[],pagination:{pageNumber:1,pageSize:10,total:0},busiYear:void 0,orgList:[],leafTypeList:[],appCode:void 0}},computed:{leafTypeObj:function(){return this.leafTypeList.map((function(e){return{key:e.leafTypeCode,title:e.leafTypeName}}))},linkUpStateObj:function(){return this.linkUpState.map((function(e){return{key:e.enumKey,title:e.name}}))},appConfig:function(){return this.$store.getters.getAppConfig}},created:function(){var e,t,a,i,n=this.$router.history.current.query.appCode;this.appCode=n||"CM",this.busiYear=null===(e=this.appConfig)||void 0===e||null===(t=e.yearValueMap)||void 0===t?void 0:t.CENTER_YEAR,this.query.busiYear=null===(a=this.appConfig)||void 0===a||null===(i=a.yearValueMap)||void 0===i?void 0:i.CENTER_YEAR,this.getAuxiliaryInfo(),this.handleQueryLeafTypeList(),this.handleGetEnum(),this.handleQueryOrgList()},methods:{handleGetEnum:function(){var e=this,t={enumTypeCodes:["WEIGHT_UNIT","AREA_UNIT","BASE_UNIT_NATURE","LINK_UP_STATE"]};this.$apis.bim.enumType.query(t).then((function(t){var a=(null===t||void 0===t?void 0:t.enumMap)||{};e.weightUnitList=a.WEIGHT_UNIT||[],e.areaUnitList=a.AREA_UNIT||[],e.unitPropList=a.BASE_UNIT_NATURE||[],e.linkUpState=a.LINK_UP_STATE||[]}))},handleQueryLeafTypeList:function(){var e=this;this.$apis.bim.leafType.query({}).then((function(t){e.leafTypeList=(null===t||void 0===t?void 0:t.rows)||[]}))},resetHandle:function(){this.query={busiYear:this.busiYear},this.onQuery()},handleQueryOrgList:function(){var e,t=this,a={busiYear:this.busiYear,orgTypeEk:"TOBACCO",orgLevelEk:"4",parentBizCode:null===(e=this.appConfig)||void 0===e?void 0:e.bizCode};this.$apis.bim.org.queryBy(a).then((function(e){t.orgList=e.rows||[]}))},pageAction:function(e,t){var a=this;return Object(l["a"])(Object(o["a"])().mark((function i(){return Object(o["a"])().wrap((function(i){while(1)switch(i.prev=i.next){case 0:a.pageNo=e,a.loading=!0,a.getData(Object(r["a"])({pageNumber:e,pageSize:t},a.query)).then((function(e){a.pagination.total=e.totalRows,a.tableData=e.rows,a.loading=!1})).catch((function(e){a.loading=!1,console.log(e)}));case 3:case"end":return i.stop()}}),i)})))()},onQuery:function(){this.$refs.tableRef.pageAction(1,10)},getData:function(e){return this.$apis.apm.baseMaintain.query(e)},getAuxiliaryInfo:function(){var e=this;return this.$apis.apm.baseMaintain.auxiliaryInfo().then((function(t){e.sideInfo=t}))},handleUpdate:function(){this.$refs.editRef.show()},onEdit:function(e){this.$refs.editRef.show(D.a.cloneDeep(e))},editRowEvent:function(){this.isEdit=!this.isEdit;var e=this.$refs.xTable;e.setActiveRow()},onDel:function(){var e=this,t=this.$createElement;!this.selectedRows||this.selectedRows.length<=0?this.$message.error("请选择一条数据再删除"):this.$confirm({title:"是否执行该操作?",content:function(){return t("div",{style:"color:red;"},["是否确认删除选中的数据，确认请点击'确认'按钮，取消点击'取消'按钮。"])},onOk:function(){e.loading=!0;for(var t=[],a=0;a<e.selectedRows.length;a++)t.push(e.selectedRows[a].leafColorId);var i=e.selectedRows.map((function(e){return e.bmUnitLinkRecId}));console.log(i),e.$apis.apm.baseMaintain.delete({bmUnitLinkRecIds:i}).then((function(t){t.result?(e.loading=!1,e.onQuery(),e.$message.success("操作成功")):e.$message.error("操作失败")})).catch((function(t){e.loading=!1,t?e.$message.error(t.message||"操作失败"):e.$message.error("操作失败")}))}})},selectAllEvent:function(e){var t=e.records;this.selectedRows=t},selectRowChange:function(e){var t=e.records;this.selectedRows=t}}},w=_,k=(a("e203"),Object(g["a"])(w,i,n,!1,null,"75a62625",null));t["default"]=k.exports},e203:function(e,t,a){"use strict";a("01d0")}}]);
//# sourceMappingURL=chunk-410154b8.0b2ab764.js.map