(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-b492cbd2"],{1453:function(e,t,a){"use strict";a("c382")},5530:function(e,t,a){"use strict";a.d(t,"a",(function(){return o}));a("b64b"),a("a4d3"),a("4de4"),a("d3b7"),a("e439"),a("159b"),a("dbb4");function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}},b898:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ec-container",{attrs:{height:"100%"}},[a("ec-container-header",[a("ec-panel-item",[a("ec-panel-item-left",[a("ec-header",{attrs:{title:"工商购销调拨计划量调整登记",icon:"onetomany","color-code":"008"}})],1)],1)],1),a("ec-container-body",[a("ec-panel",{attrs:{auto:!1}},[a("ec-panel-toolbar",[a("ec-query-panel",{attrs:{defaultFold:""},on:{query:e.onQuery,reset:e.onReset},scopedSlots:e._u([{key:"inner",fn:function(){return[a("ec-query-item",{attrs:{label:"会员单位"}},[a("a-input",{attrs:{allowClear:"",placeholder:"请输入会员单位"},model:{value:e.queryParams.memberOrgCode,callback:function(t){e.$set(e.queryParams,"memberOrgCode",t)},expression:"queryParams.memberOrgCode"}})],1),a("ec-query-item",{attrs:{label:"办理依据"}},[a("a-input",{attrs:{placeholder:"请输入办理依据"},model:{value:e.queryParams.remark,callback:function(t){e.$set(e.queryParams,"remark",t)},expression:"queryParams.remark"}})],1)]},proxy:!0}])},[a("ec-query-item",{attrs:{label:"烟叶类型"}},[a("ec-select",{attrs:{allowClear:"",placeholder:"请选择烟叶类型"},model:{value:e.queryParams.leafTypeCode,callback:function(t){e.$set(e.queryParams,"leafTypeCode",t)},expression:"queryParams.leafTypeCode"}},e._l(e.leafTypeList,(function(t){return a("a-select-option",{key:t.leafTypeCode},[e._v(" "+e._s(t.leafTypeName)+" ")])})),1)],1),a("ec-query-item",{attrs:{label:"计划年度"}},[a("ec-select",{attrs:{placeholder:"请选择计划年度"},model:{value:e.queryParams.planYear,callback:function(t){e.$set(e.queryParams,"planYear",t)},expression:"queryParams.planYear"}},e._l(e.planYearList,(function(t){return a("a-select-option",{key:t},[e._v(" "+e._s(t)+" ")])})),1)],1),a("ec-query-item",{attrs:{label:"计量单位"}},[a("a-select",{attrs:{"allow-clear":"",placeholder:"请选择计量单位"},on:{select:e.onSelWeightUnit},model:{value:e.weightUnit,callback:function(t){e.weightUnit=t},expression:"weightUnit"}},e._l(e.weightUnitList,(function(t){return a("a-select-option",{key:t.enumKey},[e._v(" "+e._s(t.name)+" ")])})),1)],1)],1),a("ec-divider")],1),a("ec-panel-header",[e.isEntry?a("ec-panel-item-left",[a("a-button",{attrs:{type:"primary"},on:{click:e.onAdd}},[e._v("新增")]),a("a-button",{attrs:{type:"default"},on:{click:e.onConfirm}},[e._v("确认")]),a("a-button",{attrs:{type:"default"},on:{click:e.onDelete}},[e._v("删除")])],1):e._e(),a("ec-panel-item-right",[a("span",{staticStyle:{"margin-right":"16px"}},[e._v("业务年度："+e._s(e.busiYear)+"年")]),a("span",[e._v("单位："+e._s(e.curWeightUnit.name))])])],1),a("ec-panel-body",[a("ec-table",{ref:"table",attrs:{border:"","show-footer":"","show-overflow":"","highlight-current-row":"",height:"100%",auto:!1,data:e.tableData,loading:e.loading,"footer-method":e.footerMethod},on:{"checkbox-all":e.onSelAllTableData,"checkbox-change":e.onSelTableData}},[a("ec-table-col",{attrs:{type:"checkbox",width:"50",align:"center"}}),a("ec-table-col",{attrs:{type:"seq",width:"60",title:"序号",align:"center"}}),a("ec-table-col",{attrs:{field:"createTime",title:"录入日期",align:"center",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("div",[e._v(e._s(e._f("dateFormat")(r.createTime,"YYYY-MM-DD")))])]}}])}),a("ec-table-col",{attrs:{field:"memberOrgName",title:"会员单位",align:"center","min-width":"150"}}),a("ec-table-col",{attrs:{field:"orgName",title:"烟叶类型",align:"center","min-width":"100"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("div",[e._v(e._s(e._f("getNameBy")(r.leafTypeCode,e.leafTypeObj)))])]}}])}),a("ec-table-col",{attrs:{field:"total",title:"总计",align:"center","min-width":"100"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("div",[e._v(e._s(e._f("amountFormat")(r.total,e.weightUnit)))])]}}])}),a("ec-table-colgroup",{attrs:{title:"国内调拨计划量"}},[a("ec-table-col",{attrs:{field:"zhej",title:"合计",align:"center","min-width":"150"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("div",[e._v(e._s(e._f("amountFormat")(r.zhej,e.weightUnit)))])]}}])}),a("ec-table-col",{attrs:{field:"gsptgx",title:"工商普通购销",align:"center","min-width":"150"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("div",[e._v(e._s(e._f("amountFormat")(r.gsptgx,e.weightUnit)))])]}}])}),a("ec-table-col",{attrs:{field:"jdy",title:"基地烟",align:"center","min-width":"150"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("div",[e._v(e._s(e._f("amountFormat")(r.jdy,e.weightUnit)))])]}}])})],1),a("ec-table-colgroup",{attrs:{title:"出口调拨计划量"}},[a("ec-table-col",{attrs:{field:"ckbhgx",title:"出口备货普通购销",align:"center","min-width":"200"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("div",[e._v(e._s(e._f("amountFormat")(r.ckbhgx,e.weightUnit)))])]}}])})],1),a("ec-table-col",{attrs:{title:"操作",align:"center",width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("a-button",{attrs:{type:"link"},on:{click:function(t){return e.onEdit(r)}}},[e._v("编辑")]),a("a-button",{attrs:{type:"link"},on:{click:function(t){return e.onDetail(r)}}},[e._v("详细")]),a("a-button",{attrs:{type:"link"},on:{click:function(t){return e.onBaseDetail(r)}}},[e._v("基地烟详细")])]}}])})],1)],1)],1),a("add-modal",{ref:"addModalRef",attrs:{busiYear:e.busiYear,orgList:e.orgList,curWeightUnit:e.curWeightUnit,leafTypeList:e.leafTypeList,planYearList:e.planYearList},on:{finish:e.onQuery}}),a("detail-modal",{ref:"detailModalRef",attrs:{leafTypeObj:e.leafTypeObj}})],1)],1)},i=[],o=a("5530"),n=(a("d81d"),a("7db0"),a("d3b7"),a("159b"),a("a9e3"),a("b680"),a("caad"),function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ec-drawer",{staticClass:"ec-draw-form",attrs:{title:e.title,visible:e.visible,size:"large","is-confirm":!0},on:{close:e.onclose}},[a("ec-container",{attrs:{height:"auto",fixed:"top bottom","color-code":"007"}},[a("ec-container-body",[a("ec-panel",{attrs:{"color-code":"001"}},[a("ec-panel-item",[a("ec-form",{ref:"formRef",attrs:{model:e.formData,rules:e.formRules}},[a("a-row",{attrs:{type:"flex",gutter:12}},[a("a-col",{staticClass:"first-step",attrs:{span:24}},[a("div",{staticClass:"sub-title"},[e._v("第一步: 选取单位、烟叶类型、操作类型")]),a("div",{staticClass:"unit"},[a("span",[e._v("业务年度："+e._s(e.formData.busiYear)+"年；")]),a("span",[e._v("计量单位："+e._s(e.curWeightUnit.name))])])]),a("a-col",{attrs:{span:6}},[a("a-form-model-item",{attrs:{label:"计划年度",prop:"planYear"}},[a("ec-select",{attrs:{disabled:e.isEdit,placeholder:"请选择计划年度"},model:{value:e.formData.planYear,callback:function(t){e.$set(e.formData,"planYear",t)},expression:"formData.planYear"}},e._l(e.planYearList,(function(t){return a("a-select-option",{key:t},[e._v(" "+e._s(t)+" ")])})),1)],1)],1),a("a-col",{attrs:{span:6}},[a("a-form-model-item",{attrs:{label:"单位名称",prop:"memberOrgCode"}},[a("select-picker",{attrs:{disabled:e.isEdit,title:"选择单位",lazy:!1,search:!1,fetchData:e.fetchGetTree,placeholder:"请选择单位名称",beforeOk:e.onBeforeOk},on:{ok:e.onSelOrg},model:{value:e.formData.memberOrgCode,callback:function(t){e.$set(e.formData,"memberOrgCode",t)},expression:"formData.memberOrgCode"}})],1)],1),a("a-col",{attrs:{span:6}},[a("a-form-model-item",{attrs:{label:"烟叶类型",prop:"leafTypeCode"}},[a("ec-select",{attrs:{disabled:e.leafTypeDisabled||e.isEdit,placeholder:"请选择烟叶类型"},on:{select:e.onQuery},model:{value:e.formData.leafTypeCode,callback:function(t){e.$set(e.formData,"leafTypeCode",t)},expression:"formData.leafTypeCode"}},e._l(e.leafTypeList,(function(t){return a("a-select-option",{key:t.leafTypeCode},[e._v(" "+e._s(t.leafTypeName)+" ")])})),1)],1)],1),a("a-col",{attrs:{span:6}},[a("a-form-model-item",{attrs:{label:"操作类型",prop:"operateType"}},[a("ec-select",{attrs:{disabled:e.isEdit,placeholder:"请选择操作类型"},on:{select:e.onQuery},model:{value:e.formData.operateType,callback:function(t){e.$set(e.formData,"operateType",t)},expression:"formData.operateType"}},[a("a-select-option",{key:"1"},[e._v("增量")]),a("a-select-option",{key:"0"},[e._v("减量")])],1)],1)],1),a("a-col",{attrs:{span:24}},[a("a-form-model-item",{attrs:{label:"办理依据"}},[a("a-input",{attrs:{disabled:e.isDetail,autocomplete:"off",placeholder:"请输入办理依据"},model:{value:e.formData.remark,callback:function(t){e.$set(e.formData,"remark",t)},expression:"formData.remark"}})],1)],1),a("a-col",{attrs:{span:24}},[a("div",{staticClass:"sub-title"},[e._v("第二步: 登记/编辑数量")])]),a("a-col",{attrs:{span:24}},[a("ec-table",{ref:"tableRef",attrs:{stripe:"",border:"","show-overflow":"",loading:e.tableLoading,data:e.tableData}},[a("ec-table-col",{attrs:{field:"title",title:"",align:"left",width:"150"}}),a("ec-table-col",{attrs:{field:"total",title:"总计",align:"center","min-width":"100"}}),a("ec-table-colgroup",{attrs:{title:"国内调拨计划量"}},[a("ec-table-col",{attrs:{field:"zhej",title:"合计",align:"center",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return["now"!==r.type||e.isDetail?a("span",[e._v(e._s(r.zhej))]):a("div",[a("a-input-number",{attrs:{min:e.tableData[0].jdy,max:"0"===e.formData.operateType?e.tableData[0].zhej:1e9},on:{blur:e.onComputedTotal},model:{value:r.zhej,callback:function(t){e.$set(r,"zhej",t)},expression:"row.zhej"}})],1)]}}])}),a("ec-table-col",{attrs:{field:"gsptgx",title:"工商普通购销",align:"center",width:"150"}}),a("ec-table-col",{attrs:{field:"jdy",title:"基地烟",align:"center",width:"150"}})],1),a("ec-table-colgroup",{attrs:{title:"出口调拨计划量"}},[a("ec-table-col",{attrs:{field:"ckbhgx",title:"出口备货普通购销",align:"center",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return["now"!==r.type||e.isDetail?a("span",[e._v(e._s(r.ckbhgx))]):a("div",[a("a-input-number",{attrs:{max:"0"===e.formData.operateType?e.tableData[0].ckbhgx:1e9},on:{blur:e.onComputedTotal},model:{value:r.ckbhgx,callback:function(t){e.$set(r,"ckbhgx",t)},expression:"row.ckbhgx"}})],1)]}}])})],1)],1)],1)],1)],1)],1)],1)],1),a("ec-container-footer",{attrs:{fixed:""}},[a("a-space",[a("a-button",{attrs:{loading:e.loading,type:"primary"},on:{click:e.onSaveAndAdd}},[e._v("保存并新增")]),a("a-button",{attrs:{loading:e.loading,type:"primary"},on:{click:e.onSave}},[e._v("保存")]),a("a-button",{on:{click:e.onclose}},[e._v("关闭")])],1)],1)],1)],1)}),l=[],s=(a("6198"),a("6fc0")),c=a.n(s),u=(a("a434"),a("6ea6")),d={name:"AddModal",components:{SelectPicker:c.a},props:{busiYear:{type:Number,default:0},leafTypeList:{type:Array,default:function(){return[]}},orgList:{type:Array,default:function(){return[]}},planYearList:{type:Array,default:function(){return[]}},curWeightUnit:{type:Object,default:function(){}}},data:function(){return{visible:!1,loading:!1,tableLoading:!1,formData:{},formRules:{memberOrgCode:{required:!0,message:"请选择单位",trigger:"change"},leafTypeCode:{required:!0,message:"请选择烟叶类型",trigger:"change"},operateType:{required:!0,message:"请选择操作类型",trigger:"change"}},tableData:[],replaceFields:{pkey:"parentBizCode",title:"orgName",key:"bizCode",children:"children"},leafTypeDisabled:!1,isEdit:!1,isDetail:!1,title:"新增"}},methods:{show:function(e,t){if(this.visible=!0,e)this.formData=e,this.isEdit=!0,this.isDetail=t,this.onQuery();else{var a,r,i;if(this.formData.busiYear=this.busiYear,null!==(a=this.leafTypeList)&&void 0!==a&&a.length)this.$set(this.formData,"leafTypeCode",null===(i=this.leafTypeList[0])||void 0===i?void 0:i.leafTypeCode);null!==(r=this.planYearList)&&void 0!==r&&r.length&&this.$set(this.formData,"planYear",this.planYearList[0]),this.$set(this.formData,"operateType","1")}},fetchGetTree:function(){var e=this;return new Promise((function(t){var a=Object(u["treeFormatList"])(e.orgList,e.replaceFields);t(a)}))},onQuery:function(){this.formData.adjustBatch?this.editQuery():this.addQuery()},addQuery:function(){var e=this;if(this.formData.busiYear&&this.formData.planYear&&this.formData.memberLevelCode&&this.formData.memberOrgCode&&this.formData.leafTypeCode){var t={busiYear:this.formData.busiYear,planYear:this.formData.planYear,memberLevelCode:this.formData.memberLevelCode,memberOrgCode:this.formData.memberOrgCode,leafTypeCode:this.formData.leafTypeCode};this.tableLoading=!0,this.$apis.apm.dailyPurchaseSale.queryDaily(t).then((function(t){var a=t.rows[0]||{};e.tableData=[{type:"before",title:"调整前",zhej:(Number(a.gsptgx)+Number(a.jdy))/Number(e.curWeightUnit.enumKey),gsptgx:Number(a.gsptgx)/Number(e.curWeightUnit.enumKey),jdy:Number(a.jdy)/Number(e.curWeightUnit.enumKey),ckbhgx:Number(a.ckbhgx)/Number(e.curWeightUnit.enumKey),total:(Number(a.zhej)+Number(a.ckbhgx))/Number(e.curWeightUnit.enumKey)},{type:"now",title:"本次调整量",zhej:0,gsptgx:0,jdy:0,ckbhgx:0,total:0},{type:"after",title:"调整后",zhej:((Number(a.gsptgx)+Number(a.jdy))/Number(e.curWeightUnit.enumKey)).toFixed(4),gsptgx:(Number(a.gsptgx)/Number(e.curWeightUnit.enumKey)).toFixed(4),jdy:(Number(a.jdy)/Number(e.curWeightUnit.enumKey)).toFixed(4),ckbhgx:(Number(a.ckbhgx)/Number(e.curWeightUnit.enumKey)).toFixed(4),total:((Number(a.zhej)+Number(a.ckbhgx))/Number(e.curWeightUnit.enumKey)).toFixed(4)}],e.tableLoading=!1}))}},editQuery:function(){var e=this,t={adjustBatch:this.formData.adjustBatch};this.$apis.apm.dailyPurchaseSale.editQuery(t).then((function(t){e.formData={adjustBatch:t.adjustBatch,busiYear:t.busiYear,planYear:t.planYear,memberOrgCode:t.memberOrgCode,leafTypeCode:t.leafTypeCode,operateType:t.operateType,remark:t.remark};var a={};t.dailyPcTAsAppTplForTplDTOS.forEach((function(e){a[e.row]=e})),e.tableData=[{type:"before",title:"调整前",zhej:(Number(a["0"].gsptgx)+Number(a["0"].jdy))/Number(e.curWeightUnit.enumKey),gsptgx:Number(a["0"].gsptgx)/Number(e.curWeightUnit.enumKey),jdy:Number(a["0"].jdy)/Number(e.curWeightUnit.enumKey),ckbhgx:Number(a["0"].ckbhgx)/Number(e.curWeightUnit.enumKey),total:(Number(a["0"].zhej)+Number(a["0"].ckbhgx))/Number(e.curWeightUnit.enumKey)},{type:"now",title:"本次调整量",zhej:(Number(a["1"].gsptgx)+Number(a["1"].jdy))/Number(e.curWeightUnit.enumKey),gsptgx:Number(a["1"].gsptgx)/Number(e.curWeightUnit.enumKey),jdy:Number(a["1"].jdy)/Number(e.curWeightUnit.enumKey),ckbhgx:Number(a["1"].ckbhgx)/Number(e.curWeightUnit.enumKey),total:(Number(a["1"].zhej)+Number(a["1"].ckbhgx))/Number(e.curWeightUnit.enumKey)},{type:"after",title:"调整后",zhej:0,gsptgx:0,jdy:0,ckbhgx:0,total:0}],e.onComputedTotal()}))},onBeforeOk:function(e){var t;if("1"===(null===e||void 0===e||null===(t=e.selectOption)||void 0===t?void 0:t.orgLevelEk))return this.$message.error("中国烟草公司不可选"),!1},onSelOrg:function(e){var t=(null===e||void 0===e?void 0:e.selectOption)||{};"INDUSTRY"===(null===t||void 0===t?void 0:t.orgTypeEk)&&(this.leafTypeDisabled=!0,this.formData.leafTypeCode="10"),this.formData.memberLevelCode=t.orgLevelEk,this.formData.memberOrgCode=t.key,this.onQuery()},onComputedTotal:function(){var e=this.tableData[1];e.gsptgx=e.zhej-e.jdy,e.total=e.zhej+e.ckbhgx,this.tableData.splice(1,1,e);var t=this.tableData[2];"1"===this.formData.operateType?(t.zhej=(this.tableData[0].zhej+this.tableData[1].zhej).toFixed(4),t.gsptgx=(this.tableData[0].gsptgx+this.tableData[1].gsptgx).toFixed(4),t.jdy=(this.tableData[0].jdy+this.tableData[1].jdy).toFixed(4),t.ckbhgx=(this.tableData[0].ckbhgx+this.tableData[1].ckbhgx).toFixed(4),t.total=(this.tableData[0].total+this.tableData[1].total).toFixed(4)):(t.zhej=(this.tableData[0].zhej-this.tableData[1].zhej).toFixed(4),t.gsptgx=(this.tableData[0].gsptgx-this.tableData[1].gsptgx).toFixed(4),t.jdy=(this.tableData[0].jdy-this.tableData[1].jdy).toFixed(4),t.ckbhgx=(this.tableData[0].ckbhgx-this.tableData[1].ckbhgx).toFixed(4),t.total=(this.tableData[0].total-this.tableData[1].total).toFixed(4)),this.tableData.splice(2,1,t)},onSaveAndAdd:function(){var e=this;this.$refs.formRef.validate((function(t){var a,r,i,o,n,l;t?(e.formData.ckbhgxba=null===(a=e.tableData[0])||void 0===a?void 0:a.ckbhgx,e.formData.gsptgxba=null===(r=e.tableData[0])||void 0===r?void 0:r.gsptgx,e.formData.zhejba=null===(i=e.tableData[0])||void 0===i?void 0:i.zhej,e.formData.ckbhgx=null===(o=e.tableData[1])||void 0===o?void 0:o.ckbhgx,e.formData.gsptgx=null===(n=e.tableData[1])||void 0===n?void 0:n.gsptgx,e.formData.zhej=null===(l=e.tableData[1])||void 0===l?void 0:l.zhej,e.loading=!0,e.$apis.apm.dailyPurchaseSale.add(e.formData).then((function(){var t,a;(e.$message.success("保存成功"),e.$emit("finish"),e.formData={busiYear:e.busiYear},null!==(t=e.leafTypeList)&&void 0!==t&&t.length)&&e.$set(e.formData,"leafTypeCode",null===(a=e.leafTypeList[0])||void 0===a?void 0:a.leafTypeCode);e.$set(e.formData,"operateType","1"),e.tableData=[],e.$refs.formRef.resetFields(),e.loading=!1}))):e.$message.error("验证不通过")}))},onSave:function(){var e=this;this.$refs.formRef.validate((function(t){if(t){var a,r,i,o,n,l;if(0===e.tableData[1].zhej&&0===e.tableData[1].ckbhgx)return void e.$message.error("未做任何调整，不能保存");e.formData.ckbhgxba=(null===(a=e.tableData[0])||void 0===a?void 0:a.ckbhgx)*Number(e.curWeightUnit.enumKey),e.formData.gsptgxba=(null===(r=e.tableData[0])||void 0===r?void 0:r.gsptgx)*Number(e.curWeightUnit.enumKey),e.formData.zhejba=(null===(i=e.tableData[0])||void 0===i?void 0:i.zhej)*Number(e.curWeightUnit.enumKey),e.formData.ckbhgx=(null===(o=e.tableData[1])||void 0===o?void 0:o.ckbhgx)*Number(e.curWeightUnit.enumKey),e.formData.gsptgx=(null===(n=e.tableData[1])||void 0===n?void 0:n.gsptgx)*Number(e.curWeightUnit.enumKey),e.formData.zhej=(null===(l=e.tableData[1])||void 0===l?void 0:l.zhej)*Number(e.curWeightUnit.enumKey),e.loading=!0,e.$apis.apm.dailyPurchaseSale.add(e.formData).then((function(){e.loading=!1,e.$message.success("保存成功"),e.$emit("finish"),e.onclose()}))}else e.$message.error("验证不通过")}))},onclose:function(){this.$refs.formRef.resetFields(),this.formData={},this.tableData=[],this.visible=!1,this.isEdit=!1,this.isDetail=!1}}},f=d,h=(a("1453"),a("2877")),m=Object(h["a"])(f,n,l,!1,null,"0870d1b8",null),p=m.exports,b=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ec-modal",{attrs:{title:"详细",size:"large","is-confirm":!0},scopedSlots:e._u([{key:"footer",fn:function(){return[a("a-button",{on:{click:e.onClose}},[e._v("关闭")])]},proxy:!0}]),model:{value:e.visibile,callback:function(t){e.visibile=t},expression:"visibile"}},[a("ec-table",{attrs:{border:"","show-footer":"",height:"100%",auto:!1,data:e.tableData,loading:e.loading,"show-overflow":"","footer-method":e.footerMethod}},[a("ec-table-col",{attrs:{type:"seq",width:"60",title:"序号",align:"center"}}),a("ec-table-col",{attrs:{field:"createTime",title:"录入日期",align:"center",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("div",[e._v(e._s(e._f("dateFormat")(r.createTime,"YYYY-MM-DD")))])]}}])}),a("ec-table-col",{attrs:{field:"apprTypeCode",title:"业务类型",align:"center",width:"100"}}),a("ec-table-col",{attrs:{field:"baseCellName",title:"基地单元",align:"center","min-width":"100"}}),a("ec-table-col",{attrs:{field:"orgName",title:"烟叶类型",align:"center","min-width":"100"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("div",[e._v(e._s(e._f("getNameBy")(r.leafTypeCode,e.leafTypeObj)))])]}}])}),a("ec-table-col",{attrs:{field:"baApprWeight",title:"调整前量",align:"center",width:"100"}}),a("ec-table-col",{attrs:{field:"apprWeight",title:"本次调整量",align:"center",width:"100"}}),a("ec-table-col",{attrs:{field:"aaApprWeight",title:"调整后量",align:"center",width:"100"}}),a("ec-table-col",{attrs:{field:"remark",title:"办理依据",align:"center","min-width":"100"}})],1)],1)},g=[],y={name:"DetailModal",props:{leafTypeObj:{type:Array,default:function(){return[]}}},data:function(){return{visibile:!1,loading:!1,tableData:[]}},methods:{show:function(e){this.visibile=!0,this.onQuery(e)},onClose:function(){this.visibile=!1},onQuery:function(e){var t=this,a={adjustBatch:e.adjustBatch};this.loading=!0,this.$apis.apm.dailyPurchaseSale.queryJdy(a).then((function(e){t.loading=!1,t.tableData=(null===e||void 0===e?void 0:e.rows)||[]})).catch((function(){t.loading=!1}))},sumNum:function(e,t){var a=0;return e.forEach((function(e){a+=Number(e[t])})),a.toFixed(2)},footerMethod:function(e){var t=this,a=e.columns,r=e.data;return[a.map((function(e,a){return 0===a?"合计":["baApprWeight","apprWeight"].includes(e.property)?t.sumNum(r,e.property):null}))]}}},v=y,D=Object(h["a"])(v,b,g,!1,null,null,null),k=D.exports,x=a("2ef0"),T=a.n(x),w={name:"Index",components:{AddModal:p,DetailModal:k},data:function(){return{loading:!1,tableData:[],queryParams:{},pagination:{pageNumber:1,pageSize:10,total:0},appCode:void 0,orgCode:void 0,orgList:[],leafTypeList:[{leafTypeCode:"10",leafTypeName:"烤烟"},{leafTypeCode:"20",leafTypeName:"晾晒烟"},{leafTypeCode:"2013",leafTypeName:"雪茄烟"}],weightUnitList:[],selTableData:[],weightUnit:"500000",userInfo:{},isEntry:!1,planYearList:[]}},computed:{appConfig:function(){return this.$store.getters.getAppConfig},leafTypeObj:function(){return this.leafTypeList.map((function(e){return{key:e.leafTypeCode,title:e.leafTypeName}}))},busiYear:function(){var e,t;return null===(e=this.$store.getters.getAppConfig)||void 0===e||null===(t=e.yearValueMap)||void 0===t?void 0:t.DAILY_YEAR},bizCode:function(){var e;return null===(e=this.$store.getters.getAppConfig)||void 0===e?void 0:e.bizCode},curWeightUnit:function(){var e=this;return this.weightUnitList.find((function(t){return t.enumKey===e.weightUnit}))||{}}},created:function(){var e=this.$router.history.current.query.appCode;this.appCode=e||"CM";var t=(new Date).getFullYear();this.planYearList=[t,t+1],this.queryParams.planYear=t,this.beforeHandler(),this.handleGetWeightUnitList(),this.handleGetOrgList(),this.onQuery()},methods:{beforeHandler:function(){var e=this;this.$apis.apm.dailyPurchaseSale.before().then((function(t){"1"===t&&(e.isEntry=!0)}))},handleGetWeightUnitList:function(){var e=this,t={enumTypeCodes:["WEIGHT_UNIT"]};this.$apis.bim.enumType.query(t).then((function(t){var a;e.weightUnitList=(null===t||void 0===t||null===(a=t.enumMap)||void 0===a?void 0:a.WEIGHT_UNIT)||[]}))},handleGetOrgList:function(){var e=this,t={bizYear:this.busiYear,bizCode:this.bizCode,orgTypeEk:"EXPORT,INDUSTRY,TOBACCO",orgLevelEk:"2",paramMap:{isCorporation:"1"}};this.$apis.apm.dailyPurchaseSale.queryOrgTree(t).then((function(t){e.orgList=(null===t||void 0===t?void 0:t.rows)||[]}))},handleListToTree:function(e){var t={};e.forEach((function(e){t[e.orgUniqueCode]=e}));var a=[];return e.forEach((function(e){var r=t[e.parentOrgUniqueCode];r?(r.children=r.children||[],r.children.push(e)):a.push(e)})),a},onSelWeightUnit:function(){this.tableData=T.a.cloneDeep(this.tableData)},onQuery:function(){var e=this,t=Object(o["a"])({busiYear:this.busiYear},this.queryParams);this.loading=!0,this.$apis.apm.dailyPurchaseSale.query(t).then((function(t){e.loading=!1,e.tableData=null===t||void 0===t?void 0:t.rows.map((function(e){var t=e;return t.total=Number(e.zhej)+Number(e.ckbhgx),t})),e.pagination.total=null===t||void 0===t?void 0:t.totalRows})).catch((function(){e.loading=!1}))},onReset:function(){this.queryParams={},this.onQuery()},onSelTableData:function(e){var t=e.records;this.selTableData=t},onSelAllTableData:function(e){var t=e.records;this.selTableData=t},sumNum:function(e,t){var a=0;return e.forEach((function(e){a+=Number(e[t])})),a/=this.weightUnit,a.toFixed(4)},footerMethod:function(e){var t=this,a=e.columns,r=e.data;return[a.map((function(e,a){return 0===a?"合计":["total","zhej","gsptgx","jdy","ckbhgx"].includes(e.property)?t.sumNum(r,e.property):null}))]},onAdd:function(){this.$refs.addModalRef.show()},onEdit:function(e){this.$refs.addModalRef.show(T.a.cloneDeep(e))},onConfirm:function(){var e=this,t=this.$createElement;this.selTableData.length?this.$confirm({title:"是否执行该操作?",content:function(){return t("div",{style:"color:red;"},["是否要确认选中的数据，确认请点击'确认'按钮，取消点击'取消'按钮。"])},onOk:function(){e.loading=!0;var t={adjustBatchs:e.selTableData.map((function(e){return e.adjustBatch}))};e.$apis.apm.dailyPurchaseSale.confirm(t).then((function(){e.$message.success("确认成功"),e.loading=!1,e.onQuery()}))}}):this.$message.error("请选择一条数据再确认")},onDelete:function(){var e=this,t=this.$createElement;this.selTableData.length?this.$confirm({title:"是否执行该操作?",content:function(){return t("div",{style:"color:red;"},["是否确认删除选中的数据，确认请点击'确认'按钮，取消点击'取消'按钮。"])},onOk:function(){e.loading=!0;var t={adjustBatchs:e.selTableData.map((function(e){return e.adjustBatch}))};e.$apis.apm.dailyPurchaseSale.delete(t).then((function(){e.$message.success("删除成功"),e.loading=!1,e.onQuery()}))}}):this.$message.error("请选择一条数据再删除")},onDetail:function(e){this.$refs.addModalRef.show(T.a.cloneDeep(e),!0)},onBaseDetail:function(e){this.$refs.detailModalRef.show(e)}}},j=w,_=Object(h["a"])(j,r,i,!1,null,"ac65c240",null);t["default"]=_.exports},c382:function(e,t,a){}}]);
//# sourceMappingURL=chunk-b492cbd2.008421d0.js.map