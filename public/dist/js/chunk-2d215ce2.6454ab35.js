(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d215ce2"],{c087:function(e,t,n){"use strict";n.r(t);var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("ec-container",{attrs:{height:"100%",title:"采集批次计划量管理",icon:"onetomany","color-code":"008"}},[n("ec-container-body",[n("ec-panel",{attrs:{auto:!1}},[n("ec-panel-toolbar",[n("ec-query-panel",{attrs:{showAction:!1}},[n("ec-query-item",{attrs:{label:"采集批次"}},[n("a-select",{attrs:{placeholder:"请选择"},on:{select:e.onQuery},model:{value:e.queryItems.batchName,callback:function(t){e.$set(e.queryItems,"batchName",t)},expression:"queryItems.batchName"}},e._l(e.batchList,(function(t){return n("a-select-option",{key:t.batchName},[e._v(" "+e._s(t.batchName)+" ")])})),1)],1)],1),n("ec-divider")],1),n("ec-panel-header",[n("ec-panel-item",[n("ec-panel-item-right",[n("span",{staticClass:"ant-form-text"},[e._v(" 业务年度： "+e._s(e.queryItems.busiYear))]),n("span",{staticClass:"ant-form-text"},[e._v(" 计量单位： "+e._s(e.weightUnitName))])])],1)],1),n("ec-panel-body",{staticStyle:{overflow:"hidden"}},[n("ec-table",{ref:"table",attrs:{border:"",data:e.tableData.rows,"edit-config":{trigger:"click",mode:"row",showStatus:!0},loading:e.loading,"row-select":""}},[n("ec-table-col",{attrs:{width:"70",title:"序号",type:"seq",align:"center"}}),n("ec-table-col",{attrs:{field:"orgName",title:"中烟工业","header-align":"center",align:"left","min-width":"23%"}}),n("ec-table-col",{attrs:{field:"crudeWeight",title:"烤烟计划量",align:"right","header-align":"center",width:"21%","edit-render":{}},scopedSlots:e._u([{key:"edit",fn:function(t){var a=t.row;return["0"===a.finishFlag&&"1"===a.isFlueCuredControl?n("a-input-number",{attrs:{min:0,max:1e5,precision:2},on:{blur:function(t){return e.handleNoValue(a,"crudeWeight")}},model:{value:a.crudeWeight,callback:function(t){e.$set(a,"crudeWeight",t)},expression:"row.crudeWeight"}}):[e._v(e._s(a.crudeWeight))]]}}])}),n("ec-table-col",{attrs:{field:"sunCuredWeight",title:"晾晒烟计划量",align:"right","header-align":"center",width:"21%","edit-render":{}},scopedSlots:e._u([{key:"edit",fn:function(t){var a=t.row;return["0"===a.finishFlag&&"1"===a.isSunCuredControl?n("a-input-number",{attrs:{min:0,max:1e5,precision:2},on:{blur:function(t){return e.handleNoValue(a,"sunCuredWeight")}},model:{value:a.sunCuredWeight,callback:function(t){e.$set(a,"sunCuredWeight",t)},expression:"row.sunCuredWeight"}}):[e._v(e._s(a.sunCuredWeight))]]}}])}),n("ec-table-col",{attrs:{field:"rtPlanWeight",title:"再造烟叶计划量",align:"right","header-align":"center",width:"21%","edit-render":{}},scopedSlots:e._u([{key:"edit",fn:function(t){var a=t.row;return["0"===a.finishFlag&&"1"===a.isRtControl?n("a-input-number",{attrs:{min:0,max:1e5,precision:2},on:{blur:function(t){return e.handleNoValue(a,"rtPlanWeight")}},model:{value:a.rtPlanWeight,callback:function(t){e.$set(a,"rtPlanWeight",t)},expression:"row.rtPlanWeight"}}):[e._v(e._s(a.rtPlanWeight))]]}}])})],1)],1)],1)],1),n("ec-container-footer",{attrs:{fixed:""}},[n("a-space",[n("a-button",{attrs:{type:"primary"},on:{click:e.onSave}},[e._v("保存")]),n("a-button",{on:{click:e.onReset}},[e._v("重置")])],1)],1)],1)},i=[],o=n("c7eb"),r=n("1da1"),c=(n("d3b7"),n("159b"),n("b680"),n("a9e3"),n("e9c4"),n("7db0"),n("99af"),n("2ef0")),s=n.n(c),l={name:"BatchManage",components:{},data:function(){return{queryItems:{busiYear:"",batchName:""},bizCode:"",orgCodeList:[],loading:!1,yearDisable:!0,defaultBatchName:"",batchList:[],oldTableData:[],pagination:{pageNumber:1,pageSize:10,total:0},auditStateList:[{id:"",name:"全部"},{id:"0",name:"未上报"},{id:"1",name:"省公司退回"},{id:"2",name:"总公司退回"},{id:"3",name:"省公司待确认"},{id:"4",name:"省公司已确认"},{id:"5",name:"总公司待审核"},{id:"6",name:"总公司已审核"}],weightUnit:5e5,weightUnitName:"万担",tableData:{rows:[]}}},computed:{appConfig:function(){return this.$store.getters.getAppConfig}},created:function(){var e=this.$router.history.current.query.appCode;this.appCode=e||"CM"},mounted:function(){this.onQuery()},methods:{handleNoValue:function(e,t){var n=this,a=e,i=a[t];i||(a[t]="0.00"),this.oldTableData.forEach((function(i){if(i.planAmountId===a.planAmountId){var o=i;o[t]=(Number(e[t])*Number(n.weightUnit)).toFixed(2)}})),console.log("tableData:".concat(JSON.stringify(e))),console.log("oldTableData:".concat(JSON.stringify(this.oldTableData)))},handleGetYear:function(){var e=this;return Object(r["a"])(Object(o["a"])().mark((function t(){var n,a,i,r,c,s,l,u;return Object(o["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(""!==e.queryItems.busiYear){t.next=24;break}if(e.orgCode){t.next=7;break}return t.next=4,e.$apis.bim.curOrg.get({});case 4:n=t.sent,e.bizCode=null===n||void 0===n?void 0:n.bizCode,e.orgCode=null===n||void 0===n?void 0:n.orgUniqueCode;case 7:return a={bizCode:e.appConfig.bizCode,appCode:e.appCode,yearTypeCode:"BIZ_YEAR"},t.next=10,e.$apis.bpm.executionEnter.getBuYear(a);case 10:return i=t.sent,r=(null===i||void 0===i?void 0:i.yearValue)||(new Date).getFullYear(),e.queryItems.busiYear=r,e.bizYear=r,console.log("业务年度".concat(r)),c={busiYear:r},t.next=18,e.$apis.apm.demandManage.queryBatch(c);case 18:s=t.sent,l=(null===s||void 0===s?void 0:s.rows)||[],e.batchList=l,u=l&&l.length>0?l[0].batchName:"",e.queryItems.batchName=u,e.defaultBatchName=u;case 24:case"end":return t.stop()}}),t)})))()},onQuery:function(){var e=this;return Object(r["a"])(Object(o["a"])().mark((function t(){var n,a,i;return Object(o["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.handleGetYear();case 2:n=e.queryItems.batchName,a=e.batchList.find((function(e){return e.batchName===n})),i={busiYear:e.queryItems.busiYear,batchName:n,needCollectBatchId:null===a||void 0===a?void 0:a.needCollectBatchId},e.loading=!0,console.log("调用后端的参数：".concat(JSON.stringify(i))),e.$apis.apm.demandManage.query(i).then((function(t){var n=null===t||void 0===t?void 0:t.rows;console.log("计划量管理：".concat(JSON.stringify(t))),e.oldTableData=s.a.cloneDeep(n);var a=s.a.cloneDeep(n);e.handleUnitParse(a),e.loading=!1})).catch((function(t){e.loading=!1,console.log(t)}));case 8:case"end":return t.stop()}}),t)})))()},handleUnitParse:function(e){var t=this,n=[],a=e;a.forEach((function(e){var a=e;a.crudeWeight=(a.crudeWeight/t.weightUnit).toFixed(2),a.sunCuredWeight=(a.sunCuredWeight/t.weightUnit).toFixed(2),a.rtPlanWeight=(a.rtPlanWeight/t.weightUnit).toFixed(2),n.push(a)})),this.tableData.rows=n},onSave:function(){var e=this;this.saving=!0;var t={pcTNeedCollectPlanAmountMasDTOS:this.oldTableData};console.log("===".concat(JSON.stringify(t))),this.$apis.apm.demandManage.save(t).then((function(t){console.log(JSON.stringify(t)),t.result?(e.saving=!1,e.$message.success("操作成功"),e.onQuery()):(e.saving=!1,e.$message.error("操作失败"))})).catch((function(t){console.log(t),e.saving=!1}))},onCancle:function(){},onDel:function(){var e=this,t=this.$createElement;!this.selectedRows||this.selectedRows.length<=0?this.$message.error("请选择一条数据再删除"):this.$confirm({title:"是否执行该操作?",content:function(){return t("div",{style:"color:red;"},["是否确认删除选中的数据，确认请点击'确认'按钮，取消点击'取消'按钮。"])},onOk:function(){e.loading=!0;for(var t=[],n=0;n<e.selectedRows.length;n++)t.push(e.selectedRows[n].leafColorId);e.$apis.tbm.tabaccoColor.delete({ids:t}).then((function(t){console.log(JSON.stringify(t)),t.result?(e.loading=!1,e.$refs.table.pageAction(1),e.$message.success("操作成功")):e.$message.error("操作失败")})).catch((function(t){e.loading=!1,t?e.$message.error(t.message||"操作失败"):e.$message.error("操作失败")}))}})},onReset:function(){this.onQuery()},selectAllEvent:function(e){var t=e.checked,n=e.records;console.log("".concat(t,"-选中所有records包含选中的所以对象----").concat(JSON.stringify(n))),this.selectedRows=n},selectRowChange:function(e){var t=e.checked,n=e.records;console.log("".concat(t,"-选择改变时会把records包含选中的所以对象----").concat(JSON.stringify(n))),this.selectedRows=n}}},u=l,d=n("2877"),h=Object(d["a"])(u,a,i,!1,null,null,null);t["default"]=h.exports}}]);
//# sourceMappingURL=chunk-2d215ce2.6454ab35.js.map